<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Jest：Snapshot 測試</title>
      <link href="/article/jest-snapshot-testing.html"/>
      <url>/article/jest-snapshot-testing.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/jest.jpg" alt=""></p><p>若想確保 UI 不會因意外修改而產生 bug，snapshot 測試就是一個很好用的工具。</p><a id="more"></a><blockquote><p>其他 Jest 相關文章可參閱 <a href="https://titangene.github.io/tags/jest/">Jest 系列文章</a>。</p></blockquote><h1 id="使用-Jest-進行-snapshot-測試"><a class="header-anchor" href="#使用-Jest-進行-snapshot-測試"></a>使用 Jest 進行 snapshot 測試</h1><p>如果想測試一個 UI 元件，要測的是產生的元素 (可序列化的值，即 HTML 原始碼)，而不是需要花時間渲染出來的畫面 (圖形 UI)。</p><p>下面以連結元件為例，呼叫 <code>rendererLinkElement()</code>，並傳入 URL 和連結名稱就可以取得 renderer 回傳的 HTML：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// src/linkElement.js</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rendererLinkElement</span>(<span class="hljs-params">url, linkName</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;a href="<span class="hljs-subst">$&#123;url&#125;</span>"&gt;<span class="hljs-subst">$&#123;linkName&#125;</span>&lt;/a&gt;`</span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> rendererLinkElement;<br></code></pre></td></tr></table></figure><p>這邊使用 Jest 提供的 <code>toMatchSnapshot()</code> 進行測試：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/externalSnapshots.test.js</span><br>describe(<span class="hljs-string">'external snapshots'</span>, () =&gt; &#123;<br>  it(<span class="hljs-string">'render the link element of the Titangene Blog home page'</span>, () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> url = <span class="hljs-string">'https://titangene.github.io/'</span>;<br>    <span class="hljs-keyword">const</span> linkName = <span class="hljs-string">'Titangene Blog'</span>;<br><br>    <span class="hljs-keyword">const</span> actual = rendererLinkElement(url, linkName);<br><br>    expect(actual).toMatchSnapshot();<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>執行測試：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx jest ./__tests__/externalSnapshots.test.js</span><br> PASS  __tests__/externalSnapshots.test.js<br>  external snapshots<br>    ✓ render the link element of the Titangene Blog home page (3ms)<br><br> › 1 snapshot written.<br>Snapshot Summary<br> › 1 snapshot written from 1 test suite.<br><br>Test Suites: 1 passed, 1 total<br>Tests:       1 passed, 1 total<br>Snapshots:   1 written, 1 total<br>Time:        0.657s, estimated 1s<br>Ran all test suites matching /.\/__tests__\/externalSnapshots.test.js/i.<br></code></pre></td></tr></table></figure><p>第一次執行此測試時，Jest 會在 <code>__tests__</code> 目錄內建立 <code>__snapshots__</code> 目錄，裡面建立一個 snapshot 檔案，檔名會是測試檔的名稱再加上 <code>.snap</code> (例如：<code>externalSnapshots.test.js.snap</code> )，內容如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// Jest Snapshot v1, https://goo.gl/fbAQLP</span><br><br>exports[<span class="hljs-string">`renders correctly 1`</span>] = <span class="hljs-string">`"&lt;a href=\\"https://titangene.github.io/\\"&gt;Titangene Blog&lt;/a&gt;"`</span>;<br></code></pre></td></tr></table></figure><p>之後再次執行測試就會將 render 的輸出與之前的 snapshot 進行比較：</p><ul><li>若 match，測試就會通過</li><li>若不 match，測試就會失敗<ul><li>可能是程式有 bug，或是實作發生變化，需要更新 snapshot</li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx jest ./__tests__/linkElement.test.js</span><br> PASS  __tests__/linkElement.test.js<br>  ✓ renders correctly (4ms)<br><br>Test Suites: 1 passed, 1 total<br>Tests:       1 passed, 1 total<br>Snapshots:   1 passed, 1 total<br>Time:        0.777s, estimated 2s<br>Ran all test suites matching /.\/__tests__\/linkElement.test.js/i.<br></code></pre></td></tr></table></figure><div class="info"><p>snapshot 應與修改的程式碼一起 commit，並在 code review 中進行 review。</p><p>註：Jest 內建提供 <a href="https://github.com/facebook/jest/tree/master/packages/pretty-format" target="_blank" rel="noopener"><code>pretty-format</code></a> 套件，可讓任何 JavaScript 值變成 human-readable 的字串 (序列化 JavaScript 內建型別值)，而 snapshot 就使用了此套件，所以 snapshot 才能在 code review 過程具有可讀性。</p></div><h1 id="更新-snapshot"><a class="header-anchor" href="#更新-snapshot"></a>更新 snapshot</h1><p>剛剛提到，若程式的實作發生變化，snapshot 與程式執行結果可能會不 match，測試就會失敗。</p><p>假設不是因為 bug，是你現在修改的執行結果的確是你要的，但 snapshot 還是之前的預期結果，而你想將 snapshot 換成新的預期結果，這就需要更新 snapshot。</p><p>下面就舉個情境，假設我想將測試修改成這樣：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs diff">it('renders correctly', () =&gt; &#123;<br><span class="hljs-deletion">-  const url = 'https://titangene.github.io/';</span><br><span class="hljs-deletion">-  const linkName = 'Titangene Blog';</span><br><span class="hljs-addition">+  const url = 'https://www.google.com/';</span><br><span class="hljs-addition">+  const linkName = 'Google';</span><br><br>  const actual = rendererLinkElement(url, linkName);<br><br>  expect(actual).toMatchSnapshot();<br>&#125;);<br></code></pre></td></tr></table></figure><p>再次執行測試就會失敗，因為之前 snapshot 儲存的跟現在修改的不 match：</p><p><img src="../images/jest-snapshot-testing/2020-07-13-00-05-47.png" alt=""></p><p>使用 <code>--updateSnapshot</code> (或 <code>-u</code> ) option 就能為失敗的測試重新建立新的 snapshot (通過的測試不會重新建立)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> jest --updateSnapshot</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx jest ./__tests__/linkElement.test.js -u</span><br> PASS  __tests__/linkElement.test.js<br>  ✓ renders correctly (4ms)<br><br> › 1 snapshot updated.<br>Snapshot Summary<br> › 1 snapshot updated from 1 test suite.<br><br>Test Suites: 1 passed, 1 total<br>Tests:       1 passed, 1 total<br>Snapshots:   1 updated, 1 total<br>Time:        0.794s, estimated 1s<br>Ran all test suites matching /.\/__tests__\/linkElement.test.js/i.<br></code></pre></td></tr></table></figure><p>若要指定哪個測試需要重新產生 snapshot，可加上 <code>--testNamePattern=&lt;regex&gt;</code> option：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$ jest -u --testNamePattern=<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">regex</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h1 id="互動式-snapshot-模式"><a class="header-anchor" href="#互動式-snapshot-模式"></a>互動式 snapshot 模式</h1><p>在 watch 模式下，按 <code>i</code> 鍵進入互動式 snapshot 模式 (只有在有 failed snapshot 時，才會看到 <code>i</code> 這個選項)：</p><p><img src="../images/jest-snapshot-testing/2020-07-13-00-13-55.png" alt=""></p><p>此互動式 snapshot 模式是用 failed snapshot 和 failed output，此模式會各別看每個 snapshot，有以下功能：</p><ul><li><code>u</code> (update)：更新失敗的 snapshot</li><li><code>s</code> (skip)：跳過當前測試 (跳至下一個測試)</li><li><code>q</code> (quit)：離開互動式 snapshot 模式</li><li><code>Enter</code>：觸發測試執行 (重跑單前測試)</li></ul><p>只要還有一個 failed snapshot 未更新，就能按 <code>r</code> 鍵重新回到互動式 snapshot 模式：</p><p><img src="../images/jest-snapshot-testing/2020-07-13-00-05-59.png" alt=""></p><p>更新所有 failed snapshot 後，就可按 <code>Enter</code> 回到 watch 模式：</p><p><img src="../images/jest-snapshot-testing/2020-07-13-00-06-03.png" alt=""></p><blockquote><p>可是奇怪的是，原本我執行 Jest 時有指定某個目錄內的測試，當我從互動式 snapshot 模式回到 watch 模式時，竟然之前的指令就失效，所以還會多測其他目錄內的測試 (目前猜測是未被 Git 追蹤的測試檔都會被執行)。</p></blockquote><h1 id="Inline-Snapshots"><a class="header-anchor" href="#Inline-Snapshots"></a>Inline Snapshots</h1><p>inline snapshot 和 external snapshot ( <code>.snap</code> 檔案) 的行為相同，但 inline snapshot 會把 snapshot value 自動寫回原始碼中。不用切換至外部檔案來確保寫入正確的值。</p><div class="warning"><p>inline snapshot 是由 <a href="https://prettier.io/" target="_blank" rel="noopener">Prettier</a> 提供支援，所以必須安裝 Prettier 才能用 inline snapshot。寫測試檔時，請遵守你的 Prettier 配置。</p><p>若你在 Jest 找不到的地方安裝 Prettier，則可用 <a href="https://jestjs.io/docs/en/configuration#prettierpath-string" target="_blank" rel="noopener"><code>prettierPath</code></a> 配置屬性來告訴 Jest。</p><p>如果未安裝 Prettier 就使用 <code>toMatchInlineSnapshot()</code>，會輸出以下錯誤訊息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">FAIL  __tests__/inlineSnapshots.test.js<br> ● Test suite failed to run<br><br>   Cannot find module 'prettier' from 'setup_jest_globals.js'<br><br>     at Resolver.resolveModule (node_modules/jest-resolve/build/index.js:296:11)<br></code></pre></td></tr></table></figure></div><p>安裝 Prettier：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn add prettier --dev --exact</span><br></code></pre></td></tr></table></figure><p>一開始寫測試時，不帶 argument 呼叫 <code>toMatchInlineSnapshot()</code>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/inlineSnapshots.test.js</span><br><span class="hljs-keyword">import</span> rendererLinkElement <span class="hljs-keyword">from</span> <span class="hljs-string">"../src/linkElement"</span>;<br><br>describe(<span class="hljs-string">"inline snapshots"</span>, () =&gt; &#123;<br>  it(<span class="hljs-string">"render the link element of the Titangene Blog home page"</span>, () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> url = <span class="hljs-string">"https://titangene.github.io/"</span>;<br>    <span class="hljs-keyword">const</span> linkName = <span class="hljs-string">"Titangene Blog"</span>;<br><br>    <span class="hljs-keyword">const</span> actual = rendererLinkElement(url, linkName);<br><br>    expect(actual).toMatchInlineSnapshot();<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>執行測試時，Jest 會對 <code>tree</code> 進行評估，且 snapshot 會寫入 <code>toMatchInlineSnapshot()</code> 的 argument：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx jest .__tests__/inlineSnapshots.test.js</span><br> PASS  __tests__/inlineSnapshots.test.js<br>  inline snapshots<br>    ✓ render the link element of the Titangene Blog home page (12ms)<br><br> › 1 snapshot written.<br>Snapshot Summary<br> › 1 snapshot written from 1 test suite.<br><br>Test Suites: 1 passed, 1 total<br>Tests:       1 passed, 1 total<br>Snapshots:   1 written, 1 total<br>Time:        0.909s, estimated 1s<br>Ran all test suites matching /.\/__tests__\/inlineSnapshots.test.js/i.<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript">describe(<span class="hljs-string">"inline snapshots"</span>, () =&gt; &#123;<br>  it(<span class="hljs-string">"render the link element of the Titangene Blog home page"</span>, () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> url = <span class="hljs-string">"https://titangene.github.io/"</span>;<br>    <span class="hljs-keyword">const</span> linkName = <span class="hljs-string">"Titangene Blog"</span>;<br><br>    <span class="hljs-keyword">const</span> actual = rendererLinkElement(url, linkName);<br><br>    expect(actual).toMatchInlineSnapshot(<br>      <span class="hljs-string">`"&lt;a href=\\"https://titangene.github.io/\\"&gt;Titangene Blog&lt;/a&gt;"`</span><br>    );<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>也可在指令使用 <code>--updateSnapshot</code> (或 <code>-u</code> ) option 或在 <code>--watch</code> 模式下按 <code>u</code> 鍵來更新 snapshot。</p><h1 id="Property-Matchers"><a class="header-anchor" href="#Property-Matchers"></a>Property Matchers</h1><p>有時 snapshot 的物件中會有生成一些 field (例如：ID 和 Date)，若對這些物件進行 snapshot，就會在執行時常常發生 snapshot 失敗。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/propertyMatchers.test.js</span><br>describe(<span class="hljs-string">'Property Matchers'</span>, () =&gt; &#123;<br>  it(<span class="hljs-string">'will fail every time'</span>, () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> user = &#123;<br>      name: <span class="hljs-string">'Titan'</span>,<br>      createdAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),<br>      id: <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">20</span>)<br>    &#125;;<br><br>    <span class="hljs-built_in">console</span>.log(user);<br><br>    expect(user).toMatchSnapshot();<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>像上面的測試執行第二次時，snapshot 就會失敗：</p><p><img src="../images/jest-snapshot-testing/2020-07-13-00-06-17.png" alt=""></p><p>所以 Jest 允許你對任何 property 提供 asymmetric matcher。Jest 會在寫入 snapshot 或測試 snapshot 之前，檢查 matcher，然後將 snapshot 儲存至 snapshot 檔案中，而不是 received value：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/propertyMatchers.test.js</span><br>describe(<span class="hljs-string">'Property Matchers'</span>, () =&gt; &#123;<br>  it(<span class="hljs-string">'will check the matchers and pass'</span>, () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> user = &#123;<br>      name: <span class="hljs-string">'Titan'</span>,<br>      createdAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),<br>      id: <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">20</span>)<br>    &#125;;<br><br>    <span class="hljs-built_in">console</span>.log(user);<br><br>    expect(user).toMatchSnapshot(&#123;<br>      createdAt: expect.any(<span class="hljs-built_in">Date</span>),<br>      id: expect.any(<span class="hljs-built_in">Number</span>),<br>    &#125;);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><div class="info"><p>asymmetric matcher：在 <a href="https://jasmine.github.io/tutorials/custom_argument_matchers" target="_blank" rel="noopener">Jasmine</a> 也稱為 argument matcher，可用於建立自己的自訂 matcher 來封裝測試邏輯。</p></div><p>下面是 snapshot 儲存的內容：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/__snapshots__/propertyMatchers.test.js.snap</span><br>exports[<span class="hljs-string">`Property Matchers will check the matchers and pass 1`</span>] = <span class="hljs-string">`</span><br><span class="hljs-string">Object &#123;</span><br><span class="hljs-string">  "createdAt": Any&lt;Date&gt;,</span><br><span class="hljs-string">  "id": Any&lt;Number&gt;,</span><br><span class="hljs-string">  "name": "Titan",</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">`</span>;<br></code></pre></td></tr></table></figure><p>任何非 matcher 的 givin value，會被被明確地檢查並儲存至 snapshot，例如下面測試中的 <code>name</code> property：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/propertyMatchers.test.js</span><br>describe(<span class="hljs-string">'Property Matchers'</span>, () =&gt; &#123;<br>  it(<span class="hljs-string">'will check the values and pass'</span>, () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> user = &#123;<br>      name: <span class="hljs-string">'Titan'</span>,<br>      createdAt: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),<br>      id: <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">20</span>)<br>    &#125;;<br><br>    <span class="hljs-built_in">console</span>.log(user);<br><br>    expect(user).toMatchSnapshot(&#123;<br>      name: <span class="hljs-string">'Titan'</span>,<br>      createdAt: expect.any(<span class="hljs-built_in">Date</span>),<br>      id: expect.any(<span class="hljs-built_in">Number</span>),<br>    &#125;);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>下面是 snapshot 儲存的內容：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/__snapshots__/propertyMatchers.test.js.snap</span><br>exports[<span class="hljs-string">`Property Matchers will check the values and pass 1`</span>] = <span class="hljs-string">`</span><br><span class="hljs-string">Object &#123;</span><br><span class="hljs-string">  "createdAt": Any&lt;Date&gt;,</span><br><span class="hljs-string">  "id": Any&lt;Number&gt;,</span><br><span class="hljs-string">  "name": "Titan",</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">`</span>;<br></code></pre></td></tr></table></figure><p>資料來源：</p><ul><li><a href="https://jestjs.io/docs/en/snapshot-testing" target="_blank" rel="noopener">Snapshot Testing · Jest</a></li><li><a href="https://jestjs.io/blog/2016/07/27/jest-14.html" target="_blank" rel="noopener">Jest 14.0: React Tree Snapshot Testing · Jest</a></li><li><a href="https://benmccormick.org/2016/09/19/testing-with-jest-snapshots-first-impressions/" target="_blank" rel="noopener">Testing with Jest Snapshots: First Impressions | benmccormick.org</a></li><li><a href="https://egghead.io/lessons/javascript-use-jest-s-snapshot-testing-feature?pl=testing-javascript-with-jest-a36c4074" target="_blank" rel="noopener">Use Jest’s Snapshot Testing Feature from @kentcdodds on @eggheadio</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Testing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> Jest </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Unit Testing </tag>
            
            <tag> snapshot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jest：Mock 函數</title>
      <link href="/article/jest-mock-function.html"/>
      <url>/article/jest-mock-function.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/jest.jpg" alt=""></p><p>Jest 提供的 mock 函數可讓你自行決定要 mock 到什麼程度，並且可讓你在呼叫該 mock 函數之後，捕捉呼叫的次數、傳入的參數、使用 <code>new</code> 實例化的 instance，以及你指定要回傳的值，我們可透過這些資訊來測試 mock 函數是否如預期的呼叫。</p><a id="more"></a><blockquote><p>其他 Jest 相關文章可參閱 <a href="https://titangene.github.io/tags/jest/">Jest 系列文章</a>。</p></blockquote><p>有兩種方法來 mock 函數：</p><ul><li>在測試程式碼中使用 mock 函數</li><li>使用<a href="https://jestjs.io/docs/en/manual-mocks" target="_blank" rel="noopener">手動 mock</a> 來覆蓋依賴模組</li></ul><h1 id="使用-mock-函數"><a class="header-anchor" href="#使用-mock-函數"></a>使用 mock 函數</h1><p><code>jest.fn(implementation)</code>：新回傳一個未使用的 mock 函數 ( <code>implementation</code> 為可選的 mock 實作)</p><p>若要測試下面 <code>forEach()</code>，可用 mock 函數，並檢查 mock 的狀態，以確保按預期 invoke callback：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// src/forEach.js</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">forEach</span>(<span class="hljs-params">items, callback</span>) </span>&#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> items) &#123;<br>    callback(item);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/forEach.test.js</span><br><span class="hljs-keyword">import</span> forEach <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/forEach'</span>;<br><br>test(<span class="hljs-string">'forEach'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> mockCallback = jest.fn(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-number">42</span> + x);<br>  forEach([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], mockCallback);<br><br>  <span class="hljs-built_in">console</span>.log(mockCallback.mock.calls);  <span class="hljs-comment">// [[0], [1]]</span><br><br>  expect(mockCallback.mock.calls.length).toBe(<span class="hljs-number">2</span>);<br><br>  expect(mockCallback.mock.calls[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]).toBe(<span class="hljs-number">0</span>);<br>  expect(mockCallback.mock.calls[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]).toBe(<span class="hljs-number">1</span>);<br><br>  expect(mockCallback.mock.results[<span class="hljs-number">0</span>].value).toBe(<span class="hljs-number">42</span>);<br>  expect(mockCallback.mock.results[<span class="hljs-number">1</span>].value).toBe(<span class="hljs-number">43</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="mock-property"><a class="header-anchor" href="#mock-property"></a><code>.mock</code> property</h1><p>所有 mock 函數都有 <code>.mock</code> property，用來儲存如何呼叫函數和回傳函數的資料，此 property 也會追蹤每個呼叫的 <code>this</code> 值：</p><p><code>mockFn.mock.calls</code>：</p><ul><li>回傳一個陣列</li><li>包含對此 mock 函數所有呼叫的呼叫 argument，此陣列中的每個項目都是在呼叫過程中傳遞的 argument 陣列</li><li>例如：有一個 mock 函數被呼叫兩次，第一次被呼叫的 argument 為 <code>f('arg1', 'arg2')</code>，第二次為 <code>f('arg3', 'arg4')</code>，那此 <code>f.mock.calls</code> 會回傳 <code>[['arg1', 'arg2'], ['arg3', 'arg4']]</code></li></ul><p><code>mockFn.mock.results</code>：</p><ul><li>回傳一個陣列</li><li>包含對此 mock 函數所有呼叫的結果，此陣列中的每個項目都是一個包含 <code>type</code> 和 <code>value</code> property 的物件<ul><li><code>type</code> 為以下任一種：<ul><li><code>return</code>：透過正常回傳已完成的呼叫</li><li><code>throw</code>：透過拋出一個值來完成呼叫</li><li><code>incomplete</code>：呼叫尚未完成。若從 mock 函數本身內部或從 mock 呼叫的函數內部測試結果，則會發生這種狀況</li></ul></li><li><code>value</code>：<ul><li>包含拋出的值或回傳值</li><li>當 <code>type === 'incomplete'</code> 時，值為定義</li></ul></li></ul></li></ul><p><code>mockFn.mock.instances</code>：</p><ul><li>回傳一個陣列</li><li>包含使用 <code>new</code> 從此 mock 函數實例化的所有物件 instance</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/mockProperty.test.js</span><br>it(<span class="hljs-string">'mock property'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> fooMockFunction = jest<br>    .fn(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>&#123;<br>      <span class="hljs-keyword">let</span> tmp = <span class="hljs-keyword">this</span>.x || <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">return</span> tmp + x + y;<br>    &#125;);<br><br>  <span class="hljs-keyword">const</span> a = <span class="hljs-keyword">new</span> fooMockFunction(<span class="hljs-string">'first arg'</span>, <span class="hljs-string">'second arg'</span>);<br>  <span class="hljs-built_in">console</span>.log(a);    <span class="hljs-comment">// mockConstructor &#123;&#125;</span><br>  <span class="hljs-built_in">console</span>.log(a.x);  <span class="hljs-comment">// undefined</span><br><br>  <span class="hljs-keyword">const</span> b = &#123;<span class="hljs-attr">x</span>: <span class="hljs-number">10</span>&#125;;<br>  <span class="hljs-keyword">const</span> bound = fooMockFunction.bind(b, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>);<br>  <span class="hljs-built_in">console</span>.log(bound());  <span class="hljs-comment">// 17</span><br><br>  <span class="hljs-built_in">console</span>.log(fooMockFunction.mock);<br>  <span class="hljs-comment">// &#123;</span><br>  <span class="hljs-comment">//   calls: [ [ 1, 2 ], [ 3, 4 ] ],</span><br>  <span class="hljs-comment">//   instances: [ mockConstructor &#123;&#125;, &#123; x: 10 &#125; ],</span><br>  <span class="hljs-comment">//   invocationCallOrder: [ 1, 2 ],</span><br>  <span class="hljs-comment">//   results: [</span><br>  <span class="hljs-comment">//     &#123; type: 'return', value: 3; &#125;,</span><br>  <span class="hljs-comment">//     &#123; type: 'return', value: 17 &#125;</span><br>  <span class="hljs-comment">//   ]</span><br>  <span class="hljs-comment">// &#125;</span><br><br>  <span class="hljs-built_in">console</span>.log(fooMockFunction.mock.instances[<span class="hljs-number">0</span>]);  <span class="hljs-comment">// mockConstructor &#123;&#125;</span><br>  <span class="hljs-built_in">console</span>.log(fooMockFunction.mock.instances[<span class="hljs-number">1</span>]);  <span class="hljs-comment">// &#123; x: 10 &#125;</span><br><br>  <span class="hljs-comment">// 呼叫幾次</span><br>  expect(fooMockFunction.mock.calls.length).toBe(<span class="hljs-number">2</span>);<br><br>  <span class="hljs-comment">// 第幾次呼叫的第幾個 arg</span><br>  expect(fooMockFunction.mock.calls[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]).toBe(<span class="hljs-string">'first arg'</span>);<br>  expect(fooMockFunction.mock.calls[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]).toBe(<span class="hljs-string">'second arg'</span>);<br>  expect(fooMockFunction.mock.calls[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]).toBe(<span class="hljs-number">3</span>);<br>  expect(fooMockFunction.mock.calls[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]).toBe(<span class="hljs-number">4</span>);<br><br>  <span class="hljs-comment">// 第幾次呼叫的回傳值</span><br>  expect(fooMockFunction.mock.results[<span class="hljs-number">1</span>].value).toBe(<span class="hljs-number">17</span>);<br><br>  <span class="hljs-comment">// 此 mock 函數被實例化的次數</span><br>  expect(fooMockFunction.mock.instances.length).toBe(<span class="hljs-number">2</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="mock-回傳值"><a class="header-anchor" href="#mock-回傳值"></a>mock 回傳值</h1><p>使用 mock 函數在測試期間將測試值注入至程式碼中：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/mockReturnValues.test.js</span><br>test(<span class="hljs-string">'mock return values'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> myMock = jest.fn();<br>  <span class="hljs-built_in">console</span>.log(myMock());  <span class="hljs-comment">// undefined</span><br><br>  myMock<br>    .mockReturnValueOnce(<span class="hljs-number">10</span>)<br>    .mockReturnValueOnce(<span class="hljs-string">'x'</span>)<br>    .mockReturnValue(<span class="hljs-literal">true</span>);<br><br>  expect(myMock()).toBe(<span class="hljs-number">10</span>);<br>  expect(myMock()).toBe(<span class="hljs-string">'x'</span>);<br>  expect(myMock()).toBe(<span class="hljs-literal">true</span>);<br>  expect(myMock()).toBe(<span class="hljs-literal">true</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>這種寫法可避免需要複雜的 stub 來重新建立實際元件的行為，利於在使用前將值直接注入到測試中。</p><div class="info"><p>Test stub：回傳固定值的實作</p><p>資料來源：<a href="http://teddy-chen-tw.blogspot.com/2014/09/test-double2.html" target="_blank" rel="noopener">搞笑談軟工: Test Double（2）：五種替身簡介</a></p></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs javascript">test(<span class="hljs-string">'mock return values'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> myMock = jest.fn();<br>  <span class="hljs-built_in">console</span>.log(myMock());  <span class="hljs-comment">// undefined</span><br><br>  myMock<br>    .mockReturnValueOnce(<span class="hljs-number">10</span>)<br>    .mockReturnValueOnce(<span class="hljs-string">'x'</span>)<br>    .mockReturnValue(<span class="hljs-literal">true</span>);<br><br>  expect(myMock()).toBe(<span class="hljs-number">10</span>);<br>  expect(myMock()).toBe(<span class="hljs-string">'x'</span>);<br>  expect(myMock()).toBe(<span class="hljs-literal">true</span>);<br>  expect(myMock()).toBe(<span class="hljs-literal">true</span>);<br>&#125;);<br><br>test(<span class="hljs-string">'filter mock function return values'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> filterTestFn = jest.fn();<br><br>  filterTestFn<br>    .mockReturnValueOnce(<span class="hljs-literal">true</span>)<br>    .mockReturnValueOnce(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">const</span> result = [<span class="hljs-number">11</span>, <span class="hljs-number">12</span>].filter(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> filterTestFn(num));<br>  expect(result).toMatchObject([<span class="hljs-number">11</span>]);<br>  expect(filterTestFn.mock.calls[<span class="hljs-number">0</span>]).toMatchObject([<span class="hljs-number">11</span>]);<br>  expect(filterTestFn.mock.calls[<span class="hljs-number">1</span>]).toMatchObject([<span class="hljs-number">12</span>]);<br>&#125;);<br></code></pre></td></tr></table></figure><p>儘量避免在沒有直接測試的函數內部實作邏輯。</p><h1 id="mocking-模組"><a class="header-anchor" href="#mocking-模組"></a>mocking 模組</h1><p>假設有一個從 API fetch 使用者的 class，該 class 使用 <a href="https://github.com/axios/axios" target="_blank" rel="noopener"><code>axios</code></a> 呼叫 API，然後回傳包含所有使用者的 <code>data</code> 屬性：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// src/users.js</span><br><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Users</span> </span>&#123;<br>  <span class="hljs-keyword">static</span> all() &#123;<br>    <span class="hljs-keyword">return</span> axios.get(<span class="hljs-string">'https://jsonplaceholder.typicode.com/users'</span>)<br>      .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.data);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Users;<br></code></pre></td></tr></table></figure><p>若要在不實際打 API 的情況下測試該方法，可用 <code>jest.mock()</code> 自動 mock <code>axios</code> 模組。</p><p>接著使用 <code>mockResolvedValue()</code> 來 mock <code>axios.get</code>。只要測試呼叫了 <code>axios.get()</code>，就會回傳 fake response，以便於我們來 assert 資料：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/mockingModule.test.js</span><br><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;<br><span class="hljs-keyword">import</span> Users <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/users'</span>;<br><br>jest.mock(<span class="hljs-string">'axios'</span>);<br><br>test(<span class="hljs-string">'should fetch users'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> expected = [&#123;<span class="hljs-attr">name</span>: <span class="hljs-string">'Titan'</span>&#125;];<br>  <span class="hljs-keyword">const</span> response = &#123;<span class="hljs-attr">data</span>: expected&#125;;<br><br>  axios.get.mockResolvedValue(response);<br>  <span class="hljs-comment">// 上一行等同於：</span><br>  <span class="hljs-comment">// axios.get.mockImplementation(() =&gt; Promise.resolve(resp))</span><br><br>  <span class="hljs-keyword">return</span> Users.all()<br>    .then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> expect(data).toEqual(expected));<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="Mock-Implementations"><a class="header-anchor" href="#Mock-Implementations"></a>Mock Implementations</h1><p>指定回傳值，以及完全替換 mock 函數的實作，可透過 <code>jest.fn</code> 或 <code>mock</code> 函數上的 <code>mockImplementationOnce()</code> 來完成：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/mockImplementation.test.js</span><br>describe(<span class="hljs-string">'使用 `jest.fn()` 建立 mock 函數'</span>, () =&gt; &#123;<br>  it(<span class="hljs-string">'mock 函數'</span>, () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> myMockFn = jest.fn(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> callback(<span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>));<br>    myMockFn(<span class="hljs-function">(<span class="hljs-params">err, val</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(val));<br><br>    expect(myMockFn).toBeCalledTimes(<span class="hljs-number">1</span>);<br>    expect(myMockFn).lastCalledWith(expect.any(<span class="hljs-built_in">Function</span>));<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>可用 <code>mockImplementationOnce()</code> 來定義 mock 函數的預設實作：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/mockImplementation.test.js</span><br><span class="hljs-keyword">import</span> foo <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/foo'</span>;<br><br>jest.mock(<span class="hljs-string">'../src/foo'</span>);<br><br>describe(<span class="hljs-string">'mock module'</span>, () =&gt; &#123;<br>  it(<span class="hljs-string">'mock foo module'</span>, () =&gt; &#123;<br>    foo.mockImplementation(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-number">42</span>);<br>    foo();<br><br>    expect(foo).toBeCalledTimes(<span class="hljs-number">1</span>);<br>    expect(foo).toReturnWith(<span class="hljs-number">42</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>若要讓 mock 函數多次呼叫會產生不同的結果，也可用 <code>mockImplementationOnce()</code> 來定義。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/mockImplementation.test.js</span><br>describe(<span class="hljs-string">'mock 函數呼叫多次時，會產生不同的結果'</span>, () =&gt; &#123;<br>  it(<span class="hljs-string">'第一次呼叫回傳 `true`，第二次回傳 `false`，之後都不回傳'</span>, () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> myMockFn = jest.fn()<br>      .mockImplementationOnce(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> callback(<span class="hljs-literal">true</span>))<br>      .mockImplementationOnce(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> callback(<span class="hljs-literal">false</span>));<br><br>    myMockFn(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> value);<br>    myMockFn(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> value);<br>    myMockFn(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> value);<br>    myMockFn(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> value);<br><br>    expect(myMockFn).toBeCalledTimes(<span class="hljs-number">4</span>);<br>    expect(myMockFn).nthReturnedWith(<span class="hljs-number">1</span>, <span class="hljs-literal">true</span>);<br>    expect(myMockFn).nthReturnedWith(<span class="hljs-number">2</span>, <span class="hljs-literal">false</span>);<br>    expect(myMockFn).nthReturnedWith(<span class="hljs-number">3</span>);<br>    expect(myMockFn).nthReturnedWith(<span class="hljs-number">4</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>當 mock 函數執行完 <code>mockImplementationOnce()</code> 定義的實作時，會執行 <code>jest.fn</code> (若已定義) 的預設實作集合：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/mockImplementation.test.js</span><br>describe(<span class="hljs-string">'mock 函數呼叫多次時，會產生不同的結果'</span>, () =&gt; &#123;<br>  it(<span class="hljs-string">'第一次呼叫回傳 `first call`，第二次回傳 `second call`，之後都回傳 `default`'</span>, () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> myMockFn = jest.fn(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-string">'default'</span>)<br>      .mockImplementationOnce(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-string">'first call'</span>)<br>      .mockImplementationOnce(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-string">'second call'</span>);<br><br>    myMockFn();<br>    myMockFn();<br>    myMockFn();<br>    myMockFn();<br><br>    expect(myMockFn).toBeCalledTimes(<span class="hljs-number">4</span>);<br>    expect(myMockFn).nthReturnedWith(<span class="hljs-number">1</span>, <span class="hljs-string">'first call'</span>);<br>    expect(myMockFn).nthReturnedWith(<span class="hljs-number">2</span>, <span class="hljs-string">'second call'</span>);<br>    expect(myMockFn).nthReturnedWith(<span class="hljs-number">3</span>, <span class="hljs-string">'default'</span>);<br>    expect(myMockFn).nthReturnedWith(<span class="hljs-number">4</span>, <span class="hljs-string">'default'</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>若要回傳 <code>this</code>，可用 sugary API <code>.mockReturnThis()</code> 來簡化方法。</p><p>下面是相同的兩種寫法：</p><ul><li>使用 <code>.mockReturnThis()</code></li><li>使用 <code>jest.fn()</code> 自己實作 mock 函數要回傳 <code>this</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/mockImplementation.test.js</span><br>describe.only(<span class="hljs-string">'mock 函數回傳 `this`'</span>, () =&gt; &#123;<br>  it(<span class="hljs-string">'使用 `mockReturnThis()`'</span>, () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> myObj = &#123;<br>      myMethod: jest.fn().mockReturnThis()<br>    &#125;;<br><br>    myObj.myMethod();<br><br>    expect(myObj.myMethod).toBeCalledTimes(<span class="hljs-number">1</span>);<br>    expect(myObj.myMethod).toReturnWith(myObj);<br>  &#125;);<br><br>  it(<span class="hljs-string">'使用 `jest.fn()` 實作'</span>, () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> myObj = &#123;<br>      myMethod: jest.fn(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<br>      &#125;)<br>    &#125;;<br><br>    myObj.myMethod();<br><br>    expect(myObj.myMethod).toBeCalledTimes(<span class="hljs-number">1</span>);<br>    expect(myObj.myMethod).toReturnWith(myObj);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="mock-名稱"><a class="header-anchor" href="#mock-名稱"></a>mock 名稱</h1><p>可為 mock 函數命名，可在測試錯誤的輸出中顯示名稱，而不是 <code>jest.fn()</code>。若想快速識別 mock 函數，並在測試輸出中 report 錯誤，可用此方式：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript">describe(<span class="hljs-string">'mock 名稱'</span>, () =&gt; &#123;<br>  it.only(<span class="hljs-string">'設定 mock 名稱'</span>, () =&gt; &#123;<br>    <span class="hljs-keyword">const</span> myMockFn = jest.fn()<br>      .mockImplementation(<span class="hljs-function"><span class="hljs-params">scalar</span> =&gt;</span> <span class="hljs-number">42</span> + scalar)<br>      .mockName(<span class="hljs-string">'add42'</span>);<br><br>    myMockFn(<span class="hljs-number">10</span>);<br>    myMockFn(<span class="hljs-number">10</span>);<br>    myMockFn(<span class="hljs-number">10</span>);<br><br>    expect(myMockFn).toBeCalledTimes(<span class="hljs-number">3</span>);<br>    expect(myMockFn).toReturnWith(<span class="hljs-number">52</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>若沒設定 mock 函數名稱，測試錯誤時會像這樣：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">FAIL week-05/__tests__/mockName.test.js<br><br>  ● mock 名稱 › 設定 mock 名稱<br><br>    expect(jest.fn()).toReturnWith(expected)<br>    ...<br></code></pre></td></tr></table></figure><p>若有設定名稱就會像這樣：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">FAIL week-05/__tests__/mockName.test.js<br><br>  ● mock 名稱 › 設定 mock 名稱<br><br>    expect(add42).toReturnWith(expected)<br>    ...<br></code></pre></td></tr></table></figure><h1 id="自訂-matcher"><a class="header-anchor" href="#自訂-matcher"></a>自訂 matcher</h1><p>下面是 mock 函數會用到的 matcher，這些都是語法糖：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// mock 函數被呼叫的次數</span><br>expect(mockFunc).toBeCalledTimes(<span class="hljs-number">4</span>);<br><br><span class="hljs-comment">// mock 函數至少被呼叫一次</span><br>expect(mockFunc).toBeCalled();<br>expect(mockFunc).toHaveBeenCalled();<br><br><span class="hljs-comment">// 至少一次呼叫 mock 函數所指定的 args</span><br>expect(mockFunc).toBeCalledWith(arg1, arg2);<br>expect(mockFunc).toHaveBeenCalledWith(arg1, arg2);<br><br><span class="hljs-comment">// 最後一次呼叫 mock 函數所指定的 args</span><br>expect(mockFunc).lastCalledWith(arg1, arg2);<br>expect(mockFunc).toHaveBeenLastCalledWith(arg1, arg2);<br><br><span class="hljs-comment">// 所有呼叫和 mock 的名稱都寫成 snapshot</span><br>expect(mockFunc).toMatchSnapshot();<br></code></pre></td></tr></table></figure><p>這些 matcher 是檢查 <code>.mock</code> property 的常見形式的 sugar。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// mock 函數被呼叫的次數</span><br>expect(mockFunc.mock.calls.length).toBe(<span class="hljs-number">4</span>);<br><br><span class="hljs-comment">// mock 函數至少被呼叫一次</span><br>expect(mockFunc.mock.calls.length).toBeGreaterThan(<span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 至少一次呼叫 mock 函數所指定的 args</span><br>expect(mockFunc.mock.calls).toContainEqual([arg1, arg2]);<br><br><span class="hljs-comment">// 最後一次呼叫 mock 函數所指定的 args</span><br>expect(mockFunc.mock.calls[mockFunc.mock.calls.length - <span class="hljs-number">1</span>]).toEqual([<br>  arg1,<br>  arg2,<br>]);<br><br><span class="hljs-comment">// 最後一次呼叫 mock 函數的第一個 arg 是 `42` (此 assert 沒有語法糖)</span><br>expect(mockFunc.mock.calls[mockFunc.mock.calls.length - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>]).toBe(<span class="hljs-number">42</span>);<br><br><span class="hljs-comment">// snapshot 會檢查 mock 是否以相同的順序、相同的 arg 被呼叫相同的次數</span><br>expect(mockFunc.mock.calls).toEqual([[arg1, arg2]]);<br><br><span class="hljs-comment">// assert mock 函數的名稱</span><br>expect(mockFunc.getMockName()).toBe(<span class="hljs-string">'a mock name'</span>);<br></code></pre></td></tr></table></figure><p>例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/customMatcher.test.js</span><br>it(<span class="hljs-string">'custom matcher'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> mockFunc = jest.fn(<span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> x + y)<br>    .mockName(<span class="hljs-string">'mockFunc'</span>);<br><br>  mockFunc(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br>  mockFunc();<br>  mockFunc(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>);<br><br>  <span class="hljs-comment">// mock 函數被呼叫的次數</span><br>  expect(mockFunc).toBeCalledTimes(<span class="hljs-number">3</span>);<br>  expect(mockFunc.mock.calls.length).toBe(<span class="hljs-number">3</span>);<br><br>  <span class="hljs-comment">// mock 函數至少被呼叫一次</span><br>  expect(mockFunc).toBeCalled();<br>  expect(mockFunc.mock.calls.length).toBeGreaterThan(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-comment">// 至少一次呼叫 mock 函數所指定的 args</span><br>  expect(mockFunc).toBeCalledWith(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br>  expect(mockFunc).toBeCalledWith(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>);<br>  expect(mockFunc.mock.calls).toContainEqual([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]);<br>  expect(mockFunc.mock.calls).toContainEqual([<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);<br><br>  <span class="hljs-comment">// 最後一次呼叫 mock 函數所指定的 args</span><br>  expect(mockFunc).lastCalledWith(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>);<br>  expect(mockFunc.mock.calls[mockFunc.mock.calls.length - <span class="hljs-number">1</span>]).toEqual([<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);<br><br>  <span class="hljs-comment">// 最後一次呼叫 mock 函數的第一個 arg 是 `3` (此 assert 沒有語法糖)</span><br>  expect(mockFunc.mock.calls[mockFunc.mock.calls.length - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>]).toBe(<span class="hljs-number">3</span>);<br><br>  <span class="hljs-comment">// snapshot 會檢查 mock 是否以相同的順序、相同的 arg 被呼叫相同的次數</span><br>  expect(mockFunc.mock.calls).toEqual([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]]);<br><br>  <span class="hljs-comment">// assert mock 函數的名稱</span><br>  expect(mockFunc.getMockName()).toBe(<span class="hljs-string">'mockFunc'</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>資料來源：</p><ul><li><a href="https://jestjs.io/docs/en/mock-functions" target="_blank" rel="noopener">Mock Functions · Jest</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Testing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> Jest </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Unit Testing </tag>
            
            <tag> mock </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jest：非同步測試</title>
      <link href="/article/jest-async-test.html"/>
      <url>/article/jest-async-test.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/jest.jpg" alt=""></p><p>處理 JS 非同步的常見作法包括 callback、ES6 的 <code>Promise</code> 以及 ES7 的 <code>async</code> 和 <code>await</code>，而本篇會分別說明如何在 Jest 使用這些 JS 特性來測試非同步程式碼。</p><a id="more"></a><blockquote><p>其他 Jest 相關文章可參閱 <a href="https://titangene.github.io/tags/jest/">Jest 系列文章</a>。</p></blockquote><h2 id="Callbacks"><a class="header-anchor" href="#Callbacks"></a>Callbacks</h2><p>假設你要測下面這個函數，我使用 <code>setTimeout</code> 來模擬發 API 需要花一段時間，若 API 發送成功就會呼叫你傳入的 callback 函數，在呼叫 callback 時會傳入 <code>'hi'</code>，代表從 API 拿到的資料：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// src/fetchData.js</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchData</span>(<span class="hljs-params">callback</span>) </span>&#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- fetchData: Start ---`</span>);<br>  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    callback(<span class="hljs-string">'hi'</span>);<br>  &#125;, <span class="hljs-number">1000</span>);<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- fetchData: End ---`</span>);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> fetchData;<br></code></pre></td></tr></table></figure><p>而我們要測試的就是呼叫 <code>fetchData()</code> 所傳入的 callback 有無正確的呼叫，並且傳入 callback 的資料是否為 <code>&quot;hi&quot;</code>。也許你會這樣寫測試：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/async.test.js</span><br><span class="hljs-keyword">import</span> fetchData <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/async'</span>;<br><br>test(<span class="hljs-string">'同步執行 callback 回傳 hi'</span>, () =&gt; &#123;<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callback</span>(<span class="hljs-params">data</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`---callback: Start---`</span>);<br>    expect(data).toBe(<span class="hljs-string">'hi'</span>);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`---callback: End---`</span>);<br>  &#125;<br><br>  fetchData(callback);<br>&#125;);<br></code></pre></td></tr></table></figure><p>執行測試後，測試通過了，但感覺怪怪的！為什麼測試內的 <code>callback()</code> 沒有執行到？</p><p><img src="../images/jest-async-test/2020-06-28-22-55-49.png" alt=""></p><p>因為 Jest 測試只要跑到最後一行的 <code>fetchData(..)</code> 就會結束，裡面執行的非同步處理 (即模擬發 API 的 <code>setTimeout</code> ) 根本還沒處理完，Jest 測試就會在 callback 呼叫之前就結束了。</p><p>Jest 提供一種建議：使用 <code>test()</code> 時不要用 empty argument，而是用名為 <code>done</code> 的 argument。Jest 就會等到 <code>done</code> callback 被呼叫時才會結束測試。這樣就能確保測試是在你決定的地方結束 ( <code>done</code>，雙關)：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/async.test.js</span><br><span class="hljs-keyword">import</span> fetchData <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/async'</span>;<br><br>test(<span class="hljs-string">'非同步執行 callback 回傳 hi'</span>, done =&gt; &#123;<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callback</span>(<span class="hljs-params">data</span>) </span>&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`---callback: Start---`</span>);<br>    expect(data).toBe(<span class="hljs-string">'hi'</span>);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`---callback: End---`</span>);<br>    done();<br>  &#125;<br><br>  fetchData(callback);<br>&#125;);<br></code></pre></td></tr></table></figure><p><img src="../images/jest-async-test/2020-06-28-23-07-10.png" alt=""></p><p>若 <code>test()</code> 使用了 <code>done</code> argument，但沒有呼叫 <code>done()</code>，測試就會失敗 (帶有 timeout error)：</p><p><img src="../images/jest-async-test/2020-06-28-23-09-02.png" alt=""></p><div class="info"><p>錯誤訊息是說這個測試沒有在 timeout 內 invoke 非同步的 callback。</p><p>至於 timeout 的時間預設為 5 秒，若要自訂 <code>test()</code> 的 timeout，可自行加上第三個 arg (單位為豪秒)。像下面是自訂 timeout 為 3 秒：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">test(<span class="hljs-string">'test name'</span>, () =&gt; &#123;<br>  <span class="hljs-comment">// some test code...</span><br>&#125;, <span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參閱 <a href="https://titangene.github.io/article/jest-describe-test-case.html#test-name-fn-timeout">Jest：Describe &amp; Test case</a> 的「<code>test(name, fn, timeout)</code>」段落。</p></blockquote></div><p>如果 <code>expect</code> 陳述句失敗，就會拋出錯誤，並且不會呼叫 <code>done()</code>。若想在測試輸出結果看到失敗的原因，就要用 <code>try</code> 區塊把 <code>expect</code> 包起來，並在 <code>catch</code> 區塊中接收錯誤。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/async.test.js</span><br><span class="hljs-keyword">import</span> fetchData <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/async'</span>;<br><br>test(<span class="hljs-string">'非同步執行 callback 回傳 hi'</span>, done =&gt; &#123;<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callback</span>(<span class="hljs-params">data</span>) </span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`---callback: Start---`</span>);<br>      expect(data).toBe(<span class="hljs-string">'hi~~~'</span>);<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`---callback: End---`</span>);<br>      done();<br>    &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>      done(error);<br>    &#125;<br>  &#125;<br><br>  fetchData(callback);<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="Promise"><a class="header-anchor" href="#Promise"></a>Promise</h2><p>如果測試回傳一個 promise，Jest 會等待這個 promise 的 resolve。如果 promise 被 reject，測試會自動失敗。</p><p>一定要回傳 promise：如果省略了 <code>return</code> 陳述句，測試會在 <code>promiseFetchData</code> 回傳的 promise 被 resolve，並且 <code>then()</code> 有機會執行 callback 之前完成。</p><p>例如：下面範例的測試不會等到 promise 內的 <code>setTimeout()</code> 跑完就會立即完成測試：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// src/fetchData.js</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">promiseFetchData</span>(<span class="hljs-params">option</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- Promise: Start ---`</span>);<br>    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (option.flag === <span class="hljs-string">'success'</span>) resolve(<span class="hljs-string">'hi'</span>);<br>      <span class="hljs-keyword">if</span> (option.flag === <span class="hljs-string">'fail'</span>) reject(<span class="hljs-string">'error'</span>);<br>    &#125;, <span class="hljs-number">3000</span>);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- Promise: End ---`</span>);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/async.test.js</span><br><span class="hljs-keyword">import</span> promiseFetchData <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/fetchData'</span>;<br><br>test(<span class="hljs-string">'回傳的 promise resolve 資料為 hi'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">return</span> promiseFetchData(&#123; <span class="hljs-attr">flag</span>: <span class="hljs-string">'success'</span> &#125;).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- then: Start ---`</span>);<br>    expect(data).toBe(<span class="hljs-string">'hi'</span>);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- then: End ---`</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>所以如果省略了 <code>return</code> 陳述句，下面範例的 <code>'hi XD'</code> 雖然跟 <code>data</code> 真正拿到的值不同，但測試還是會通過：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/async.test.js</span><br><span class="hljs-keyword">import</span> promiseFetchData <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/fetchData'</span>;<br><br>test(<span class="hljs-string">'回傳的 promise resolve 資料為 hi'</span>, () =&gt; &#123;<br>  promiseFetchData(&#123; <span class="hljs-attr">flag</span>: <span class="hljs-string">'success'</span> &#125;).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- then: Start ---`</span>);<br>    expect(data).toBe(<span class="hljs-string">'hi'</span>);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- then: End ---`</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>若想讓 promise 被 reject，可用 <code>.catch</code> 方法。記得要加上 <code>expect.assertions</code> 來驗證是否呼叫一定數量的 assertions。否則一個 fulfilled promise 不會讓錯誤失敗：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/async.test.js</span><br><span class="hljs-keyword">import</span> promiseFetchData <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/fetchData'</span>;<br><br>test(<span class="hljs-string">'promise reject 的錯誤訊息為 error'</span>, () =&gt; &#123;<br>  expect.assertions(<span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">return</span> promiseFetchData(&#123; <span class="hljs-attr">flag</span>: <span class="hljs-string">'fail'</span> &#125;).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- catch: Start ---`</span>);<br>    expect(e).toMatch(<span class="hljs-string">'error'</span>);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- catch: End ---`</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="resolves-rejects"><a class="header-anchor" href="#resolves-rejects"></a><code>.resolves</code> / <code>.rejects</code></h2><p>也可在 <code>expect</code> 陳述句中使用 <code>.resolves</code> matcher，Jest 會等待 promise 的 resolve。如果 promise 被 reject，測試會自動失敗。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/async.test.js</span><br><span class="hljs-keyword">import</span> promiseFetchData <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/fetchData'</span>;<br><br>test(<span class="hljs-string">'使用 resolves matcher'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">return</span> expect(promiseFetchData(&#123; <span class="hljs-attr">flag</span>: <span class="hljs-string">'success'</span> &#125;)).resolves.toBe(<span class="hljs-string">'hi'</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>一定要回傳 assertion：如果省略了 <code>return</code> 陳述句，測試會在 <code>promiseFetchData</code> 回傳的 promise 被 resolve，並且 <code>then()</code> 有機會執行 callback 之前完成。</p><p>若想讓 promise 被 reject，可用 <code>.rejects</code> matcher。如果 promise 是 fulfilled，測試就會自動失敗：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/async.test.js</span><br><span class="hljs-keyword">import</span> promiseFetchData <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/fetchData'</span>;<br><br>test(<span class="hljs-string">'使用 rejects matcher'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">return</span> expect(promiseFetchData(&#123; <span class="hljs-attr">flag</span>: <span class="hljs-string">'fail'</span> &#125;)).rejects.toMatch(<span class="hljs-string">'error'</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="Async-Await"><a class="header-anchor" href="#Async-Await"></a>Async/Await</h2><p>也可用 <code>async</code> 和 <code>await</code>。在傳給測試函數前加上 <code>async</code> 關鍵字：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/async.test.js</span><br><span class="hljs-keyword">import</span> promiseFetchData <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/fetchData'</span>;<br><br>test(<span class="hljs-string">'使用 await resolves'</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> promiseFetchData(&#123; <span class="hljs-attr">flag</span>: <span class="hljs-string">'success'</span> &#125;);<br>  expect(data).toBe(<span class="hljs-string">'hi'</span>);<br>&#125;);<br><br>test(<span class="hljs-string">'使用 await rejects'</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>  expect.assertions(<span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">await</span> promiseFetchData(&#123; <span class="hljs-attr">flag</span>: <span class="hljs-string">'fail'</span> &#125;);<br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    expect(e).toMatch(<span class="hljs-string">'error'</span>);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>也可將 <code>async</code> 和 <code>await</code> 與 <code>.resolves</code> 和 <code>.rejects</code> matcher 結合使用：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/async.test.js</span><br><span class="hljs-keyword">import</span> promiseFetchData <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/fetchData'</span>;<br><br>test(<span class="hljs-string">'使用 await 和 resolves matcher'</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">await</span> expect(promiseFetchData(&#123; <span class="hljs-attr">flag</span>: <span class="hljs-string">'success'</span> &#125;)).resolves.toBe(<span class="hljs-string">'hi'</span>);<br>&#125;);<br><br>test(<span class="hljs-string">'使用 await 和 rejects matcher'</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">await</span> expect(promiseFetchData(&#123; <span class="hljs-attr">flag</span>: <span class="hljs-string">'fail'</span> &#125;)).rejects.toMatch(<span class="hljs-string">'error'</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>資料來源：<a href="https://jestjs.io/docs/en/asynchronous" target="_blank" rel="noopener">Testing Asynchronous Code · Jest</a></p>]]></content>
      
      
      <categories>
          
          <category> Testing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> Jest </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Unit Testing </tag>
            
            <tag> async </tag>
            
            <tag> promise </tag>
            
            <tag> callback </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jest：Setup &amp; Teardown</title>
      <link href="/article/jest-setup-teardown.html"/>
      <url>/article/jest-setup-teardown.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/jest.jpg" alt=""></p><p>每個測試案例都必須是獨立的，不能互相影響，而解決方法就是讓每個測試在執行前進行重設，或在每個測試結束後清除痕跡。在 Jest，提供 setup 和 teardown 的函數，能讓你自訂在執行 <code>describe</code> 區塊或 <code>test</code> 區塊的前後分別要做什麼準備和收尾。</p><a id="more"></a><blockquote><p>其他 Jest 相關文章可參閱 <a href="https://titangene.github.io/tags/jest/">Jest 系列文章</a>。</p></blockquote><h1 id="測試案例互相汙染"><a class="header-anchor" href="#測試案例互相汙染"></a>測試案例互相汙染</h1><p>一開始寫測試時，可能會發生測試案例互相汙染的問題。</p><p>例如：有一個城市資料庫，提供初始化、清除、新增以及檢查是否已存在資料庫內這些功能：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// src/cityDB.js</span><br><span class="hljs-keyword">let</span> cityDB = [];<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initCityDB</span>(<span class="hljs-params"></span>) </span>&#123;<br>  cityDB = [<span class="hljs-string">'Taipei'</span>, <span class="hljs-string">'Tainan'</span>];<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearCityDB</span>(<span class="hljs-params"></span>) </span>&#123;<br>  cityDB = [];<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addCity</span>(<span class="hljs-params">city</span>) </span>&#123;<br>  cityDB.push(city);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isCity</span>(<span class="hljs-params">city</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> cityDB.includes(city);<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123;<br>  initCityDB,<br>  clearCityDB,<br>  addCity,<br>  isCity<br>&#125;<br></code></pre></td></tr></table></figure><p>如果測試寫起來像這樣會發現，第一個測試操作的步驟會影響到第二個測試 (所以第二個測試不用初始化 DB 和新增城市就已經擁有該城市，看起來很奇怪吧？)：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/unusedBeforeEachAndAfterEach.test.js</span><br><span class="hljs-keyword">import</span> &#123;<br>  initCityDB,<br>  isCity,<br>  addCity<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../../src/cityDB'</span>;<br><br>describe(<span class="hljs-string">'未使用 beforeEach 和 afterEach'</span>, () =&gt; &#123;<br>  describe(<span class="hljs-string">'測試案例會互相汙染'</span>, () =&gt; &#123;<br>    test(<span class="hljs-string">'新增 Kaohsiung'</span>, () =&gt; &#123;<br>      initCityDB();<br>      expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeFalsy();<br>      addCity(<span class="hljs-string">'Kaohsiung'</span>);<br>      expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeTruthy();<br>    &#125;);<br><br>    test(<span class="hljs-string">'第二個測試案例未重新設定，所以有 Kaohsiung'</span>, () =&gt; &#123;<br>      expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeTruthy();<br>    &#125;);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>所以你可能會手動處理初始化和清除的工作：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/unusedBeforeEachAndAfterEach.test.js</span><br><span class="hljs-keyword">import</span> &#123;<br>  initCityDB,<br>  clearCityDB,<br>  isCity,<br>  addCity<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../../src/cityDB'</span>;<br><br>describe(<span class="hljs-string">'未使用 beforeEach 和 afterEach'</span>, () =&gt; &#123;<br>  describe(<span class="hljs-string">'手動在每個測試案例重複設定'</span>, () =&gt; &#123;<br>    test(<span class="hljs-string">'新增 Kaohsiung'</span>, () =&gt; &#123;<br>      initCityDB();<br>      expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeFalsy();<br>      addCity(<span class="hljs-string">'Kaohsiung'</span>);<br>      expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeTruthy();<br>      clearCityDB();<br>    &#125;);<br>    <br>    test(<span class="hljs-string">'第二個測試案例有重新設定，所以預設沒有 Kaohsiung'</span>, () =&gt; &#123;<br>      initCityDB();<br>      expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeFalsy();<br>      clearCityDB();<br>    &#125;);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>但每次都要手動處理這些問題很麻煩，所以在寫測試時常需要：</p><ul><li>在測試執行前進行一些設定工作</li><li>在測試執行後進行一些收尾工作</li></ul><h1 id="多次測試的重複設定：beforeEach、afterEach"><a class="header-anchor" href="#多次測試的重複設定：beforeEach、afterEach"></a>多次測試的重複設定：<code>beforeEach</code>、<code>afterEach</code></h1><p>每個測試案例都要進行一些設定，可用 <code>beforeEach</code> 和 <code>afterEach</code>：</p><ul><li><code>beforeEach(fn, timeout)</code>：<ul><li>在執行此檔案中的每個測試之前執行 <code>fn</code> 函數</li><li>若 <code>fn</code> 函數回傳 promise 或 generator，Jest 會在執行測試之前等待該 promise resolve</li><li>若 <code>beforeEach</code> 放在 <code>describe</code> 區塊內，就只會在此區塊內的測試之前執行</li><li>例如：重置每個測試要使用的全域狀態</li></ul></li><li><code>afterEach(fn, timeout)</code>：<ul><li>在執行此檔案中的每個測試之後執行 <code>fn</code> 函數</li><li>若 <code>fn</code> 函數回傳 promise 或 generator，Jest 會等待該 promise resolve 後才會繼續</li><li>若 <code>afterEach</code> 放在 <code>describe</code> 區塊內，就只會在此區塊內的測試之後執行</li><li>例如：清除每個測試建立的某些臨時狀態</li></ul></li></ul><div class="info"><p><code>timeout</code> 是可選參數，可提供 timeout 來指定 <code>beforeEach</code> 或 <code>afterEach</code> 中止前要等待的時間，單位為豪秒，預設為 5 秒。</p></div><h2 id="同步的重複設定"><a class="header-anchor" href="#同步的重複設定"></a>同步的重複設定</h2><p>例如：要在每個測試案例執行之前呼叫 <code>initCityDB()</code>，並在每個測試案例執行之後呼叫 <code>clearCityDB()</code>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/repeatSetupForManyTests/sync.test.js</span><br><span class="hljs-keyword">import</span> &#123;<br>  addCity,<br>  clearCityDB,<br>  initCityDB,<br>  isCity<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../../src/cityDB'</span>;<br><br>describe(<span class="hljs-string">'使用 beforeEach 和 afterEach 對多個測試重複設定'</span>, () =&gt; &#123;<br>  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- beforeEach init DB Start ---`</span>);<br>    initCityDB();<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- beforeEach init DB End ---`</span>);<br>  &#125;);<br><br>  afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- afterEach clear DB Start ---`</span>);<br>    clearCityDB();<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- afterEach clear DB End ---`</span>);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`=========================================`</span>);<br>  &#125;);<br><br>  test(<span class="hljs-string">'新增 Kaohsiung'</span>, () =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- test1 Start ---`</span>);<br>    expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeFalsy();<br>    addCity(<span class="hljs-string">'Kaohsiung'</span>);<br>    expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeTruthy();<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- test1 End ---`</span>);<br>  &#125;);<br>  <br>  test(<span class="hljs-string">'有 Tainan，但沒有 Kaohsiung'</span>, () =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- test2 Start ---`</span>);<br>    expect(isCity(<span class="hljs-string">'Tainan'</span>)).toBeTruthy();<br>    expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeFalsy();<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- test2 End ---`</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>執行測試；</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx jest ./__tests__/repeatSetupForManyTests/sync.test.js --watch</span><br></code></pre></td></tr></table></figure><p><img src="../images/jest-setup-teardown/repeat-setup-for-many-tests_sync.png" alt=""></p><h2 id="非同步的重複設定"><a class="header-anchor" href="#非同步的重複設定"></a>非同步的重複設定</h2><p><code>beforeEach</code> 和 <code>afterEach</code> 可以若要<a href="https://jestjs.io/docs/en/asynchronous" target="_blank" rel="noopener">處理非同步</a>，有兩種處理方式：</p><ul><li>使用 <code>.done</code> 參數</li><li>回傳 promise</li></ul><h3 id="使用-done-參數"><a class="header-anchor" href="#使用-done-參數"></a>使用 <code>.done</code> 參數</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/repeatSetupForManyTests/doneParameter.test.js</span><br><span class="hljs-keyword">import</span> &#123;<br>  addCity,<br>  clearCityDBCallback,<br>  initCityDBCallback,<br>  isCity<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../../src/cityDB'</span>;<br><br>describe(<span class="hljs-string">'beforeEach 和 afterEach 使用 done 參數'</span>, () =&gt; &#123;<br>  beforeEach(<span class="hljs-function"><span class="hljs-params">done</span> =&gt;</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callback</span>(<span class="hljs-params"></span>) </span>&#123;<br>      done();<br>    &#125;<br>    <br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- beforeEach callback init DB Start ---`</span>);<br>    initCityDBCallback(callback);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- beforeEach callback init DB End ---`</span>);<br>  &#125;);<br><br>  afterEach(<span class="hljs-function"><span class="hljs-params">done</span> =&gt;</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callback</span>(<span class="hljs-params"></span>) </span>&#123;<br>      done();<br>    &#125;<br>    <br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- afterEach callback clear DB Start ---`</span>);<br>    clearCityDBCallback(callback);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- afterEach callback clear DB End ---`</span>);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`===============================================`</span>);<br>  &#125;);<br><br>  test(<span class="hljs-string">'新增 Kaohsiung'</span>, () =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- test1 Start ---`</span>);<br>    expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeFalsy();<br>    addCity(<span class="hljs-string">'Kaohsiung'</span>);<br>    expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeTruthy();<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- test1 End ---`</span>);<br>  &#125;);<br>  <br>  test(<span class="hljs-string">'有 Tainan，但沒有 Kaohsiung'</span>, () =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- test2 Start ---`</span>);<br>    expect(isCity(<span class="hljs-string">'Tainan'</span>)).toBeTruthy();<br>    expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeFalsy();<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- test2 End ---`</span>);<br>  &#125;);<br>&#125;)<br></code></pre></td></tr></table></figure><p>執行測試：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx jest ./__tests__/repeatSetupForManyTests/doneParameter.test.js --watch</span><br></code></pre></td></tr></table></figure><p><img src="../images/jest-setup-teardown/repeat-setup-for-many-tests_done-parameter_1.png" alt=""></p><p><img src="../images/jest-setup-teardown/repeat-setup-for-many-tests_done-parameter_2.png" alt=""></p><h3 id="回傳-promise"><a class="header-anchor" href="#回傳-promise"></a>回傳 promise</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/repeatSetupForManyTests/returnPromise.test.js</span><br><span class="hljs-keyword">import</span> &#123;<br>  addCity,<br>  initCityDBPromise,<br>  clearCityDBPromise,<br>  isCity<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../../src/cityDB'</span>;<br><br>describe(<span class="hljs-string">'城市資料庫 (使用 beforeEach 和 afterEach 回傳 promise)'</span>, () =&gt; &#123;<br>  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- beforeEach promise init DB Start ---`</span>);<br>    <span class="hljs-keyword">return</span> initCityDBPromise();<br>  &#125;);<br>  <br>  afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- afterEach promise clear DB Start ---`</span>);<br>    <span class="hljs-keyword">return</span> clearCityDBPromise();<br>  &#125;);<br><br>  test(<span class="hljs-string">'新增 Kaohsiung'</span>, () =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- test1 Start ---`</span>);<br>    expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeFalsy();<br>    addCity(<span class="hljs-string">'Kaohsiung'</span>);<br>    expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeTruthy();<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- test1 End ---`</span>);<br>  &#125;);<br>  <br>  test(<span class="hljs-string">'有 Tainan，但沒有 Kaohsiung'</span>, () =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- test2 Start ---`</span>);<br>    expect(isCity(<span class="hljs-string">'Tainan'</span>)).toBeTruthy();<br>    expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeFalsy();<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- test2 End ---`</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>執行測試：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx jest ./__tests__/repeatSetupForManyTests/returnPromise.test.js --watch</span><br></code></pre></td></tr></table></figure><p><img src="../images/jest-setup-teardown/repeat-setup-for-many-tests_return-promise.png" alt=""></p><h1 id="一次性設定：beforeAll、afterAll"><a class="header-anchor" href="#一次性設定：beforeAll、afterAll"></a>一次性設定：<code>beforeAll</code>、<code>afterAll</code></h1><p>有時需要在檔案的開頭執行一次設定。當設定是非同步時，可能很麻煩，所以不能直接在檔案開頭處理。Jest 提供 <code>beforeAll</code> 和 <code>afterAll</code> 來處理這種情況。</p><p>若要在所有測試執行之後處理一些事，可用 <code>beforeAll</code> 和 <code>afterAll</code>：</p><ul><li><code>beforeAll(fn, timeout)</code>：<ul><li>在執行此檔案中的所有測試之前執行 <code>fn</code> 函數</li><li>若 <code>fn</code> 函數回傳 promise 或 generator，Jest 會在執行測試之前等待該 promise resolve</li><li>若 <code>beforeAll</code> 放在 <code>describe</code> 區塊內，就只會在此區塊內的開頭執行</li><li>例如：設定多個測試都要共用的全域狀態</li></ul></li><li><code>afterAll(fn, timeout)</code>：<ul><li>在執行此檔案中的所有測試之後執行 <code>fn</code> 函數</li><li>若 <code>fn</code> 函數回傳 promise 或 generator，Jest 會等待該 promise resolve 後才會繼續</li><li>若 <code>afterAll</code> 放在 <code>describe</code> 區塊內，就只會在此區塊內的結尾執行</li><li>例如：清除多個測試都要共用的全域狀態</li></ul></li></ul><div class="info"><p><code>timeout</code> 是可選參數，可提供 timeout 來指定 <code>beforeAll</code> 或 <code>afterAll</code> 中止前要等待的時間，單位為豪秒，預設為 5 秒</p></div><p>例如：若 <code>initCityDBPromise</code> 和 <code>clearCityDBPromise</code> 都回傳 promise，並且城市資料庫可以在多個測試案例之間重用：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// src/cityDB.js</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initCityDBPromise</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- Promise：init DB Start ---`</span>);<br>    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>      cityDB = [<span class="hljs-string">'Taipei'</span>, <span class="hljs-string">'Tainan'</span>];<br>      resolve();<br>    &#125;, <span class="hljs-number">3000</span>);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- Promise：init DB End ---`</span>);<br>  &#125;);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearCityDBPromise</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- Promise：clear DB Start ---`</span>);<br>    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>      cityDB = [];<br>      resolve();<br>    &#125;, <span class="hljs-number">3000</span>);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- Promise：clear DB End ---`</span>);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/setupAndTeardown.test.js</span><br><span class="hljs-keyword">import</span> &#123;<br>  initCityDBPromise,<br>  clearCityDBPromise,<br>  isCity<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../src/cityDB'</span>;<br><br>beforeAll(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'beforeAll'</span>);<br>  <span class="hljs-keyword">return</span> initCityDBPromise();<br>&#125;);<br><br>afterAll(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'afterAll'</span>);<br>  <span class="hljs-keyword">return</span> clearCityDBPromise();<br>&#125;);<br><br>test(<span class="hljs-string">'有 Tainan'</span>, () =&gt; &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'test 1'</span>);<br>  expect(isCity(<span class="hljs-string">'Tainan'</span>)).toBeTruthy();<br>&#125;);<br><br>test(<span class="hljs-string">'沒有 Kaohsiung'</span>, () =&gt; &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'test 2'</span>);<br>  expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeFalsy();<br>&#125;);<br></code></pre></td></tr></table></figure><p>執行測試：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx jest ./__tests__/setupAndTeardown.test.js --watch</span><br></code></pre></td></tr></table></figure><p><img src="../images/jest-setup-teardown/setup-and-teardown.png" alt=""></p><h1 id="Scoping"><a class="header-anchor" href="#Scoping"></a>Scoping</h1><p><code>before</code> 和 <code>after</code> 區塊適用於檔案中的每個測試，也可放在 <code>describe</code> 區塊來將測試案例分組。當 <code>before</code> 和 <code>after</code> 放在 <code>describe</code> 區塊中時，只適用在該 <code>describe</code> 區塊中的測試案例。</p><p>若以下這些放在 <code>describe</code> 區塊內；</p><ul><li><code>beforeAll</code>：只會在此區塊內的開頭執行</li><li><code>afterAll</code>：只會在此區塊內的結尾執行</li><li><code>beforeEach</code>：只會在此區塊內的測試之前執行</li><li><code>afterEach</code>：只會在此區塊內的測試之後執行</li></ul><p>例如：有城市資料庫和食物資料庫，可為不同測試做不同設定：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// src/foodDB.js</span><br><span class="hljs-keyword">let</span> foodDB = [];<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initFoodDBPromise</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- Promise: init DB Start ---`</span>);<br>    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>      foodDB = [<br>        &#123; <span class="hljs-attr">city</span>: <span class="hljs-string">'Taipei'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Apple'</span> &#125;,<br>        &#123; <span class="hljs-attr">city</span>: <span class="hljs-string">'Tainan'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Banana'</span> &#125;<br>      ];<br>      resolve();<br>    &#125;, <span class="hljs-number">3000</span>);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- Promise: init DB End ---`</span>);<br>  &#125;);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearFoodDBPromise</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- Promise: clear DB Start ---`</span>);<br>    setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>      foodDB = [];<br>      resolve();<br>    &#125;, <span class="hljs-number">3000</span>);<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`--- Promise: clear DB End ---`</span>);<br>  &#125;);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidCityFoodPair</span>(<span class="hljs-params">foodCity, foodName</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> foodDB.some(<span class="hljs-function"><span class="hljs-params">food</span> =&gt;</span> (food.city === foodCity) &amp;&amp; (food.name === foodName));<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123;<br>  initFoodDBPromise,<br>  clearFoodDBPromise,<br>  isValidCityFoodPair<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/scoping/scope.test.js</span><br><span class="hljs-keyword">import</span> &#123;<br>  initCityDBPromise,<br>  clearCityDBPromise,<br>  isCity<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../../src/cityDB'</span>;<br><br><span class="hljs-keyword">import</span> &#123;<br>  initFoodDBPromise,<br>  clearFoodDBPromise,<br>  isValidCityFoodPair<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../../src/foodDB'</span>;<br><br><span class="hljs-comment">// 適用於此文件中的所有測試</span><br>beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'global: beforeEach'</span>);<br>  <span class="hljs-keyword">return</span> initCityDBPromise();<br>&#125;);<br><br>afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'global: afterEach'</span>);<br>  <span class="hljs-keyword">return</span> clearCityDBPromise();<br>&#125;);<br><br>test(<span class="hljs-string">'城市資料庫有 Tainan'</span>, () =&gt; &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'global: test1'</span>);<br>  expect(isCity(<span class="hljs-string">'Tainan'</span>)).toBeTruthy();<br>&#125;);<br><br>test(<span class="hljs-string">'城市資料庫沒有 Kaohsiung'</span>, () =&gt; &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'global: test2'</span>);<br>  expect(isCity(<span class="hljs-string">'Kaohsiung'</span>)).toBeFalsy();<br>&#125;);<br><br>describe(<span class="hljs-string">'城市與食物 match'</span>, () =&gt; &#123;<br>  <span class="hljs-comment">// 僅適用於此 describe 區塊中的測試</span><br>  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'scope: beforeEach'</span>);<br>    <span class="hljs-keyword">return</span> initFoodDBPromise();<br>  &#125;);<br>  <br>  afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'scope: afterEach'</span>);<br>    <span class="hljs-keyword">return</span> clearFoodDBPromise();<br>  &#125;);<br>  <br>  test(<span class="hljs-string">'Taipei &lt;3 Apple'</span>, () =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'scope: test1'</span>);<br>    expect(isValidCityFoodPair(<span class="hljs-string">'Taipei'</span>, <span class="hljs-string">'Apple'</span>)).toBe(<span class="hljs-literal">true</span>);<br>  &#125;);<br>  <br>  test(<span class="hljs-string">'Tainan &lt;3 Banana'</span>, () =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'scope: test2'</span>);<br>    expect(isValidCityFoodPair(<span class="hljs-string">'Tainan'</span>, <span class="hljs-string">'Banana'</span>)).toBe(<span class="hljs-literal">true</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>執行測試：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx jest ./__tests__/scoping/scope.test.js --watch</span><br></code></pre></td></tr></table></figure><p><img src="../images/jest-setup-teardown/scoping%E2%80%94scope_1.png" alt=""></p><p><img src="../images/jest-setup-teardown/scoping%E2%80%94scope_2.png" alt=""></p><p><img src="../images/jest-setup-teardown/scoping%E2%80%94scope_3.png" alt=""></p><p>測試檔最上層的 <code>beforeEach</code> 會在 <code>describe</code> 區塊內的 <code>beforeEach</code> 之前執行。看以下範例可了解這些 hook 的執行順序：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/scoping/executionOrder.test.js</span><br>beforeAll(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'global: beforeAll'</span>));<br>afterAll(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'global: afterAll'</span>));<br><br>beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'global: beforeEach'</span>));<br>afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'global: afterEach'</span>));<br><br>test(<span class="hljs-string">''</span>, () =&gt; <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'global: test'</span>));<br><br>describe(<span class="hljs-string">'Scoped / Nested block'</span>, () =&gt; &#123;<br>  beforeAll(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'scope: beforeAll'</span>));<br>  afterAll(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'scope: afterAll'</span>));<br><br>  beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'scope: beforeEach'</span>));<br>  afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'scope: afterEach'</span>));<br><br>  test(<span class="hljs-string">''</span>, () =&gt; <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'scope: test'</span>));<br>&#125;);<br><br><span class="hljs-comment">// global: beforeAll</span><br><span class="hljs-comment">// global: beforeEach</span><br><span class="hljs-comment">// global: test</span><br><span class="hljs-comment">// global: afterEach</span><br><br><span class="hljs-comment">// scope: beforeAll</span><br><span class="hljs-comment">// global: beforeEach</span><br><span class="hljs-comment">// scope: beforeEach</span><br><span class="hljs-comment">// scope: test</span><br><span class="hljs-comment">// scope: afterEach</span><br><span class="hljs-comment">// global: afterEach</span><br><span class="hljs-comment">// scope: afterAll</span><br><br><span class="hljs-comment">// global: afterAll</span><br></code></pre></td></tr></table></figure><p>執行測試：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx jest ./__tests__/scoping/executionOrder.test.js --watch</span><br></code></pre></td></tr></table></figure><p><img src="../images/jest-setup-teardown/scoping_execution-order.png" alt=""></p><h1 id="describe-區塊和-test-區塊的執行順序"><a class="header-anchor" href="#describe-區塊和-test-區塊的執行順序"></a><code>describe</code> 區塊和 <code>test</code> 區塊的執行順序</h1><ul><li>Jest 在執行任何測試之前，會先執行測試檔案中的所有 <code>describe</code> handler<ul><li>這就是為何要在 <code>before*</code> 和 <code>after*</code> handler 中進行設定和拆除 (setup and teardown)，而不是在 <code>describe</code> 區塊中處理的原因</li></ul></li><li>當 <code>describe</code> 區塊完成時，預設情況下，Jest 會按照在收集階段中遇到的順序連續執行所有測試，等待每個測試完成並進行整理之後再繼續</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/orderOfExecutionOfDescribeAndTestBlocks.test.js</span><br>describe(<span class="hljs-string">'outer'</span>, () =&gt; &#123;<br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'describe outer-a'</span>);<br><br>  describe(<span class="hljs-string">'describe inner 1'</span>, () =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'describe inner 1'</span>);<br>    test(<span class="hljs-string">'test 1'</span>, () =&gt; &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'test for describe inner 1'</span>);<br>      expect(<span class="hljs-literal">true</span>).toEqual(<span class="hljs-literal">true</span>);<br>    &#125;);<br>  &#125;);<br><br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'describe outer-b'</span>);<br><br>  test(<span class="hljs-string">'test 1'</span>, () =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'test for describe outer'</span>);<br>    expect(<span class="hljs-literal">true</span>).toEqual(<span class="hljs-literal">true</span>);<br>  &#125;);<br><br>  describe(<span class="hljs-string">'describe inner 2'</span>, () =&gt; &#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'describe inner 2'</span>);<br>    test(<span class="hljs-string">'test for describe inner 2'</span>, () =&gt; &#123;<br>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'test for describe inner 2'</span>);<br>      expect(<span class="hljs-literal">false</span>).toEqual(<span class="hljs-literal">false</span>);<br>    &#125;);<br>  &#125;);<br><br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'describe outer-c'</span>);<br>&#125;);<br><br><span class="hljs-comment">// describe outer-a</span><br><span class="hljs-comment">// describe inner 1</span><br><span class="hljs-comment">// describe outer-b</span><br><span class="hljs-comment">// describe inner 2</span><br><span class="hljs-comment">// describe outer-c</span><br><span class="hljs-comment">// test for describe inner 1</span><br><span class="hljs-comment">// test for describe outer</span><br><span class="hljs-comment">// test for describe inner 2</span><br></code></pre></td></tr></table></figure><p>執行測試：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx jest ./__tests__/scoping/OrderOfExecutionOfDescribeAndTestBlocks.test.js --watch</span><br></code></pre></td></tr></table></figure><p><img src="../images/jest-setup-teardown/order-of-execution-of-describe-and-test-blocks.png" alt=""></p><h1 id="建議"><a class="header-anchor" href="#建議"></a>建議</h1><p>如果測試失敗，要檢查的第一件事就是當只有它在執行時是否會失敗。若只要讓 Jest 執行一個測試，可將測試指令臨時改成 <a href="https://titangene.github.io/article/jest-describe-test-case.html#test-only-name-fn-timeout"><code>test.only</code></a>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// __tests__/testOnly.test.js</span><br>test.only(<span class="hljs-string">'this will be the only test that runs'</span>, () =&gt; &#123;<br>  expect(<span class="hljs-literal">true</span>).toBe(<span class="hljs-literal">true</span>);<br>&#125;);<br><br>test(<span class="hljs-string">'this test will not run'</span>, () =&gt; &#123;<br>  expect(<span class="hljs-string">'A'</span>).toBe(<span class="hljs-string">'A'</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>執行測試：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx jest ./__tests__/testOnly.test.js --watch</span><br></code></pre></td></tr></table></figure><p><img src="../images/jest-setup-teardown/test-only.png" alt=""></p><p>如果你有一個測試在大型案例的一部份執行會發生錯誤，但單獨執行不會失敗，那可能是其他測試干擾了此測試。通常可用 <code>beforeEach</code> 來清除一些共享狀態來解決此問題。若不確定是否正在修改哪些共享狀態，也可嘗試用 <code>beforeEach</code> 來紀錄資料。</p><h1 id="參考資料"><a class="header-anchor" href="#參考資料"></a>參考資料</h1><ul><li><a href="https://jestjs.io/docs/en/setup-teardown" target="_blank" rel="noopener">Setup and Teardown · Jest</a></li><li><a href="https://medium.com/enjoy-life-enjoy-coding/unit-test-%E6%9B%BF%E6%B8%AC%E8%A9%A6%E8%A8%AD%E7%BD%AE%E5%88%86%E9%A1%9E-describe-%E5%8F%8A%E4%BD%9C%E7%94%A8%E5%9F%9F-scoping-2c5082266ca" target="_blank" rel="noopener">Jest | 測試設定分類 (describe) 及作用域 (scoping) by 神Q超人</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Testing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> Jest </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Unit Testing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jest：Describe &amp; Test case</title>
      <link href="/article/jest-describe-test-case.html"/>
      <url>/article/jest-describe-test-case.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/jest.jpg" alt=""></p><p>上次介紹了 <a href="https://titangene.github.io/article/jest-matcher-assertion.html">Jest 提供的 matcher</a>，可讓你驗證程式碼是否符合預期，而這次來說明如何透過 <code>describe</code> 和 <code>test</code> 區塊來組織測試案例。當需求變多時，可針對需求來分類測試案例，將相關的測試放在同一個群組區塊內，此時就會用到 Jest 提供的 <code>describe</code> 和 <code>test</code> 區塊。</p><a id="more"></a><ul><li><code>test</code> 區塊：即測試案例 (test case)，使用 matcher 驗證程式執行結果是否符合預期</li><li><code>describe</code> 區塊：將多個相關的 <code>test</code> 區塊放在一起，便於組織測試案例</li></ul><blockquote><p>其他 Jest 相關文章可參閱 <a href="https://titangene.github.io/tags/jest/">Jest 系列文章</a>。</p></blockquote><p>下面範例都會用數學運算的範例來說明：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> addition = <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span>(x) === <span class="hljs-string">'number'</span> &amp;&amp; <span class="hljs-keyword">typeof</span>(y) === <span class="hljs-string">'number'</span>)<br>   <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CustomError(<span class="hljs-string">'請輸入數字'</span>);<br>  <span class="hljs-keyword">return</span> x + y;<br>&#125;;<br><span class="hljs-keyword">const</span> subtraction = <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span>(x) === <span class="hljs-string">'number'</span> &amp;&amp; <span class="hljs-keyword">typeof</span>(y) === <span class="hljs-string">'number'</span>)<br>   <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CustomError(<span class="hljs-string">'請輸入數字'</span>);<br>  <span class="hljs-keyword">return</span> x - y;<br>&#125;;<br></code></pre></td></tr></table></figure><h1 id="describe-區塊"><a class="header-anchor" href="#describe-區塊"></a><code>describe</code> 區塊</h1><h2 id="describe-name-fn"><a class="header-anchor" href="#describe-name-fn"></a><code>describe(name, fn)</code></h2><p>argument：</p><ul><li><code>name</code>：描素此 <code>describe</code> 區塊的敘述</li><li><code>fn</code>：包含 <code>test</code> 區塊的函數</li></ul><p>用來將多個相關的 <code>test</code> 區塊放在同一個 <code>describe</code> 區塊內，以便於將測試組織成群組。例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript">describe(<span class="hljs-string">'數學運算'</span>, () =&gt; &#123;<br>  test(<span class="hljs-string">'加法運算'</span>, () =&gt; &#123;<br>    expect(addition(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)).toBe(<span class="hljs-number">3</span>);<br>  &#125;);<br>  <br>  test(<span class="hljs-string">'減法運算'</span>, () =&gt; &#123;<br>    expect(subtraction(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>)).toBe(<span class="hljs-number">2</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>但寫測試不一定要用 <code>describe</code> 區塊，也可以不用將 <code>test</code> 區塊包在 <code>describe</code> 區塊內，而是直接寫在測試檔上，但建議你使用 <code>describe</code> 區塊。</p><p>也可以巢狀使用 <code>describe</code> 區塊：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs javascript">describe(<span class="hljs-string">'數學運算'</span>, () =&gt; &#123;<br>  describe(<span class="hljs-string">'加法運算'</span>, () =&gt; &#123;<br>    describe(<span class="hljs-string">'傳入非數字值'</span>, () =&gt; &#123;<br>      test(<span class="hljs-string">'傳入布林值應拋出 CustomError'</span>, () =&gt; &#123;<br>        expect(addition(<span class="hljs-literal">true</span>, <span class="hljs-number">2</span>)).toThrow(CustomError);<br>      &#125;);<br><br>      test(<span class="hljs-string">'傳入字串值應拋出 CustomError'</span>, () =&gt; &#123;<br>        expect(addition(<span class="hljs-string">'a'</span>, <span class="hljs-number">1</span>)).toThrow(CustomError);<br>      &#125;);<br>    &#125;);<br>    <br>    describe(<span class="hljs-string">'傳入數字值'</span>, () =&gt; &#123;<br>      test(<span class="hljs-string">'應回傳正確的運算結果'</span>, () =&gt; &#123;<br>        expect(addition(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)).toBe(<span class="hljs-number">3</span>);<br>      &#125;);<br>    &#125;);<br>  &#125;);<br><br>  describe(<span class="hljs-string">'減法運算'</span>, () =&gt; &#123;<br>    describe(<span class="hljs-string">'傳入非數字值'</span>, () =&gt; &#123;<br>      test(<span class="hljs-string">'傳入布林值應拋出 CustomError'</span>, () =&gt; &#123;<br>        expect(subtraction(<span class="hljs-literal">true</span>, <span class="hljs-number">2</span>)).toThrow(CustomError);<br>      &#125;);<br><br>      test(<span class="hljs-string">'傳入字串值應拋出 CustomError'</span>, () =&gt; &#123;<br>        expect(subtraction(<span class="hljs-string">'a'</span>, <span class="hljs-number">1</span>)).toThrow(CustomError);<br>      &#125;);<br>    &#125;);<br>    <br>    describe(<span class="hljs-string">'傳入數字值'</span>, () =&gt; &#123;<br>      test(<span class="hljs-string">'應回傳正確的運算結果'</span>, () =&gt; &#123;<br>        expect(subtraction(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>)).toBe(<span class="hljs-number">2</span>);<br>      &#125;);<br>    &#125;);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="describe-only-name-fn"><a class="header-anchor" href="#describe-only-name-fn"></a><code>describe.only(name, fn)</code></h2><p>alias：<code>fdescribe(name, fn)</code></p><p>讓測試只跑使用 <code>describe.only()</code> 的 <code>describe</code> 區塊。</p><p>例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript">describe.only(<span class="hljs-string">'數學運算'</span>, () =&gt; &#123;<br>  test(<span class="hljs-string">'加法運算'</span>, () =&gt; &#123;<br>    expect(addition(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)).toBe(<span class="hljs-number">3</span>);<br>  &#125;);<br>  <br>  test(<span class="hljs-string">'減法運算'</span>, () =&gt; &#123;<br>    expect(subtraction(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>)).toBe(<span class="hljs-number">2</span>);<br>  &#125;);<br>&#125;);<br><br>describe(<span class="hljs-string">'其他'</span>, () =&gt; &#123;<br>  <span class="hljs-comment">// 此區塊的測試會被略過</span><br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="describe-skip-name-fn"><a class="header-anchor" href="#describe-skip-name-fn"></a><code>describe.skip(name, fn)</code></h2><p>alias：<code>xdescribe(name, fn)</code></p><p>不想執行指定的 <code>describe</code> 區塊可用 <code>describe.skip()</code>。</p><p>例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript">describe(<span class="hljs-string">'數學運算'</span>, () =&gt; &#123;<br>  test(<span class="hljs-string">'加法運算'</span>, () =&gt; &#123;<br>    expect(addition(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)).toBe(<span class="hljs-number">3</span>);<br>  &#125;);<br>  <br>  test(<span class="hljs-string">'減法運算'</span>, () =&gt; &#123;<br>    expect(subtraction(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>)).toBe(<span class="hljs-number">2</span>);<br>  &#125;);<br>&#125;);<br><br>describe.skip(<span class="hljs-string">'其他'</span>, () =&gt; &#123;<br>  <span class="hljs-comment">// 略過此區塊的測試</span><br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="test-區塊"><a class="header-anchor" href="#test-區塊"></a><code>test</code> 區塊</h1><h2 id="test-name-fn-timeout"><a class="header-anchor" href="#test-name-fn-timeout"></a><code>test(name, fn, timeout)</code></h2><p>alias：<code>it(name, fn, timeout)</code></p><p>argument：</p><ul><li><code>name</code>：測試名稱</li><li><code>fn</code>：包含要測試的期望函數</li><li><code>timeout</code> (可選)：測試終止之前要等待的時間 (單位毫秒)，預設為 5 秒</li></ul><p>測試檔案內一定要有 <code>test</code> 區塊才能測試程式。</p><p>剛剛有提到，不一定要 <code>describe</code> 區塊，可直接在測試檔內放 <code>test</code> 區塊即可。例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">test(<span class="hljs-string">'加法運算'</span>, () =&gt; &#123;<br>  expect(addition(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)).toBe(<span class="hljs-number">3</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="test-only-name-fn-timeout"><a class="header-anchor" href="#test-only-name-fn-timeout"></a><code>test.only(name, fn, timeout)</code></h2><p>alias：<code>it.only(name, fn, timeout)</code> 和 <code>fit(name, fn, timeout)</code></p><p>在 debug 測試檔內的測試時，通常只需要執行一部分的測試，此時就可以將那些 <code>test</code> 區塊加上 <code>.only</code> 來指定要執行哪些測試，其餘的測試都會被略過。</p><blockquote><p>註：<code>timeout</code> argument 跟 <code>test()</code> 一樣，所以不再次重複說明。</p></blockquote><p>例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">test.only(<span class="hljs-string">'加法運算'</span>, () =&gt; &#123;<br>  expect(addition(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)).toBe(<span class="hljs-number">3</span>);<br>&#125;);<br><br>test(<span class="hljs-string">'其他運算'</span>, () =&gt; &#123;<br>  <span class="hljs-comment">// 略過此區塊的測試</span><br>&#125;);<br></code></pre></td></tr></table></figure><div class="info"><p><code>test.only</code> 只會在 debug 階段使用，不建議 commit 至 Git 版本控制中，記得要在 debug 後刪掉 <code>.only</code>。</p></div><h2 id="test-skip-name-fn"><a class="header-anchor" href="#test-skip-name-fn"></a><code>test.skip(name, fn)</code></h2><p>alias：<code>it.skip(name, fn)</code> 或 <code>xit(name, fn)</code> 或 <code>xtest(name, fn)</code></p><p>若要跳過一些 <code>test</code> 區塊的測試，可用 <code>test.skip()</code>。</p><p>例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">test(<span class="hljs-string">'加法運算'</span>, () =&gt; &#123;<br>  expect(addition(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)).toBe(<span class="hljs-number">3</span>);<br>&#125;);<br><br>test.skip(<span class="hljs-string">'其他運算'</span>, () =&gt; &#123;<br>  <span class="hljs-comment">// 略過此區塊的測試</span><br>&#125;);<br></code></pre></td></tr></table></figure><p>若不想執行某 <code>test</code> 區塊的測試，雖然可將該測試註解掉，但建議用 <code>test.skip</code>，因為只少會保留原本的縮排和顯示程式碼 highlight。</p><h2 id="test-todo-name"><a class="header-anchor" href="#test-todo-name"></a><code>test.todo(name)</code></h2><p>alias：<code>it.todo(name)</code></p><p>規劃要寫的測試 (寫在 <code>name</code> argument 上) 可用 <code>test.todo()</code>，這些測試會在摘要輸出中 highlight 顯示，以便提醒你還有多少測試還沒寫。</p><p>若提供 test callback 函數，<code>test.todo()</code> 會拋出錯誤。若你已實作了該測試，且該測試已出錯，而你不想執行此測試，請改用 <code>test.skip()</code>。</p><p>例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> add = <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b;<br><br>test.todo(<span class="hljs-string">'add should be associative'</span>);<br></code></pre></td></tr></table></figure><p>資料來源：</p><ul><li><a href="https://jestjs.io/docs/en/api" target="_blank" rel="noopener">Globals · Jest</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Testing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> Jest </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Unit Testing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jest：Matcher &amp; Assertion</title>
      <link href="/article/jest-matcher-assertion.html"/>
      <url>/article/jest-matcher-assertion.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/jest.jpg" alt=""></p><p>Assertion (斷言) 就要測試程式碼的執行結果是否符合預期，如果結果一致，代表測試通過，否則 assertion 就會拋出錯誤，代表測試失敗。而 Jest 提供多種 matcher，能讓你 assert 程式碼執行結果的正確性。</p><a id="more"></a><blockquote><p>之前介紹了如何建制 Jest 測試環境，還沒安裝環境的可參閱：</p><ul><li><a href="https://titangene.github.io/article/jest-build-test-env.html">Jest：建置測試環境 (包含 Babel) | Titangene Blog</a></li><li><a href="https://titangene.github.io/article/jest-typescript.html">Jest + TypeScript：建置測試環境 | Titangene Blog</a></li></ul></blockquote><blockquote><p>其他 Jest 相關文章可參閱 <a href="https://titangene.github.io/tags/jest/">Jest 系列文章</a>。</p></blockquote><p>下面介紹 Jest 提供的各種 matcher：</p><h1 id="通用-Matchers"><a class="header-anchor" href="#通用-Matchers"></a>通用 Matchers</h1><p><code>expect()</code> 回傳一個 “期望 (expectation)” 的物件</p><p>當 Jest 執行時，它會追蹤所有失敗的 matcher，以便列印錯誤訊息：</p><ul><li><code>.toBe()</code> 是 matcher，使用 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is" target="_blank" rel="noopener"><code>Object.is()</code></a> 來測試 exact equality (精確相等)</li><li><code>.toEqual()</code>：檢查物件的值，遞迴的檢查物件或陣列的每個 field</li><li><code>.not</code>：matcher 的相反</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript">test(<span class="hljs-string">'two plus two is four'</span>, () =&gt; &#123;<br>  expect(<span class="hljs-number">2</span> + <span class="hljs-number">2</span>).toBe(<span class="hljs-number">4</span>);<br>&#125;);<br><br>test(<span class="hljs-string">'object assignment'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> data = &#123;<span class="hljs-attr">one</span>: <span class="hljs-number">1</span>&#125;;<br>  data[<span class="hljs-string">'two'</span>] = <span class="hljs-number">2</span>;<br>  expect(data).toEqual(&#123;<span class="hljs-attr">one</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">two</span>: <span class="hljs-number">2</span>&#125;);<br>&#125;);<br><br>test(<span class="hljs-string">'adding positive numbers is not zero'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>; a &lt; <span class="hljs-number">10</span>; a++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> b = <span class="hljs-number">1</span>; b &lt; <span class="hljs-number">10</span>; b++) &#123;<br>      expect(a + b).not.toBe(<span class="hljs-number">0</span>);<br>    &#125;<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="Truthiness-真實性"><a class="header-anchor" href="#Truthiness-真實性"></a>Truthiness (真實性)</h1><p>在測試中，有時需要區分 <code>undefined</code>、<code>null</code> 和 <code>false</code>，但有時你又不需要區分。Jest 包含一些 helper，便於確認想要的內容：</p><ul><li><code>toBeNull</code> 只 match <code>null</code></li><li><code>toBeUndefined</code> 只 match <code>undefined</code></li><li><code>toBeDefined</code> 與 <code>toBeUndefined</code> 相反</li><li><code>toBeTruthy</code> match 任何 <code>if</code> 陳述句為 true</li><li><code>toBeFalsy</code> match 任何 <code>if</code> 陳述句為 false</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript">test(<span class="hljs-string">'null'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> n = <span class="hljs-literal">null</span>;<br>  expect(n).toBeNull();<br>  expect(n).not.toBeUndefined();<br>  expect(n).toBeDefined();<br>  expect(n).not.toBeTruthy();<br>  expect(n).toBeFalsy();<br>&#125;);<br><br>test(<span class="hljs-string">'zero'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> z = <span class="hljs-number">0</span>;<br>  expect(z).not.toBeNull();<br>  expect(z).toBeDefined();<br>  expect(z).not.toBeUndefined();<br>  expect(z).not.toBeTruthy();<br>  expect(z).toBeFalsy();<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="Numbers"><a class="header-anchor" href="#Numbers"></a>Numbers</h1><p>大多數的比較數字都有 matcher equivalents (等價物)：</p><ul><li><code>toBeGreaterThan()</code>：比較 <code>received &gt; expected</code></li><li><code>toBeGreaterThanOrEqual()</code>：比較 <code>received &gt;= expected</code></li><li><code>toBeLessThan()</code>：比較 <code>received &lt; expected</code></li><li><code>toBeLessThanOrEqual()</code>：比較 <code>received &lt;= expected</code></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript">test(<span class="hljs-string">'two plus two'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> value = <span class="hljs-number">2</span> + <span class="hljs-number">2</span>;<br>  expect(value).toBeGreaterThan(<span class="hljs-number">3</span>);<br>  expect(value).toBeGreaterThanOrEqual(<span class="hljs-number">3.5</span>);<br>  expect(value).toBeLessThan(<span class="hljs-number">5</span>);<br>  expect(value).toBeLessThanOrEqual(<span class="hljs-number">4.5</span>);<br><br>  <span class="hljs-comment">// toBe 和 toEqual 等價於數字</span><br>  expect(value).toBe(<span class="hljs-number">4</span>);<br>  expect(value).toEqual(<span class="hljs-number">4</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>對於浮點數相等，請使用 <code>toBeCloseTo()</code> 而不是 <code>toEqual()</code>，因為你不希望測試依賴於微小的捨入誤差 (rounding error)：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">test(<span class="hljs-string">'adding floating point numbers'</span>, () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> value = <span class="hljs-number">0.1</span> + <span class="hljs-number">0.2</span>;<br>  <span class="hljs-comment">// expect(value).toBe(0.3);        由於舍入錯誤無法運作</span><br>  expect(value).toBeCloseTo(<span class="hljs-number">0.3</span>); <span class="hljs-comment">// 可運作</span><br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="Strings"><a class="header-anchor" href="#Strings"></a>Strings</h1><p>可用 <code>toMatch()</code> 根據 regex 檢查字串：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript">test(<span class="hljs-string">'there is no I in team'</span>, () =&gt; &#123;<br>  expect(<span class="hljs-string">'team'</span>).not.toMatch(<span class="hljs-regexp">/I/</span>);<br>&#125;);<br><br>test(<span class="hljs-string">'but there is a "stop" in Christoph'</span>, () =&gt; &#123;<br>  expect(<span class="hljs-string">'Christoph'</span>).toMatch(<span class="hljs-regexp">/stop/</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="Arrays-和-iterables"><a class="header-anchor" href="#Arrays-和-iterables"></a>Arrays 和 iterables</h1><p>可用 <code>toContain()</code> 來檢查陣列或可迭代物件是否包含特定項目：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> shoppingList = [<br>  <span class="hljs-string">'diapers'</span>,<br>  <span class="hljs-string">'kleenex'</span>,<br>  <span class="hljs-string">'trash bags'</span>,<br>  <span class="hljs-string">'paper towels'</span>,<br>  <span class="hljs-string">'beer'</span>,<br>];<br><br>test(<span class="hljs-string">'the shopping list has beer on it'</span>, () =&gt; &#123;<br>  expect(shoppingList).toContain(<span class="hljs-string">'beer'</span>);<br>  expect(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>(shoppingList)).toContain(<span class="hljs-string">'beer'</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="Exceptions"><a class="header-anchor" href="#Exceptions"></a>Exceptions</h1><p>若要測試特定函數在呼叫時是否拋出錯誤，請使用 <code>toThrow()</code>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compileAndroidCode</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'you are using the wrong JDK'</span>);<br>&#125;<br><br>test(<span class="hljs-string">'compiling android goes as expected'</span>, () =&gt; &#123;<br>  expect(compileAndroidCode).toThrow();<br>  expect(compileAndroidCode).toThrow(<span class="hljs-built_in">Error</span>);<br><br>  <span class="hljs-comment">// 還可以使用確切的錯誤訊息或 regexp</span><br>  expect(compileAndroidCode).toThrow(<span class="hljs-string">'you are using the wrong JDK'</span>);<br>  expect(compileAndroidCode).toThrow(<span class="hljs-regexp">/JDK/</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><blockquote><p>更多 matcher 可參閱 Jest 社群維護的 <a href="https://github.com/jest-community/jest-extended" target="_blank" rel="noopener">jest-community/jest-extended</a>。</p></blockquote><p>資料來源：<a href="https://jestjs.io/docs/en/using-matchers" target="_blank" rel="noopener">Using Matchers · Jest</a></p>]]></content>
      
      
      <categories>
          
          <category> Testing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> Jest </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Unit Testing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jest + TypeScript：建置測試環境</title>
      <link href="/article/jest-typescript.html"/>
      <url>/article/jest-typescript.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/jest-typescript.jpg" alt=""></p><p>TypeScript 是 JavaScript 的 typed superset，提供強大的型別檢查系統，讓你在編譯時期就能即時發現錯誤，而不是到了 runtime 才發生未知的 bug。上次介紹了 <a href="https://titangene.github.io/article/jest-build-test-env.html">Jest + Babel 的測試環境建置</a>，這次來介紹 Jest + TypeScript 的測試環境建置過程。</p><a id="more"></a><blockquote><p>其他 Jest 相關文章可參閱 <a href="https://titangene.github.io/tags/jest/">Jest 系列文章</a>。</p></blockquote><p>下面來介紹如何建置 Jest + TypeScript 的測試開發環境。</p><h1 id="建立開發環境"><a class="header-anchor" href="#建立開發環境"></a>建立開發環境</h1><h2 id="建立-npm-專案"><a class="header-anchor" href="#建立-npm-專案"></a>建立 npm 專案</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm init -y</span><br></code></pre></td></tr></table></figure><h2 id="安裝-TypeScript"><a class="header-anchor" href="#安裝-TypeScript"></a>安裝 TypeScript</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn add -D typescript</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install -D typescript</span><br></code></pre></td></tr></table></figure><h2 id="安裝與-Node-js-和-TypeScript-相關的環境"><a class="header-anchor" href="#安裝與-Node-js-和-TypeScript-相關的環境"></a>安裝與 Node.js 和 TypeScript 相關的環境</h2><ul><li><a href="https://github.com/TypeStrong/ts-node" target="_blank" rel="noopener"><code>ts-node</code></a>：Node.js 的 TypeScript 執行環境和 REPL，且支援 source map<ul><li>不用手動執行 <code>tsc</code> 編譯 TypeScript 檔案，就能直接像是使用 <code>node</code> 指令那樣，直接透過 <code>ts-node</code> 指令來編譯並執行 TypeScript 檔案</li></ul></li><li><a href="https://github.com/remy/nodemon" target="_blank" rel="noopener"><code>nodemon</code></a>：提供 watch 模式的 <code>node</code><ul><li>當 <code>nodemon</code> 檢測到指定目錄中的檔案有變更時，就會重新啟動 Node 應用程式</li></ul></li><li><a href="https://www.npmjs.com/package/@types/node" target="_blank" rel="noopener"><code>@types/node</code></a>：Node.js 的型別定義檔</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn add -D ts-node nodemon @types/node</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install -D ts-node nodemon @types/node</span><br></code></pre></td></tr></table></figure><h2 id="安裝與-Jest-和-TS-相關的環境"><a class="header-anchor" href="#安裝與-Jest-和-TS-相關的環境"></a>安裝與 Jest 和 TS 相關的環境</h2><ul><li><a href="https://github.com/facebook/jest" target="_blank" rel="noopener"><code>jest</code></a>：JavaScript 測試框架</li><li><a href="https://github.com/kulshekhar/ts-jest" target="_blank" rel="noopener"><code>ts-jest</code></a>：用於 Jest preprocessor 的 TypeScript preprocessor<ul><li>支援 Jest 的 source map</li><li>可讓你使用 Jest 來測試用 TypeScript 寫的專案</li><li>支援 TS 的所有功能，包括型別檢查</li></ul></li><li><a href="https://www.npmjs.com/package/@types/jest" target="_blank" rel="noopener"><code>@types/jest</code></a>：Jest 的型別定義檔</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn add -D jest ts-jest @types/jest</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install -D jest ts-jest @types/jest</span><br></code></pre></td></tr></table></figure><h2 id="設定-package-json"><a class="header-anchor" href="#設定-package-json"></a>設定 <code>package.json</code></h2><p>在 <code>package.json</code> 加上下面內容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">"scripts"</span>: &#123;<br>    <span class="hljs-attr">"start"</span>: <span class="hljs-string">"ts-node src/main.ts"</span>,<br>    <span class="hljs-attr">"dev"</span>: <span class="hljs-string">"nodemon --watch 'src/**/*.ts' --exec ts-node src/main.ts"</span>,<br>    <span class="hljs-attr">"build"</span>: <span class="hljs-string">"tsc"</span>,<br>    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"jest --coverage"</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="設定-jest-config-js"><a class="header-anchor" href="#設定-jest-config-js"></a>設定 <code>jest.config.js</code></h2><p>Jest 的預設是可以不用配置任何檔案就能執行測試，但 Jest 的預設是使用 Babel 來處理 <code>.ts</code> (和 <code>.tsx</code> ) 檔案 <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>，而 Babel 不會對 <code>.ts</code> 檔案進行編譯處理，所以就不會進行型別檢查。而 <code>ts-jest</code> 就能幫你處理 TS 該做的這些事。</p><blockquote><p>在 <a href="https://kulshekhar.github.io/ts-jest/user/babel7-or-ts" target="_blank" rel="noopener">Babel7 or TypeScript | ts-jest</a> 這篇文章內有提到為何不要用 <code>@babel/preset-typescript</code>，而要用 <code>ts-jest</code> 的原因。</p><p>所以若要開發 TypeScript，不建議使用 Babel，建議用 <code>tsc</code> 來編譯 TypeScript。</p></blockquote><p>為了要使用 <code>ts-jest</code> 來 transpile TypeScript，請執行以下指令來建立 Jest 的配置檔案 <code>jest.config.js</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx ts-jest config:init</span><br></code></pre></td></tr></table></figure><p>此指令建立的 <code>jest.config.js</code> 檔案內容如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">module</span>.exports = &#123;<br>  preset: <span class="hljs-string">'ts-jest'</span>,<br>  testEnvironment: <span class="hljs-string">'node'</span>,<br>&#125;;<br></code></pre></td></tr></table></figure><p>但我自己自訂了一些配置：</p><ul><li><code>coverageDirectory</code>：Jest 輸出的 coverage 檔案要放在哪個目錄<ul><li>預設：<code>undefined</code></li></ul></li><li><code>preset</code>：設定 preset<ul><li>預設：<code>undefined</code></li><li>preset 應指向 root 目錄上具有 <code>jest-preset.json</code> 或 <code>jest-preset.js</code> 檔案的 npm 模組</li></ul></li><li><code>testEnvironment</code>：用於測試的測試環境<ul><li>預設：<code>&quot;jsdom&quot;</code> (類似瀏覽器的環境)</li><li>若要建置 node service，可用 <code>&quot;node&quot;</code> 來使用類似 node 的環境</li></ul></li><li><code>testRegex</code>：Jest 只執行 match 此 pattern 的測試檔案<ul><li>預設：<code>(/__tests__/.*|(\\.|/)(test|spec))\\.[jt]sx?$</code><ul><li>即在 <code>__tests__</code> 目錄內的 <code>.js</code>、<code>.jsx</code>、<code>.ts</code> 和 <code>.tsx</code> 檔，以及帶有 <code>.test</code> 或 <code>.spec</code> 後綴的任何檔案，例如：<code>sum.test.ts</code> 或 <code>sum.spec.ts</code></li></ul></li><li>Jest 會用 <code>testRegex</code> 配置的 pattern 來嘗試 match 測試檔案的絕對路徑</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">module</span>.exports = &#123;<br>  coverageDirectory: <span class="hljs-string">"coverage"</span>,<br>  preset: <span class="hljs-string">'ts-jest'</span>,<br>  testEnvironment: <span class="hljs-string">"node"</span>,<br>  testRegex: <span class="hljs-string">"(/__tests__/.*|(\\.|/)(test|spec))\\.tsx?$"</span><br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><p>更多 Jest 配置詳情可參閱 <a href="https://jestjs.io/docs/en/configuration" target="_blank" rel="noopener">Configuring Jest · Jest</a>。</p></blockquote><h1 id="設定-tsconfig-json"><a class="header-anchor" href="#設定-tsconfig-json"></a>設定 <code>tsconfig.json</code></h1><p>自己手動建立 <code>tsconfig.json</code>：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">"compilerOptions"</span>: &#123;<br>    <span class="hljs-attr">"target"</span>: <span class="hljs-string">"es6"</span>,<br>    <span class="hljs-attr">"module"</span>: <span class="hljs-string">"commonjs"</span>,<br>    <span class="hljs-attr">"outDir"</span>: <span class="hljs-string">"dist"</span>,<br>    <span class="hljs-attr">"strict"</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">"sourceMap"</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">"esModuleInterop"</span>: <span class="hljs-literal">true</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>當然你也可以用 <code>tsc --init</code> 指令來建立 <code>tsconfig.json</code>。</p><blockquote><p>更多 <code>tsconfig.json</code> 配置詳情可參閱 <a href="https://www.typescriptlang.org/tsconfig" target="_blank" rel="noopener">TypeScript: TSConfig Reference - Docs on every TSConfig option</a>。</p></blockquote><h1 id="寫範例程式碼"><a class="header-anchor" href="#寫範例程式碼"></a>寫範例程式碼</h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// src/sum.ts</span><br><span class="hljs-keyword">type</span> sumType = <span class="hljs-function">(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;<br><span class="hljs-keyword">const</span> sum: sumType = <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> sum;<br></code></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// src/main.ts</span><br><span class="hljs-keyword">import</span> sum <span class="hljs-keyword">from</span> <span class="hljs-string">'./sum'</span>;<br><br><span class="hljs-built_in">console</span>.log(sum(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));<br></code></pre></td></tr></table></figure><p>執行 <code>main.js</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn start</span><br>yarn run v1.21.1<br><span class="hljs-meta">$</span><span class="bash"> ts-node src/main.ts</span><br>3<br>Done in 4.71s.<br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm run start</span><br><br><span class="hljs-meta">&gt;</span><span class="bash"> jest-typescript-101@1.0.0 start /home/titan/project/jest/jest-typescript-101</span><br><span class="hljs-meta">&gt;</span><span class="bash"> ts-node src/main.ts</span><br><br>3<br></code></pre></td></tr></table></figure><h1 id="建立測試"><a class="header-anchor" href="#建立測試"></a>建立測試</h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// src/__tests__/sum.test.ts</span><br><span class="hljs-keyword">import</span> sum <span class="hljs-keyword">from</span> <span class="hljs-string">'../sum'</span>;<br><br>test(<span class="hljs-string">'adds 1 + 2 to equal 3'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<br>  <span class="hljs-comment">// Arrange</span><br>  <span class="hljs-keyword">let</span> x: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>, y: <span class="hljs-built_in">number</span> = <span class="hljs-number">2</span>;<br>  <span class="hljs-keyword">let</span> expected: <span class="hljs-built_in">number</span> = <span class="hljs-number">3</span>;<br><br>  <span class="hljs-comment">// Act</span><br>  <span class="hljs-keyword">let</span> actual: <span class="hljs-built_in">number</span> = sum(x, y);<br><br>  <span class="hljs-comment">// Assert</span><br>  expect(actual).toBe(expected);<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="執行測試"><a class="header-anchor" href="#執行測試"></a>執行測試</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn <span class="hljs-built_in">test</span></span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm run <span class="hljs-built_in">test</span></span><br></code></pre></td></tr></table></figure><p>測試通過：</p><p><img src="../images/jest-typescript/2020-05-31-23-23-21.png" alt=""></p><p>資料來源：</p><ul><li><a href="https://kulshekhar.github.io/ts-jest/" target="_blank" rel="noopener">ts-jest</a></li><li><a href="https://github.com/TypeStrong/ts-node" target="_blank" rel="noopener">ts-node</a></li><li><a href="https://github.com/remy/nodemon" target="_blank" rel="noopener">nodemon</a></li><li><a href="https://jestjs.io/docs/en/getting-started" target="_blank" rel="noopener">Getting Started · Jest</a></li><li><a href="https://jestjs.io/docs/en/cli" target="_blank" rel="noopener">Jest CLI Options · Jest</a></li><li><a href="https://jestjs.io/docs/en/configuration" target="_blank" rel="noopener">Configuring Jest · Jest</a></li><li><a href="https://www.typescriptlang.org/tsconfig" target="_blank" rel="noopener">TypeScript: TSConfig Reference - Docs on every TSConfig option</a></li></ul><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://jestjs.io/blog/2019/01/25/jest-24-refreshing-polished-typescript-friendly#typescript-support" target="_blank" rel="noopener">Jest 24: 💅 Refreshing, Polished, TypeScript-friendly · Jest</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> Testing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> Jest </tag>
            
            <tag> Unit Testing </tag>
            
            <tag> Node.js </tag>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jest：建置測試環境 (包含 Babel)</title>
      <link href="/article/jest-build-test-env.html"/>
      <url>/article/jest-build-test-env.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/jest.jpg" alt=""></p><p>最近在學習單元測試，而 Jest 是在前端蠻常見的測試框架，可透過建立測試來確保自己寫的程式碼是否符合需求，而且當改動程式碼時，才能確保是否因不小心而產生的 bug，測試能讓我更有信心的去重構程式碼。</p><a id="more"></a><blockquote><p>其他 Jest 相關文章可參閱 <a href="https://titangene.github.io/tags/jest/">Jest 系列文章</a>。</p></blockquote><p>那 Jest 可以用在哪些專案？你可為下面這些專案建立測試：</p><ul><li><a href="https://babeljs.io/" target="_blank" rel="noopener">Babel</a></li><li><a href="https://www.typescriptlang.org/" target="_blank" rel="noopener">TypeScript</a></li><li><a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node</a></li><li><a href="https://angular.io/" target="_blank" rel="noopener">Angular</a>、<a href="https://vuejs.org/" target="_blank" rel="noopener">Vue</a>、<a href="https://reactjs.org/" target="_blank" rel="noopener">React</a></li><li>…等</li></ul><p>下面來介紹如何建置 Jest 的測試開發環境。</p><h1 id="建立開發環境"><a class="header-anchor" href="#建立開發環境"></a>建立開發環境</h1><h2 id="建立-npm-專案"><a class="header-anchor" href="#建立-npm-專案"></a>建立 npm 專案</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm init -y</span><br></code></pre></td></tr></table></figure><h2 id="安裝-Jest"><a class="header-anchor" href="#安裝-Jest"></a>安裝 Jest</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn add -D jest</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install -D jest</span><br></code></pre></td></tr></table></figure><h2 id="設定-package-json"><a class="header-anchor" href="#設定-package-json"></a>設定 <code>package.json</code></h2><p>在 <code>package.json</code> 加上下面內容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">"scripts"</span>: &#123;<br>    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"jest"</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="寫範例程式碼"><a class="header-anchor" href="#寫範例程式碼"></a>寫範例程式碼</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// sum.js</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sum</span>(<span class="hljs-params">a, b</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> a + b;<br>&#125;<br><span class="hljs-built_in">module</span>.exports = sum;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// main.js</span><br><span class="hljs-keyword">const</span> sum = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./sum'</span>);<br><br><span class="hljs-built_in">console</span>.log(sum(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));<br></code></pre></td></tr></table></figure><p>執行 <code>main.js</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> node main.js</span><br>3<br></code></pre></td></tr></table></figure><h1 id="建立測試"><a class="header-anchor" href="#建立測試"></a>建立測試</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// sum.test.js</span><br><span class="hljs-keyword">const</span> sum = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./sum'</span>);<br><br>test(<span class="hljs-string">'adds 1 + 2 to equal 3'</span>, () =&gt; &#123;<br>  <span class="hljs-comment">// Arrange</span><br>  <span class="hljs-keyword">let</span> x = <span class="hljs-number">1</span>, y = <span class="hljs-number">2</span>;<br>  <span class="hljs-keyword">let</span> expected = <span class="hljs-number">3</span>;<br><br>  <span class="hljs-comment">// Act</span><br>  <span class="hljs-keyword">let</span> actual = sum(x, y);<br><br>  <span class="hljs-comment">// Assert</span><br>  expect(actual).toBe(expected);<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="執行測試"><a class="header-anchor" href="#執行測試"></a>執行測試</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn <span class="hljs-built_in">test</span></span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm run <span class="hljs-built_in">test</span></span><br></code></pre></td></tr></table></figure><p>測試通過：</p><p><img src="../images/jest-build-test-env/2020-05-24-22-26-37.png" alt=""></p><h1 id="從指令列執行測試"><a class="header-anchor" href="#從指令列執行測試"></a>從指令列執行測試</h1><p>例如：Jest 只執行 match <code>my-test</code> 的測試檔案，以及使用 <code>config.json</code> 作為配置檔案，並且在執行後顯示 native 的 OS 通知：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> jest my-test --notify --config=config.json</span><br></code></pre></td></tr></table></figure><p>Jest CLI option 說明：</p><ul><li><code>jest &lt;regexForTestFiles&gt;</code>：match 到名為 <code>&lt;regexForTestFiles&gt;</code> (像此範例的 <code>my-test</code> ) 的檔案執行 Jest<ul><li>若在執行 <code>jest</code> 時使用了 <code>&lt;regexForTestFiles&gt;</code> argument，該 argument 會被視為 regex pattern，Jest 只會執行與 pattern match 的測試檔案</li><li>有些 terminal 可能需要用引號把 argument 包起來，例如：<code>jest &quot;my.*(complex)?pattern&quot;</code></li><li>Windows 需使用 <code>/</code> 作為路徑分隔字元 (separator) 或將 <code>\</code> 轉義 (escape) 成 <code>\\</code></li></ul></li><li><code>--config=&lt;path&gt;</code>，<code>-c=&lt;path&gt;</code>：使用 <code>&lt;path&gt;</code> (像此範例的 <code>config.json</code> ) 作為配置檔案<ul><li>Jest 配置檔案的路徑來指定如何查找和執行測試</li><li>如果在配置中未設定 <code>rootDir</code>，則假定包含配置檔案的目錄為專案的 <code>rootDir</code></li><li>也可以是 JSON-encoded value 作為 Jest 的配置</li></ul></li><li><code>--notify</code>：執行完成後顯示原生的 OS 通知<ul><li>激活 (activates) 測試結果通知</li><li>當你不希望自己的意識能夠專注於 JavaScript 測試以外的任何事物時，可用此 option</li><li>Beware：Jest 使用 <a href="https://github.com/mikaelbr/node-notifier" target="_blank" rel="noopener">node-notifier</a> 來顯示桌面通知<ul><li>在 Windows 上，它在第一次使用時會建立一個新的 start menu entry，並且不會顯示通知。通知將在後續執行中正確顯示</li></ul></li></ul></li></ul><h1 id="Jest-Config"><a class="header-anchor" href="#Jest-Config"></a>Jest Config</h1><p>使用下面指令生成 Jest 的基礎配置檔案 <code>jest.config.js</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> jest --init</span><br></code></pre></td></tr></table></figure><p>因為我沒有在 global 安裝 <code>jest</code>，所以需要透過 <code>yarn</code> 來執行 Jest CLI (或是可透過 <code>npx</code> 來執行)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn <span class="hljs-built_in">test</span> --init</span><br>yarn run v1.21.1<br><span class="hljs-meta">$</span><span class="bash"> jest --init</span><br><br>The following questions will help Jest to create a suitable configuration for your project<br><br>✔ Choose the test environment that will be used for testing › node<br>✔ Do you want Jest to add coverage reports? … yes<br>✔ Automatically clear mock calls and instances between every test? … no<br><br>📝  Configuration file created at /home/titan/.local/share/Trash/files/jest.config.js<br>Done in 7.41s.<br></code></pre></td></tr></table></figure><p>第一個問題我選擇 <code>node</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">? Choose the test environment that will be used for testing › - Use arrow-keys. Return to submit.<br>❯   node<br>    jsdom (browser-like)<br></code></pre></td></tr></table></figure><p>第二個問題：是否要測試涵蓋報告 (coverage reports)？我選擇 <code>yes</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">? Do you want Jest to add coverage reports? › (y/N)<br></code></pre></td></tr></table></figure><p>第三個問題：是否要在每個測試之間自動清除 mock calls 和 instance？我選擇 <code>No</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">? Automatically clear mock calls and instances between every test? › (y/N)<br></code></pre></td></tr></table></figure><p>下面是剛剛執行 <code>jest init</code> 時，所生成的 <code>jest.config.js</code> 設定：</p><ul><li><code>coverageDirectory</code>：Jest 輸出的 coverage 檔案要放在哪個目錄<ul><li>預設：<code>undefined</code></li></ul></li><li><code>testEnvironment</code>：用於測試的測試環境<ul><li>預設：<code>&quot;jsdom&quot;</code> (類似瀏覽器的環境)</li><li>若要建置 node service，可用 <code>&quot;node&quot;</code> 來使用類似 node 的環境</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">module</span>.exports = &#123;<br>  coverageDirectory: <span class="hljs-string">"coverage"</span>,<br>  testEnvironment: <span class="hljs-string">"node"</span><br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><p>更多 Jest 配置設定，詳情可參閱 <a href="https://jestjs.io/docs/en/configuration" target="_blank" rel="noopener">Configuring Jest · Jest</a>。</p></blockquote><h1 id="使用-Babel"><a class="header-anchor" href="#使用-Babel"></a>使用 Babel</h1><p>在安裝 Babel 前，將程式碼改成 ES6 語法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// sum.js</span><br><span class="hljs-keyword">const</span> sum = <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> sum;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// main.js</span><br><span class="hljs-keyword">import</span> sum <span class="hljs-keyword">from</span> <span class="hljs-string">'./sum'</span>;<br><br><span class="hljs-built_in">console</span>.log(sum(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>));<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// sum.test.js</span><br><span class="hljs-keyword">import</span> sum <span class="hljs-keyword">from</span> <span class="hljs-string">'./sum'</span>;<br><br>test(<span class="hljs-string">'adds 1 + 2 to equal 3'</span>, () =&gt; &#123;<br>  <span class="hljs-comment">// Arrange</span><br>  <span class="hljs-keyword">let</span> x = <span class="hljs-number">1</span>, y = <span class="hljs-number">2</span>;<br>  <span class="hljs-keyword">let</span> expected = <span class="hljs-number">3</span>;<br><br>  <span class="hljs-comment">// Act</span><br>  <span class="hljs-keyword">let</span> actual = sum(x, y);<br><br>  <span class="hljs-comment">// Assert</span><br>  expect(actual).toBe(expected);<br>&#125;);<br></code></pre></td></tr></table></figure><p>跑測試會出錯，因為 Jest 需要透過 Babel 才能執行 ES6 的語法：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn <span class="hljs-built_in">test</span></span><br></code></pre></td></tr></table></figure><p><img src="../images/jest-build-test-env/2020-05-24-23-17-50.png" alt=""></p><p>所以來安裝 <a href="http://babeljs.io/" target="_blank" rel="noopener">Babel</a>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn add -D babel-jest @babel/core @babel/preset-env</span><br></code></pre></td></tr></table></figure><p>在專案根目錄建立 <code>babel.config.js</code>，此檔案用於配置與你當前 Node 版本相容的 Babel：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// babel.config.js</span><br><span class="hljs-built_in">module</span>.exports = &#123;<br>  presets: [<br>    [<br>      <span class="hljs-string">'@babel/preset-env'</span>,<br>      &#123;<br>        targets: &#123;<br>          node: <span class="hljs-string">'current'</span>,<br>        &#125;,<br>      &#125;,<br>    ],<br>  ],<br>&#125;;<br></code></pre></td></tr></table></figure><p>再跑測試就會通過：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn <span class="hljs-built_in">test</span></span><br></code></pre></td></tr></table></figure><p><img src="../images/jest-build-test-env/2020-05-24-23-24-29.png" alt=""></p><blockquote><p>詳情可參閱 <a href="https://babeljs.io/docs/en/" target="_blank" rel="noopener">Babel 官方文件</a>。</p></blockquote><p>資料來源：</p><ul><li><a href="https://jestjs.io/docs/en/getting-started" target="_blank" rel="noopener">Getting Started · Jest</a></li><li><a href="https://jestjs.io/docs/en/cli" target="_blank" rel="noopener">Jest CLI Options · Jest</a></li><li><a href="https://jestjs.io/docs/en/configuration" target="_blank" rel="noopener">Configuring Jest · Jest</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Testing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> Jest </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Unit Testing </tag>
            
            <tag> Node.js </tag>
            
            <tag> Babel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sass：@import rule</title>
      <link href="/article/sass-import-rule.html"/>
      <url>/article/sass-import-rule.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/sass.jpg" alt=""></p><p>Sass 的 <code>@import</code> rule 可以引入 Sass 和 CSS stylesheet、提供對 mixin、function 和變數的存取，並且還能將多個 stylesheet 的 CSS 組合在一起。例如：<code>main.scss</code> 內使用 <code>@import</code> 引入 Sass 和 CSS 檔，在編譯 Sass 後，就只會產生一個 <code>main.css</code> 檔。</p><a id="more"></a><p>而 CSS 本身提供的 <code>@import</code> rule 會讓瀏覽器在呈現頁面時，有幾個 CSS 檔案是透過 <code>@import</code> 引入的，就要發出幾個 HTTP request，這與 Sass <code>@import</code> rule 的行為不同。</p><h2 id="同時引入多個檔案"><a class="header-anchor" href="#同時引入多個檔案"></a>同時引入多個檔案</h2><p>雖然 Sass 和 CSS 的引入語法相同，但 Sass 可以用逗號分隔，一次引入多個檔案，不需要每個檔案都各別用一行 <code>@import</code> 引入：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; _button.scss<br>.button &#123; color: #aaa; &#125;<br></code></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; _nav.scss<br>.nav &#123; color: #bbb; &#125;<br></code></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; main.scss<br>@import &#39;button&#39;, &#39;nav&#39;;<br><br>main &#123; color: #000; &#125;<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.button</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-number">#aaa</span>; &#125;<br><span class="hljs-selector-class">.nav</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-number">#bbb</span>; &#125;<br><span class="hljs-selector-tag">main</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-number">#000</span>; &#125;<br></code></pre></td></tr></table></figure><p>當 Sass 引入檔案時，會對該檔案進行估算，很像是將內容直接抄在你使用 <code>@import</code> 的位置上。</p><p>在 <code>@import</code> 之前定義的任何 mixin、function 或變數 (甚至來自其他 <code>@import</code> 的) 都可以在你引入的 stylesheet 中使用他們。</p><h2 id="不要重複引入"><a class="header-anchor" href="#不要重複引入"></a>不要重複引入</h2><p>所以若對同一個檔案引入多次，就會造成編譯出來的 CSS 檔案內，會有重複的 stylesheet。例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; main.scss<br>@import &#39;button&#39;;<br>@import &#39;button&#39;;<br><br>main &#123; color: #000; &#125;<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.button</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-number">#aaa</span>; &#125;<br><span class="hljs-selector-class">.button</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-number">#aaa</span>; &#125;<br><span class="hljs-selector-tag">main</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-number">#000</span>; &#125;<br></code></pre></td></tr></table></figure><p>除非你重複引入的檔案內，只有像是 mixin、function 或變數等不會產生樣式規則的東西，就不會產生重複的內容。</p><h2 id="引入不用寫副檔名"><a class="header-anchor" href="#引入不用寫副檔名"></a>引入不用寫副檔名</h2><p>另外，使用 Sass 的 <code>@import</code> rule 時，不用寫檔案的副檔名，因為 Sass 會自動幫你引入。</p><p>例如：當你引入 <code>@import &quot;a&quot;</code> 時，Sass 會自動引入 <code>a.scss</code>、<code>a.sass</code> 或 <code>a.css</code>。但 CSS 本身提供的 <code>@import</code> rule 記得要寫檔案的副檔名才能正確的引入。</p><h2 id="引入路徑"><a class="header-anchor" href="#引入路徑"></a>引入路徑</h2><ul><li>在引入 partials (以 <code>_</code> 為開頭的檔案) 時，不用寫 <code>_</code> 就能引入，且該檔案不會被編譯</li><li>引入檔案時可省略 <code>./</code> 相對引入</li><li>在使用 Sass CLI 時，若有提供 <code>--load-path</code> 或 <code>-I</code> option，就可以簡化引入的路徑<ul><li>詳情可參閱我之前寫的 <a href="https://titangene.github.io/article/dart-sass.html#load-path%EF%BC%8C-I">Dart Sass 介紹 (使用與安裝)</a></li><li>但引入時，Sass 會先解析相對於當前檔案的路徑，若沒有找到時，才會引入相對於 <code>--load-path</code> 提供的路徑內的檔案</li></ul></li></ul><p>例如：在 <code>node_modules/bootstrap/scss</code> 目錄內正好有名為 <code>_button.scss</code> 的檔案，而我引入了 <code>@import 'buttons'</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; src&#x2F;_buttons.scss<br>.button &#123; color: blue; &#125;<br></code></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; src&#x2F;main.scss<br>@import &#39;buttons&#39;;<br><br>main &#123; color: #000; &#125;<br></code></pre></td></tr></table></figure><p>編譯 Sass (注意，我使用了 <code>--load-path</code> option，指定了 Bootstrap 內的路徑)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass --load-path=node_modules/bootstrap/scss src/main.scss</span><br></code></pre></td></tr></table></figure><p>但輸出的結果表名，我引入的 <code>@import 'buttons'</code> 指的是 <code>src/_buttons.scss</code> 這個檔案，而不是 <code>node_modules/bootstrap/scss</code> 目錄內的 <code>_button.scss</code> 這個檔案：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.button</span> &#123; <span class="hljs-attribute">color</span>: blue; &#125;<br><span class="hljs-selector-tag">main</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-number">#000</span>; &#125;<br></code></pre></td></tr></table></figure><p>因為在 <code>src</code> 目錄內，<code>_buttons.scss</code> 相對於 <code>main.scss</code>，所以不會引用到 Bootstrap 內的檔案。</p><h2 id="index-檔案"><a class="header-anchor" href="#index-檔案"></a>index 檔案</h2><p>若在資料夾 (例如：<code>base</code> 資料夾) 內建立 <code>_index.scss</code> 或 <code>_index.sass</code> 檔案，而 index 檔案內引入了該資料夾內的其他檔案 (例如：<code>_code.scss</code> 和 <code>_list.scss</code> ) 時，則可直接透過 <code>@import</code> 該資料夾來引入那些檔案。</p><p>目錄結構：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree</span><br>.<br>├── base<br>│   ├── _code.scss<br>│   ├── _index.scss<br>│   └── _list.scss<br>└── main.scss<br></code></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; base&#x2F;_code.scss<br>code &#123; padding: 4px; &#125;<br></code></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; base&#x2F;_list.scss<br>ul &#123; padding: 0; &#125;<br></code></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; base&#x2F;_index.scss<br>@import &#39;code&#39;, &#39;list&#39;;<br></code></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; main.scss<br>@import &#39;base&#39;;<br><br>main &#123; color: #000; &#125;<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">code</span> &#123; <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span>; &#125;<br><span class="hljs-selector-tag">ul</span> &#123; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; &#125;<br><span class="hljs-selector-tag">main</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-number">#000</span>; &#125;<br></code></pre></td></tr></table></figure><h2 id="巢狀引入"><a class="header-anchor" href="#巢狀引入"></a>巢狀引入</h2><p>也可以巢狀引入，但要注意的是在巢狀引入 (nested import) 中定義的 mixin、function 或變數都還是全域定義的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; _button.scss<br>.button &#123; color: #aaa; &#125;<br></code></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; main.scss<br>main &#123;<br>  @import &#39;a&#39;;<br>&#125;<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">main</span> <span class="hljs-selector-class">.button</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-number">#aaa</span>; &#125;<br></code></pre></td></tr></table></figure><p>若是巢狀引入的檔案內有使用 parent selectors (也就是 <code>&amp;</code> )，則會引用 stylesheet 巢狀在其中的選擇器 (估算的方式類似 mixin)，例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; _theme.scss<br>ul li &#123;<br>  padding-left: 16px;<br><br>  [dir&#x3D;rtl] &amp; &#123;<br>    padding-left: 0;<br>    padding-right: 16px;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sass">&#x2F;&#x2F; style.scss<br>.theme-sample &#123;<br>  @import &#39;theme&#39;;<br>&#125;<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.theme-sample</span> <span class="hljs-selector-tag">ul</span> <span class="hljs-selector-tag">li</span> &#123;<br>  <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">16px</span>;<br>&#125;<br><span class="hljs-selector-attr">[dir=rtl]</span> <span class="hljs-selector-class">.theme-sample</span> <span class="hljs-selector-tag">ul</span> <span class="hljs-selector-tag">li</span> &#123;<br>  <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">16px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="引入-CSS"><a class="header-anchor" href="#引入-CSS"></a>引入 CSS</h2><p>Sass 的 <code>@import</code> rule 除了可以引入 <code>.scss</code> 和 <code>.sass</code> 檔，也可以引入 <code>.css</code> 檔。</p><p>但要記得在引入 <code>.css</code> 檔時，不可以像 <code>@import 'file.css';</code> 這樣明確的寫你引入了 <code>.css</code> 檔，而是要忽略副檔名。因為當你明確的寫 <code>.css</code> 副檔名時，代表你想用 <a href="https://sass-lang.com/documentation/at-rules/import#plain-css-imports" target="_blank" rel="noopener">CSS 原本的 <code>@import</code> rule</a>。</p><p>以下這些引入方式都是 CSS 原本的 <code>@import</code> rule：</p><ul><li>以 <code>.css</code> 為結尾的 URL</li><li>以 <code>http://</code> 或 <code>https://</code> 為開頭的 URL</li><li>用 <code>url()</code> 來引入 URL</li><li>具有 media query 的引入</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sass">@import &quot;theme.css&quot;;<br>@import &quot;http:&#x2F;&#x2F;fonts.googleapis.com&#x2F;css?family&#x3D;Droid+Sans&quot;;<br>@import url(theme);<br>@import &quot;landscape&quot; screen and (orientation: landscape);<br></code></pre></td></tr></table></figure><h2 id="Interpolation"><a class="header-anchor" href="#Interpolation"></a>Interpolation</h2><p>雖然 Sass imports 不能使用 <a href="https://sass-lang.com/documentation/interpolation" target="_blank" rel="noopener">interpolation</a>，但 CSS 原本的 <code>@import</code> 是可以的。這樣就可以動態生成引入的 URL，例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sass">@mixin google-font($family) &#123;<br>  @import url(&quot;http:&#x2F;&#x2F;fonts.googleapis.com&#x2F;css?family&#x3D;#&#123;$family&#125;&quot;);<br>&#125;<br><br>@include google-font(&quot;Droid Sans&quot;);<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@import</span> url(<span class="hljs-string">"http://fonts.googleapis.com/css?family=Droid Sans"</span>);<br></code></pre></td></tr></table></figure><p>資料來源：<a href="https://sass-lang.com/documentation/at-rules/import" target="_blank" rel="noopener">Sass: @import</a></p>]]></content>
      
      
      <categories>
          
          <category> Web Dev </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> Sass </tag>
            
            <tag> CSS </tag>
            
            <tag> Dart Sass </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sass：@use rule</title>
      <link href="/article/sass-use-rule.html"/>
      <url>/article/sass-use-rule.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/sass.jpg" alt=""></p><p>若要模組化 Sass，最常用的就是 <code>@import</code> 規則。但在 <a href="https://titangene.github.io/article/dart-sass.html">Dart Sass</a> 推出了一個新功能：模組系統，可用 <code>@use</code> 規則，並透過 namespace 來引入其他 stylesheet 中的成員。</p><a id="more"></a><h1 id="Overview"><a class="header-anchor" href="#Overview"></a>Overview</h1><ul><li>載入其他 Sass stylesheet 中的 mixin、函數和變數，並將多個 stylesheet 中的 CSS 組合在一起</li><li>不管用 <code>@use</code> 載入幾次的任何樣式，都只會在編譯的 CSS 輸出中出現一次</li><li><code>@use</code> 必須放在所有規則之前 (除了 <code>@forward</code> 和變數宣告之外)</li><li>便於了解成員是從哪些檔案載入的</li><li>不用像使用 <code>@import</code> 時那樣，需把命名寫清楚，因為可透過 <code>@use</code> 提供的 namespace 來避免命名衝突</li></ul><div class="info"><p>只要使用 <code>@use</code> 引入的檔案，stylesheet 就會被全部引入，不管有無另外使用。</p></div><h1 id="語法"><a class="header-anchor" href="#語法"></a>語法</h1><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@use</span> <span class="hljs-string">"&lt;url&gt;"</span>;<br><br><span class="hljs-keyword">@use</span> <span class="hljs-string">"&lt;url&gt;"</span> as &lt;namespace&gt;;<br><span class="hljs-keyword">@use</span> <span class="hljs-string">"&lt;url&gt;"</span> as *;<br><br><span class="hljs-keyword">@use</span> <span class="hljs-string">"&lt;url&gt;"</span> with (<br>  &lt;variable&gt;: &lt;value&gt;,<br>  &lt;variable&gt;: &lt;value&gt;<br>);<br></code></pre></td></tr></table></figure><h1 id="載入成員"><a class="header-anchor" href="#載入成員"></a>載入成員</h1><ul><li>用 <code>@use</code> 載入的 stylesheet 稱為「modules (模組)」。</li><li>使用 <code>@use</code> 時，可透過 namespace 來存取另一個模組中的變數、函數和 mixin：<ul><li>變數：<code>&lt;namespace&gt;.&lt;variable&gt;</code></li><li>函數：<code>&lt;namespace&gt;.&lt;function&gt;()</code></li><li>mixin：<code>@include &lt;namespace&gt;.&lt;mixin&gt;()</code></li></ul></li><li>預設的 <code>&lt;namespace&gt;</code> 就是模組 URL 的檔名 (不包含 <code>_</code> 底線前綴和副檔名)</li><li>用 <code>@use</code> 載入的成員有存取範圍，只有載入它們的 stylesheet 才能存取<ul><li>若其他 stylesheet 想存取這些成員，就必須自己寫 <code>@use</code> 載入</li></ul></li></ul><p>例如：用 <code>@use</code> 引入的 <code>styles/base/_color.scss</code> 檔案會像下面這樣，而此模組的 namespace 就是 <code>color</code>：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// styles/base/_color.scss</span><br><span class="hljs-variable">$blue</span>: <span class="hljs-number">#2979ff</span>;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// styles/_tool.scss</span><br><span class="hljs-keyword">@mixin</span> rounded &#123;<br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">3px</span>;<br>&#125;<br><br><span class="hljs-keyword">@function</span> px2em(<span class="hljs-variable">$pixel</span>, <span class="hljs-variable">$font-size-base</span>: <span class="hljs-number">16px</span>) &#123;<br>  <span class="hljs-keyword">@return</span> (<span class="hljs-variable">$pixel</span> / <span class="hljs-variable">$font-size-base</span>) * <span class="hljs-number">1em</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// styles/main.scss</span><br><span class="hljs-keyword">@use</span> <span class="hljs-string">"base/color"</span>;<br><span class="hljs-keyword">@use</span> <span class="hljs-string">"tool"</span>;<br><br><span class="hljs-selector-class">.button</span> &#123;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">color</span>: color.<span class="hljs-variable">$blue</span>;<br>  <span class="hljs-attribute">font-size</span>: tool.px2em(<span class="hljs-number">32px</span>);<br>  <span class="hljs-keyword">@include</span> tool.rounded;<br>&#125;<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.button</span> &#123;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#2979ff</span>;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2em</span>;<br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">3px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="設定-namespace"><a class="header-anchor" href="#設定-namespace"></a>設定 namespace</h1><p>語法：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@use</span> <span class="hljs-string">"&lt;url&gt;"</span> as &lt;namespace&gt;;<br><span class="hljs-keyword">@use</span> <span class="hljs-string">"&lt;url&gt;"</span> as *;<br></code></pre></td></tr></table></figure><p>自訂 namespace (很像設定 alias) 的情境：</p><ul><li>載入相同檔名的多個模組 (例如：第三方 library 和我的檔名相同)</li><li>讓模組的名稱變短</li></ul><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// src/_mycolor.scss</span><br><span class="hljs-variable">$blue</span>: <span class="hljs-number">#2979ff</span>;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// src/main.scss</span><br><span class="hljs-keyword">@use</span> <span class="hljs-string">"src/mycolor"</span> as color;<br><br><span class="hljs-selector-class">.button</span> &#123;<br>  <span class="hljs-attribute">color</span>: color.<span class="hljs-variable">$blue</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.button</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#2979ff</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>也可用 <code>*</code> 來載入沒有 namespace 的模組，但建議使用在自己寫的 stylesheet 或 <a href="https://sass-lang.com/documentation/modules" target="_blank" rel="noopener">Sass 提供的內建模組</a>，以避免引入名稱衝突的成員：</p><p>例如：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@use</span> <span class="hljs-string">'sass:math'</span> as *;<br><br><span class="hljs-variable">$half</span>: percentage(<span class="hljs-number">1</span>/<span class="hljs-number">2</span>);<br><br><span class="hljs-selector-class">.button</span> &#123;<br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-variable">$half</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.button</span> &#123;<br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="私有成員"><a class="header-anchor" href="#私有成員"></a>私有成員</h1><p>若你不想讓你定義的所有成員都可在 stylesheet 之外使用，就可在成員名稱的前面加上 <code>-</code> 或 <code>_</code>，來讓它們變成私有成員。</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// styles/_corner.scss</span><br>$_radius: <span class="hljs-number">3px</span>;<br><br><span class="hljs-keyword">@mixin</span> rounded &#123;<br>  <span class="hljs-attribute">border-radius</span>: $_radius;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// styles/main.scss</span><br><span class="hljs-keyword">@use</span> <span class="hljs-string">"corner"</span>;<br><br><span class="hljs-selector-class">.button</span> &#123;<br>  <span class="hljs-attribute">border-radius</span>: corner.rounded;<br>  <span class="hljs-attribute">padding</span>: corner.$_radius;  <span class="hljs-comment">// Error</span><br>&#125;<br></code></pre></td></tr></table></figure><p>編譯會報錯：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npx sass styles:dict/styles</span><br>Error: Private members can't be accessed from outside their modules.<br>  ╷<br>5 │   padding: corner.$_radius;<br>  │            ^^^^^^^^^^^^^^^<br>  ╵<br>  src/scss/main.scss 5:12  root stylesheet<br></code></pre></td></tr></table></figure><h1 id="配置模組"><a class="header-anchor" href="#配置模組"></a>配置模組</h1><p>stylesheet 可用 <a href="https://sass-lang.com/documentation/variables#default-values" target="_blank" rel="noopener"><code>!default</code> flag</a> 來定義變數，會被新的值給覆蓋。</p><p>若要載入帶有配置的模組，可用以下語法：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@use</span> <span class="hljs-string">"&lt;url&gt;"</span> with (<br>  &lt;variable&gt;: &lt;value&gt;,<br>  &lt;variable&gt;: &lt;value&gt;<br>);<br></code></pre></td></tr></table></figure><p>配置的值會覆蓋變數的預設值。</p><p>例如：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// styles/base/_color.scss</span><br><span class="hljs-variable">$blue</span>: <span class="hljs-number">#2979ff</span> !default;<br><span class="hljs-variable">$red</span>: <span class="hljs-number">#f44336</span> !default;<br><br><span class="hljs-variable">$primary</span>: <span class="hljs-variable">$blue</span>;<br><span class="hljs-variable">$secondary</span>: <span class="hljs-variable">$red</span>;<br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// styles/main.scss</span><br><span class="hljs-keyword">@use</span> <span class="hljs-string">"base/color"</span> with (<br>  <span class="hljs-variable">$blue</span>: <span class="hljs-number">#00f</span>,<br>  <span class="hljs-variable">$red</span>: <span class="hljs-number">#f00</span><br>);<br><br><span class="hljs-selector-class">.button-primary</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: color.<span class="hljs-variable">$primary</span>;<br>&#125;<br><br><span class="hljs-selector-class">.button-secondary</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: color.<span class="hljs-variable">$secondary</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.button-primary</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#00f</span>;<br>&#125;<br><br><span class="hljs-selector-class">.button-secondary</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f00</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>資料來源：</p><ul><li><a href="https://sass-lang.com/documentation/at-rules/use#configuring-modules" target="_blank" rel="noopener">Sass: @use</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Web Dev </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> Sass </tag>
            
            <tag> CSS </tag>
            
            <tag> Dart Sass </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dart Sass 介紹 (使用與安裝)</title>
      <link href="/article/dart-sass.html"/>
      <url>/article/dart-sass.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/sass.jpg" alt=""></p><p><a href="https://github.com/sass/dart-sass" target="_blank" rel="noopener">Dart Sass</a> 是 Sass 的主要實作，過去常見的是 Ruby Sass，而現今 <a href="https://sass-lang.com/ruby-sass" target="_blank" rel="noopener">Sass 官方推薦大家改用 Dart Sass</a>，尤其是用 JavaScript 或 Node.js 開發的相關專案。</p><a id="more"></a><p>Dart Sass 是 Sass 的 Dart 實作，效能比 Ruby Sass 還要快，且易於安裝，還可編譯成純 JavaScript，讓我們可以輕鬆的整合至現有的 Web 開發工作流程中。</p><h1 id="安裝"><a class="header-anchor" href="#安裝"></a>安裝</h1><p>有多種安裝和執行 Dart Sass 的方法：</p><h2 id="Standalone"><a class="header-anchor" href="#Standalone"></a>Standalone</h2><p>從 <a href="https://github.com/sass/dart-sass/releases/" target="_blank" rel="noopener">GitHub Release 頁面</a>下載適用於你 OS 的 standalone Dart Sass archive，其中包含 Dart VM 和 executable 的 snapshot。</p><p>使用方法很簡單，下載後並解壓縮，將解壓縮後的目錄新增至 <code>PATH</code> (<a href="https://katiek2.github.io/path-doc/" target="_blank" rel="noopener">這篇</a> 提供各 OS 如何設定 <code>PATH</code> 的步驟)，接著重新啟動 terminal，然後就能執行 <code>sass</code> executable 開始使用！</p><h2 id="npm"><a class="header-anchor" href="#npm"></a>npm</h2><p>可透過 npm 安裝 <a href="https://www.npmjs.com/package/sass" target="_blank" rel="noopener">Dart Sass</a>，該套件是已編譯為 JavaScript，且沒有任何 native code 或外部依賴。提供 command-line <code>sass</code> executable 和 Node.js API。</p><p>全域安裝：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install -g sass</span><br></code></pre></td></tr></table></figure><p>local 安裝：新增至專案</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm init -y</span><br><span class="hljs-meta">$</span><span class="bash"> npm install --save-dev sass</span><br></code></pre></td></tr></table></figure><div class="info"><p>其餘的安裝方式可參考 <a href="https://github.com/sass/dart-sass#using-dart-sass" target="_blank" rel="noopener">Dart Sass GitHub Repo 的 README 說明</a>。</p></div><h1 id="為何用-Dart？"><a class="header-anchor" href="#為何用-Dart？"></a>為何用 Dart？</h1><p>在 <a href="https://github.com/sass/dart-sass#why-dart" target="_blank" rel="noopener">Dart Sass GitHub Repo</a> 的 README 有提到為何 Dart Sass 會取代 Ruby Sass，有以下幾個優點：</p><ul><li>效能快：比 Ruby 塊，且與 C++ 差不多</li><li>免安裝：<ul><li>Dart VM 沒有外部依賴，可將應用程式編譯成獨立的 snapshot 檔案，因此可將 Dart Sass 只需發佈三個檔案 (VM、snapshot 和 wrapper script)</li><li>可編譯成 JavaScript，所以可透過 npm 發佈</li></ul></li><li>容易寫：<ul><li>Dart 是比 C++ 更高級的語言，不需要太多的記憶體管理和建制系統的麻煩</li><li>Dart 是靜態型別 (statically typed)，與 Ruby 相比 可更容易的進行大型重構</li></ul></li><li>對貢獻者更友好：<ul><li>Dart 比 Ruby 更容易學習</li></ul></li></ul><h1 id="Command-Line"><a class="header-anchor" href="#Command-Line"></a>Command Line</h1><p>Dart Sass executable 有兩種使用模式：</p><ul><li>One-to-One Mode (一對一模式)</li><li>Many-to-many Mode (多對多模式)</li></ul><h2 id="One-to-One-Mode"><a class="header-anchor" href="#One-to-One-Mode"></a>One-to-One Mode</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass &lt;input.scss&gt; [output.css]</span><br></code></pre></td></tr></table></figure><ul><li>一個輸入檔 ( <code>input.scss</code> ) 編譯成一個輸出檔 ( <code>output.scss</code> )</li><li>若為提供輸出路徑，會將已編譯的 CSS 列印至 terminal 上</li><li>若輸入檔的副檔名是：<ul><li><code>.scss</code>：解析成 <a href="https://sass-lang.com/documentation/syntax#scss" target="_blank" rel="noopener">SCSS</a></li><li><code>.sass</code>：解析成 <a href="https://sass-lang.com/documentation/syntax#the-indented-syntax" target="_blank" rel="noopener">縮排語法 (indented syntax)</a></li><li><code>.css</code>：解析成 <a href="https://sass-lang.com/documentation/at-rules/import#importing-css" target="_blank" rel="noopener">純 CSS</a></li><li>若都不是以上三種，或來至標準輸入，預設會解析成 SCSS<ul><li>也可用 <code>--indented</code> flag 來控制輸出格式</li></ul></li></ul></li></ul><h2 id="Many-to-many-Mode"><a class="header-anchor" href="#Many-to-many-Mode"></a>Many-to-many Mode</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass [&lt;input.css&gt;:&lt;output.css&gt;] [&lt;input/&gt;:&lt;output/&gt;]...</span><br></code></pre></td></tr></table></figure><ul><li>一個或多個輸入檔編譯成一個或多個輸出檔</li><li>輸入和輸出用 <code>:</code> 字元來隔開</li><li>可將目錄中的所有 Sass 檔編譯為另一個目錄中具有相同名稱的 CSS 檔</li></ul><p>例如：</p><p>將 <code>style.scss</code> 編譯成 <code>style.css</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass style.scss:style.css</span><br></code></pre></td></tr></table></figure><p>將 <code>light.scss</code> 和 <code>dark.scss</code> 編譯成 <code>light.css</code> 和 <code>dark.css</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass light.scss:light.css dark.scss:dark.css</span><br></code></pre></td></tr></table></figure><p>將 <code>src/scss/</code> 目錄內的所有 Sass 檔編譯至 <code>public/css/</code> 目錄中，且會編譯成 CSS 檔：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass src/scss:public/css</span><br></code></pre></td></tr></table></figure><div class="info"><p>編譯整個目錄時，如果只想編譯出一個 CSS 檔案 (例如：<code>main.css</code> )，就要將主要檔案之外的其他檔案的名稱，改為以 <code>_</code> 為開頭的 (例如：<code>_color.scss</code>，這種檔案被稱為 <a href="https://sass-lang.com/documentation/at-rules/import#partials" target="_blank" rel="noopener">partial 檔案</a>)。</p></div><h2 id="CLI-option"><a class="header-anchor" href="#CLI-option"></a>CLI option</h2><h3 id="indented"><a class="header-anchor" href="#indented"></a><code>--indented</code></h3><p>指定輸入檔要解析成縮排語法 (indented syntax)</p><h3 id="load-path，-I"><a class="header-anchor" href="#load-path，-I"></a><code>--load-path</code>，<code>-I</code></h3><ul><li>新增額外的載入路徑來查找 stylesheet</li><li>此 option 可使用多次，代表提供多個載入路徑</li><li>最先載入的會優先於較晚載入的路徑</li></ul><p>例如：如果沒有使用 <code>--load-path</code> option，要 import Bootstrap 就必須使用很長的路徑：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@import</span> <span class="hljs-string">"../node_modules/bootstrap/scss/functions"</span>;<br><span class="hljs-keyword">@import</span> <span class="hljs-string">"../node_modules/bootstrap/scss/variables"</span>;<br><span class="hljs-keyword">@import</span> <span class="hljs-string">"../node_modules/bootstrap/scss/mixins"</span>;<br></code></pre></td></tr></table></figure><p>若使用 <code>--load-path</code> option，就能簡短 import Bootstrap 的路徑：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass --load-path=node_modules src/main.scss dist/main.css</span><br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@import</span> <span class="hljs-string">"bootstrap/scss/functions"</span>;<br><span class="hljs-keyword">@import</span> <span class="hljs-string">"bootstrap/scss/variables"</span>;<br><span class="hljs-keyword">@import</span> <span class="hljs-string">"bootstrap/scss/mixins"</span>;<br></code></pre></td></tr></table></figure><h3 id="style，-s"><a class="header-anchor" href="#style，-s"></a><code>--style</code>，<code>-s</code></h3><p>指定 CSS 的輸出樣式。</p><p>Dart Sass 支援兩種輸出樣式：</p><ul><li><code>expanded</code>：預設，將每個選擇器和宣告寫在自己的那行上</li><li><code>compressed</code>：刪除盡可能多的多餘字元，並將整個 stylesheet 寫成一行</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass --style=expanded style.scss</span><br>h1 &#123;<br>  font-size: 40px;<br>&#125;<br><br><span class="hljs-meta">$</span><span class="bash"> sass --style=compressed style.scss</span><br>h1&#123;font-size:40px&#125;<br></code></pre></td></tr></table></figure><h3 id="error-css"><a class="header-anchor" href="#error-css"></a><code>--error-css</code></h3><ul><li>當編譯期間發生錯誤時，會告訴 Sass 是否 emit CSS 檔案</li><li>該 CSS 檔會在註解和 <code>body::before</code> 的 <code>content</code> property 中描述錯誤<ul><li>可在瀏覽器中察看錯誤訊息，而不會切回 terminal 察看</li></ul></li><li>預設若要編譯至少一個檔案 (不是標準輸出)，就會啟用 error CSS<ul><li>可在編譯成標準輸出時加上 <code>--error-css</code> 來啟用 error CSS</li><li>也可以加上 <code>--no-error-css</code> 來禁用 error CSS</li></ul></li><li>禁用 error CSS 後，<code>--update</code> flag 和 <code>--watch</code> flag 會在發生錯誤時刪除 CSS 檔案</li></ul><p>例如：以下 Sass 檔的內容是錯誤的：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// main.scss</span><br><span class="hljs-variable">$width</span>: <span class="hljs-number">15px</span> + <span class="hljs-number">2em</span>;<br></code></pre></td></tr></table></figure><p>編譯此 Sass 檔會出現以下錯誤：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass --error-css main.scss main.css</span><br>Error: Incompatible units em and px.<br>  ╷<br>1 │ $width: 15px + 2em;<br>  │         ^^^^^^^^^^<br>  ╵<br>  test.scss 1:9  root stylesheet<br></code></pre></td></tr></table></figure><p>而輸出的 <code>main.css</code> 檔的內容如下：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">/* Error: Incompatible units em and px.</span><br><span class="hljs-comment"> *   ,</span><br><span class="hljs-comment"> * 1 | $width: 15px + 2em;</span><br><span class="hljs-comment"> *   |         ^^^^^^^^^^</span><br><span class="hljs-comment"> *   '</span><br><span class="hljs-comment"> *   test.scss 1:9  root stylesheet */</span><br><br><span class="hljs-selector-tag">body</span><span class="hljs-selector-pseudo">::before</span> &#123;<br>  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">"Source Code Pro"</span>, <span class="hljs-string">"SF Mono"</span>, Monaco, Inconsolata, <span class="hljs-string">"Fira Mono"</span>,<br>      <span class="hljs-string">"Droid Sans Mono"</span>, monospace, monospace;<br>  <span class="hljs-attribute">white-space</span>: pre;<br>  <span class="hljs-attribute">display</span>: block;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1em</span>;<br>  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">1em</span>;<br>  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">2px</span> solid black;<br>  <span class="hljs-attribute">content</span>: <span class="hljs-string">"Error: Incompatible units em and px.\a   \2577 \a 1 \2502  $width: 15px + 2em;\a   \2502          ^^^^^^^^^^\a   \2575 \a   test.scss 1:9  root stylesheet"</span>;         <br>&#125;<br></code></pre></td></tr></table></figure><p>若用瀏覽器察看使用此 <code>main.css</code> 檔的頁面會像下圖這樣：</p><p><img src="../images/dart-sass/error-css.png" alt=""></p><h3 id="update"><a class="header-anchor" href="#update"></a><code>--update</code></h3><ul><li>當 stylesheets 的依賴更新時，Sass 就只會編譯 stylesheets</li><li>更新 stylesheets 時，會列印狀態訊息</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass --update themes:public/css</span><br>Compiled themes/light.scss to public/css/light.css.<br></code></pre></td></tr></table></figure><h3 id="watch"><a class="header-anchor" href="#watch"></a><code>--watch</code></h3><p>類似 <code>--update</code>，但是在完成第一次編譯後，Sass 保持 open 狀態，並在 stylesheets 或其依賴發生更改時繼續編譯 stylesheets。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass --watch themes:public/css</span><br>Compiled themes/light.scss to public/css/light.css.<br><br><span class="hljs-meta">#</span><span class="bash"> Then when you edit themes/dark.scss...</span><br>Compiled themes/dark.scss to public/css/dark.css.<br></code></pre></td></tr></table></figure><h2 id="常用的-option"><a class="header-anchor" href="#常用的-option"></a>常用的 option</h2><p>開發用：</p><ul><li><code>--watch</code>：watch 模式</li><li><code>-I node_modules</code>：新增額外載入的 <code>node_modules</code> 目錄</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass --watch -I node_modules src/scss:dict/styles</span><br></code></pre></td></tr></table></figure><p>部署用 (build)：</p><ul><li><code>-s compressed</code>：CSS Minifier</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sass -s compressed src/scss:dict/styles</span><br></code></pre></td></tr></table></figure><div class="info"><p>更多 CLI option 可參閱 <a href="https://sass-lang.com/documentation/cli/dart-sass" target="_blank" rel="noopener">Sass 文件</a>。</p></div><h1 id="資料來源"><a class="header-anchor" href="#資料來源"></a>資料來源</h1><ul><li><a href="https://github.com/sass/dart-sass#using-dart-sass" target="_blank" rel="noopener">sass/dart-sass: The reference implementation of Sass, written in Dart.</a></li><li><a href="https://sass-lang.com/ruby-sass" target="_blank" rel="noopener">Sass: Ruby Sass</a></li><li><a href="https://www.npmjs.com/package/sass" target="_blank" rel="noopener">sass - npm</a></li><li><a href="https://sass-lang.com/install" target="_blank" rel="noopener">Sass: Install Sass</a></li><li><a href="https://www.dart-china.org/t/topic/146" target="_blank" rel="noopener">CSS 預處理器 Sass 的預設實作將遷移到 Dart Sass - 分享 - Dart 中文社區</a></li><li><a href="https://sass-lang.com/documentation/cli/dart-sass" target="_blank" rel="noopener">Sass: Dart Sass Command-Line Interface</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Web Dev </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dart </tag>
            
            <tag> w3HexSchool </tag>
            
            <tag> Sass </tag>
            
            <tag> CSS </tag>
            
            <tag> Dart Sass </tag>
            
            <tag> CLI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>npm / Yarn 套件管理器指令比對 cheatsheet</title>
      <link href="/article/npm-and-yarn-cheatsheet.html"/>
      <url>/article/npm-and-yarn-cheatsheet.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/npm_yarn.jpg" alt=""></p><p>npm 或 Yarn 都是最常見的 Node.js 套件管理器。本篇紀錄兩個 CLI 對應的指令。</p><a id="more"></a><h2 id="建立新專案"><a class="header-anchor" href="#建立新專案"></a>建立新專案</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm init</span><br><span class="hljs-meta">$</span><span class="bash"> npm init -y</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn init</span><br><span class="hljs-meta">$</span><span class="bash"> yarn init -y</span><br></code></pre></td></tr></table></figure><h2 id="安裝專案-package-json-中的所有相依套件"><a class="header-anchor" href="#安裝專案-package-json-中的所有相依套件"></a>安裝專案 <code>package.json</code> 中的所有相依套件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn</span><br><span class="hljs-meta">$</span><span class="bash"> yarn install</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install</span><br><span class="hljs-meta">$</span><span class="bash"> npm i</span><br></code></pre></td></tr></table></figure><h2 id="安裝相依套件"><a class="header-anchor" href="#安裝相依套件"></a>安裝相依套件</h2><p>安裝相依套件，並將套件新增至不同類型的 <code>dependencies</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm i &lt;package&gt;</span><br><span class="hljs-meta">$</span><span class="bash"> npm install &lt;package&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt;</span><br><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt;@&lt;version&gt;</span><br><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt;@&lt;tag&gt;</span><br></code></pre></td></tr></table></figure><p>安裝套件並將此套件儲存至 <code>package.json</code> 中的 <code>dependencies</code> (目前 npm 的預設參數，不需加 <code>-S</code> 就有此功能，舊版 npm 需要加此 option 才會將安裝的套件存至 <code>package.json</code> )：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install &lt;package&gt; --save</span><br><span class="hljs-meta">$</span><span class="bash"> npm install &lt;package&gt; -S</span><br></code></pre></td></tr></table></figure><h3 id="新增至不同類型的-dependencies"><a class="header-anchor" href="#新增至不同類型的-dependencies"></a>新增至不同類型的 dependencies</h3><p>安裝相依套件，並將套件新增至不同類型的 <code>devDependencies</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install &lt;package&gt; --save-dev</span><br><span class="hljs-meta">$</span><span class="bash"> npm install &lt;package&gt; -D</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt; --dev</span><br><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt; -D</span><br></code></pre></td></tr></table></figure><p>安裝相依套件，並將套件新增至不同類型的 <code>optionalDependencies</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install &lt;package&gt; --save-optional</span><br><span class="hljs-meta">$</span><span class="bash"> npm install &lt;package&gt; -O</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt; --optional</span><br><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt; -O</span><br></code></pre></td></tr></table></figure><p>安裝相依套件，並將套件新增至不同類型的 <code>bundleDependencies</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install &lt;package&gt; --save-bundle</span><br><span class="hljs-meta">$</span><span class="bash"> npm install &lt;package&gt; -B</span><br></code></pre></td></tr></table></figure><p>安裝相依套件，並將套件新增至不同類型的 <code>peerDependencies</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt; --peer</span><br><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt; -P</span><br></code></pre></td></tr></table></figure><blockquote><p>不同類型的 dependencies 可參閱 <a href="https://classic.yarnpkg.com/zh-Hant/docs/dependency-types/" target="_blank" rel="noopener">Yarn 官方文件中的「依賴關係的種類」</a> 這篇。</p></blockquote><h3 id="安裝指定版本"><a class="header-anchor" href="#安裝指定版本"></a>安裝指定版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install &lt;package&gt; --save-exact</span><br><span class="hljs-meta">$</span><span class="bash"> npm install &lt;package&gt; -E</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt; --exact</span><br><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt; -E</span><br></code></pre></td></tr></table></figure><h3 id="安裝次版號的最新版"><a class="header-anchor" href="#安裝次版號的最新版"></a>安裝次版號的最新版</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt; --tilde</span><br><span class="hljs-meta">$</span><span class="bash"> yarn add &lt;package&gt; -T</span><br></code></pre></td></tr></table></figure><h3 id="在全域安裝套件"><a class="header-anchor" href="#在全域安裝套件"></a>在全域安裝套件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install -g &lt;package&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn global add &lt;package&gt;</span><br></code></pre></td></tr></table></figure><h2 id="升級相依套件"><a class="header-anchor" href="#升級相依套件"></a>升級相依套件</h2><p>升級目前專案的相依套件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm update</span><br><span class="hljs-meta">$</span><span class="bash"> npm update &lt;package&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn upgrade</span><br><span class="hljs-meta">$</span><span class="bash"> yarn upgrade &lt;package&gt;</span><br></code></pre></td></tr></table></figure><p>全域的相依套件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm update -g</span><br><span class="hljs-meta">$</span><span class="bash"> npm update -g &lt;package&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn global upgrade</span><br><span class="hljs-meta">$</span><span class="bash"> yarn global upgrade &lt;package&gt;</span><br></code></pre></td></tr></table></figure><h3 id="升級至最新版"><a class="header-anchor" href="#升級至最新版"></a>升級至最新版</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn upgrade &lt;package&gt; --latest</span><br></code></pre></td></tr></table></figure><h2 id="升級相依套件可選擇是否升級"><a class="header-anchor" href="#升級相依套件可選擇是否升級"></a>升級相依套件可選擇是否升級</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn upgrade-interactive &lt;package&gt;</span><br></code></pre></td></tr></table></figure><h2 id="刪除套件"><a class="header-anchor" href="#刪除套件"></a>刪除套件</h2><p>刪除目前專案的相依套件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm uninstall &lt;package&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn remove &lt;package&gt;</span><br></code></pre></td></tr></table></figure><p>刪除全域的相依套件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm uninstall -g &lt;package&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn global remove &lt;package&gt;</span><br></code></pre></td></tr></table></figure><h2 id="列出已安裝的套件"><a class="header-anchor" href="#列出已安裝的套件"></a>列出已安裝的套件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm ls</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> yarn list</span><br></code></pre></td></tr></table></figure><p>資料來源</p><ul><li><a href="https://classic.yarnpkg.com/zh-Hant/docs/migrating-from-npm" target="_blank" rel="noopener">migrating from npm | Yarn</a></li><li><a href="https://classic.yarnpkg.com/zh-Hant/docs/cli/add" target="_blank" rel="noopener">yarn add | Yarn</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Web Dev </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> CLI </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Node.js </tag>
            
            <tag> version manager </tag>
            
            <tag> npm </tag>
            
            <tag> Yarn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nvm：安裝、切換不同 Node.js 版本的管理器</title>
      <link href="/article/nvm.html"/>
      <url>/article/nvm.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/node.jpg" alt=""></p><p>nvm 是 Node.js 的版本管理器 (version manager)，可在同一台主機上安裝多個版本的 Node.js 環境，因為不同專案可能會使用不同的 Node.js 版本，那就需要透過一個版本管理器來切換不同的 Node.js 版本。</p><a id="more"></a><h2 id="安裝-NVM"><a class="header-anchor" href="#安裝-NVM"></a>安裝 NVM</h2><p>可用 <code>cURL</code> 或 <code>wget</code> 指令使用安裝腳本安裝或更新 nvm：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash</span><br></code></pre></td></tr></table></figure><p>此安裝腳本會將 nvm repo clone 到 <code>~/.nvm</code>，並且將 source line 新增至你的 profile 設定 ( <code>~/.bash_profile</code>、<code>~/.zshrc</code>、<code>~/.profile</code> 或 <code>~/.bashrc</code> )：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> NVM_DIR=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.nvm"</span><br>[ -s <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/nvm.sh"</span> ] &amp;&amp; \. <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/nvm.sh"</span>  <span class="hljs-comment"># This loads nvm</span><br>[ -s <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/bash_completion"</span> ] &amp;&amp; \. <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/bash_completion"</span>  <span class="hljs-comment"># This loads nvm bash_completion</span><br></code></pre></td></tr></table></figure><p>如果在 Linux 執行安裝腳本後，執行下面指令會顯示以下訊息或沒有任何訊息時，建議重開一個新的終端機 (terminal) 再重新執行一次 <code>nvm</code> 指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">command</span> -v nvm</span><br>nvm: command not found<br></code></pre></td></tr></table></figure><p>如果還是無法使用 nvm，可執行下面指令立即應用 ZSH 的設定：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> .zshrc</span><br></code></pre></td></tr></table></figure><div class="warning"><p>注意：</p><ul><li>使用 <code>nvm</code> 時，不需要 <code>sudo</code> 即可使用 <code>npm -g</code> 全域安裝模組，所以與其執行 <code>sudo npm i -g</code>，不如執行 <code>npm i -g</code></li><li>若你有 <code>~/.npmrc</code>，請確保裡面不包含任何 <code>prefix</code> 的設定 (因為與 <code>nvm</code> 不相容)</li><li>你可以 (但不應該) 保留以前在 “系統” 安裝的 Node.js，但 <code>nvm</code> 只對你的使用者帳戶 (用於安裝 <code>nvm</code> 的使用者帳戶) 可用。可能會導致版本不 match，因為其他使用者會使用 <code>/usr/local/lib/node_modules/*</code>，而使用者帳戶會使用 <code>~/.nvm/versions/node/vX.X.X/lib/node_modules/*</code></li></ul></div><h2 id="version：確認-NVM-是否安裝成功"><a class="header-anchor" href="#version：確認-NVM-是否安裝成功"></a><code>--version</code>：確認 NVM 是否安裝成功</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm --version</span><br>0.34.0<br></code></pre></td></tr></table></figure><h2 id="install：利用-NVM-安裝-Node-js"><a class="header-anchor" href="#install：利用-NVM-安裝-Node-js"></a><code>install</code>：利用 NVM 安裝 Node.js</h2><p>安裝 NVM 後，其實還沒安裝 Node 環境：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> node  </span><br>zsh: command not found: node<br></code></pre></td></tr></table></figure><p>如果執行下面指令，會提醒你需要執行 <code>install</code> 指令才能安裝 Node.js：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm use node</span><br>N/A: version "node -&gt; N/A" is not yet installed.<br><br>You need to run "nvm install node" to install it before using it.<br></code></pre></td></tr></table></figure><p>安裝最新版的 Node.js：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm install node</span><br>Downloading and installing node v12.8.1...<br>Downloading https://nodejs.org/dist/v12.8.1/node-v12.8.1-linux-x64.tar.xz...<br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">################################################################################################### 100.0%</span></span><br>Computing checksum with sha256sum<br>Checksums matched!<br>Now using node v12.8.1 (npm v6.10.2)<br>Creating default alias: default -&gt; node (-&gt; v12.8.1)<br></code></pre></td></tr></table></figure><p>如果要指定安裝版本，可以直接指定版本號：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm install 8.9.1</span><br></code></pre></td></tr></table></figure><p>安裝的第一個版本的 Node.js 會成員 nvm 的預設版本，新的 shell 就會以預設版本的 Node.js 來使用 (例如：<code>nvm alias default</code>)。</p><p>查看目前安裝 Node.js 的版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> node -v</span><br>v12.8.1<br></code></pre></td></tr></table></figure><h2 id="ls-remote：察看可用的安裝版本"><a class="header-anchor" href="#ls-remote：察看可用的安裝版本"></a><code>ls-remote</code>：察看可用的安裝版本</h2><p>可以看目前有哪些可用版本可安裝，在版本號前面的 <code>-&gt;</code> 箭頭符號代表目前 nvm 正在使用的 Node.js 版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm ls-remote</span><br>...<br>       v10.16.1   (LTS: Dubnium)<br>       v10.16.2   (LTS: Dubnium)<br>       v10.16.3   (Latest LTS: Dubnium)<br>...<br>        v12.7.0<br>        v12.8.0<br><span class="hljs-meta">-&gt;</span><span class="bash">      v12.8.1</span><br></code></pre></td></tr></table></figure><p>不過剛剛的 <code>ls-remote</code> 指令會把所有可用的版本都列出來，但通常會選擇安裝 LTS (Long-term support，長期支援) 版，所以只要加上 <code>-lts</code> 參數就可以指列出可用的 LTS 版：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm ls-remote --lts</span><br>...<br>       v10.16.1   (LTS: Dubnium)<br>       v10.16.2   (LTS: Dubnium)<br>       v10.16.3   (Latest LTS: Dubnium)<br></code></pre></td></tr></table></figure><p>如果版本號的文字有特殊顏色 (不是白色字)，則代表該版本的 Node.js 有透過 nvm 安裝過，例如：我的電腦就安裝了 <code>v10.16.3</code> 和 <code>v12.8.1</code>：</p><p><img src="../images/nvm/nvm-ls-remote.png" alt=""></p><h2 id="ls：查看目前安裝了哪些版本"><a class="header-anchor" href="#ls：查看目前安裝了哪些版本"></a><code>ls</code>：查看目前安裝了哪些版本</h2><p><code>ls</code> 指令可以查看目前安裝了哪些版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm ls</span><br>       v10.16.3<br><span class="hljs-meta">-&gt;</span><span class="bash">      v12.8.1</span><br>default -&gt; node (-&gt; v12.8.1)<br>node -&gt; stable (-&gt; v12.8.1) (default)<br>stable -&gt; 12.8 (-&gt; v12.8.1) (default)<br>iojs -&gt; N/A (default)<br>unstable -&gt; N/A (default)<br>lts/* -&gt; lts/dubnium (-&gt; N/A)<br>lts/argon -&gt; v4.9.1 (-&gt; N/A)<br>lts/boron -&gt; v6.17.1 (-&gt; N/A)<br>lts/carbon -&gt; v8.16.1 (-&gt; N/A)<br>lts/dubnium -&gt; v10.16.3<br></code></pre></td></tr></table></figure><h2 id="use：切換-Node-js-版本"><a class="header-anchor" href="#use：切換-Node-js-版本"></a><code>use</code>：切換 Node.js 版本</h2><p>如果要使用 nvm 切換正在使用的 Node.js 版本，可用 <code>use</code> 指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm use v10.6.3</span><br>Now using node v10.16.3 (npm v6.9.0)<br></code></pre></td></tr></table></figure><p>如果切換的目標版本還沒安裝，nvm 會提醒你要安裝：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm use lts/carbon </span><br>N/A: version "lts/carbon -&gt; N/A" is not yet installed.<br><br>You need to run "nvm install lts/carbon" to install it before using it.<br></code></pre></td></tr></table></figure><p>透過 nvm 安裝 Node.js 時，nvm 會將不同的 Node.js 版本儲存在 <code>~/.nvm/versions/node/vX.X.X</code>，然後再修改 <code>$PATH</code>，將指定版本的 Node.js 路徑加入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm current</span><br>v10.16.3<br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span>             </span><br>/home/titan/.nvm/versions/node/v10.16.3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br><br><span class="hljs-meta">$</span><span class="bash"> use v12.13.1</span><br><span class="hljs-meta">$</span><span class="bash"> nvm current</span><br>v12.13.1<br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span>             </span><br>/home/titan/.nvm/versions/node/v12.13.1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br></code></pre></td></tr></table></figure><p>在 nvm 的各個 Node.js 版本安裝的全域套件都會在各自版本的目錄內安裝，所以在切換至新安裝的 Node.js 版本後需要重新安裝，也因為如此，不同版本間的套件就不會有衝突問題。</p><h2 id="current：察看目前使用版本"><a class="header-anchor" href="#current：察看目前使用版本"></a><code>current</code>：察看目前使用版本</h2><p>如果忘記自己切換到哪個版本，可以用 <code>current</code> 指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm current</span><br>v10.6.3<br></code></pre></td></tr></table></figure><h2 id="run：直接執行-Node-js"><a class="header-anchor" href="#run：直接執行-Node-js"></a><code>run</code>：直接執行 Node.js</h2><p>如果要直接執行 Node.js，可以使用下面指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm run node</span><br>Running node v12.8.1 (npm v6.10.2)<br>Welcome to Node.js v12.8.1.<br>Type ".help" for more information.<br><span class="hljs-meta">&gt;</span><br></code></pre></td></tr></table></figure><h2 id="exec：指定要執行的-Node-js-版本"><a class="header-anchor" href="#exec：指定要執行的-Node-js-版本"></a><code>exec</code>：指定要執行的 Node.js 版本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm <span class="hljs-built_in">exec</span> 12.8.1 node</span><br>Running node v12.8.1 (npm v6.10.2)<br>Welcome to Node.js v12.8.1.<br>Type ".help" for more information.<br><span class="hljs-meta">&gt;</span><br></code></pre></td></tr></table></figure><h2 id="which：察看-Node-js-的安裝路徑"><a class="header-anchor" href="#which：察看-Node-js-的安裝路徑"></a><code>which</code>：察看 Node.js 的安裝路徑</h2><p>執行下面指令可以查看特定版本的 Node.js 的安裝路徑：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm <span class="hljs-built_in">which</span> 12.8.1</span><br>/home/titan/.nvm/versions/node/v12.8.1/bin/node<br></code></pre></td></tr></table></figure><h2 id="alias"><a class="header-anchor" href="#alias"></a>alias</h2><p>如下圖有些版本的文字是紅色或是顯示 <code>N/A</code>，就代表該版本未在電腦安裝：</p><p><img src="../images/nvm/nvm-ls.png" alt=""></p><p>預設 alias 可以取代版本號：</p><ul><li><code>node</code>：安裝最新版的 Node.js</li><li><code>iojs</code>：安裝最新版的 io.js</li><li><code>stable</code>：此 alias 已棄用，僅適用於 v0.12 以及更舊版，目前改為 <code>node</code> alias</li><li><code>unstable</code>：此 alias 為 v0.11，最後一個 “unstable” (不穩定) Node release，在 v1.0 之後的版本都是穩定版 (in SemVer, versions communicate breakage, not stability)</li></ul><p>可在下面這些指令使用以上預設別名：</p><ul><li><code>nvm install</code></li><li><code>nvm use</code></li><li><code>nvm run</code></li><li><code>nvm exec</code></li><li><code>nvm which</code></li><li>… 等</li></ul><h2 id="alias：察看別名、設定別名"><a class="header-anchor" href="#alias：察看別名、設定別名"></a><code>alias</code>：察看別名、設定別名</h2><h3 id="察看別名"><a class="header-anchor" href="#察看別名"></a>察看別名</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm <span class="hljs-built_in">alias</span>                                                                    * ?</span><br>default -&gt; v10.16.3<br>node -&gt; stable (-&gt; v12.8.1) (default)<br>stable -&gt; 12.8 (-&gt; v12.8.1) (default)<br>iojs -&gt; N/A (default)<br>unstable -&gt; N/A (default)<br>lts/* -&gt; lts/erbium (-&gt; N/A)<br>lts/argon -&gt; v4.9.1 (-&gt; N/A)<br>lts/boron -&gt; v6.17.1 (-&gt; N/A)<br>lts/carbon -&gt; v8.16.2 (-&gt; N/A)<br>lts/dubnium -&gt; v10.17.0 (-&gt; N/A)<br>lts/erbium -&gt; v12.13.0 (-&gt; N/A)<br></code></pre></td></tr></table></figure><h3 id="設定別名"><a class="header-anchor" href="#設定別名"></a>設定別名</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm <span class="hljs-built_in">alias</span> titan-test v10.15.3                                                  * ?</span><br>titan-test -&gt; v10.15.3<br></code></pre></td></tr></table></figure><p>接著用 <code>nvm alias</code> 指令就會看到剛剛新增的別名所對應的 Node.js 版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvm <span class="hljs-built_in">alias</span>                                                                    * ?</span><br>titan-test -&gt; v10.15.3<br>default -&gt; v10.16.3<br>node -&gt; stable (-&gt; v12.8.1) (default)<br>stable -&gt; 12.8 (-&gt; v12.8.1) (default)<br>iojs -&gt; N/A (default)<br>unstable -&gt; N/A (default)<br>lts/* -&gt; lts/erbium (-&gt; N/A)<br>lts/argon -&gt; v4.9.1 (-&gt; N/A)<br>lts/boron -&gt; v6.17.1 (-&gt; N/A)<br>lts/carbon -&gt; v8.16.2 (-&gt; N/A)<br>lts/dubnium -&gt; v10.17.0 (-&gt; N/A)<br>lts/erbium -&gt; v12.13.0 (-&gt; N/A)<br></code></pre></td></tr></table></figure><h2 id="資料來源"><a class="header-anchor" href="#資料來源"></a>資料來源</h2><ul><li><a href="https://github.com/nvm-sh/nvm#install--update-script" target="_blank" rel="noopener">nvm-sh/nvm: Node Version Manager</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Web Dev </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> CLI </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Node.js </tag>
            
            <tag> version manager </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>淺入 Git：detached HEAD</title>
      <link href="/article/git-detached-head.html"/>
      <url>/article/git-detached-head.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/git.jpg" alt=""></p><p>在 Git 的世界中，想回到過去，也許你會用 <code>git checkout</code> 跳至某個過去的 commit，但 Git 會提醒你正在「detached HEAD」狀態。那 detached <code>HEAD</code> 是什麼？它能做什麼？要怎麼離開 detached <code>HEAD</code> 狀態？</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><p>在之前的 <a href="https://titangene.github.io/article/git-head-ref.html">深入 Git：<code>HEAD</code> refs</a> 有談到 <code>HEAD</code> 通常會指向當前分支，而當前分支通常會指向該分支頂端的 commit (也就是該分支最新的 commit)。不過再某些情況下，會發生 <code>HEAD</code> 不是指向分支，而是指向某個 commit，而這個狀態的 <code>HEAD</code> 就被稱為「detached HEAD」。</p><p>下面會用以下 Git 歷史紀錄作為範例來說明 detached <code>HEAD</code>。本專案內有四個檔案，分別是 <code>a</code>、<code>b</code>、<code>c</code> 和 <code>d</code>，我為每個檔案分別建立了一個 commit：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ls</span><br>a  b  c  d<br><br><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">log</span> --oneline --graph --decorate</span><br>* 71e5770 (HEAD -&gt; master, origin/master) feat: d<br>* c3a31ea feat: c<br>* b757c26 feat: b<br>* 3b7be17 feat: a<br></code></pre></td></tr></table></figure><h2 id="路人甲發生的情境"><a class="header-anchor" href="#路人甲發生的情境"></a>路人甲發生的情境</h2><p>下面是路人甲發生的情境，讓我們來看這個情境發生了什麼？</p><p>現在 <code>HEAD</code> 指向 <code>master</code> 分支，而 <code>master</code> 分支指向名為 <code>e2f2a4</code> 的 commit：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">log</span> --oneline --graph --decorate</span><br>* 71e5770 (HEAD -&gt; master, origin/master) feat: d<br>* c3a31ea feat: c<br>* b757c26 feat: b<br>* 3b7be17 feat: a<br><br><span class="hljs-meta">$</span><span class="bash"> cat .git/HEAD</span><br>ref: refs/heads/master<br><span class="hljs-meta">$</span><span class="bash"> cat .git/refs/heads/master</span><br>71e57702f208a7c463a2b5cd069ea47cdbed9eba<br></code></pre></td></tr></table></figure><p>路人甲可能想回到過去的 commit，於是使用了 <code>git checkout &lt;commit&gt;</code> 跳至指定的 commit，假設要 checkout 至名為 <code>b757c26</code> 的 commit 就會看到以下訊息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git checkout b757c26</span><br>Note: checking out 'b757c26'.<br><br>You are in 'detached HEAD' state. You can look around, make experimental<br>changes and commit them, and you can discard any commits you make in this<br>state without impacting any branches by performing another checkout.<br><br>If you want to create a new branch to retain commits you create, you may<br>do so (now or later) by using -b with the checkout command again. Example:<br><br>  git checkout -b &lt;new-branch-name&gt;<br><br>HEAD is now at b757c26 feat: b<br></code></pre></td></tr></table></figure><div class="warning"><p>假設路人甲很少注意看 Git 提供的訊息，所以忽略了「detached HEAD」的提醒訊息。</p></div><p>路人甲只想確定自己是不是回到過去，於是執行 <code>git log</code> 來察看，的確看到 <code>HEAD</code> 指向 <code>b757c26</code> 這個 commit：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">log</span> --oneline --graph --decorate</span><br>* b757c26 (HEAD) feat: b<br>* 3b7be17 feat: a<br></code></pre></td></tr></table></figure><p>所以心滿意足的開始基於 <code>7e347a4</code> 這個 commit 開始建立兩個新的 commit：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">"test1"</span> &gt; test1</span><br><span class="hljs-meta">$</span><span class="bash"> git add test1</span><br><span class="hljs-meta">$</span><span class="bash"> git commit -m <span class="hljs-string">"feat: test1"</span></span><br>[detached HEAD 3936d06] feat: test1<br> 1 file changed, 0 insertions(+), 0 deletions(-)<br> create mode 100644 test1<br><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">"test2"</span> &gt; test2</span><br><span class="hljs-meta">$</span><span class="bash"> git add test2</span><br><span class="hljs-meta">$</span><span class="bash"> git commit -m <span class="hljs-string">"feat: test2"</span></span><br>[detached HEAD 845992a] feat: test2<br> 1 file changed, 1 insertion(+)<br> create mode 100644 test2<br></code></pre></td></tr></table></figure><p>所以現在 <code>git log</code> 變成這樣：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">log</span> --oneline --graph --decorate</span><br>* 845992a (HEAD) feat: test2<br>* 9fd0924 feat: test1<br>* b757c26 feat: b<br>* 3b7be17 feat: a<br></code></pre></td></tr></table></figure><p>當路人甲建立完 commit 後，突然想回到之前的 <code>master</code> 分支，所以執行 <code>git checkout master</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git checkout master</span><br>Warning: you are leaving 2 commits behind, not connected to<br>any of your branches:<br><br>  845992a feat: test2<br>  9fd0924 feat: test1<br><br>If you want to keep them by creating a new branch, this may be a good time<br>to do so with:<br><br> git branch &lt;new-branch-name&gt; 845992a<br><br>Switched to branch 'master'<br>Your branch is up to date with 'origin/master'.<br></code></pre></td></tr></table></figure><p>回到 <code>master</code> 分支後，路人甲看 <code>git log</code> 變成下面這樣馬上傻眼，心想：「剛剛的那兩個 commit 呢？怎麼不見了！怎麼辦啊！還找的回來嗎？」：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">log</span> --oneline --graph --decorate</span><br>* 71e5770 (HEAD -&gt; master, origin/master) feat: d<br>* c3a31ea feat: c<br>* b757c26 feat: b<br>* 3b7be17 feat: a<br></code></pre></td></tr></table></figure><p>好，看到這個故事，你應該會發現，其實 Git 一直不停的在輸出訊息提醒你：</p><ul><li>在 checkout 至某個 commit 時，會提醒你正在「detached HEAD」狀態</li><li>在「detached HEAD」狀態建立 commit 時，會像這樣提醒你：<code>[detached HEAD 845992a] feat: test2</code></li><li>在「detached HEAD」狀態建立 commit 後，checkout 回分支時，會像這樣提醒你：<code>Warning: you are leaving 2 commits behind</code></li></ul><p>所以看輸出訊息很重要！</p><div class="info"><p>我曾經就是那個不看輸出訊息的路人甲 XD</p></div><h2 id="此狀態有何用"><a class="header-anchor" href="#此狀態有何用"></a>此狀態有何用</h2><p>那「detached HEAD」狀態到底能做什麼？</p><p>如果在 detached <code>HEAD</code> 狀態時建立的 commit 是實驗性的，那的確可以直接 checkout 至任何分支，把那些 commit 都丟棄 (但 Git 不會馬上刪除，會自動等到 Git GC 來回收，所以還救的回來)，這代表你放棄了在 detached <code>HEAD</code> 狀態下所做的任何 commit，而且這些操作都不會影響任何分支。</p><p>那如果是像路人甲的情境那樣，你想保留那些 commit，那可以在該 commit 上建立 ref，讓該 ref 指向該 commit，ref 可以是分支或 tag。</p><p>建立 ref 有很多種方式，下面會介紹幾種處理的方式。</p><h2 id="資料來源"><a class="header-anchor" href="#資料來源"></a>資料來源</h2><ul><li><a href="https://git-scm.com/docs/git-checkout" target="_blank" rel="noopener">Git - git-checkout Documentation</a></li><li><a href="https://git-scm.com/book/en/v2/Git-Branching-Remote-Branches" target="_blank" rel="noopener">Git Branching - Remote Branches | Pro Git, 2/e</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深入 Git </tag>
            
            <tag> w3HexSchool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入 Git：Git 物件儲存 - tag 物件</title>
      <link href="/article/git-tag-object.html"/>
      <url>/article/git-tag-object.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/git.jpg" alt=""></p><p>本篇將深入探討 Git tag 是什麼？如何建立 tag？Git 是如何儲存 tag？與 commit 和分支的差別在哪？</p><a id="more"></a><h1 id="Git-tag"><a class="header-anchor" href="#Git-tag"></a>Git tag</h1><p>Git tag 常用於標記某個版本號碼，例如：<code>v0.5</code>、<code>v1.0.1</code>、<code>9.1.0-rc.2</code>、<code>v2.6.0-beta.3</code>。</p><p>在 Git 中有兩種類型的 tag：lightweight tag (輕量標籤) 和 annotated tag (註解標籤)。</p><p>先介紹兩者的共通點：</p><ul><li>提供更 friendlier 的名稱的標記</li><li>都會指向某個 Git 物件 (通常為 commit 物件，但也可以是其他物件，也就是 tree 物件、blob 物件，甚至是其他 tag 物件)<ul><li>只是 lightweight tag 是直接指向某 Git 物件</li><li>而 annotated tag 則是透過 tag 物件，間接指向某 Git 物件</li></ul></li><li>不會改變 tag 所指向的物件 (除非用 <code>git tag -f</code> 替換現有 tag)</li></ul><p>接著會說明各自的特性、要如何建立 lightweight tag 和 annotated tag，以及在 Git 中是如何儲存這些 tag 的。</p><p>下面會用以下 Git 歷史紀錄的範例來說明：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">log</span> --oneline --decorate</span><br>32aa934 (HEAD -&gt; master) feat: c<br>9b6d639 feat: b<br>d835d6b feat: a<br></code></pre></td></tr></table></figure><h2 id="lightweight-tag-輕量標籤"><a class="header-anchor" href="#lightweight-tag-輕量標籤"></a>lightweight tag (輕量標籤)</h2><ul><li>很像不會移動的分支，tag 只會指向一個特定的 Git 物件</li><li>若只作為暫時的標籤，且不想保留額外資訊，可用 lightweight tag</li></ul><h3 id="建立-lightweight-tag"><a class="header-anchor" href="#建立-lightweight-tag"></a>建立 lightweight tag</h3><p>建立 lightweight tag 時，不要指定 <code>-a</code>、<code>-s</code> 或 <code>-m</code> option (建立 annotated tag 時才會用到，後面會說明)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git tag &lt;tagname&gt; [&lt;commit&gt; | &lt;object&gt;]</span><br></code></pre></td></tr></table></figure><p>例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git tag v1.0-lw</span><br></code></pre></td></tr></table></figure><p>也可以指定某個 commit：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git tag v0.2-lw 9b6d639</span><br></code></pre></td></tr></table></figure><h3 id="察看-lightweight-tag"><a class="header-anchor" href="#察看-lightweight-tag"></a>察看 lightweight tag</h3><p>若要透過 <code>git show</code> 指令察看 lightweight tag，就不會看到該標籤的額外資訊，只會顯示標籤所在的 commit 資訊：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git show v1.0-lw</span><br>commit 32aa934a24212ef22cc373e7838c30618952003d (HEAD -&gt; master, tag: v1.0-lw)<br>Author: titangene &lt;titangene.tw@gmail.com&gt;<br>Date:   Sun Apr 5 21:36:25 2020 +0800<br><br>    feat: c<br><br>diff --git a/c b/c<br>new file mode 100644<br>index 0000000..f2ad6c7<br>--- /dev/null<br>+++ b/c<br>@@ -0,0 +1 @@<br>+c<br></code></pre></td></tr></table></figure><h3 id="lightweight-tag-存在哪？"><a class="header-anchor" href="#lightweight-tag-存在哪？"></a>lightweight tag 存在哪？</h3><p>Git 將 lightweight tag 存在 <code>.git/refs/tag</code> 目錄內：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree .git/refs/tags/</span><br>.git/refs/tags/<br>├── v0.2-lw<br>└── v1.0-lw<br><br>0 directories, 2 files<br></code></pre></td></tr></table></figure><p>tag ref 的內容就是該 tag 指向的 commit 物件 (也就是該 commit SHA-1 值)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat .git/refs/tags/v1.0-lw</span><br>32aa934a24212ef22cc373e7838c30618952003d<br></code></pre></td></tr></table></figure><p>使用 <code>git cat-file</code> 來確定此 SHA-1 值真的是 commit 物件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 32aa93</span><br>commit<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 32aa93</span><br>tree 04a59185a0c5f4047e4fd3fa87b0c84e671b00ee<br>parent 9b6d6398e5e020a76f9a0f8d620e676a1decc78a<br>author titangene &lt;titangene.tw@gmail.com&gt; 1586093785 +0800<br>committer titangene &lt;titangene.tw@gmail.com&gt; 1586093785 +0800<br><br>feat: c<br></code></pre></td></tr></table></figure><h3 id="使用底層指令建立-lightweight-tag"><a class="header-anchor" href="#使用底層指令建立-lightweight-tag"></a>使用底層指令建立 lightweight tag</h3><p>使用 <code>git update-ref</code> 底層指令建立 lightweight tag 的 ref：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git update-ref refs/tags/v0.1-lw d835d6bf85258f2fe93c582f60f3f148900e0d7f</span><br></code></pre></td></tr></table></figure><p>察看該 tag ref 的確是指向剛剛指定的 SHA-1 值：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat .git/refs/tags/v0.1-lw </span><br>d835d6bf85258f2fe93c582f60f3f148900e0d7f<br></code></pre></td></tr></table></figure><h2 id="annotated-tag-註解標籤"><a class="header-anchor" href="#annotated-tag-註解標籤"></a>annotated tag (註解標籤)</h2><ul><li>會在 Git 的資料庫中儲存成完整的物件。它們將被計算校驗碼 (checksummed)</li><li>包含：<ul><li>建立標籤的人 (tagger) 的名字、電子郵件和建立日期</li><li>紀錄一個標籤訊息 (tagging message)</li><li>指標 (也就是 Git 物件)</li></ul></li><li>可以簽名 (signed) 及透過 GNU Privacy Guard (GPG) 驗證</li><li>若想紀錄與 tag 有關的資訊 (例如：建立 tag 的人、時間)，建議使用 annotated tag</li></ul><h3 id="建立-annotated-tag"><a class="header-anchor" href="#建立-annotated-tag"></a>建立 annotated tag</h3><p>建立 annotated tag 時，可同時指定以下 option：</p><ul><li><code>-a</code>，<code>--annotate</code>：製作一個 unsigned、annotated tag 物件 (未簽名且帶有註解的標籤物件)</li><li><code>-m &lt;msg&gt;</code>，<code>--message=&lt;msg&gt;</code>：<ul><li>指定標籤訊息，此訊息會和此標籤一起儲存</li><li>若你沒有為標籤指定訊息，Git 就會開啟編輯器讓你輸入 (很像 <code>git commit</code> 沒有加上 <code>-m</code> option 那樣)</li><li>若加上多組 <code>-m</code> option，會將這些值串聯成段落</li><li>如果使用 <code>-m</code> option 但沒有加上 <code>-a</code>、<code>-s</code> 或 <code>-u &lt;keyid&gt;</code>，則代表是 <code>-a</code> (也就是建立 annotated tag)</li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git tag -a &lt;tagname&gt; -m &lt;msg&gt; [&lt;commit&gt; | &lt;object&gt;]</span><br></code></pre></td></tr></table></figure><p>例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git tag -a v1.0 -m <span class="hljs-string">"version 1.0"</span></span><br></code></pre></td></tr></table></figure><p>也可以指定某個 commit：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git tag -a v0.1 -m <span class="hljs-string">"version 0.1"</span> d835d6b</span><br></code></pre></td></tr></table></figure><h3 id="察看-annotated-tag-資訊"><a class="header-anchor" href="#察看-annotated-tag-資訊"></a>察看 annotated tag 資訊</h3><p>使用 <code>git show</code> 指令可查看標籤資訊，以及此標籤所標記的 commit 資訊：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git show v0.1</span><br>tag v0.1<br>Tagger: titangene &lt;titangene.tw@gmail.com&gt;<br>Date:   Sun Apr 5 21:39:01 2020 +0800<br><br>version 0.1<br><br>commit d835d6bf85258f2fe93c582f60f3f148900e0d7f (tag: v0.1)<br>Author: titangene &lt;titangene.tw@gmail.com&gt;<br>Date:   Sun Apr 5 21:36:18 2020 +0800<br><br>    feat: a<br><br>diff --git a/a b/a<br>new file mode 100644<br>index 0000000..7898192<br>--- /dev/null<br>+++ b/a<br>@@ -0,0 +1 @@<br>+a<br></code></pre></td></tr></table></figure><p>以上面標籤資訊為例，包含：</p><ul><li>標籤名稱：<code>v0.1</code></li><li>建立標籤的人 (tagger) 的名字、電子郵件：<code>Tagger: titangene &lt;titangene.tw@gmail.com&gt;</code></li><li>標籤建立日期：<code>Date: Sun Apr 5 21:39:01 2020 +0800</code></li><li>標籤訊息：<code>version 0.1</code></li><li>指標：在 <code>git show</code> 沒有提供，下面會提到</li></ul><h3 id="annotated-tag-存在哪？"><a class="header-anchor" href="#annotated-tag-存在哪？"></a>annotated tag 存在哪？</h3><p>Git 也將 annotated tag 存在 <code>.git/refs/tag</code> 目錄內：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree .git/refs/tags/</span><br>.git/refs/tags/<br>├── v0.1<br>├── v0.1-lw<br>├── v0.2-lw<br>├── v1.0<br>└── v1.0-lw<br><br>0 directories, 5 files<br></code></pre></td></tr></table></figure><p>tag ref 的內容就是該 tag 指向的 commit 物件 (也就是該 commit SHA-1 值)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat .git/refs/tags/v0.1</span><br>530097c078c2fa4c16a532443170a40179599a69<br></code></pre></td></tr></table></figure><p>使用 <code>git cat-file</code> 來確定此 SHA-1 值時，會發現跟剛剛介紹的 lightweight tag 不一樣，lightweight tag 會直接指向 commit 物件，而 annotated tag 則是指向 tag 物件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 530097</span><br>tag<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 530097</span><br>object d835d6bf85258f2fe93c582f60f3f148900e0d7f<br>type commit<br>tag v0.1<br>tagger titangene &lt;titangene.tw@gmail.com&gt; 1586093941 +0800<br><br>version 0.1<br></code></pre></td></tr></table></figure><p>而這個 tag 物件才是真正指向 commit 物件的 ref。</p><p>再次使用 <code>git cat-file</code> 指令，就能確定 tag 物件的確是指向 <code>d835d6</code> 這個 commit 物件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -t d835d6</span><br>commit<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p d835d6</span><br>tree aaff74984cccd156a469afa7d9ab10e4777beb24<br>author titangene &lt;titangene.tw@gmail.com&gt; 1586093778 +0800<br>committer titangene &lt;titangene.tw@gmail.com&gt; 1586093778 +0800<br><br>feat: a<br></code></pre></td></tr></table></figure><h3 id="使用底層指令建立-annotated-tag"><a class="header-anchor" href="#使用底層指令建立-annotated-tag"></a>使用底層指令建立 annotated tag</h3><p>建立 annotated tag 主要有兩個步驟：</p><ol><li>建立 tag 物件</li><li>建立 tag ref，此 tag ref 會指向剛剛建立的 tag 物件</li></ol><p>我之前在 <a href="https://titangene.github.io/article/git--blob-object.html#hash-object-%E8%A8%88%E7%AE%97%E7%89%A9%E4%BB%B6%E5%90%8D%E7%A8%B1%E7%9A%84%E6%BC%94%E7%AE%97%E6%B3%95">深入 Git：Git 物件儲存 - blob 物件</a> 這篇有提到建立 Git 物件的底層指令 <code>git hash-object</code>，以及這個底層指令的原理。</p><p>但是在使用 <code>git hash-object</code> 之前，必須要先準備好這個指令上的 <code>--stdin</code> option 要從 stdin (standard input，標準輸入) 讀取的內容，內容格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">object &lt;object-sha1&gt;<br>type &lt;object-type&gt;<br>tag &lt;tag-name&gt;<br>tagger &lt;tagger-name&gt; &lt;&lt;tagger-email&gt;&gt; &lt;timestamp&gt;<br><br>&lt;tag-message&gt;<br></code></pre></td></tr></table></figure><p>內容範例如下 (我先隨意將以下內容儲存在一個檔案內，任意檔名都可以，因為重點是檔案的內容)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> vim my-tag.txt</span><br><span class="hljs-meta">$</span><span class="bash"> cat my-tag.txt</span><br>object 61780798228d17af2d34fce4cfbdf35556832472<br>type blob<br>tag file-b<br>tagger titangene &lt;titangene.tw@gmail.com&gt; 1586097930 +0800<br><br>file b<br></code></pre></td></tr></table></figure><p>因為這次要建立的是 tag 物件，所以需要在 <code>git hash-object</code> 指令上加上 <code>-t</code> option，並且指定 <code>tag</code>，代表要建立 tag 物件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">hash</span>-object -t tag -w --stdin &lt; my-tag.txt</span><br>8785f7a44e2af5628544ecb0aa9dccf2adfa37ff<br></code></pre></td></tr></table></figure><p>這邊輸出的 <code>8785f7</code> 就是剛剛建立的 tag 物件的 SHA-1 值，我們用 <code>git cat-file</code> 來驗證一下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 8785f7</span><br>tag<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 8785f7</span><br>object 61780798228d17af2d34fce4cfbdf35556832472<br>type blob<br>tag file-b<br>tagger titangene &lt;titangene.tw@gmail.com&gt; 1586097930 +0800<br><br>file b<br></code></pre></td></tr></table></figure><p>接著處理第二步驟，使用 <code>git update-ref</code> 底層指令建立 annotated tag 的 ref：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git update-ref refs/tags/file-b 8785f7a44e2af5628544ecb0aa9dccf2adfa37ff</span><br></code></pre></td></tr></table></figure><p>察看該 tag ref 的確是指向剛剛指定的 SHA-1 值 (在這邊就是 tag 物件)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat .git/refs/tags/file-b  </span><br>8785f7a44e2af5628544ecb0aa9dccf2adfa37ff<br></code></pre></td></tr></table></figure><h2 id="在-git-log-察看-tag"><a class="header-anchor" href="#在-git-log-察看-tag"></a>在 <code>git log</code> 察看 tag</h2><p>使用 <code>git log</code> 察看剛剛建立的 tag 都貼上哪個 commit 上面 (也就是那些 tag 都指向哪個 commit)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">log</span> --oneline --decorate</span><br>32aa934 (HEAD -&gt; master, tag: v1.0-lw, tag: v1.0) feat: c<br>9b6d639 (tag: v0.2-lw) feat: b<br>d835d6b (tag: v0.1-lw, tag: v0.1) feat: a<br></code></pre></td></tr></table></figure><p>另外提一下 (雖然上面有介紹到)，不管是 lightweight tag 還是 annotated tag，如果是指向 commit 物件之外的其他 Git 物件 (也就是 blob 物件或 tree 物件，甚至是其他 tag 物件)，都無法在 <code>git log</code> 的輸出察看，只能透過 <code>git show</code> 或是透過 <code>cat</code> 和 <code>git cat-file</code> 指令來察看該 tag 是指向哪個 Git 物件。</p><p>下面以 annotated tag 為例，透過這些指令來找到名為 <code>file-b</code> 的 tag 指向 SHA-1 值為 <code>8785f7</code> 的 tag 物件，而該 tag 物件是指向 SHA-1 值為 <code>617807</code> 的 blob 物件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git tag -a file-c -m <span class="hljs-string">"file c"</span> f2ad6c</span><br><br><span class="hljs-meta">$</span><span class="bash"> cat .git/refs/tags/file-c</span><br>febbaa9a5276f0321d72232c4bc3aa561bfc38c5<br><br><span class="hljs-meta">$</span><span class="bash"> git cat-file -t febbaa</span><br>tag<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p febbaa</span><br>object f2ad6c76f0115a6ba5b00456a849810e7ec0af20<br>type blob<br>tag file-c<br>tagger titangene &lt;titangene.tw@gmail.com&gt; 1586100520 +0800<br><br>file c<br></code></pre></td></tr></table></figure><h2 id="察看所有-tag"><a class="header-anchor" href="#察看所有-tag"></a>察看所有 tag</h2><p>執行 <code>git tag</code> 指令可以察看所有建立的 tag：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git tag</span><br>file-b<br>file-c<br>v0.1<br>v0.1-lw<br>v0.2-lw<br>v1.0<br>v1.0-lw<br></code></pre></td></tr></table></figure><h1 id="commit-vs-tag"><a class="header-anchor" href="#commit-vs-tag"></a>commit vs tag</h1><ul><li>commit 物件紀錄的指標只能是 tree 物件，不能是其他 Git 物件</li><li>tag 物件通常紀錄的指標是 commit 物件，當然也可以是其他 Git 物件，包括 tree 物件、blob 物件，甚至是其他 tag 物件</li></ul><h1 id="分支-vs-tag"><a class="header-anchor" href="#分支-vs-tag"></a>分支 vs tag</h1><p>那分支和 tag 都可以指向 commit 物件，那他們有何差別？</p><ul><li>分支：在提交新的 commit 時，會將分支指向該分支的末端，也就是新的 commit 物件</li><li>lightweight tag 和 annotated tag 這兩種 tag 都是永遠不會改變 tag 所指向的物件，只是提供更 friendlier 的名稱的標記而已<ul><li>lightweight tag：很像不會移動的分支，此 tag ref 只會指向一個特定的 Git 物件</li><li>annotated tag：此 tag ref 會指向 tag 物件，而 tag 物件會指向一個特定的 Git 物件</li></ul></li></ul><p>資料來源：</p><ul><li><a href="https://git-scm.com/book/zh-tw/v2/Git-Internals-Git-References" target="_blank" rel="noopener">Git Internals - Git References | Pro Git, 2/e</a></li><li><a href="https://git-scm.com/book/zh-tw/v2/Git-%E5%9F%BA%E7%A4%8E-%E6%A8%99%E7%B1%A4" target="_blank" rel="noopener">Git 基礎 - 標籤 | Pro Git, 2/e</a></li><li><a href="https://stackoverflow.com/questions/10986615/what-is-the-format-of-a-git-tag-object-and-how-to-calculate-its-sha" target="_blank" rel="noopener">hash - What is the format of a git tag object and how to calculate its SHA? - Stack Overflow</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深入 Git </tag>
            
            <tag> w3HexSchool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入 Git：HEAD refs</title>
      <link href="/article/git-head-ref.html"/>
      <url>/article/git-head-ref.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/git.jpg" alt=""></p><p>本篇將深入探討 Git <code>HEAD</code> 是什麼？儲存在 repo 的哪裡？以及跟 <code>git branch</code> 和 <code>git checkout</code> 之間的關係。</p><a id="more"></a><p>上次提到的 <a href="https://titangene.github.io/article/git-branch-ref.html">Git 分支 ref</a>，可用來紀錄不同的工作過程，例如最常見的 <code>master</code> 和 <code>develop</code> 分支，<code>master</code> 分支通常用來紀錄發佈的版本，而 <code>develop</code> 分支通常用來紀錄正在開發的版本。</p><p>那 Git 是如何知道你正在哪一個分支？其實是透過 <code>HEAD</code> 檔案來紀錄的。這個檔案通常會放在 <code>.git</code> 路徑底下。</p><p>通常 <code>HEAD</code> 檔案是對當前所在分支的 symbolic reference <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>，也就是紀錄你正在哪一個分支的檔案：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat .git/HEAD</span><br>ref: refs/heads/master<br></code></pre></td></tr></table></figure><p>如果執行 <code>git checkout</code> 來切換分支，Git 就會更新 <code>HEAD</code> 檔案：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git checkout</span><br>Switched to branch 'test'<br><span class="hljs-meta">$</span><span class="bash"> cat .git/HEAD</span><br>ref: refs/heads/test<br></code></pre></td></tr></table></figure><p>在執行 <code>git commit</code> 時，為何當前所在的分支會一直指向最新的 commit？這是因為 <code>HEAD</code> 會指向當前分支，而當前分支會指向該分支的末端，也就是說，當執行 <code>git commit</code> 時，Git 會建立新的 <a href="https://titangene.github.io/article/git-commit-object.html">commit 物件</a>，而分支會被更新成指向該分支的末端 (也就是新的 commit 物件)。</p><p>通常 <code>HEAD</code> 會指向當前分支，若 <code>HEAD</code> 檔案的內容為 Git 物件的 SHA-1 值時，則代表 <a href="https://git-scm.com/docs/git-checkout#_detached_head" target="_blank" rel="noopener">detached HEAD</a> 狀態。這種情況會在你使用 <code>git checkout</code> 切換至 tag、commit 或遠端分支時發生。在此狀態下，沒有分支會與 working tree 關聯。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git checkout 665439e            </span><br>Note: checking out '665439e'.<br><br>You are in 'detached HEAD' state. You can look around, make experimental<br>changes and commit them, and you can discard any commits you make in this<br>state without impacting any branches by performing another checkout.<br><br>If you want to create a new branch to retain commits you create, you may<br>do so (now or later) by using -b with the checkout command again. Example:<br><br>  git checkout -b &lt;new-branch-name&gt;<br><br>HEAD is now at 665439e feat: a<br></code></pre></td></tr></table></figure><h2 id="手動編輯-HEAD-檔案模擬-checkout-分支"><a class="header-anchor" href="#手動編輯-HEAD-檔案模擬-checkout-分支"></a>手動編輯 <code>HEAD</code> 檔案模擬 checkout 分支</h2><p>我們來手動編輯此 <code>HEAD</code> 檔案，驗證改變 <code>HEAD</code> 檔案的內容就等同於在 <code>git checkout</code> 至某個分支。</p><p>假設目前正在 <code>test</code> 分支，然後將 <code>HEAD</code> 檔案的內容從 <code>ref: refs/heads/test</code> 變成 <code>ref: refs/heads/master</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git branch</span><br>* test<br>  master<br><br><span class="hljs-meta">$</span><span class="bash"> cat .git/HEAD</span><br>ref: refs/heads/test<br><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">"ref: refs/heads/master"</span> &gt; .git/HEAD</span><br></code></pre></td></tr></table></figure><p>然後用 <code>git branch</code> 就能驗證現在已經「<code>checkout</code>」至 <code>master</code> 分支：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git branch</span><br>  test<br>* master<br></code></pre></td></tr></table></figure><h2 id="使用-symbolic-ref-底層指令"><a class="header-anchor" href="#使用-symbolic-ref-底層指令"></a>使用 <code>symbolic-ref</code> 底層指令</h2><p>雖然剛剛有提到可以手動編輯 <code>HEAD</code> 檔案，但建議使用 Git 提供的底層指令 <a href="https://git-scm.com/docs/git-symbolic-ref" target="_blank" rel="noopener"><code>git symbolic-ref</code></a> 來編輯和讀取 <code>HEAD</code> 檔案：</p><p>讀取 <code>HEAD</code> 檔案 (察看當前所在分支)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git symbolic-ref HEAD</span><br>refs/heads/master<br></code></pre></td></tr></table></figure><p>加上 <code>--short</code> option 會只顯示分支名稱，不會顯示分支 ref 的路徑：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git symbolic-ref HEAD --short</span><br>master<br></code></pre></td></tr></table></figure><p>設定 <code>HEAD</code> 檔案 (等同於 <code>git checkout &lt;branch&gt;</code> )：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git symbolic-ref HEAD refs/heads/<span class="hljs-built_in">test</span></span><br><span class="hljs-meta">$</span><span class="bash"> cat .git/HEAD</span><br>ref: refs/heads/test<br></code></pre></td></tr></table></figure><p>一定要用 <code>refs/</code> 為開頭的 ref 才能設定 <code>HEAD</code> 檔案，要不然會報錯：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git symbolic-ref HEAD <span class="hljs-built_in">test</span></span><br>fatal: Refusing to point HEAD outside of refs/<br></code></pre></td></tr></table></figure><p>資料來源：</p><ul><li><a href="https://git-scm.com/book/en/v2/Git-Internals-Git-References" target="_blank" rel="noopener">Git Internals - Git References | Pro Git, 2/e</a></li></ul><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://git-scm.com/docs/gitglossary#def_symref" target="_blank" rel="noopener">Git - gitglossary Documentation</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深入 Git </tag>
            
            <tag> w3HexSchool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入 Git：分支 refs</title>
      <link href="/article/git-branch-ref.html"/>
      <url>/article/git-branch-ref.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/git.jpg" alt=""></p><p>本篇將深入探討 Git 分支到底是什麼？建立分支時到底建立了什麼？如何紀錄分支要指向哪個 commit？</p><a id="more"></a><p>Git 參考 (references 或 refs) 都存在 <code>.git/refs</code> 目錄內，目錄結構如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree .git/refs/</span><br>.git/refs/<br>├── heads<br>└── tags<br><br>2 directories, 0 files<br></code></pre></td></tr></table></figure><p>因為「<a href="https://titangene.github.io/tags/%E6%B7%B1%E5%85%A5-git/">深入 Git</a>」此文章系列都是探討如何用 Git 的底層指令來模擬 Git 高階指令的操作。在之前建立 <a href="https://titangene.github.io/article/git--blob-object.html">blob</a>、<a href="https://titangene.github.io/article/git-tree-object.html">tree</a> 和 <a href="https://titangene.github.io/article/git-commit-object.html">commit</a> 物件時，都還沒建立 Git refs，所以 <code>.git/refs</code> 目錄內的資料夾中，才沒有其他紀錄指標的檔案。</p><p>若用平常使用的高階指令就會幫你建立很多 Git refs，目錄可能像下面這樣：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree .git/refs/</span><br>.git/refs/<br>├── heads<br>│   ├── develop<br>│   └── master<br>├── original<br>│   └── refs<br>│       └── heads<br>│           └── master<br>├── remotes<br>│   └── origin<br>│       ├── develop<br>│       └── master<br>└── tags<br>    └── v1.0<br></code></pre></td></tr></table></figure><p>那我們就開始試著利用底層指令來手動建立 Git refs 吧！</p><h2 id="建立分支-ref"><a class="header-anchor" href="#建立分支-ref"></a>建立分支 ref</h2><p>若沒有 Git refs，就要像這樣指定 commit 的 SHA-1 值才能看到歷史紀錄：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">log</span> --oneline --decorate 200c91</span><br>200c91c second commit<br>9079eb3 first commit<br></code></pre></td></tr></table></figure><p>若有一個指標指向該 commit 的 SHA-1 值就不用再記住了，省很多麻煩。</p><p>而 <code>master</code> 就是最常見的指標，要建立分支的指標其實很簡單，只要在 <code>.git/refs/heads</code> 目錄內，建立該分支名稱的檔案，而檔案內容就是你要指定的 commit SHA-1 值，例如：我要將 <code>master</code> 分支指向 <code>200c91</code> 這個 commit 上，可執行以下指令建立分支 ref：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> 200c91c4acb82e529fb8205ea786a17cc10008b6 &gt; .git/refs/heads/master</span><br></code></pre></td></tr></table></figure><p>建立分支後，就可以使用剛剛建立的 head ref (分支頂端的 commit 的 named reference，通常儲存在 <code>.git/refs/heads</code> 目錄中) <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> 來察看歷史紀錄：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">log</span> --oneline --decorate master</span><br>200c91c (HEAD -&gt; master) second commit<br>9079eb3 first commit<br></code></pre></td></tr></table></figure><p>不過，不建議你自己編輯 ref 檔案。Git 提供 <code>git update-ref</code> 這個底層指令可讓你更新 ref (可不用輸入完整的 commit SHA-1 值，因為 Git 會自動找到對應的 Git 物件)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git update-ref refs/heads/master 200c91</span><br></code></pre></td></tr></table></figure><p>剛剛建立的 head ref 就是分支。分支只是一個指標 (不是像樹的分岔樹枝)，用來紀錄正在開發的分支的最新 commit (或 head) 的 SHA-1 值：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat .git/refs/heads/master</span><br>200c91c4acb82e529fb8205ea786a17cc10008b6<br></code></pre></td></tr></table></figure><p>要察看此 repo 有哪些 Git ref，可用 Git 提供的 <code>git show-ref</code> 這個底層指令來察看：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git show-ref</span><br>200c91c4acb82e529fb8205ea786a17cc10008b6 refs/heads/master<br></code></pre></td></tr></table></figure><p>所以你在執行 <code>git branch &lt;branch&gt;</code> 指令時，Git 基本上會執行 <code>git update-ref</code> 指令，將你當前所在分支的最後一個 commit 的 SHA-1 新增至你想建立的新 reference (也就是分支 ref)。</p><p>資料來源：</p><ul><li><a href="https://git-scm.com/book/en/v2/Git-Internals-Git-References" target="_blank" rel="noopener">Git - Git References | Pro Git, 2/e</a></li></ul><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://git-scm.com/docs/gitglossary#Documentation/gitglossary.txt-aiddefheadahead" target="_blank" rel="noopener">Git - gitglossary Documentation</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深入 Git </tag>
            
            <tag> w3HexSchool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入 Git：Git 物件儲存 - commit 物件</title>
      <link href="/article/git-commit-object.html"/>
      <url>/article/git-commit-object.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/git.jpg" alt=""></p><p>本篇將深入探討 Git 如何運作，在執行 <code>git commit</code> 時，Git 會如何建立和儲存 commit 物件。</p><a id="more"></a><p>tree 物件會指向追蹤專案的不同 snapshot，若要取得這些 snapshot 就會遇到一些問題：</p><ul><li>必須記得這些 tree 物件的 SHA-1 值 (麻煩)</li><li>snapshot 是誰儲存的</li><li>snapshot 是何時儲存的</li><li>為何要儲存 snapshot</li></ul><p>以上這些就是 commit 物件為你儲存的資訊。</p><h2 id="準備"><a class="header-anchor" href="#準備"></a>準備</h2><p>下面會以這個檔案結構為範例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> mkdir demo</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> demo</span><br><span class="hljs-meta">$</span><span class="bash"> git init</span><br>Initialized empty Git repository in /home/titan/project/demo/.git/<br><span class="hljs-meta">$</span><span class="bash"> mkdir styles</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">"index"</span> &gt; index.html</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">"# README"</span> &gt; README.md</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">"/* style */"</span> &gt; styles/main.css</span><br><br><span class="hljs-meta">$</span><span class="bash"> tree      </span><br>.<br>├── index.html<br>├── README.md<br>└── styles<br>    └── main.css<br><br>1 directories, 3 files<br></code></pre></td></tr></table></figure><h2 id="將第一個檔案加入-index，並建立-tree-物件"><a class="header-anchor" href="#將第一個檔案加入-index，並建立-tree-物件"></a>將第一個檔案加入 index，並建立 tree 物件</h2><p>先將 <code>index.html</code> 加入 index，接著將 index 寫至 tree 物件中：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat index.html</span><br>index<br><span class="hljs-meta">$</span><span class="bash"> git add index.html</span><br><span class="hljs-meta">$</span><span class="bash"> git write-tree</span><br>2dce93ea08ed9059be0a838c6bcf62b7b5c28907<br></code></pre></td></tr></table></figure><div class="info"><p>註：<code>git add</code> 看起來只是將檔案加入 index，但在 Git 的運作原理其實做了很多步驟，詳情可參閱我之前寫的這幾篇，本篇就不再重複說明這些內容：</p><ul><li><a href="https://titangene.github.io/article/git--blob-object.html">深入 Git：Git 物件儲存 - blob 物件</a></li><li><a href="https://titangene.github.io/article/git-tree-object.html">深入 Git：Git 物件儲存 - tree 物件</a></li><li><a href="https://titangene.github.io/article/git-index.html">深入 Git：index 檔案</a></li></ul></div><p>此時在 <code>.git/object</code> 目錄內，已經有兩個 Git 物件，分別為：</p><ul><li><code>9015a7</code> blob 物件：透過 <code>index.html</code> 此檔案產生的</li><li><code>2dce93</code> tree 物件：對應到專案根目錄</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree .git/objects</span><br>.git/objects<br>├── 2d<br>│   └── ce93ea08ed9059be0a838c6bcf62b7b5c28907<br>├── 90<br>│   └── 15a7a32ca0681be64471d3ac2f8c1f24c1040d<br>├── info<br>└── pack<br><br>4 directories, 2 files<br><br><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 9015a7</span><br>blob<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 9015a7    </span><br>index<br><br><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 2dce93</span><br>tree<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 2dce93</span><br>100644 blob 9015a7a32ca0681be64471d3ac2f8c1f24c1040dindex.html<br></code></pre></td></tr></table></figure><h2 id="建立第一個-commit-物件"><a class="header-anchor" href="#建立第一個-commit-物件"></a>建立第一個 commit 物件</h2><p>要建立 commit 物件需使用 <code>git commit-tree</code> 指令，指定一個 tree 物件的 SHA-1 值以及前一個 commit 物件 (第一個 commit 不需要)。</p><p>下面使用剛剛建立的 <code>2dce93</code> 的 tree 物件來建立 commit 物件，並且提供 commit 訊息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">'first commit'</span> | git commit-tree 2dce93</span><br>9079eb3c74f72f1409dc47ef5d7c8763dbd128f6<br></code></pre></td></tr></table></figure><p>commit 物件會根據建立的時間和作者的資訊而建立不同的 SHA-1 值。使用 <code>git cat-file</code> 指令察看剛剛建立的 commit 物件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 9079eb</span><br>commit<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 9079eb</span><br>tree 2dce93ea08ed9059be0a838c6bcf62b7b5c28907<br>author titangene &lt;titangene.tw@gmail.com&gt; 1584281436 +0800<br>committer titangene &lt;titangene.tw@gmail.com&gt; 1584281436 +0800<br><br>first commit<br></code></pre></td></tr></table></figure><p>commit 物件的格式包含以下內容：</p><ul><li>專案 snapshot 的頂層 tree：也就是專案根目錄對應的 tree 物件</li><li>author/committer 訊息：使用 <code>user.name</code> 和 <code>user.email</code> 的配置和 timestamp<ul><li>author 就是編輯檔案內容的人</li><li>committer 就是 commit 的人</li><li>通常 author 和 committer 會是同一個人</li><li>若透過 email 來發送 patch，就可能發生 author 和 committer 是不同人 <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></li></ul></li><li>一個空行 (blank line)</li><li>commit 訊息</li></ul><h3 id="將另外兩個檔案加入-index，並建立-tree-物件"><a class="header-anchor" href="#將另外兩個檔案加入-index，並建立-tree-物件"></a>將另外兩個檔案加入 index，並建立 tree 物件</h3><p>接著將 <code>README.md</code> 和 <code>styles/main.css</code> 加入 index，接著再將 index 寫至 tree 物件中：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat README.md</span><br><span class="hljs-meta">#</span><span class="bash"> README</span><br><span class="hljs-meta">$</span><span class="bash"> git add README.md</span><br><br><span class="hljs-meta">$</span><span class="bash"> cat styles/main.css</span><br>/* style */<br><span class="hljs-meta">$</span><span class="bash"> git add styles/main.css</span><br><br><span class="hljs-meta">$</span><span class="bash"> git write-tree</span><br>563b8123edfdfd28aeb8bd6cde392a4be9adba2d<br></code></pre></td></tr></table></figure><p>此時在 <code>.git/object</code> 目錄內，多了 4 個 Git 物件，分別為：</p><ul><li><code>7e5960</code> blob 物件：透過 <code>README.md</code> 此檔案產生的</li><li><code>202479</code> blob 物件：透過 <code>styles/main.css</code> 此檔案產生的</li><li><code>0bb8d2</code> tree 物件：對應到 <code>styles</code> 目錄</li><li><code>563b81</code> tree 物件：對應到專案根目錄</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree .git/objects</span><br>.git/objects<br>├── 0b<br>│   └── b8d2a25db76aec1c38bc948ba579959d443790<br>├── 20<br>│   └── 2479c888bf25f40895164be873c63f556a1b76<br>├── 2d<br>│   └── ce93ea08ed9059be0a838c6bcf62b7b5c28907<br>├── 56<br>│   └── 3b8123edfdfd28aeb8bd6cde392a4be9adba2d<br>├── 7e<br>│   └── 59600739c96546163833214c36459e324bad0a<br>├── 90<br>│   ├── 15a7a32ca0681be64471d3ac2f8c1f24c1040d<br>│   └── 79eb3c74f72f1409dc47ef5d7c8763dbd128f6<br>├── info<br>└── pack<br><br>8 directories, 7 files<br><br><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 7e5960</span><br>blob<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 7e5960</span><br><span class="hljs-meta">#</span><span class="bash"> README</span><br><br><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 202479</span><br>blob<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 202479</span><br>/* style */<br><br><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 0bb8d2</span><br>tree<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 0bb8d2</span><br>100644 blob 202479c888bf25f40895164be873c63f556a1b76main.css<br><br><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 563b81</span><br>tree<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 563b81</span><br>100644 blob 7e59600739c96546163833214c36459e324bad0aREADME.md<br>100644 blob 9015a7a32ca0681be64471d3ac2f8c1f24c1040dindex.html<br>040000 tree 0bb8d2a25db76aec1c38bc948ba579959d443790styles<br></code></pre></td></tr></table></figure><h2 id="建立第二個-commit-物件"><a class="header-anchor" href="#建立第二個-commit-物件"></a>建立第二個 commit 物件</h2><p>接著使用剛剛建立的 <code>563b81</code> 的 tree 物件來建立第二個 commit，並且提供 commit 訊息和指定前一個 commit (也就是 parent commit)：</p><ul><li><code>-p &lt;parent&gt;</code>：指定 parent commit 的 ID，在此範例是第一個 commit 物件的 SHA-1 值</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">'second commit'</span> | git commit-tree 563b81 -p 9079eb</span><br>200c91c4acb82e529fb8205ea786a17cc10008b6<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 200c91</span><br>commit<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 200c91</span><br>tree 563b8123edfdfd28aeb8bd6cde392a4be9adba2d<br>parent 9079eb3c74f72f1409dc47ef5d7c8763dbd128f6<br>author titangene &lt;titangene.tw@gmail.com&gt; 1584285257 +0800<br>committer titangene &lt;titangene.tw@gmail.com&gt; 1584285257 +0800<br><br>second commit<br></code></pre></td></tr></table></figure><h2 id="編輯檔案後加入-index，並建立-tree-物件"><a class="header-anchor" href="#編輯檔案後加入-index，並建立-tree-物件"></a>編輯檔案後加入 index，並建立 tree 物件</h2><p>接著編輯 <code>index.html</code> 後，將變更加入 index，接著再將 index 寫至 tree 物件中：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat index.html</span><br>index<br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">'index v2'</span> &gt; index.html</span><br><span class="hljs-meta">$</span><span class="bash"> git add index.html</span><br><br><span class="hljs-meta">$</span><span class="bash"> git write-tree</span><br>bdaf4c7dc919738d7d59a27ef2ef3d5ff3107ae6<br></code></pre></td></tr></table></figure><p>此時在 <code>.git/object</code> 目錄內，多了 2 個 Git 物件，分別為：</p><ul><li><code>b2e53d</code> blob 物件：透過 <code>index.html</code> 此檔案產生的</li><li><code>bdaf4c</code> tree 物件：對應到專案根目錄</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -t b2e53d</span><br>blob<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p b2e53d</span><br>index v2<br><br><span class="hljs-meta">$</span><span class="bash"> git cat-file -t bdaf4c</span><br>tree<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p bdaf4c</span><br>100644 blob 7e59600739c96546163833214c36459e324bad0a    README.md<br>100644 blob b2e53d55f22bdb2eafcdfaff9b1b37829309ae50    index.html<br>040000 tree 0bb8d2a25db76aec1c38bc948ba579959d443790    styles<br></code></pre></td></tr></table></figure><h2 id="建立第三個-commit-物件"><a class="header-anchor" href="#建立第三個-commit-物件"></a>建立第三個 commit 物件</h2><p>接著使用剛剛建立的 <code>bdaf4c</code> 的 tree 物件來建立第三個 commit，並且提供 commit 訊息和指定前一個 commit (也就是 parent commit)：</p><ul><li><code>-p &lt;parent&gt;</code>：指定 parent commit 的 ID，在此範例是第一個 commit 物件的 SHA-1 值</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">'third commit'</span> | git commit-tree bdaf4c -p 200c91</span><br>64fd0be6f2b66bc48d26c7c77cab62fab1477072<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 64fd0b</span><br>commit<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 64fd0b</span><br>tree bdaf4c7dc919738d7d59a27ef2ef3d5ff3107ae6<br>parent 200c91c4acb82e529fb8205ea786a17cc10008b6<br>author titangene &lt;titangene.tw@gmail.com&gt; 1584892171 +0800<br>committer titangene &lt;titangene.tw@gmail.com&gt; 1584892171 +0800<br><br>third commit<br></code></pre></td></tr></table></figure><h2 id="察看歷史紀錄"><a class="header-anchor" href="#察看歷史紀錄"></a>察看歷史紀錄</h2><p>不過到目前為止，都還無法透過 <code>git log</code> 指令來察看剛剛建立的 commit 歷史紀錄，這是因為我們從一開始就是使用底層指令 (plumbing 指令) 來模擬平常我們在用的指令 (porcelain 指令)，而在過程中都沒有建立 <code>master</code> 分支：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">log</span></span><br>fatal: your current branch 'master' does not have any commits yet<br></code></pre></td></tr></table></figure><p>但我們可在 <code>git log</code> 指令上，另外指定最後一個建立的 commit 物件，這樣就能看到剛剛建立的 Git 歷史紀錄了：</p><ul><li><code>--stat</code>：顯示每個 commit 的 diff 資訊 (diffstat)</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">log</span> --<span class="hljs-built_in">stat</span> 64fd0b</span><br>commit 64fd0be6f2b66bc48d26c7c77cab62fab1477072<br>Author: titangene &lt;titangene.tw@gmail.com&gt;<br>Date:   Sun Mar 22 23:49:31 2020 +0800<br><br>    third commit<br><br> index.html | 2 +-<br> 1 file changed, 1 insertion(+), 1 deletion(-)<br><br>commit 200c91c4acb82e529fb8205ea786a17cc10008b6 (HEAD -&gt; master)<br>Author: titangene &lt;titangene.tw@gmail.com&gt;<br>Date:   Sun Mar 15 23:14:17 2020 +0800<br><br>    second commit<br><br> README.md       | 1 +<br> styles/main.css | 1 +<br> 2 files changed, 2 insertions(+)<br><br>commit 9079eb3c74f72f1409dc47ef5d7c8763dbd128f6<br>Author: titangene &lt;titangene.tw@gmail.com&gt;<br>Date:   Sun Mar 15 22:10:36 2020 +0800<br><br>    first commit<br><br> index.html | 1 +<br> 1 file changed, 1 insertion(+)<br></code></pre></td></tr></table></figure><h2 id="Git-物件關聯圖"><a class="header-anchor" href="#Git-物件關聯圖"></a>Git 物件關聯圖</h2><p>以上這些就是 Git 在執行 <code>git add</code> 和 <code>git commit</code> 指令時所做的事情：</p><ol><li>儲存已變更檔案的 blob 物件</li><li>更新 index</li><li>利用 index 建立 tree 物件</li><li>建立指向頂層 tree 和 parent commit 的 commit 物件</li></ol><p>這些物件都存在 <code>.git/objects</code> 目錄內。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> find .git/objects -<span class="hljs-built_in">type</span> f</span><br>.git/objects/2d/ce93ea08ed9059be0a838c6bcf62b7b5c28907 # Tree: ./ dir v1<br>.git/objects/20/0c91c4acb82e529fb8205ea786a17cc10008b6 # Commit: second commit<br>.git/objects/20/2479c888bf25f40895164be873c63f556a1b76 # Blob: main.css<br>.git/objects/7e/59600739c96546163833214c36459e324bad0a # Blob: README.md<br>.git/objects/0b/b8d2a25db76aec1c38bc948ba579959d443790 # Tree: styles dir<br>.git/objects/90/79eb3c74f72f1409dc47ef5d7c8763dbd128f6 # Commit: first commit<br>.git/objects/90/15a7a32ca0681be64471d3ac2f8c1f24c1040d # Blob: index.html<br>.git/objects/56/3b8123edfdfd28aeb8bd6cde392a4be9adba2d # Tree: ./ dir v2<br></code></pre></td></tr></table></figure><p>下圖是這些 Git 物件的關聯圖：</p><p><img src="../images/git-commit-object/object-DAG.png" alt=""></p><div class="info"><p>雖然看起來很像目錄和子目錄的關係，但在 Git 中是沒有層級關係的，commit 物件形成<a href="https://zh.m.wikipedia.org/wiki/%E6%9C%89%E5%90%91%E6%97%A0%E7%8E%AF%E5%9B%BE" target="_blank" rel="noopener">有向無環圖 (directed acyclic graph，DAG)</a>，commit 物件有 parent commit (有向)，並且 commit 物件的圖是無環的 (從開始到結束不會是同一個物件) <sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>。</p></div><p>資料來源：<a href="https://git-scm.com/book/zh-tw/v2/Git-Internals-Git-Objects#r_tree_objects" target="_blank" rel="noopener">10.2 Git Internals - Git Objects | Pro Git, 2/e</a></p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://git-scm.com/book/en/v2/Git-Basics-Viewing-the-Commit-History" target="_blank" rel="noopener">Git - Viewing the Commit History</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><a href="https://git-scm.com/book/en/v2/Distributed-Git-Maintaining-a-Project#_git_am" target="_blank" rel="noopener">Git - Maintaining a Project</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><a href="https://git-scm.com/docs/gitglossary#Documentation/gitglossary.txt-aiddefDAGaDAG" target="_blank" rel="noopener">Git - gitglossary Documentation</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深入 Git </tag>
            
            <tag> w3HexSchool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入 Git：index 檔案</title>
      <link href="/article/git-index.html"/>
      <url>/article/git-index.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/git.jpg" alt=""></p><p><code>git add</code> 會將檔案加入 index，究竟 index 到底存在哪？其實，通常會放在 <code>.git/index</code>，本篇將深入探討此檔案式如何紀錄有哪些檔案被加入 index。</p><a id="more"></a><p>index 是一個二進位檔案，通常放在 <code>.git/index</code>，其中包含路徑名稱的排序列表、每個路徑名稱的權限和 blob 物件的 SHA-1 值。而 <code>git ls-files</code> 指令可顯示 index 的內容。</p><h2 id="透過-git-ls-files-來認識-index"><a class="header-anchor" href="#透過-git-ls-files-來認識-index"></a>透過 <code>git ls-files</code> 來認識 index</h2><p>使用 <code>git ls-files</code> 底層指令來察看 index 檔案，但指令預設只會顯示有哪些檔名，所以加上一些選項：</p><ul><li><code>-c</code>，<code>--cached</code>：預設選項，只在輸出顯示已暫存的檔案</li><li><code>-s</code>，<code>--stage</code>：在輸出中顯示 stage 內容的 mode bit、物件名稱和 stage number</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git ls-files -s</span><br>100644 9015a7a32ca0681be64471d3ac2f8c1f24c1040d 0index.html<br></code></pre></td></tr></table></figure><p>從上面輸出可得知：</p><ul><li><code>index.html</code> 的 file mode bits 為 <code>100644</code>，代表是 regular non-executable file</li><li><code>index.html</code> 的 blob 物件名稱為 <code>9015a7...</code></li><li>stage number 在合併衝突處理時會用到</li><li>檔案名稱</li></ul><p>file mode bits (6 位數) 是檔案權限的八進位表示法，也可以是以二進位的方式讀取。這邊的 <code>100644</code> ( <code>0b1000000110100100</code> ) 代表檔案是 regular non-executable file，檔案擁有者可以讀寫，檔案群組中的其他使用者可以讀取，而其他使用者也可以讀取。</p><p>這類似 Unix 的檔案屬性 <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>，用來表示該檔案的類型 (檔案、目錄、link) 和權限 (可讀、可寫、可執行)，以下是常見的 (用二進位和八進位表示) <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup> <sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>：</p><ul><li><code>0100000000000000</code> ( <code>040000</code> )：Directory</li><li><code>1000000110100100</code> ( <code>100644</code> )：Regular non-executable file</li><li><code>1000000110110100</code> ( <code>100664</code> )：Regular non-executable group-writeable file</li><li><code>1000000111101101</code> ( <code>100755</code> )：Regular executable file</li><li><code>1010000000000000</code> ( <code>120000</code> )：Symbolic link</li><li><code>1110000000000000</code> ( <code>160000</code> )：Gitlink</li></ul><div class="info"><p>註：二進位表示法 <sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></p><ul><li>前 4-bit：物件 type<ul><li><code>1000</code>：regular file</li><li><code>1010</code>：symbolic link</li><li><code>1110</code>：gitlink</li></ul></li><li>中間 3-bit：沒有使用</li><li>後面 9-bit：unix 權限<ul><li>regular file 只能用 <code>0755</code> 和 <code>0644</code></li><li>symbolic link 和 gitlink 在此 field 中的值為 <code>0</code></li></ul></li></ul><p>blob 物件只對 <code>100644</code>、<code>100664</code> 和 <code>100755</code> 這三種 mode 有效。</p></div><p>在 <code>git add</code> 指令期間沒有真正使用不同的 stage number，用於處理合併衝突：</p><ul><li><code>0</code>：normal，無衝突，一切正常</li><li><code>1</code>：base，共同 ancestor 版本</li><li><code>2</code>：ours，目標 ( <code>HEAD</code> ) 版本</li><li><code>3</code>：theris，被合併的版本</li></ul><h2 id="git-index-內部"><a class="header-anchor" href="#git-index-內部"></a><code>.git/index</code> 內部</h2><p>對 Git index 檔案 <code>.git/index</code> 進行位元轉儲 (bits dump)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> xxd -b -c 4 .git/index</span><br>00000000: 01000100 01001001 01010010 01000011  DIRC<br>00000004: 00000000 00000000 00000000 00000010  ....<br>00000008: 00000000 00000000 00000000 00000001  ....<br>0000000c: 01011110 01011011 11000111 10010001  ^[..<br>00000010: 00101111 00001011 00100011 00101010  /.#*<br>00000014: 01011110 01011011 11000111 10010001  ^[..<br>00000018: 00100111 00101111 10101000 11100000  '/..<br>0000001c: 00000000 00000000 00001000 00000100  ....<br>00000020: 00000000 10111000 00001101 01001111  ...O<br>00000024: 00000000 00000000 10000001 10100100  ....<br>00000028: 00000000 00000000 00000011 11101000  ....<br>0000002c: 00000000 00000000 00000011 11101000  ....<br>00000030: 00000000 00000000 00000000 00001011  ....<br>00000034: 10111011 11011110 11111001 00101010  ...*<br>00000038: 11101111 00001111 11101100 11111000  ....<br>0000003c: 00100111 00000100 01110000 10100110  '.p.<br>00000040: 00011111 11101000 10010101 00101010  ...*<br>00000044: 01101010 11111101 01011011 10011010  j.[.<br>00000048: 00000000 00001010 01101001 01101110  ..in<br>0000004c: 01100100 01100101 01111000 00101110  dex.<br>00000050: 01101000 01110100 01101101 01101100  html<br>00000054: 00000000 00000000 00000000 00000000  ....<br>00000058: 00000000 00000000 00000000 00000000  ....<br>0000005c: 00101000 01000001 00101101 00100001  (A-!<br>00000060: 00011010 10000111 01011011 00010011  ..[.<br>00000064: 01101111 01010010 10010111 01110010  oR.r<br>00000068: 11001010 01001100 01110011 11110011  .Ls.<br>0000006c: 10110011 11001100 00110011 00001000  ..3.<br></code></pre></td></tr></table></figure><p>或以十六進位轉儲 (hex dump) 版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> xxd .git/index     </span><br>00000000: 4449 5243 0000 0002 0000 0001 5e5b c791  DIRC........^[..<br>00000010: 2f0b 232a 5e5b c791 272f a8e0 0000 0804  /.#*^[..'/......<br>00000020: 00b8 0d4f 0000 81a4 0000 03e8 0000 03e8  ...O............<br>00000030: 0000 000b bbde f92a ef0f ecf8 2704 70a6  .......*....'.p.<br>00000040: 1fe8 952a 6afd 5b9a 000a 696e 6465 782e  ...*j.[...index.<br>00000050: 6874 6d6c 0000 0000 0000 0000 2841 2d21  html........(A-!<br>00000060: 1a87 5b13 6f52 9772 ca4c 73f3 b3cc 3308  ..[.oR.r.Ls...3.<br></code></pre></td></tr></table></figure><p>index 檔案包含以下資訊：</p><ul><li>12-byte header</li><li>多個排序的 index entries</li><li>Extensions，它們通過簽名 (signature) 來識別</li><li>此 checksum 和之前的 index 檔案內容的 160-bit SHA-1</li></ul><h3 id="Header"><a class="header-anchor" href="#Header"></a>Header</h3><p>index 以 12-byte 的 header 開頭：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 4449 5243 0000 0002 0000 0001<br></code></pre></td></tr></table></figure><p>由代表 “DirCache” 的 4-btye 簽名 “DIRC” ( <code>0x44495243</code> ) 組成<br>4-byte 是 Git index 格式的當前版本號 “2” ( <code>0x00000002</code> )<br>32-bit 的 index entries “1” ( <code>0x00000001</code> )</p><h3 id="Index-Entry"><a class="header-anchor" href="#Index-Entry"></a>Index Entry</h3><p>在 <code>index.html</code> 此 index entry 中包括：</p><h4 id="64-bit-ctime"><a class="header-anchor" href="#64-bit-ctime"></a>64-bit ctime</h4><p>ctime 是 change time，也就是檔案的 metadata 在最後修改的時間</p><ul><li>前面 32-bit：ctime seconds</li><li>後面 32-bit：ctime nanosecond fractions</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 5e5b c791 2f0b 232a<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 的最後修改時間：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'ctime: %z (%Z)'</span> index.html</span><br>ctime: 2020-03-01 22:32:49.789259050 +0800 (1583073169)<br></code></pre></td></tr></table></figure><p>然後用下面指令驗證：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 1583073169</span><br><span class="hljs-meta">5e5bc791%</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 789259050</span><br><span class="hljs-meta">2f0b232a%</span><br></code></pre></td></tr></table></figure><h4 id="64-bit-mtime"><a class="header-anchor" href="#64-bit-mtime"></a>64-bit mtime</h4><p>mtime 是 modify time，也就是檔案的資料在最後修改的時間</p><ul><li>前面 32-bit：mtime seconds</li><li>後面 32-bit：mtime nanosecond fractions</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 5e5b c791 272f a8e0<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 的最後修改時間：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'mtime: %y (%Y)'</span> index.html</span><br>mtime: 2020-03-01 22:32:49.657434848 +0800 (1583073169)<br></code></pre></td></tr></table></figure><p>然後用下面指令驗證：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 1583073169</span><br><span class="hljs-meta">5e5bc791%</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 657434848</span><br><span class="hljs-meta">272fa8e0%</span><br></code></pre></td></tr></table></figure><h4 id="32-bit-dev"><a class="header-anchor" href="#32-bit-dev"></a>32-bit dev</h4><p>檔案所在的裝置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 0000 0804<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 檔案所在的裝置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'%D'</span> index.html</span><br>804<br></code></pre></td></tr></table></figure><h4 id="32-bit-ino"><a class="header-anchor" href="#32-bit-ino"></a>32-bit ino</h4><p>檔案 inode number：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 00b8 0d4f<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 檔案所在的裝置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'%i'</span> index.html</span><br>12062031<br></code></pre></td></tr></table></figure><p>然後用下面指令驗證：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 12062031</span><br><span class="hljs-meta">b80d4f%</span><br></code></pre></td></tr></table></figure><h4 id="32-bit-mode"><a class="header-anchor" href="#32-bit-mode"></a>32-bit mode</h4><p>檔案權限以十六進位表示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 0000 81a4<br>bin: 00000000 00000000 10000001 10100100<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 檔案的權限：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'%f'</span> index.html</span><br>81a4<br></code></pre></td></tr></table></figure><h4 id="32-bit-uid"><a class="header-anchor" href="#32-bit-uid"></a>32-bit uid</h4><p>當前使用者的 user identifier</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 0000 03e8<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 檔案的 uid：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'%u'</span> index.html</span><br>1000<br></code></pre></td></tr></table></figure><p>然後用下面指令驗證：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 1000</span><br><span class="hljs-meta">3e8%</span><br></code></pre></td></tr></table></figure><h4 id="32-bit-gid"><a class="header-anchor" href="#32-bit-gid"></a>32-bit gid</h4><p>當前使用者的 group identifier</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 0000 03e8<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 檔案的 gid：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'%g'</span> index.html</span><br>1000<br></code></pre></td></tr></table></figure><p>然後用下面指令驗證：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 1000</span><br><span class="hljs-meta">3e8%</span><br></code></pre></td></tr></table></figure><h4 id="32-bit-file-size"><a class="header-anchor" href="#32-bit-file-size"></a>32-bit file size</h4><p>檔案大小</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 0000 000b<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 檔案的大小：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'%s'</span> index.html</span><br>11<br></code></pre></td></tr></table></figure><p>然後用下面指令驗證：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 11</span><br><span class="hljs-meta">b%</span><br></code></pre></td></tr></table></figure><h4 id="160-bit-SHA-1-Object-ID"><a class="header-anchor" href="#160-bit-SHA-1-Object-ID"></a>160-bit SHA-1 Object ID</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: bbde f92a ef0f ecf8 2704<br>     70a6 1fe8 952a 6afd 5b9a<br></code></pre></td></tr></table></figure><p>可用 <code>git hash-object</code> 指令來取得 <code>index.html</code> 檔案的 blob 物件 ID：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">hash</span>-object index.html</span><br>bbdef92aef0fecf8270470a61fe8952a6afd5b9a<br></code></pre></td></tr></table></figure><h4 id="16-bit-‘flags’-field"><a class="header-anchor" href="#16-bit-‘flags’-field"></a>16-bit ‘flags’ field</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 000a<br></code></pre></td></tr></table></figure><p>分為：</p><ul><li>1-bit：assume-valid flag</li><li>1-bit：extended flag (在版本 2 中必須為零)</li><li>2-bit：stage (合併期間)</li><li>如果 length 小於 0xFFF，則為 12-bit name length；否則，將 0xFFF 儲存在此 field 中</li></ul><h4 id="16-bit-field"><a class="header-anchor" href="#16-bit-field"></a>16-bit field</h4><p>(版本 3 或更新版) 當前面的 16-bit field 的 “extended flag” 為 1 時適用</p><ul><li>1-bit：為未來保留</li><li>1-bit：skip-worktree flag (用於 sparse checkout)</li><li>1-bit：intent-to-add flag (用於 <code>git add -N</code> )</li><li>13-bit：未使用，必須為零</li></ul><p>忽略此部份，因為我目前使用的 Git 的版本為 2：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git --version</span><br>git version 2.17.1<br></code></pre></td></tr></table></figure><h4 id="檔案路徑"><a class="header-anchor" href="#檔案路徑"></a>檔案路徑</h4><ul><li>相對於 top level 目錄 (不包含斜線) 的 entry 路徑名稱 (可變長度)</li><li><code>/</code> 作為路徑分隔字元</li><li>不允許使用特殊路徑元件 <code>.</code>、<code>..</code> 和 <code>.git</code></li><li>不允許使用斜線</li><li>確切的編碼不確定，但 <code>.</code> 和 <code>/</code> 字元會以 7-bit ASCII 編碼，並且編碼不能包含 NUL byte (UNIX 路徑名稱)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 696e 6465 782e 6874 6d6c<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'index.html'</span> | xxd</span><br>00000000: 696e 6465 782e 6874 6d6c                 index.html<br></code></pre></td></tr></table></figure><h4 id="1-8-NUL-byte"><a class="header-anchor" href="#1-8-NUL-byte"></a>1-8 NUL byte</h4><p>使用 1-8 NUL byte 將 entry 填充為 8 byte 的倍數，同時保持名稱 NUL-terminated</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 0000 0000 0000 0000<br></code></pre></td></tr></table></figure><h3 id="Extensions"><a class="header-anchor" href="#Extensions"></a>Extensions</h3><p>忽略此部份，因本範例的 index 無 extensions。</p><h3 id="SHA-1-Index-Checksum"><a class="header-anchor" href="#SHA-1-Index-Checksum"></a>SHA-1 Index Checksum</h3><p>在 index 檔案內容的最後 160-bit 是 index checksum，是由這 160-bit 之前的 index 檔案內容透過 SHA-1 計算的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 2841 2d21 1a87 5b13 6f52<br>     9772 ca4c 73f3 b3cc 3308<br></code></pre></td></tr></table></figure><p>用下面指令驗證：</p><ul><li><code>head -c</code>：列印檔案的前幾個 byte</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat .git/index | head -c92 | sha1sum </span><br>28412d211a875b136f529772ca4c73f3b3cc3308  -<br></code></pre></td></tr></table></figure><p>如果 index 損壞，就能透過此 SHA-1 Index Checksum 來確認，並會說明 index 檔案已損壞：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git status</span><br>error: bad index file sha1 signature<br>fatal: index file corrupt<br></code></pre></td></tr></table></figure><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="http://linux.vbird.org/linux_basic/0210filepermission.php#filepermission_perm" target="_blank" rel="noopener">鳥哥的 Linux 私房菜 – 第五章、Linux 的檔案權限與目錄配置</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><a href="https://stackoverflow.com/questions/737673/how-to-read-the-mode-field-of-git-ls-trees-output" target="_blank" rel="noopener">file permissions - How to read the mode field of git-ls-tree’s output - Stack Overflow</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><a href="https://github.com/doggy8088/Learn-Git-in-30-days/blob/master/zh-tw/09.md" target="_blank" rel="noopener">30 天精通 Git 版本控管 第 09 天：比對檔案與版本差異 by 保哥</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p><a href="https://github.com/git/git/blob/master/Documentation/technical/index-format.txt#L63" target="_blank" rel="noopener">git/index-format.txt at master · git/git</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深入 Git </tag>
            
            <tag> w3HexSchool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入 Git：Git 物件儲存 - tree 物件</title>
      <link href="/article/git-tree-object.html"/>
      <url>/article/git-tree-object.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/git.jpg" alt=""></p><p>本篇將深入探討 Git 如何運作，Git 是如何建立和儲存 tree 物件。</p><a id="more"></a><p>之前講到 blob 物件是由檔案內容來產生的，那 Git 是如何知道這些檔案內容是分別存在哪個目錄內的檔案名稱中？</p><p>目錄名稱和檔案名稱就是由 tree 物件來管理。一個 tree 物件可以紀錄包含哪些 blob 物件 (也就是檔案內容)，以及該 blob 物件對應的檔案名稱，以及其他 tree 物件和其對應的目錄名稱。例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -p</span><br></code></pre></td></tr></table></figure><p>Git 儲存內容的方式類似 Unix 檔案系統，所有內容在 Git 都儲存成 tree 物件和 blob 物件，tree 物件對應於 Unix directory entries (目錄項目)，而 blob 物件是對應 inode (記錄檔案的權限與相關屬性) <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> 或檔案內容 <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>。</p><p>每個 tree 物件可包含一個或多個 tree entries，每個 tree entry 都包含一個指向 blob 物件或 subtree 的 SHA-1 指標 (hash 值) 以及關聯模式 (associated mode)、物件類型、檔名。例如：</p><p>先建立一個 commit：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git init</span><br>Initialized empty Git repository in /home/titan/project/demo/.git/<br><br><span class="hljs-meta">$</span><span class="bash"> mkdir styles</span><br><span class="hljs-meta">$</span><span class="bash"> touch index.html README.md styles/main.css</span><br><span class="hljs-meta">$</span><span class="bash"> git add .</span><br><span class="hljs-meta">$</span><span class="bash"> tree .git/objects</span><br>.git/objects<br>├── e6<br>│   └── 9de29bb2d1d6434b8b29ae775ad8c2e48c5391<br>├── info<br>└── pack<br><br>3 directories, 1 file<br><br><span class="hljs-meta">$</span><span class="bash"> git commit -m <span class="hljs-string">"init"</span>   </span><br>[master (root-commit) 158f5a2] init<br> 3 files changed, 0 insertions(+), 0 deletions(-)<br> create mode 100644 README.md<br> create mode 100644 index.html<br> create mode 100644 styles/main.css<br></code></pre></td></tr></table></figure><p><code>master^{tree}</code> 代表由 <code>master</code> 分支上的最後一次 commit 所指向的 tree 物件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree</span><br>.<br>├── index.html<br>├── README.md<br>└── styles<br>    └── main.css<br><br>1 directory, 3 files<br><br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p master^&#123;tree&#125;</span><br>100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391README.md<br>100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391index.html<br>040000 tree c6d62294a2323c2047b43787d55a44ff8c94f565styles<br></code></pre></td></tr></table></figure><p><code>styles</code> 子目錄是指向另一個名為 <code>c6d622</code> 的 tree 物件，而這個 tree 物件又指向另一個名為 <code>e69de2</code> 的 blob 物件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -p c6d622</span><br>100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391main.css<br></code></pre></td></tr></table></figure><h2 id="建立-index"><a class="header-anchor" href="#建立-index"></a>建立 index</h2><p>初始化 Git repo：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git init</span><br>Initialized empty Git repository in /home/titan/project/git/pro-git/.git/<br><span class="hljs-meta">$</span><span class="bash"> tree .git        </span><br>.git<br>├── branches<br>├── config<br>├── description<br>├── HEAD<br>├── hooks<br>│   └── ...<br>├── info<br>│   └── exclude<br>├── objects<br>│   ├── info<br>│   └── pack<br>└── refs<br>    ├── heads<br>    └── tags<br><br>9 directories, 15 files<br></code></pre></td></tr></table></figure><p>建立專案需要的檔案：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> mkdir styles</span><br><span class="hljs-meta">$</span><span class="bash"> touch index.html README.md styles/main.css</span><br><span class="hljs-meta">$</span><span class="bash"> tree</span><br>.<br>├── index.html<br>├── README.md<br>└── styles<br>    └── main.css<br><br>1 directory, 3 files<br></code></pre></td></tr></table></figure><p>現在 Git 還未追蹤這些檔案：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git status                      </span><br>On branch master<br><br>No commits yet<br><br>Untracked files:<br>  (use "git add &lt;file&gt;..." to include in what will be committed)<br><br>README.md<br>index.html<br>styles/<br><br>nothing added to commit but untracked files present (use "git add" to track)<br></code></pre></td></tr></table></figure><p>建立 blob 物件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">hash</span>-object -w index.html</span><br>9015a7a32ca0681be64471d3ac2f8c1f24c1040d<br><span class="hljs-meta">$</span><span class="bash"> tree .git/objects            </span><br>.git/objects<br>├── 90<br>│   └── 15a7a32ca0681be64471d3ac2f8c1f24c1040d<br>├── info<br>└── pack<br><br>3 directories, 1 file<br></code></pre></td></tr></table></figure><p>在將 commit 之前，Git 會根據 staging area (預存區或稱暫存區) 或 index 來建立 tree 物件，所以必須在建立 tree 物件之前，先暫存物件來建立 index。</p><p>使用 <code>update-index</code> 底層指令來為單一檔案建立 index。</p><p>因為 index 之前沒有該檔案，甚至連 index 都還沒建立 (也就是沒有 <code>.git/index</code> 檔案)，所以必須加上 <code>--add</code> 選項。另外，因為要增加的檔案還不在工作目錄中，而是在資料庫 (也就是 <code>.git/object</code> 目錄內) 中，所以需要加上 <code>--cacheinfo</code> 選項，<code>--cacheinfo</code> 選項後面必須指定相關 mode、物件 SHA-1 值、檔名。</p><div class="info"><p><code>git update-index</code> 指令：將 working tree 中的檔案內容註冊至 index</p><ul><li><code>--add</code>：<ul><li>如果指定的檔案不在 index 中，就會新增該檔案至 index</li><li>預設行為 (也就是不加上 <code>--add</code> 選項時) 會忽略新檔案</li></ul></li><li><code>--cacheinfo &lt;mode&gt; &lt;object&gt; &lt;path&gt;</code> 或 <code>--cacheinfo &lt;mode&gt;,&lt;object&gt;,&lt;path&gt;</code>：<ul><li>將指定的資訊直接插入 index</li><li>用於註冊不在當前工作目錄中的檔案。對於最小 checkout 合併很有用</li><li>為了向後相容，還可將這三個參數作為三個單獨的參數提供，但是鼓勵新的使用者使用單一參數形式</li></ul></li></ul></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git update-index --add --cacheinfo \</span><br>    100644 9015a7a32ca0681be64471d3ac2f8c1f24c1040d index.html<br><br><span class="hljs-meta">$</span><span class="bash"> git status</span><br>On branch master<br><br>No commits yet<br><br>Changes to be committed:<br>  (use "git rm --cached &lt;file&gt;..." to unstage)<br><br>new file:   index.html<br><br>Untracked files:<br>  (use "git add &lt;file&gt;..." to include in what will be committed)<br><br>README.md<br>styles/<br></code></pre></td></tr></table></figure><p>這邊指定的 <code>100644</code> 是 mode，代表是個普通的檔案。這類似 Unix 的檔案屬性 <sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>，用來表示該檔案的類型 (檔案、目錄、link) 和權限 (可讀、可寫、可執行)，以下是常見的 (用二進位和八進位表示) <sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup> <sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup>：</p><ul><li><code>0100000000000000</code> ( <code>040000</code> )：Directory</li><li><code>1000000110100100</code> ( <code>100644</code> )：Regular non-executable file</li><li><code>1000000110110100</code> ( <code>100664</code> )：Regular non-executable group-writeable file</li><li><code>1000000111101101</code> ( <code>100755</code> )：Regular executable file</li><li><code>1010000000000000</code> ( <code>120000</code> )：Symbolic link</li><li><code>1110000000000000</code> ( <code>160000</code> )：Gitlink</li></ul><div class="info"><p>註：<code>.git/index</code> 的二進位表示法 <sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup></p><ul><li>前 4-bit：物件 type<ul><li><code>1000</code>：regular file</li><li><code>1010</code>：symbolic link</li><li><code>1110</code>：gitlink</li></ul></li><li>中間 3-bit：沒有使用</li><li>後面 9-bit：unix 權限<ul><li>regular file 只能用 <code>0755</code> 和 <code>0644</code></li><li>symbolic link 和 gitlink 在此 field 中的值為 <code>0</code></li></ul></li></ul><p>blob 物件只對 <code>100644</code>、<code>100664</code> 和 <code>100755</code> 這三種 mode 有效。</p></div><p>接著使用 <code>write-tree</code> 指令將 index 寫至 tree 物件中。不需要使用 <code>-w</code> 選項，如果該 tree 物件還不存在，則呼叫 <code>write-tree</code> 會根據 index 的狀態自動建立 tree 物件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git write-tree</span><br>2dce93ea08ed9059be0a838c6bcf62b7b5c28907<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 2dce93</span><br>100644 blob 9015a7a32ca0681be64471d3ac2f8c1f24c1040dindex.html<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 2dce93</span><br>tree<br></code></pre></td></tr></table></figure><p>如果使用 <code>index.html</code> 的第二版和一個新檔案來建立新的 tree 物件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">'text'</span> &gt;&gt; index.html</span><br><span class="hljs-meta">$</span><span class="bash"> cat index.html </span><br>index<br>text<br><span class="hljs-meta">$</span><span class="bash"> git update-index index.html</span><br><span class="hljs-meta">$</span><span class="bash"> git update-index --add README.md</span><br><span class="hljs-meta">$</span><span class="bash"> git status                           </span><br>On branch master<br><br>No commits yet<br><br>Changes to be committed:<br>  (use "git rm --cached &lt;file&gt;..." to unstage)<br><br>new file:   README.md<br>new file:   index.html<br><br>Untracked files:<br>  (use "git add &lt;file&gt;..." to include in what will be committed)<br><br>styles/<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree .git/objects      </span><br>.git/objects<br>├── 2d<br>│   └── ce93ea08ed9059be0a838c6bcf62b7b5c28907<br>├── 70<br>│   └── f702d2c1492a9989a64c8e68bedf7c81052898<br>├── 7e<br>│   └── 59600739c96546163833214c36459e324bad0a<br>├── 90<br>│   └── 15a7a32ca0681be64471d3ac2f8c1f24c1040d<br>├── info<br>└── pack<br><br>6 directories, 4 files<br><br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 70f702          </span><br>index<br>text<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 7e5960</span><br><span class="hljs-meta">#</span><span class="bash"> README</span><br></code></pre></td></tr></table></figure><p>建立 tree 物件 (將 staging area 的狀態或 index 紀錄到一個 tree 物件)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git write-tree</span><br>436d33ce00a9bbf0a1ce763b2c36330b6faf309b<br><span class="hljs-meta">$</span><span class="bash"> git cat-file -p 436d33      </span><br>100644 blob 7e59600739c96546163833214c36459e324bad0aREADME.md<br>100644 blob 70f702d2c1492a9989a64c8e68bedf7c81052898index.html<br></code></pre></td></tr></table></figure><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="http://linux.vbird.org/linux_basic/0230filesystem.php" target="_blank" rel="noopener">鳥哥的 Linux 私房菜 – 第七章、Linux 磁碟與檔案系統管理</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><a href="https://git-scm.com/book/zh-tw/v2/Git-Internals-Git-Objects" target="_blank" rel="noopener">Git - Git Objects</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><a href="http://linux.vbird.org/linux_basic/0210filepermission.php#filepermission_perm" target="_blank" rel="noopener">鳥哥的 Linux 私房菜 – 第五章、Linux 的檔案權限與目錄配置</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p><a href="https://stackoverflow.com/questions/737673/how-to-read-the-mode-field-of-git-ls-trees-output" target="_blank" rel="noopener">file permissions - How to read the mode field of git-ls-tree’s output - Stack Overflow</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p></li><li id="fn5" class="footnote-item"><p><a href="https://github.com/doggy8088/Learn-Git-in-30-days/blob/master/zh-tw/09.md" target="_blank" rel="noopener">30 天精通 Git 版本控管 第 09 天：比對檔案與版本差異 by 保哥</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p></li><li id="fn6" class="footnote-item"><p><a href="https://github.com/git/git/blob/master/Documentation/technical/index-format.txt#L63" target="_blank" rel="noopener">git/index-format.txt at master · git/git</a> <a href="#fnref6" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深入 Git </tag>
            
            <tag> w3HexSchool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>處理 Git 斷行字元的問題</title>
      <link href="/article/git-auto-crlf.html"/>
      <url>/article/git-auto-crlf.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/git.jpg" alt=""></p><p>在使用 Git 的過程中，若在不同作業系統編輯同一個 repo 的檔案，可能就會發生斷行字元的問題。Git 在 config 提供了 <code>core.autocrlf</code> 選項並用 <code>.gitAttributes</code> 檔案來處理斷行字元的問題。</p><a id="more"></a><p>之前我在 Windows 建立一個專案，是用來專門放用 Markdown 檔案的筆記，而且是用 Git 來作版本控制。但最近我在這台筆電安裝完雙系統 (Windows 10 和 Ubuntu 18.04) 後，有時候會在 Ubuntu 開發並將過程寫成筆記，所以這個筆記專案就會需要在不同 OS 下編輯。</p><p>也因為以上需求讓我多學習到不同系統其實預設使用的文字檔案的斷行字元是不同的，Windows 是使用 CRLF ( <code>\r\n</code>，<code>0x0D 0x0A</code> )，而 Linux 則是使用 LF 字元 ( <code>\n</code>，<code>0x0A</code> )。也因如此，Windows 上的每個檔案的每一行結尾都會比 Liunx 還要多一個字元，也就是多了很多 CR ( <code>\r</code> ) 字元。</p><div class="info"><p>註：</p><ul><li>CR 是 Carriage Return 的意思，也就是 Enter 字元</li><li>LF 是 Line Feed 的意思，也就是真正的換行字元</li><li>macOS 的斷行字元也是 LF 字元 ( <code>\n</code>，<code>0x0A</code> )</li></ul></div><p>那為何會提到斷行字元？因為當我執行 <code>git status</code> 指令後，發現竟然檔案有被修改過，但我除了切換 OS 之外，根本沒有修改筆記啊！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git status</span><br>On branch master<br>Your branch is up to date with 'origin/master'.<br><br>Changes not staged for commit:<br>  (use "git add &lt;file&gt;..." to update what will be committed)<br>  (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)<br><br>        modified:   note.md<br><br>no changes added to commit (use "git add" and/or "git commit -a")<br></code></pre></td></tr></table></figure><p>其實這跟剛剛提到的斷行字元有關。如果用 <code>git diff</code> 指令就會看到筆記內的每行文字的結尾都多出了 <code>^M</code> 這個東西，而且有些編輯器 (例如：VS Code) 可能會看不出來：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs diff">$ git diff note.md<br>diff --git a/note.md b/note.md<br>index e27815a..6b5682e 100644<br><span class="hljs-comment">--- a/note.md</span><br><span class="hljs-comment">+++ b/note.md</span><br><span class="hljs-meta">@@ -1,5 +1,5 @@</span><br><span class="hljs-deletion">-Note</span><br><span class="hljs-deletion">-===</span><br><span class="hljs-deletion">-</span><br><span class="hljs-deletion">-something</span><br><span class="hljs-addition">+Note^M</span><br><span class="hljs-addition">+===^M</span><br><span class="hljs-addition">+^M</span><br><span class="hljs-addition">+something^M</span><br> This is the last line<br>\ No newline at end of file<br></code></pre></td></tr></table></figure><p>其實 <code>^M</code> 恰好是 vim 用來顯示 <code>0x0D</code> 的方式，而 <code>0x0D</code> 就是剛剛提到 Windows 檔案內的每一行結尾，都會比 Linux 多出 CR ( <code>\r</code> ) 這個字元。所以 <code>^M</code> 其實就等同於 CR ( <code>\r</code>，<code>0x0D</code> )。</p><div class="info"><p>註：</p><ul><li><code>^M</code> 其中的 <code>^</code> 代表 Ctrl，所以 <code>^M</code> 也就代表 <code>Ctrl + M</code> (也就是 Enter)</li><li><code>^M</code> 雖然看是兩個字元，但在終端機上實際只有一個字元。在大部分的終端機系統中，包括 Windows 的 cmd、Linux 和 FreeBSD 都可用 Ctrl 來表示 <code>^</code> 字元 (caret)</li><li><code>0x0D</code> 是以十六進位表示的 13，而 M 正好是英文字母中第 13 個字母</li></ul></div><p>不過，如果有多個檔案的每一行都要刪掉 <code>^M</code> 就會很麻煩，所以 Git 提供一種自動轉換斷行符號的功能：<code>core.autocrlf</code>。</p><p>那 Git 的自動轉換斷行符號功能到底做了什麼？</p><ul><li>當你執行 <code>git add</code> 將檔案加入 index 時，Git 可將 CRLF 自動傳成 LF。</li><li>當你執行 <code>git checkout</code> 將程式碼 checkout 出檔案系統時，Git 可將 LF 自動轉成 CRLF。</li></ul><p>如果要在全域設定可執行下面指令來設定：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git config --global core.autocrlf <span class="hljs-literal">true</span></span><br></code></pre></td></tr></table></figure><p>如果是要在各別的 repo 設定，就需要在 repo 的根目錄下建立一個名為 <code>.gitattributes</code> 的檔案，當這個檔案被 commit 至 repo 時，就會覆蓋 <code>core.autocrlf</code> 的設定，以確保管理此 repo 的協作者的設定一致。下面是 <code>.gitattributes</code> 這個檔案的範例模板：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plain"># Set the default behavior, in case people don&#39;t have core.autocrlf set.<br>* text&#x3D;auto<br><br># Explicitly declare text files you want to always be normalized and converted<br># to native line endings on checkout.<br>*.c text<br>*.h text<br><br># Declare files that will always have CRLF line endings on checkout.<br>*.sln text eol&#x3D;crlf<br><br># Denote all files that are truly binary and should not be modified.<br>*.png binary<br>*.jpg binary<br></code></pre></td></tr></table></figure><p>此檔案的設定格式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">pattern attr1 attr2 ...<br></code></pre></td></tr></table></figure><p><code>pattern</code> 和屬性的中間要以空格分隔。當 <code>pattern</code> 匹配相關路徑時，後面的屬性的設定會應用在那些路徑。</p><p><code>text</code> 這個屬性是用於啟用並控制行尾的正規化。正規化文字檔後，行尾會在 repo 中轉換為 LF。如果要控制工作目錄中使用的行尾樣式，請針對該檔案設定 <code>eol</code> 屬性 ( <code>eol</code> 就 end-of-line 的縮寫)，並且對所有文字檔設定 <code>core.eol</code> 變數。如果將 <code>core.autocrlf</code> 設為 <code>true</code> 或 <code>input</code> 會覆蓋 <code>core.eol</code> 的設定。</p><blockquote><p>詳情可參考 <a href="https://git-scm.com/docs/git-config" target="_blank" rel="noopener">Git - git-config Documentation</a> 文件中對於 <code>core.eol</code> 設定的定義。</p></blockquote><p><code>text=auto</code>：路徑被標記為自動轉換行尾。如果 Git 確定該內容為文字，那該檔案的行尾就會在 checkin 時轉換成 LF。當用 CRLF commit 檔案時，則不會進行轉換。</p><p>資料來源：</p><ul><li><a href="https://help.github.com/en/articles/configuring-git-to-handle-line-endings" target="_blank" rel="noopener">Configuring Git to handle line endings - GitHub Help</a></li><li><a href="https://blog.miniasp.com/post/2013/09/15/Git-for-Windows-Line-Ending-Conversion-Notes" target="_blank" rel="noopener">Git 在 Windows 平台處理斷行字元 (CRLF) 的注意事項 | The Will Will Web</a></li><li><a href="https://zh.wikipedia.org/wiki/ASCII" target="_blank" rel="noopener">ASCII - Wiki</a></li><li><a href="https://stackoverflow.com/questions/5843495/what-does-m-character-mean-in-vim" target="_blank" rel="noopener">unix - What does ^M character mean in Vim? - Stack Overflow</a></li><li><a href="https://git-scm.com/docs/gitattributes" target="_blank" rel="noopener">Git - gitattributes Documentation</a></li><li><a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Attributes" target="_blank" rel="noopener">Git - Git Attributes</a></li><li><a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Configuration" target="_blank" rel="noopener">Git - Git Configuration</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入 Git：Git 物件儲存 - blob 物件</title>
      <link href="/article/git--blob-object.html"/>
      <url>/article/git--blob-object.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/git.jpg" alt=""></p><p>本篇將深入探討 Git 如何運作，在執行 <code>git add</code> 將檔案加入 index 時，Git 會如何建立和儲存 blob 物件。</p><a id="more"></a><p>Git 是一個 content-addressable (按內容定址，按檔案內容定位) 的檔案系統，這代表 Git 的核心是一個 key-value data store (資料儲存) <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>。我們只要提供檔案內容，Git 就會透過一些演算法計算成 key，未來就可透過該 key 來檢索出對應的內容。</p><p>Git 有四種 type (類型) 的物件：blob、tree、commit 和 tag。</p><p>下面會使用 <code>git hash-object</code> 這個底層指令來介紹物件名稱是如何產生的。</p><h2 id="手動建立-blob-物件"><a class="header-anchor" href="#手動建立-blob-物件"></a>手動建立 blob 物件</h2><p>首先，先執行 <code>git init</code> 初始化 repo：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git init</span><br>Initialized empty Git repository in /home/titan/project/git-demo/.git/<br></code></pre></td></tr></table></figure><p>初始化新的 repo 時，Git 會在 <code>.git</code> 目錄中初始化 <code>objects</code> 目錄，並在裡面建立 <code>pack</code> 和 <code>info</code> 子層的空目錄：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree .git/objects</span><br>.git/objects<br>├── info<br>└── pack<br></code></pre></td></tr></table></figure><p>使用底層指令 <code>hash-object</code> 將資料儲存至 <code>.git</code> 目錄中，並獲得對應的 key (也就是物件名稱，或稱 SHA-1 值)。下面是 <code>hash-object</code> 的 option：</p><ul><li><code>-w</code>：<ul><li>將物件寫入至物件資料庫 (也就是 <code>.git/objects</code> 目錄內)，並輸出該物件的 key (也就是 SHA-1 checksum)</li><li>若不用此 option，就只會輸出 key，不會儲存物件</li></ul></li><li><code>--stdin</code>：<ul><li>從 stdin (standard input，標準輸入) 讀取內容</li><li>若不用此 option，<code>hash-object</code> 指令預設會從檔案中讀取，所以必須在 <code>hash-object</code> 指令之後加上指定的檔案路徑<ul><li>例如：<code>git hash-object README.md</code></li></ul></li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">'test content'</span> | git <span class="hljs-built_in">hash</span>-object -w --stdin</span><br>d670460b4b4aece5915caf5c68d12f560a9fe3e4<br></code></pre></td></tr></table></figure><p><code>hash-object</code> 指令會輸出 40 個字元的 checksum hash，這是個 SHA-1 hash (後面會介紹 <a href="#SHA-1">SHA-1</a>)，是由儲存的內容和 header 資訊所計算出來的 checksum。</p><p>在 Git 的儲存方式是一份內容就存成一個檔案，都放在 <code>.git/objects</code> 目錄內，子目錄為 SHA-1 的前 2 個字元，檔名為剩餘的 38 個字元。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree .git/objects</span><br>.git/objects<br>├── d6<br>│   └── 70460b4b4aece5915caf5c68d12f560a9fe3e4<br>├── info<br>└── pack<br></code></pre></td></tr></table></figure><h2 id="使用-cat-file-指令察看物件資訊"><a class="header-anchor" href="#使用-cat-file-指令察看物件資訊"></a>使用 <code>cat-file</code> 指令察看物件資訊</h2><p>使用 <code>cat-file</code> 指令取得物件的內容，可用於檢查物件。使用 <code>-p</code> option 找出內容的 type 並輸出該內容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -p d67046</span><br>test content<br></code></pre></td></tr></table></figure><p>使用 <code>-t</code> option 可獲得該物件的 type：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -t d67046</span><br>blob<br></code></pre></td></tr></table></figure><p>剛剛建立的 <code>d67046</code> 就是 Git 的 blob 物件。</p><h2 id="變更檔案內容後再次建立-blob-物件"><a class="header-anchor" href="#變更檔案內容後再次建立-blob-物件"></a>變更檔案內容後再次建立 blob 物件</h2><p>那如果變更檔案內容後，再建立 blob 物件又會如何？看下面範例：</p><p>先建立一個全新的專案，並使用 <code>git init</code> 初始化 Git repo：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> mkdir git-demo-2</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> git-demo-2</span><br><span class="hljs-meta">$</span><span class="bash"> git init</span><br>Initialized empty Git repository in /home/titan/project/git-demo-2/.git/<br></code></pre></td></tr></table></figure><p>接著建立一個名為 <code>test.txt</code> 的檔案，內容為 <code>v1</code>，使用 <code>git hash-object</code> 建立的 blob 物件為 <code>626799</code>，後來將內容修改為 <code>v2</code>，再次建立的 blob 物件為 <code>8c1384</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">'v1'</span> &gt; test.txt</span><br><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">hash</span>-object -w test.txt</span><br>626799f0f85326a8c1fc522db584e86cdfccd51f<br><br><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 626799</span><br>blob<br><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">'v2'</span> &gt; test.txt</span><br><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">hash</span>-object -w test.txt</span><br>8c1384d825dbbe41309b7dc18ee7991a9085c46e<br><br><span class="hljs-meta">$</span><span class="bash"> git cat-file -t 8c1384</span><br>blob<br></code></pre></td></tr></table></figure><p>可以看到當檔案內容不同時，就可以產生不同的 blob 物件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree .git/objects</span><br>.git/objects<br>├── 62<br>│   └── 6799f0f85326a8c1fc522db584e86cdfccd51f<br>├── 8c<br>│   └── 1384d825dbbe41309b7dc18ee7991a9085c46e<br>├── info<br>└── pack<br></code></pre></td></tr></table></figure><h2 id="建立內容相同，但檔名不同的檔案"><a class="header-anchor" href="#建立內容相同，但檔名不同的檔案"></a>建立內容相同，但檔名不同的檔案</h2><p>當你建立檔案內容相同，但檔名不同的檔案時，在 repo 內也只會存一份，因為物件的名稱是由檔案內容來決定的，而不是依檔名決定。</p><p>不過，<code>git hash-object</code> 指令還是會重新產生同一個 blob 物件 (因為該物件的檔案時間被更新了)。範例如下：</p><p>在建立 <code>other-test.txt</code> 檔案之前，<code>.git/objects/8c/6799f...</code> 的檔案時間是 <code>23:38</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree .git/objects</span><br>.git/objects<br>├── 62<br>│   └── 6799f0f85326a8c1fc522db584e86cdfccd51f<br>├── 8c<br>│   └── 1384d825dbbe41309b7dc18ee7991a9085c46e<br>├── info<br>└── pack<br><br><span class="hljs-meta">$</span><span class="bash"> ls -lR .git/objects</span><br>.git/objects:<br>總計 16<br>drwxr-xr-x 2 titan titan 4096  2月 16 23:39 62<br>drwxr-xr-x 2 titan titan 4096  2月 16 23:40 8c<br>drwxr-xr-x 2 titan titan 4096  2月 16 23:39 info<br>drwxr-xr-x 2 titan titan 4096  2月 16 23:39 pack<br><br>.git/objects/62:<br>總計 4<br>-r--r--r-- 1 titan titan 18  2月 16 23:38 6799f0f85326a8c1fc522db584e86cdfccd51f<br><br>.git/objects/8c:<br>總計 4<br>-r--r--r-- 1 titan titan 18  2月 16 23:39 1384d825dbbe41309b7dc18ee7991a9085c46e<br><br>...<br></code></pre></td></tr></table></figure><p>在建立 <code>other-test.txt</code> 檔案之後，<code>.git/objects/8c/6799f...</code> 的檔案時間變成 <code>23:40</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">'v2'</span> &gt; other-test.txt</span><br><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">hash</span>-object -w other-test.txt</span><br>8c1384d825dbbe41309b7dc18ee7991a9085c46e<br><br><span class="hljs-meta">$</span><span class="bash"> tree .git/objects</span><br>.git/objects<br>├── 62<br>│   └── 6799f0f85326a8c1fc522db584e86cdfccd51f<br>├── 8c<br>│   └── 1384d825dbbe41309b7dc18ee7991a9085c46e<br>├── info<br>└── pack<br><br><span class="hljs-meta">$</span><span class="bash"> ls -lR .git/objects</span><br>.git/objects:<br>總計 16<br>drwxr-xr-x 2 titan titan 4096  2月 16 23:39 62<br>drwxr-xr-x 2 titan titan 4096  2月 16 23:40 8c<br>drwxr-xr-x 2 titan titan 4096  2月 16 23:39 info<br>drwxr-xr-x 2 titan titan 4096  2月 16 23:39 pack<br><br>.git/objects/62:<br>總計 4<br>-r--r--r-- 1 titan titan 18  2月 16 23:40 6799f0f85326a8c1fc522db584e86cdfccd51f<br><br>.git/objects/8c:<br>總計 4<br>-r--r--r-- 1 titan titan 18  2月 16 23:39 1384d825dbbe41309b7dc18ee7991a9085c46e<br><br>...<br></code></pre></td></tr></table></figure><h2 id="hash-object-計算物件名稱的演算法"><a class="header-anchor" href="#hash-object-計算物件名稱的演算法"></a><code>hash-object</code> 計算物件名稱的演算法</h2><p>那 Git 的物件名稱 (也就是 SHA-1) 是如何計算的？不同的 Git 物件有不同的計算方式，這邊先說明 blob 物件的部份。</p><p>Git 物件都是使用 <a href="https://www.zlib.net/" target="_blank" rel="noopener">zlib</a> 壓縮，物件名稱的 SHA-1 hash 值就是 header 加上檔案內容，演算法如下 <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;type&gt; &lt;content_length&gt;\0&lt;content&gt;<br></code></pre></td></tr></table></figure><p>前面的 <code>&lt;type&gt; &lt;content_length&gt;\0</code> 代表 header，而 <code>&lt;content&gt;</code> 代表檔案內容。下面舉個例子：</p><p>建立名為 <code>hello.txt</code> 的檔案，檔案內容為 <code>hello</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">"hello"</span> &gt; hello.txt</span><br></code></pre></td></tr></table></figure><p>使用 <code>cat</code> 指令並加上 <code>-A</code> 選項察看檔案內容：</p><ul><li><code>-A</code>：相當於 <code>-vET</code> 整合選項</li><li><code>-E</code>：將結尾的斷行字元以 <code>$</code> 顯示</li><li><code>-T</code>：將 TAB 字元以 <code>^I</code> 顯示</li><li><code>-v</code>：除了換行及 TAB 字元外，使用 <code>^</code> 及 <code>M-</code> 表示法顯示字元 (列出一些看不出來的特殊字元)</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat -A hello.txt</span><br><span class="hljs-meta">hello%</span><br></code></pre></td></tr></table></figure><p>檔案內容的結尾 <code>%</code> 代表 LF (line Feed，<code>\n</code> )，我是在 Linux 建立 <code>hello.txt</code> 此檔案的，而 Linux 的換行字元是使用 LF 字元，所以在每一行的結尾才會多了 LF 這個字元。</p><p>所以依照上面建立物件名稱的演算法就會像這樣，下面分別代表：</p><ul><li><code>blob</code>：要建立的物件是 blob 物件</li><li><code>6</code>：檔案內容長度</li><li><code>\0</code>：Null 結束字元</li><li><code>hello\n</code>：檔案內容</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">blob 6\0hello\n<br></code></pre></td></tr></table></figure><p>所以如果使用以下指令就能算出此 blob 物件的 SHA-1 hash 值：</p><ul><li><code>echo</code> 的 <code>-n</code> 選項：不輸出結尾的換行字元 (trailing newline)</li><li><code>sha1sum</code>：計算 SHA-1 值</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"blob 6\0hello\n"</span> | sha1sum </span><br>ce013625030ba8dba906f756967f9e9ca394464a<br></code></pre></td></tr></table></figure><h2 id="實作-Git-物件名稱演算法"><a class="header-anchor" href="#實作-Git-物件名稱演算法"></a>實作 Git 物件名稱演算法</h2><p>如果用 Python 實作此演算法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> zlib<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha1<br><br>content = <span class="hljs-string">'hello\n'</span><br>header = <span class="hljs-string">'blob &#123;&#125;\0'</span>.format(len(content))<br>store = header + content<br>hash = sha1(store.encode(<span class="hljs-string">'utf-8'</span>)).hexdigest()<br><br>zlib_content = zlib.compress(store.encode(<span class="hljs-string">'utf-8'</span>))<br><br>path = <span class="hljs-string">'.git/objects/&#123;&#125;/&#123;&#125;'</span>.format(hash[:<span class="hljs-number">2</span>], hash[<span class="hljs-number">2</span>:])<br>os.makedirs(os.path.dirname(path), exist_ok=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">with</span> open(path, <span class="hljs-string">'wb+'</span>) <span class="hljs-keyword">as</span> file:<br>    file.write(zlib_content)<br></code></pre></td></tr></table></figure><p>驗證剛剛實作的 blob 物件是否有效：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git cat-file -p ce0136</span><br>hello<br></code></pre></td></tr></table></figure><p>看到檔案內容就代表實作成功 😃。</p><h2 id="驗證-Git-物件"><a class="header-anchor" href="#驗證-Git-物件"></a>驗證 Git 物件</h2><p>Git 物件名稱可以用來檢查物件的 type 和物件內容是否一致，如果 Git 物件的檔案名稱或內容被惡意修改，就可以很容易的發現有錯誤。</p><p>Git 可用 <code>git fsck</code> 指令來如何驗證資料庫中的物件是否有效，如果驗證成功就會像這樣輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git fsck</span><br>Checking object directories: 100% (256/256), done.<br></code></pre></td></tr></table></figure><p>假設我惡意修改剛剛建立的 blob 物件，使用 <code>git fsck</code> 指令就會告知該物件有問題：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> vim .git/objects/ce/013625030ba8dba906f756967f9e9ca394464a</span><br><span class="hljs-meta">$</span><span class="bash"> git fsck                                                  </span><br>error: inflate: data stream error (incorrect header check)<br>error: unable to unpack header of .git/objects/ce/013625030ba8dba906f756967f9e9ca394464a<br>error: ce013625030ba8dba906f756967f9e9ca394464a: object corrupt or missing: .git/objects/ce/013625030ba8dba906f756967f9e9ca394464a<br>Checking object directories: 100% (256/256), done.<br>missing blob ce013625030ba8dba906f756967f9e9ca394464a<br></code></pre></td></tr></table></figure><h2 id="SHA-1"><a class="header-anchor" href="#SHA-1"></a>SHA-1</h2><p>SHA-1 (Secure Hash Algorithm 1) 是一種 hash (雜湊) 演算法，它可生成 160 bit (20 byte) 的 hash 值，通常以 40 個十六進位 (hex) 的數字表示 <sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>。</p><p>hash 演算法的特性 <sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup>：</p><ul><li>給定訊息很容易計算出 hash 值</li><li>很難用已知的 hash 值推算出原始訊息</li><li>很難修改訊息而 hash 值不變</li><li>很難讓不同的訊息有相同的 hash 值</li></ul><p>所以 Git 有以下優點 <sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup>：</p><ul><li>Git 可透過比較物件名稱 (也就是 SHA-1) 來快速確定兩個物件是否相同</li><li>在每個 repo 中都以相同的方式計算物件名稱，所以儲存在不同 repo 內的相同內容會以相同的名稱來儲存</li><li>可以透過檢查物件名稱來確認其內容的 SHA-1 hash 值，Git 可在讀取物件時檢查錯誤</li></ul><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://git-scm.com/book/zh-tw/v2/Git-Internals-Git-Objects" target="_blank" rel="noopener">Git Internals - Git Objects | Pro Git 2/e</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><a href="https://git-scm.com/docs/user-manual#object-details" target="_blank" rel="noopener">Git - user-manual Documentation</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><a href="https://zh.wikipedia.org/wiki/SHA-1" target="_blank" rel="noopener">SHA-1 - Wiki</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p><a href="https://zh.wikipedia.org/wiki/%E5%AF%86%E7%A2%BC%E9%9B%9C%E6%B9%8A%E5%87%BD%E6%95%B8" target="_blank" rel="noopener">密碼雜湊函式 - Wiki</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p></li><li id="fn5" class="footnote-item"><p><a href="https://git-scm.com/docs/user-manual#the-object-database" target="_blank" rel="noopener">Git - user-manual Documentation</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深入 Git </tag>
            
            <tag> w3HexSchool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git - 刪除遠端分支 (以 GitHub、GitLab 為例)</title>
      <link href="/article/git-delete-remote-branch.html"/>
      <url>/article/git-delete-remote-branch.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/git.jpg" alt=""></p><p>本篇將介紹如何刪除 GitHub 或 GitLab 的遠端分支，以及透過是否可刪除遠端 <code>master</code> 分支 (雖然通常不會這樣做)，以了解如何在 GitHub 和 GitLab 修改預設分支。</p><a id="more"></a><p>如果某分支已合併至遠端的 <code>master</code> 分支 (或穩定版的分支) 時，可在 <code>git push</code> 指令加上 <code>--delete</code> 或 <code>-d</code> 選項來刪除遠端分支 <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git push &lt;remote&gt; --delete &lt;remoteBranchName&gt;</span><br><span class="hljs-meta">$</span><span class="bash"> git push &lt;remote&gt; -d &lt;remoteBranchName&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git push origin --delete dev</span><br>To github.com:titangene/git-demo.git<br> - [deleted]         dev<br></code></pre></td></tr></table></figure><p>或是在 ref (在這邊指的是下面指令中的 <code>&lt;remoteBranchName&gt;</code> ) 之前加上冒號 ( <code>:</code> ) 也可以刪除遠端分支：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git push &lt;remote&gt; :&lt;remoteBranchName&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git push origin :dev</span><br>To github.com:titangene/git-demo.git<br> - [deleted]         dev<br></code></pre></td></tr></table></figure><p>此指令是在 <code>origin</code> repo 中找到與 <code>dev</code> match 的 ref (例如：<code>refs/heads/dev</code> )，然後將該遠端分支刪除 <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>，其實就是刪除遠端 server 上的分支指標。Git Server 會將資料保留一段時間，直到執行 GC (garbage collection，垃圾回收) 為止。所以如果誤刪了分支都很容易恢復。</p><h2 id="刪除多個遠端分支"><a class="header-anchor" href="#刪除多個遠端分支"></a>刪除多個遠端分支</h2><p>如果要刪除多個遠端分支，可直接將多個指定遠端分支加在後面：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git push origin -d feature master</span><br>To github.com:titangene/git-demo.git<br> - [deleted]         feature<br> - [deleted]         master<br></code></pre></td></tr></table></figure><h2 id="無法刪除的遠端分支"><a class="header-anchor" href="#無法刪除的遠端分支"></a>無法刪除的遠端分支</h2><p>通常預設會無法刪除遠端的 <code>master</code> 分支，因為遠端通常會將 <code>master</code> 分支作為預設分支：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git push origin -d master</span><br>To github.com:titangene/git-demo.git<br> ! [remote rejected] master (refusing to delete the current branch: refs/heads/master)<br>error: failed to push some refs to 'git@github.com:titangene/git-demo.git'<br></code></pre></td></tr></table></figure><p>預設是無法刪除 GitHub 和 GitLab 遠端 repo 的 <code>master</code> 分支。</p><h2 id="刪除-GitHub-的遠端分支"><a class="header-anchor" href="#刪除-GitHub-的遠端分支"></a>刪除 GitHub 的遠端分支</h2><p>如果要刪除 GitHub 遠端 repo 的 <code>master</code> 分支，只要將該 repo 的預設分支改成其他分支，這樣就可以刪掉了。</p><p>在 repo 的「Settings &gt; Branches &gt; Default branch &gt; 將預設分支改為其他分支 &gt; Update」，如圖：</p><p><img src="../images/git-delete-remote-branch/2020-02-09-23-30-43.png" alt=""></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git push origin -d master</span><br>To github.com:titangene/git-demo.git<br> - [deleted]         master<br></code></pre></td></tr></table></figure><h2 id="刪除-GitLab-的遠端分支"><a class="header-anchor" href="#刪除-GitLab-的遠端分支"></a>刪除 GitLab 的遠端分支</h2><p>刪除 GitLab 遠端 repo 的 <code>master</code> 分支時，會發生以下錯誤，錯誤訊息中直接說明 <code>master</code> 分支是預設分支，所以無法刪除：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git push gitlab -d master</span><br>remote: GitLab: The default branch of a project cannot be deleted.<br>To gitlab.com:titangene/git-demo.git<br> ! [remote rejected] master (pre-receive hook declined)<br>error: failed to push some refs to 'git@gitlab.com:titangene/git-demo.git'<br></code></pre></td></tr></table></figure><p>在 repo 的「Settings &gt; Repository &gt; Default branch &gt; 將預設分支改為其他分支 &gt; Save changes」，如圖：</p><p><img src="../images/git-delete-remote-branch/2020-02-09-23-28-47.png" alt=""></p><p>那如果將預設分支改成其他分支呢？結果還是不能刪除：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git push gitlab -d master</span><br>remote: GitLab: You can only delete protected branches using the web interface.<br>To gitlab.com:titangene/git-demo.git<br> ! [remote rejected] master (pre-receive hook declined)<br>error: failed to push some refs to 'git@gitlab.com:titangene/git-demo.git'<br></code></pre></td></tr></table></figure><p>其實原因也寫在錯誤訊息內，因為 GitLab 會預設將 repo 的 <code>master</code> 分支設為受保護的分支 (protected branch) <sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup> <sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup>，所以才不能刪除。</p><p>如果要刪除受保護的分支，那就讓他不受保護就可以囉 XD。</p><p>在 repo 的「Settings &gt; Repository &gt; Protected Branches &gt; Unprotect <code>master</code> 分支」，如圖：</p><p><img src="../images/git-delete-remote-branch/2020-02-09-23-30-32.png" alt=""></p><p>設定後就可以刪除 <code>master</code> 分支了：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git push gitlab -d master</span><br>To gitlab.com:titangene/git-demo.git<br> - [deleted]         master<br></code></pre></td></tr></table></figure><h2 id="察看是否刪除遠端分支"><a class="header-anchor" href="#察看是否刪除遠端分支"></a>察看是否刪除遠端分支</h2><p>另外，如果用 <code>git branch -vv</code> 可以看到該分支已被刪除 (輸出訊息中的 <code>gone</code> )：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git branch -vv</span><br>* dev    44fdaf6 [origin/dev: gone] feat: d<br>  master 49135dc [origin/master] feat: b<br></code></pre></td></tr></table></figure><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://git-scm.com/book/en/v2/Git-Branching-Remote-Branches#_delete_branches" target="_blank" rel="noopener">Git - Remote Branches | Pro Git, 2/e</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><a href="https://git-scm.com/docs/git-push#Documentation/git-push.txt-codegitpushoriginexperimentalcode" target="_blank" rel="noopener">Git - git-push Documentation</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><a href="https://gitlab.com/help/user/permissions" target="_blank" rel="noopener">Permissions · User · Help · GitLab</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p><a href="https://gitlab.com/help/user/project/protected_branches" target="_blank" rel="noopener">Protected branches · Project · User · Help · GitLab</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> w3HexSchool </tag>
            
            <tag> GitHub </tag>
            
            <tag> GitLab </tag>
            
            <tag> Branch </tag>
            
            <tag> Remote </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - 總結 &amp; 系列目錄</title>
      <link href="/article/css-series-catalog.html"/>
      <url>/article/css-series-catalog.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>終於來到鐵人賽的最後一天！本篇對「重新認識 CSS」此系列做個總結，並整理此系列中的每篇文章可對應到哪些 CSS Spec。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10228321" target="_blank" rel="noopener">重新認識 CSS - 總結 &amp; 系列目錄</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>就如前言所說，經過這次的鐵人賽，透過看 spec 來學習 CSS 的真實面貌，而不是未經驗證或自行腦補來切版，讓自己能真正的「重新認識 CSS」。</p><p>這個月以來都是當天看 spec 當天寫文，所以每天都有鐵人賽的感覺。起初看 spec 的時候，腦中天旋地轉，好多以前重來沒看過的專有名詞，還好有<a href="https://ithelp.ithome.com.tw/2020ironman/signup/team/78" target="_blank" rel="noopener">好想工作室</a>的夥伴跟我一起討論 spec，加快我理解的速度。</p><p>我第一次寫連續這麼多天的文章，雖然沒有像以前參加鐵人賽的前輩們說的那樣：「到後面幾天就會不知道要寫什麼了」，所以建議我在開賽前，事先規劃好這 30 天要寫什麼。不過我也沒有特別事先安排寫文的順序，因為我原本就預計會按照 <a href="https://www.w3.org/TR/CSS22/Overview.html#minitoc" target="_blank" rel="noopener">CSS 2.2</a> 的大綱來啃 spec，所以我不怕沒有主題可以寫，只怕自己理解的速度跟不上發文的速度 QQ，還好最後成功完賽 😄。</p><p>雖然鐵人完賽了，但這只是我學習旅程的開始，如果未來還有後續的學習紀錄，都會分享在我的 blog「<a href="https://titangene.github.io/">Titangene Blog</a>」，歡迎大家來光顧。如果想知道我之前寫過哪些專案，可以到我的 <a href="https://github.com/titangene" target="_blank" rel="noopener">Github：titangene</a> 看看。</p><p>下面是我對於這次系列「重新認識 CSS」的整理，讓大家可以更快知道哪些內容可以對應到哪些 spec。</p><h2 id="簡介"><a class="header-anchor" href="#簡介"></a>簡介</h2><p>簡介 CSS，並說明如何在 HTML 使用 CSS。系列如下：</p><ul><li><a href="https://titangene.github.io/article/css-introduction.html">重新認識 CSS - CSS 簡介</a></li></ul><blockquote><p>對應 spec 的以下幾篇：</p><ul><li><a href="https://www.w3.org/TR/html401/present/styles.html" target="_blank" rel="noopener">HTM 4.01 - 14. Style Sheets</a></li><li><a href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" target="_blank" rel="noopener">HTML Living Standard - 4.2.4. The link element</a></li></ul></blockquote><h2 id="Selector"><a class="header-anchor" href="#Selector"></a>Selector</h2><p>Selector 是寫 CSS 時，必須掌握的東西，熟悉 selector 才會選到正確的元素。而此系列是依據 <a href="https://www.w3.org/TR/selectors-3/" target="_blank" rel="noopener">Selectors Level 3</a> 的分類來各別介紹的。系列如下：</p><ul><li><a href="https://titangene.github.io/article/css-selector-1.html">重新認識 CSS - Simple Selector &amp; Groups of selector</a></li><li><a href="https://titangene.github.io/article/css-attribute-selector.html">重新認識 CSS - Attribute selector (屬性選擇器)</a></li><li><a href="https://titangene.github.io/article/css-selector-pseudo-class-1.html">重新認識 CSS - Pseudo-class (偽類) (1)</a></li><li><a href="https://titangene.github.io/article/css-selector-pseudo-class-2.html">重新認識 CSS - Pseudo-class (偽類) (2)</a></li><li><a href="https://titangene.github.io/article/css-selector-pseudo-element.html">重新認識 CSS - Pseudo-element (偽元素)</a></li></ul><blockquote><p>對應 spec 的以下幾篇：</p><ul><li><a href="https://www.w3.org/TR/CSS22/selector.html" target="_blank" rel="noopener">CSS 2.2 - 5. Selectors</a></li><li><a href="https://www.w3.org/TR/CSS22/generate.html#before-after-content" target="_blank" rel="noopener">CSS 2.2 - 12.1. The :before and :after pseudo-elements</a></li><li><a href="https://www.w3.org/TR/selectors-3/" target="_blank" rel="noopener">Selectors Level 3</a></li><li><a href="https://www.w3.org/TR/selectors-4/" target="_blank" rel="noopener">Selectors Level 4</a></li><li><a href="https://www.w3.org/TR/css-pseudo-4/" target="_blank" rel="noopener">CSS Pseudo-Elements Module Level 4</a></li></ul></blockquote><h2 id="Values-Units"><a class="header-anchor" href="#Values-Units"></a>Values &amp; Units</h2><p>在開始認識 CSS 屬性之前，可以先認識屬性有哪些值和單位可以使用。系列如下：</p><ul><li><a href="https://titangene.github.io/article/css-attribute-value.html">重新認識 CSS - CSS 屬性值</a></li></ul><blockquote><p>對應 spec 的以下幾篇：</p><ul><li><a href="https://www.w3.org/TR/CSS22/syndata.html#values" target="_blank" rel="noopener">CSS 2.2 - 4.3. Values</a></li><li><a href="https://www.w3.org/TR/css-values-3/" target="_blank" rel="noopener">CSS Values and Units Module Level 3</a></li><li><a href="https://www.w3.org/TR/css-values-4/" target="_blank" rel="noopener">CSS Values and Units Module Level 4</a></li></ul></blockquote><h2 id="Assigning-property-values-Cascading-and-Inheritance"><a class="header-anchor" href="#Assigning-property-values-Cascading-and-Inheritance"></a>Assigning property values, Cascading, and Inheritance</h2><p>了解在 CSS 中，繼承和權重這些重要的觀念之後，接著就可以更深入的了解 CSS 是如何處理屬性值的。系列如下：</p><ul><li><a href="https://titangene.github.io/article/css-inheritance.html">重新認識 CSS - Inheritance (繼承)</a></li><li><a href="https://titangene.github.io/article/css-cascading-and-specificity.html">重新認識 CSS - Cascading &amp; Specificity</a></li><li><a href="https://titangene.github.io/article/css-value-processing.html">重新認識 CSS - CSS 如何處理屬性值</a></li></ul><blockquote><p>對應 spec 的以下幾篇：</p><ul><li><a href="https://www.w3.org/TR/CSS22/cascade.html" target="_blank" rel="noopener">CSS 2.2 - 6. Assigning property values, Cascading, and Inheritance</a></li><li><a href="https://www.w3.org/TR/css-cascade-3/" target="_blank" rel="noopener">CSS Cascading and Inheritance Level 3</a></li><li><a href="https://www.w3.org/TR/css-cascade-4/" target="_blank" rel="noopener">CSS Cascading and Inheritance Level 4</a></li></ul></blockquote><h2 id="media-import-rules"><a class="header-anchor" href="#media-import-rules"></a><code>@media</code> &amp; <code>@import</code> rules</h2><p>引入其他 CSS 檔案或在多個裝置、解析度、螢幕尺寸下要應用哪個 style sheet (樣式表)，就需要了解如何使用 <code>@media</code> 和 <code>@import</code>。系列如下：</p><ul><li><a href="https://titangene.github.io/article/css-media-type.html">重新認識 CSS - Media type</a></li><li><a href="https://titangene.github.io/article/css-media-query.html">重新認識 CSS - Media query</a></li><li><a href="https://titangene.github.io/article/css-import.html">重新認識 CSS - @import</a></li></ul><blockquote><p>對應 spec 的以下幾篇：</p><ul><li><a href="https://www.w3.org/TR/CSS22/media.html" target="_blank" rel="noopener">CSS 2.2 - 7. Media types</a></li><li><a href="https://www.w3.org/TR/css3-mediaqueries/" target="_blank" rel="noopener">Media Queries</a></li><li><a href="https://www.w3.org/TR/mediaqueries/" target="_blank" rel="noopener">Media Queries Level 4</a></li><li><a href="https://www.w3.org/TR/CSS22/cascade.html#at-import" target="_blank" rel="noopener">CSS 2.2 - 6.3 The @import rule</a></li></ul></blockquote><h2 id="Box-model"><a class="header-anchor" href="#Box-model"></a>Box model</h2><p>Box model 是用來描述 document tree 中的每個元素所產生的矩形框。系列如下：</p><ul><li><a href="https://titangene.github.io/article/css-box-model.html">重新認識 CSS - Box model (前傳)</a></li><li><a href="https://titangene.github.io/article/css-border.html">重新認識 CSS - Box model：border</a></li><li><a href="https://titangene.github.io/article/css-box-sizing.html">重新認識 CSS - box-sizing</a></li><li><a href="https://titangene.github.io/article/css-collapsing-margins.html">重新認識 CSS - Collapsing margins</a></li></ul><blockquote><p>對應 spec 的以下幾篇：</p><ul><li><a href="https://www.w3.org/TR/CSS22/box.html" target="_blank" rel="noopener">CSS 2.2 - 8. Box model</a></li><li><a href="https://www.w3.org/TR/css-box-3/" target="_blank" rel="noopener">CSS Box Model Module Level 3</a></li><li><a href="https://www.w3.org/TR/css-ui-3/#box-model" target="_blank" rel="noopener">CSS Basic User Interface Module Level 3 (CSS3 UI) - 3. Box Model addition</a></li><li><a href="https://www.w3.org/TR/css-backgrounds-3/#borders" target="_blank" rel="noopener">CSS Backgrounds and Borders Module Level 3 - 4. Borders</a></li></ul></blockquote><h2 id="Visual-formatting-model"><a class="header-anchor" href="#Visual-formatting-model"></a>Visual formatting model</h2><p>Visual formatting model 是用來描述 UA 會如何處理視覺媒體 (visual media) 的 document tree，document tree 中的每個元素都會根據 box model 來產生 0 個或多個 box。而這些 box 的位置和大小都是相對於稱為 containing block 的矩形框的邊緣計算的。系列如下：</p><ul><li><a href="https://titangene.github.io/article/css-containing-block.html">重新認識 CSS - Containing block</a></li></ul><blockquote><p>對應 spec 的以下幾篇：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html#containing-block" target="_blank" rel="noopener">CSS 2.2 - 9.1.2. Containing blocks</a></li><li><a href="https://www.w3.org/TR/CSS22/visudet.html#containing-block-details" target="_blank" rel="noopener">CSS 2.2 - 10.1. Definition of “containing block”</a></li></ul></blockquote><h3 id="Controlling-box-generation"><a class="header-anchor" href="#Controlling-box-generation"></a>Controlling box generation</h3><p>元素產生的 box 的 type，可以使用 <code>display</code> 屬性來指定，而 box 的 type 會影響 box 在 visual formatting model 中的行為。系列如下：</p><ul><li><a href="https://titangene.github.io/article/css-box-generation-block-box.html">重新認識 CSS - Visual formatting model：Box generation (block)</a></li><li><a href="https://titangene.github.io/article/css-box-generation-inline-box.html">重新認識 CSS - Visual formatting model：Box generation (inline)</a></li><li><a href="https://titangene.github.io/article/css-display.html">重新認識 CSS - display</a></li></ul><blockquote><p>對應 spec 的以下幾篇：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html#box-gen" target="_blank" rel="noopener">CSS 2.2 - 9.2. Controlling box generation</a></li><li><a href="https://www.w3.org/TR/css-display-3/" target="_blank" rel="noopener">CSS Display Module Level 3</a></li></ul></blockquote><h3 id="Formatting-context-Normal-flow"><a class="header-anchor" href="#Formatting-context-Normal-flow"></a>Formatting context &amp; Normal flow</h3><p>Normal flow 中的 box 屬於某種 formatting context，可是 block 或 inline，不同的 box 會參與不同的 formatting context。block-level box 會參與 BFC，inline-level box 會參與 IFC。系列如下：</p><ul><li><a href="https://titangene.github.io/article/css-formatting-context.html">重新認識 CSS - formatting context &amp; independent formatting context</a></li><li><a href="https://titangene.github.io/article/css-bfc.html">重新認識 CSS - Block formatting context (BFC)</a></li><li><a href="https://titangene.github.io/article/css-ifc.html">重新認識 CSS - Inline formatting context (IFC)</a></li></ul><blockquote><p>對應 spec 的以下幾篇：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html#block-formatting" target="_blank" rel="noopener">CSS 2.2 - 9.4.1. Block formatting contexts</a></li><li><a href="https://www.w3.org/TR/CSS22/visuren.html#inline-formatting" target="_blank" rel="noopener">CSS 2.2 - 9.4.2. Inline formatting contexts</a></li><li><a href="https://www.w3.org/TR/css-display-3/" target="_blank" rel="noopener">CSS Display Module Level 3</a></li><li><a href="https://www.w3.org/TR/css-inline-3/" target="_blank" rel="noopener">CSS Inline Layout Module Level 3</a></li></ul></blockquote><h3 id="Positioning-schemes"><a class="header-anchor" href="#Positioning-schemes"></a>Positioning schemes</h3><p>在 CSS 2.2 中，<code>position</code> 和 <code>float</code> 屬性這些定位方案都可以對 box 進行佈局。系列如下：</p><ul><li><a href="https://titangene.github.io/article/css-position.html">重新認識 CSS - position</a></li><li><a href="https://titangene.github.io/article/css-float.html">重新認識 CSS - float</a></li></ul><blockquote><p>對應 spec 的以下幾篇：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html#positioning-scheme" target="_blank" rel="noopener">CSS 2.2 - 9.3. Positioning schemes</a></li><li><a href="https://www.w3.org/TR/css-position-3/" target="_blank" rel="noopener">CSS Positioned Layout Module Level 3</a></li></ul></blockquote><h3 id="Layered-presentation"><a class="header-anchor" href="#Layered-presentation"></a>Layered presentation</h3><p>除了水平和垂直的位置之外，如果想讓 box 可以有類似圖層的概念來排版，就能使用 <code>z-index</code> 屬性，這些 box 可以沿著 z 軸來排列，讓一個 box 可以疊在另一個 box 的上面。系列如下：</p><ul><li><a href="https://titangene.github.io/article/css-z-index-and-stacking-context.html">重新認識 CSS - z-index &amp; stacking context</a></li></ul><blockquote><p>對應 spec 的以下幾篇：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html#layers" target="_blank" rel="noopener">CSS 2.2 - 9.9. Layered presentation</a></li></ul></blockquote><h2 id="Visual-effects"><a class="header-anchor" href="#Visual-effects"></a>Visual effects</h2><p>當 block box 的內容超出 box 的 content edge 時，就可能會發生 overflow。使用 <code>overflow</code> 屬性就能指定超出的部份要如何處理 (例如：提供捲動機制來訪問被剪裁的內容)。而 <code>visibility</code> 屬性則可以指定是否要 render 由元素產生的 box，可用來顯示或隱藏 box。系列如下：</p><ul><li><a href="https://titangene.github.io/article/css-overflow.html">重新認識 CSS - overflow</a></li><li><a href="https://titangene.github.io/article/css-visibility.html">重新認識 CSS - visibility</a></li></ul><blockquote><p>對應 spec 的以下幾篇：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visufx.html" target="_blank" rel="noopener">CSS 2.2 - 11. Visual effects</a></li><li><a href="https://www.w3.org/TR/CSS22/tables.html#dynamic-effects" target="_blank" rel="noopener">CSS 2.2 - 17.5.5. Dynamic row and column effects</a></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - z-index &amp; stacking context</title>
      <link href="/article/css-z-index-and-stacking-context.html"/>
      <url>/article/css-z-index-and-stacking-context.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>本篇將介紹 CSS 的 <code>z-index</code> 屬性和 stacking context。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10228026" target="_blank" rel="noopener">重新認識 CSS - z-index &amp; stacking context</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>從 CSS 2.1 開始，每個 box 在三維空間上都有一個位置，除了水平和垂直的位置之外，這些 box 還會沿著 z 軸來排列，讓一個 box 可以疊在另一個 box 的上面，這個概念就類似於圖層。</p><p>當使用者面對螢幕時，元素的 <code>z-index</code> 屬性設定的數值愈大，則該元素就會愈靠近使用者。</p><h2 id="z-index-屬性"><a class="header-anchor" href="#z-index-屬性"></a><code>z-index</code> 屬性</h2><p>下面是 <code>z-index</code> 屬性的定義表：</p><p><img src="../images/css-z-index-and-stacking-context/2019-10-14-12-15-58.png" alt=""></p><ul><li>此元素的 initial value 為 <code>auto</code></li><li>只適用於定位元素，也就是元素的 <code>position</code> 屬性不為預設值 <code>static</code>，包括：<code>absolute</code>、<code>relative</code>、<code>fixed</code></li><li>此元素為不可繼承屬性</li></ul><p><code>z-index</code> 屬性是對 positioned box 指定了：</p><ul><li>當前 stacking context 中 box 的 stack level</li><li>該 box 是否建立 stacking context</li></ul><p>下面介紹各屬性值：</p><ul><li><code>&lt;integer&gt;</code>：該整數是當前 stacking context 中產生的 box 的 stack level。該 box 還建立了一個新的 stacking context</li><li><code>auto</code>：當前 stacking context 中產生的 box 的 stack level 為 0。如果該 box 具有 <code>position: fixed</code> 或是 root，則它還會建立新的 stacking context</li></ul><h2 id="stacking-context"><a class="header-anchor" href="#stacking-context"></a>stacking context</h2><blockquote><p>原本元素會 in-flow 來排列，當元素使用 <code>position</code> 屬性設定排列的位置時，會從原本的位置移至指定的位置，甚至是 out-of-flow，此時就會建立新的 stacking context</p></blockquote><ul><li>render tree 繪製 (painted) 到 canvas 上的順序是根據 stacking context 來決定的</li><li>每個 box 都屬於一個 stacking context，並且每個定位的 box 都有一個整數的 stack level<ul><li>stack level：代表該 box 在 z 軸上相對於同一個 stacking context 中其他 stack level 的位置</li></ul></li><li>stack level 較高的 box 會在 stack level 較低的 box 前面</li><li>box 的 stack level 可能為負數</li><li>在 stacking context 中，stack level 相同的 box 會根據 document tree 的順序來堆疊 (stacked)，也就是越寫在 HTML 後面的元素會蓋住前面的元素</li><li>stacking context 可以包含其他 stacking context</li></ul><p>如以下範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box box1"</span>&gt;</span>box1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box box2"</span>&gt;</span>box2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">36px</span>;<br>&#125;<br><span class="hljs-selector-class">.box1</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: lightblue;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> -<span class="hljs-number">50px</span> <span class="hljs-number">50px</span>;<br>&#125;<br><span class="hljs-selector-class">.box2</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: lightslategray;<br>&#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/OJJNJJY" target="_blank" rel="noopener">Codepen 連結</a></p><p><code>.box2</code> 元素在 <code>.box1</code> 元素之後，所以 <code>.box2</code> 元素會蓋住 <code>.box1</code> 元素：</p><p><img src="../images/css-z-index-and-stacking-context/2019-10-14-19-13-08.png" alt=""></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div1"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>div #1<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>position: relative;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>z-index: 5;<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div2"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>div #2<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>position: relative;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>z-index: 2;<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div3"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div4"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>div #4<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>position: relative;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>z-index: 6;<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>div #3<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>position: absolute;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>z-index: 4;<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div5"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>div #5<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>position: relative;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>z-index: 1;<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"div6"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>div #6<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">code</span>&gt;</span>position: absolute;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>z-index: 3;<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs css">* &#123; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; &#125;<br><span class="hljs-selector-tag">html</span> &#123; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; &#125;<br><span class="hljs-selector-tag">div</span> &#123;<br>  <span class="hljs-attribute">position</span>: relative;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.7</span>;<br>&#125;<br><span class="hljs-selector-id">#div1</span>,<br><span class="hljs-selector-id">#div2</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#cfc</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> dashed <span class="hljs-number">#696</span>;<br>&#125;<br><span class="hljs-selector-id">#div1</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">160px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">280px</span>;<br>  <span class="hljs-attribute">margin-bottom</span>: -<span class="hljs-number">220px</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">300px</span>;<br>  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">5</span>;<br>&#125;<br><span class="hljs-selector-id">#div2</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;<br>  <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">240px</span>;<br>  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">2</span>;<br>&#125;<br><span class="hljs-selector-id">#div3</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fdd</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">40px</span> <span class="hljs-number">20px</span> <span class="hljs-number">20px</span>;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> dashed <span class="hljs-number">#900</span>;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">40px</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">340px</span>;<br>  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">4</span>;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-selector-id">#div4</span>,<br><span class="hljs-selector-id">#div5</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffc</span>;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> dashed <span class="hljs-number">#996</span>;<br>&#125;<br><span class="hljs-selector-id">#div4</span> &#123;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">25px</span> <span class="hljs-number">10px</span> <span class="hljs-number">5px</span>;<br>  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;<br>  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">6</span>;<br>&#125;<br><span class="hljs-selector-id">#div5</span> &#123;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span> <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">15px</span>;<br>  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-selector-id">#div6</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">180px</span>;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ddf</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">300px</span> <span class="hljs-number">20px</span> <span class="hljs-number">20px</span>;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> dashed <span class="hljs-number">#009</span>;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">20px</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">200px</span>;<br>  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">3</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/KKKzwZe" target="_blank" rel="noopener">Codepen 連結</a></p><p>範例如圖：</p><p><img src="../images/css-z-index-and-stacking-context/2019-10-14-19-07-02.png" alt=""></p><iframe height="559" style="width:100%" scrolling="no" title="stacking context: z-index" src="https://codepen.io/titangene/embed/KKKzwZe?height=559&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/KKKzwZe" target="_blank" rel="noopener">stacking context: z-index</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html#z-index" target="_blank" rel="noopener">CSS 2.2 - 9.9.1. Specifying the stack level: the <code>z-index</code> property</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context" target="_blank" rel="noopener">The stacking context - CSS: Cascading Style Sheets | MDN</a></li></ul><hr>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - visibility</title>
      <link href="/article/css-visibility.html"/>
      <url>/article/css-visibility.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>本篇將介紹 CSS 的 <code>visibility</code> 屬性。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10227785" target="_blank" rel="noopener">重新認識 CSS - visibility</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="visibility-屬性"><a class="header-anchor" href="#visibility-屬性"></a><code>visibility</code> 屬性</h2><p><code>visibility</code> 屬性是用於指定是否 render 由元素產生的 box，可用來顯示或隱藏 box，而無需更改文件的佈局。</p><p>下面是 <code>visibility</code> 屬性的定義表：</p><p><img src="../images/css-visibility/css-visibility-property.png" alt=""></p><ul><li>此元素的 initial value 為 <code>visible</code></li><li>適用於所有元素</li><li>此元素為可繼承屬性，descendant 會繼承父元素的 <code>visibility</code> 屬性設定</li></ul><p>下面介紹各屬性值：</p><h3 id="visible"><a class="header-anchor" href="#visible"></a><code>visible</code></h3><ul><li><code>visibility</code> 屬性的 initial value</li><li>產生的 box 是可見的</li></ul><h3 id="hidden"><a class="header-anchor" href="#hidden"></a><code>hidden</code></h3><ul><li>產生的 box 是不可見的 (完全透明，不會繪製 (drawn) 在畫面上)</li><li>但不可見的 box 還是會影響佈局</li><li>如果元素的 descendant 設定 <code>visibility: visible</code>，則它們將是可見的</li></ul><p>如以下範例，<code>.outer</code> 元素設定 <code>visibility: hidden</code>，而 <code>.outer</code> 元素有兩個 descendant，所有 descendant 都會繼承父元素 <code>.outer</code> 的 <code>visibility</code> 屬性設定：</p><ul><li><code>.inner-hidden</code> 元素：因為沒有在此元素設定 <code>visibility: visible</code>，所以元素為不可見的</li><li><code>.inner-visible</code> 元素：也就是畫面中的紅色矩形，因為有在此元素設定 <code>visibility: visible</code>，所以元素就變為可見的</li></ul><p>在紅色矩形上面所空出的空間，其實就是 <code>.inner-hidden</code> 元素佔用的。雖然 <code>.inner-hidden</code> 元素是不可見的，但它只是被隱藏而已，元素所產生的 box 不會從文件佈局中刪除，所以 box 還是會影響佈局。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"outer"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"inner inner-hidden"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"inner inner-visible"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">outline</span>: <span class="hljs-number">3px</span> solid;<br>&#125;<br><span class="hljs-selector-class">.outer</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">background-color</span>: gray;<br>  <span class="hljs-attribute">visibility</span>: hidden;<br>&#125;<br><span class="hljs-selector-class">.inner</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;<br>  <span class="hljs-attribute">background-color</span>: red;<br>&#125;<br><span class="hljs-selector-class">.inner-visible</span> &#123;<br>  <span class="hljs-attribute">visibility</span>: visible;<br>&#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/Baajxbx" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-visibility/descendant-visibility-visible.png" alt=""></p><iframe height="382" style="width:100%" scrolling="no" title="descendant visibility: visible" src="https://codepen.io/titangene/embed/Baajxbx?height=382&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/Baajxbx" target="_blank" rel="noopener">descendant visibility: visible</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h3 id="collapse"><a class="header-anchor" href="#collapse"></a><code>collapse</code></h3><ul><li>在表格的 row 或 column (row、row group、column 和 column group 元素，也就是分別為 HTML 中的 <code>tr</code>、<code>tbody</code>、<code>col</code> 和 <code>colgroup</code> 元素) 使用 <code>visibility: collapse</code> 時：<ul><li>會導致整個 row 或 column 從顯示結果中刪除，原本佔用的空間會讓其他內容使用，也就是說顯示結果很像是將 <code>display: none</code> 應用在表格的 row 或 column 一樣</li><li>與 collapsed column 或 row (合併欄或合併列) 相交 (intersect) 的 spanned row 或 column (跨欄或跨列) 的內容會被裁切掉 (clipped)</li><li>可以在不強制重新佈局 (re-layout) 表格的情況下，使用動態效果來刪除表格的 row 或 column</li></ul></li><li>對 table cell (也就是 HTML 中的 <code>td</code> 或 <code>th</code> 元素) 使用 <code>visibility: collapse</code> 時，效果相當於 <code>visibility: hidden</code></li><li>除了上述以外的其他元素使用 <code>visibility: collapse</code> 時，效果相當於 <code>visibility: hidden</code></li></ul><p>下面是表格的範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>1.1<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"collapse"</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>1.3<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"collapse"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2.1<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2.3<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>3.1<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>3.2<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>3.3<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">table</span>&#123;<br>  <span class="hljs-attribute">outline</span>: <span class="hljs-number">1px</span> solid;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>&#125;<br><span class="hljs-selector-tag">td</span> &#123;<br>  <span class="hljs-attribute">outline</span>: <span class="hljs-number">1px</span> solid red;<br>&#125;<br><span class="hljs-selector-class">.collapse</span> &#123;<br>  <span class="hljs-attribute">visibility</span>: collapse;<br>&#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/vYYLVmd" target="_blank" rel="noopener">Codepen 連結</a></p><p>如下圖，此範例為 3 x 3 的表格，在沒有設定 <code>visibility: collapse</code> 之前，表格原本長這樣：</p><p><img src="../images/css-visibility/table-row-and-column-visibility-visable.png" alt=""></p><p>如果對 <code>1.2</code> 此 table cell 和第二列設定 <code>visibility: collapse</code>：</p><ul><li><code>1.2</code> 此 table cell 只會被隱藏，不會刪除原本佔用的空間</li><li>第二列會被隱藏，並且刪除原本佔用的空間</li></ul><p><img src="../images/css-visibility/table-row-and-column-visibility-collapse.png" alt=""></p><iframe height="302" style="width:100%" scrolling="no" title="table row &amp; column：visibility: collapse" src="https://codepen.io/titangene/embed/vYYLVmd?height=302&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/vYYLVmd" target="_blank" rel="noopener">table row &amp; column：visibility: collapse</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h2 id="display-none-與-visibility-hidden-的差異"><a class="header-anchor" href="#display-none-與-visibility-hidden-的差異"></a><code>display: none</code> 與 <code>visibility: hidden</code> 的差異</h2><p><code>display: none</code> 和 <code>visibility: hidden</code> 都是可以隱藏元素，但差別在於：</p><ul><li><code>display: none</code> 會將元素所產生的 box 從文件佈局中刪除</li><li><code>visibility: hidden</code> 不會將元素所產生的 box 從文件佈局中刪除</li></ul><p>所以，如果將元素設定 <code>display: none</code>，就會影響到其他元素的佈局，而 <code>visibility: hidden</code> 就不會，因為就只是「真正」意義上的隱藏元素而已。</p><h2 id="visibility-屬性用於動態效果"><a class="header-anchor" href="#visibility-屬性用於動態效果"></a><code>visibility</code> 屬性用於動態效果</h2><p>可以使用 JavaScript 控制哪個元素要顯示或是隱藏。下面是 <code>visibility</code> 屬性的動態效果範例：</p><p>Demo：<a href="https://codepen.io/titangene/pen/dyyGeOo" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-visibility/dynamic-visibility.gif" alt=""></p><iframe height="293" style="width:100%" scrolling="no" title="dynamic visibility" src="https://codepen.io/titangene/embed/dyyGeOo?height=293&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/dyyGeOo" target="_blank" rel="noopener">dynamic visibility</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><p>在一開始進入範例頁面時，<code>A</code> 元素是使用 <code>visibility</code> 的預設值 <code>visible</code>，而 <code>B</code> 元素是設定 <code>visibility: hidden</code> 隱藏元素。</p><p>在此範例中，<code>A</code> 元素和 <code>B</code> 元素都是使用絕對定位，並設定在相同的位置，所以當要顯示一個元素，並隱藏另一個元素時，畫面的動態效果就很像是一個元素替換成另一個元素。CSS 樣式如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">50px</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">10px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>範例中有兩個按鈕：</p><ul><li>點擊 A 按鈕會顯示 <code>A</code> 元素 (也就是顯示 “Name: A” )，並隱藏 <code>B</code> 元素 (也就是隱藏 “Name: B”)</li><li>點擊 B 按鈕會顯示 <code>B</code> 元素 (也就是顯示 “Name: B” )，並隱藏 <code>A</code> 元素 (也就是隱藏 “Name: A”)</li></ul><p>顯示元素其實就是將元素設定成 <code>visibility: visible</code>，在 JavaScript 可以使用下面程式碼來設定：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">element.style.visibility = <span class="hljs-string">'visible'</span><br></code></pre></td></tr></table></figure><p>隱藏元素則是元素設定成 <code>visibility: hidden</code>，在 JavaScript 可以使用下面程式碼來設定：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">element.style.visibility = <span class="hljs-string">'hidden'</span><br></code></pre></td></tr></table></figure><p>這樣就可以實作出 <code>A</code> 和 <code>B</code> 元素切換的動態效果。</p><p>此範例的完整原始碼如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>choose one:<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"buttonA"</span>&gt;</span>A<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"buttonB"</span>&gt;</span>B<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"A"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>Name: A<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"B"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>Name: B<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">div</span>, <span class="hljs-selector-tag">button</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span> &#125;<br><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">50px</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">10px</span>;<br>&#125;<br><span class="hljs-selector-id">#B</span> &#123; <span class="hljs-attribute">visibility</span>: hidden; &#125;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> buttonA = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.buttonA'</span>);<br><span class="hljs-keyword">var</span> buttonB = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.buttonB'</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params">elementIdName</span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> element = <span class="hljs-built_in">document</span>.getElementById(elementIdName);<br>  element.style.visibility = <span class="hljs-string">'visible'</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hide</span>(<span class="hljs-params">elementIdName</span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> element = <span class="hljs-built_in">document</span>.getElementById(elementIdName);<br>  element.style.visibility = <span class="hljs-string">'hidden'</span>;<br>&#125;<br><br>buttonA.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  show(<span class="hljs-string">'A'</span>);<br>  hide(<span class="hljs-string">'B'</span>);<br>&#125;);<br>buttonB.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  show(<span class="hljs-string">'B'</span>);<br>  hide(<span class="hljs-string">'A'</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><blockquote><p>JavaScript 跑錯棚啦 XD</p></blockquote><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visufx.html#visibility" target="_blank" rel="noopener">CSS 2.2 - 11.2. Visibility: the <code>visibility</code> property</a></li><li><a href="https://www.w3.org/TR/CSS22/tables.html#dynamic-effects" target="_blank" rel="noopener">CSS 2.2 - 17.5.5. Dynamic row and column effects</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/visibility" target="_blank" rel="noopener"><code>visibility</code> - CSS: Cascading Style Sheets | MDN</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - overflow</title>
      <link href="/article/css-overflow.html"/>
      <url>/article/css-overflow.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>本篇將介紹 CSS 的 <code>overflow</code> 屬性。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10227474" target="_blank" rel="noopener">重新認識 CSS - overflow</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="overflow-的情境"><a class="header-anchor" href="#overflow-的情境"></a>overflow 的情境</h2><p>通常 block box 的內容僅限於 box 的 content edge。在某些情況下，box 可能會 overflow (溢出)，代表 box 的部分或全部內容都位於 box 的外面，例如：</p><ul><li>一行文字不換行，導致 line box 比 block box 還要寬</li><li>在 containing block 裡面的 block-level box 的寬度比 containing block 還寬 (也就是當元素的 <code>width</code> 屬性值設定大於 containing block 的寬度時會發生)</li><li>元素設定 <code>height</code> 屬性將 containing block 的高度設定成小於元素的內容高度 (也就是元素內容的高度大於 containing block 的高度，containing block 的高度由 <code>height</code> 屬性決定，而不是內容高度決定)</li><li>descendant box 設定 <code>position: absolute</code> 時超出 containing block</li><li>descendant box 將 <code>margin</code> 設為負值時超出 containing block</li><li>設定 <code>text-indent</code> 屬性導致第一行 text 縮排超出 containing block</li></ul><p>下面根據上面這幾個狀況分別舉例，如以下範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>一行文字不換行<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"containing-block"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"inner not-wrap"</span>&gt;</span>Lorem ipsum dolor sit, amet consectetur elit.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>裡面的 block-level box 太寬<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"containing-block"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"inner box-too-wide"</span>&gt;</span>block-level box is too wide<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>內容太高<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"containing-block"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"inner height-exceeds"</span>&gt;</span>element's height exceeds<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>絕對定位<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"containing-block"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"inner absolute"</span>&gt;</span>absolute<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>margin 設為負值<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"containing-block"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"inner negative-margins"</span>&gt;</span>negative margins<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>text-indent 屬性讓第一行 text 縮排超出<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"containing-block"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"inner text-indent"</span>&gt;</span>'text-indent' property<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.containing-block</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;<br>  <span class="hljs-attribute">outline</span>: <span class="hljs-number">2px</span> solid;<br>  <span class="hljs-attribute">background-color</span>: lightgray;<br>&#125;<br><span class="hljs-selector-class">.inner</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#8bf</span>;<br>&#125;<br><span class="hljs-selector-class">.not-wrap</span> &#123;<br>  <span class="hljs-attribute">white-space</span>: nowrap;<br>&#125;<br><span class="hljs-selector-class">.box-too-wide</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">250px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;<br>&#125;<br><span class="hljs-selector-class">.height-exceeds</span> &#123;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;<br>&#125;<br><span class="hljs-selector-class">.absolute</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">190px</span>;<br>&#125;<br><span class="hljs-selector-class">.negative-margins</span> &#123;<br>  <span class="hljs-attribute">margin-right</span>: -<span class="hljs-number">50px</span>;<br>&#125;<br><span class="hljs-selector-class">.text-indent</span> &#123;<br>  <span class="hljs-attribute">text-indent</span>: <span class="hljs-number">11.5rem</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/zYYrZOe" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-overflow/2019-10-12-20-31-01.png" alt=""></p><iframe height="731" style="width:100%" scrolling="no" title="overflow 情境" src="https://codepen.io/titangene/embed/zYYrZOe?height=731&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/zYYrZOe" target="_blank" rel="noopener">overflow 情境</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h2 id="overflow-屬性"><a class="header-anchor" href="#overflow-屬性"></a><code>overflow</code> 屬性</h2><p>下面是 <code>overflow</code> 屬性的定義表：</p><p><img src="../images/css-overflow/2019-10-12-20-37-09.png" alt=""></p><p>此屬性指定 block container 元素的內容 overflow 元素 box 時是否被裁切。它會影響所有元素內容的裁切，但其 containing block 是該元素的 viewport 或 ancestor 的任何 descendant 元素 (及其各自的內容和 descendant) 除外。值具有以下含義：</p><ul><li><code>visible</code>：內容沒有被裁切，也就是可以在 block box 外呈現</li><li><code>hidden</code>：內容被裁切，並且不應提供捲動 UI 來查看裁切區域之外的內容</li><li><code>scroll</code>：內容已被裁切，並且如果 UA 使用螢幕上可見的捲動機制 (例如：scroll bar 或 panner)，則無論該內容是否有內容，都應在 box 上顯示該機制被裁切。這避免了滾動條在動態環境中出現和消失的任何問題。指定此值且目標 medium 為 <code>print</code> 時，可能會列印出 overflow 的內容。在 table box 上使用時，此值與 <code>visible</code> 具有相同的含義</li><li><code>auto</code>：此值的行為取決於 UA，但應導致為 overflow 的 box 提供捲動機制。在 table box 上使用時，此值與 <code>visible</code> 具有相同的含義</li></ul><p>資料來源：</p><ul><li><a href="https://ithelp.ithome.com.tw/articles/10224932" target="_blank" rel="noopener">話說 Overflow 是什麼呢？ - 每天來點 CSS Specification - iT 邦幫忙</a></li><li><a href="https://www.w3.org/TR/CSS22/visufx.html" target="_blank" rel="noopener">CSS 2.2 - 11. Visual effects</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Inline formatting context (IFC)</title>
      <link href="/article/css-ifc.html"/>
      <url>/article/css-ifc.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>本篇將介紹 CSS 的 inline formatting context (IFC)。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10227194" target="_blank" rel="noopener">重新認識 CSS - Inline formatting context (IFC)</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>在 IFC 中，box 會從一個 containing block 的頂端開始一個接著一個的方式來水平排列，而 box 之間會受到水平的 margin、border 和 padding 影響，但不會被垂直的 margin、border 和 padding 所影響，如以下範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><br><br></code></pre></td></tr></table></figure><p>box 可以以不同的方式垂直對齊：</p><ul><li>它們的 bottom 或 top 可以對齊</li><li>box 內的 text 的 baseline 可以對齊</li></ul><p>包含形成行 (line) 的 box 的矩形區域被稱為 line box，line box 的寬度是由 containing block 和 float 來決定，line box 的高度是由 <code>line-height</code></p><p>UA 會將 inline-level box 排列 (flow) 至 line box 的垂直 stack 內，line box 的高度以下面方式來決定：</p><ol><li>計算 line box 中每個 inline-level box 的高度。對於 replaced 元素、inline-block 元素和 inline-table 元素，這是它們的 margin box 的高度。對於 inline box，這是它們的 <code>line-height</code>。</li><li></li></ol><p>inline box (inner display type 為 <code>flow</code> 的 non-replaced inline-level box) 的內容會參與跟該 inline box 本身相同的 IFC</p><p>block container 在某些情境下會建立新的 IFC：</p><p>IFC 是由不包含 block-level box 的 block container 所建立的。當元素的 block container 只包含 inline-level content 時，block container 會建立新的 IFC，然後該元素還會產生一個 root inline box，該 root inline box 會 wrap 那些 inline content。</p><blockquote><p>root inline box 是一個 anonymous inline box，該 box 會自動產生可以容納 block container 的所有 inline-level content。</p><p>有關 anonymous inline box 的詳情，可參閱我前幾天寫的「<a href="https://ithelp.ithome.com.tw/articles/10225035" target="_blank" rel="noopener">重新認識 CSS - Visual formatting model：Box generation (inline)</a>」，內有提供實際範例說明，在此篇就不再追述。</p></blockquote><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html#inline-formatting" target="_blank" rel="noopener">CSS 2.2 - 9.4.2 Inline formatting contexts</a></li><li><a href="https://www.w3.org/TR/css-display-3/" target="_blank" rel="noopener">CSS Display Module Level 3</a></li><li><a href="https://www.w3.org/TR/css-inline-3/" target="_blank" rel="noopener">CSS Inline Layout Module Level 3</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Block formatting context (BFC)</title>
      <link href="/article/css-bfc.html"/>
      <url>/article/css-bfc.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>本篇將介紹 CSS 的 block formatting context (BFC)。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10226848" target="_blank" rel="noopener">重新認識 CSS - Block formatting context (BFC)</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>以下是 <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Block_formatting_context" target="_blank" rel="noopener">MDN</a> 對於在何種情境下會建立 BFC 的定義：</p><blockquote><p>以下情境會建立 BFC：</p><ul><li>文件中的 root 元素 (在 HTML 中是 <code>html</code> 元素)</li><li><code>float</code> 屬性不為 <code>none</code> 的元素</li><li><code>position</code> 屬性為 <code>absolute</code> 或 <code>fixed</code> 的元素</li><li><code>display</code> 屬性為 <code>inline-block</code>、<code>flow-root</code>、<code>table-cell</code> 或 <code>table-caption</code> 的元素</li><li>由 <code>display</code> 屬性為 <code>table</code>、<code>table-row</code>、<code>table-row-group</code>、<code>table-header-group</code>、<code>table-footer-group</code> 或 <code>inline-block</code> 的元素 implicitly 建立的 anonymous table cell</li><li><code>overflow</code> 屬性不為 <code>visible</code> 的 block 元素</li><li><code>contain</code> 屬性為 <code>layout</code>、<code>content</code> 或 <code>paint</code> 的元素</li><li>flex item ( <code>display</code> 屬性為 <code>flex</code> 或 <code>inline-flex</code> 的元素的子元素)</li><li>grid item ( <code>display</code> 屬性為 <code>grid</code> 或 <code>inline-grid</code> 的元素的子元素)</li><li>multicol container ( <code>column-count</code> 或 <code>column-width</code> 屬性不為 <code>auto</code> 的元素，包含 <code>column-count: 1</code> 的元素)</li><li><code>column-span: all</code> 應該始終建立一個新的 formatting context，即使該元素沒有包含在 multicol container 中</li></ul></blockquote><p>float 的定位和 clear 規則都只會適用於同一個 BFC 中的內容：</p><ul><li><code>float</code> 屬性不會影響其他 BFC 中的內容佈局</li><li><code>clear</code> 屬性只能 clear 同一個 BFC 中有設定 <code>clear</code> 屬性的元素之前的 float 元素，不會影響到元素本身內部或其他 BFC 中的 float 元素</li></ul><p>當兩個 block 都在同一個 BFC 時，它們的 margin 才會發生 margin collapsing。</p><p>資料來源：</p><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Block_formatting_context" target="_blank" rel="noopener">Block formatting context - Developer guides | MDN</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - formatting context &amp; independent formatting context</title>
      <link href="/article/css-formatting-context.html"/>
      <url>/article/css-formatting-context.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>本篇將介紹 CSS 的 formatting context 和 independent formatting context。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10226493" target="_blank" rel="noopener">重新認識 CSS - formatting context &amp; independent formatting context</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="formatting-context"><a class="header-anchor" href="#formatting-context"></a>formatting context</h2><p>看一下在不同 CSS level 的 spec 中是如何定義 formatting context。</p><p>在 <a href="https://www.w3.org/TR/CSS21/visuren.html#normal-flow" target="_blank" rel="noopener">CSS 2.1 內的「9.4 Normal flow」</a> 是這樣定義 formatting context：</p><blockquote><p>Boxes in the normal flow belong to a formatting context, which may be block or inline, but not both simultaneously. <a href="https://www.w3.org/TR/CSS21/visuren.html#block-level" target="_blank" rel="noopener">Block-level</a> boxes participate in a <a href="https://www.w3.org/TR/CSS21/visuren.html#block-formatting" target="_blank" rel="noopener">block formatting</a> context. <a href="https://www.w3.org/TR/CSS21/visuren.html#inline-level" target="_blank" rel="noopener">Inline-level boxes</a> participate in an <a href="https://www.w3.org/TR/CSS21/visuren.html#inline-formatting" target="_blank" rel="noopener">inline formatting</a> context.</p></blockquote><p>也就是說，在 CSS 2.1 定義 normal flow 中的 box 屬於某種 formatting context，可是 block 或 inline，但不能同時使用。</p><p>而不同的 box 會參與不同的 formatting context：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html#block-level" target="_blank" rel="noopener">block-level box</a> 會參與 BFC (block formatting context)</li><li><a href="https://www.w3.org/TR/CSS22/visuren.html#inline-level" target="_blank" rel="noopener">inline-level box</a> 會參與 IFC (inline formatting context)</li></ul><p>但是在 <a href="https://www.w3.org/TR/CSS22/visuren.html#normal-flow" target="_blank" rel="noopener">CSS 2.2 內的同一個章節</a>中，將定義改成以下內容：</p><blockquote><p>Boxes in the normal flow belong to a formatting context, which in CSS 2.2 may be table, block or inline. In future levels of CSS, other types of formatting context will be introduced. <a href="https://www.w3.org/TR/CSS22/visuren.html#block-level" target="_blank" rel="noopener">Block-level</a> boxes participate in a <a href="https://www.w3.org/TR/CSS22/visuren.html#block-formatting" target="_blank" rel="noopener">block formatting</a> context. <a href="https://www.w3.org/TR/CSS22/visuren.html#inline-level" target="_blank" rel="noopener">Inline-level boxes</a> participate in an <a href="https://www.w3.org/TR/CSS22/visuren.html#inline-formatting" target="_blank" rel="noopener">inline formatting</a> context. Table formatting contexts are described in the <a href="https://www.w3.org/TR/CSS22/tables.html" target="_blank" rel="noopener">chapter on tables</a>.</p><p>資料來源：<a href="https://www.w3.org/TR/CSS22/changes.html#s.9.4" target="_blank" rel="noopener">CSS 2.2 - Appendix C. Changes</a></p></blockquote><p>也就是說，在 CSS 2.2 定義 formatting context 可以是 table、block 或 inlline，並且說明在將來的 CSS level 會引入其他 type 的 formatting context。另外也可以看到在 CSS 2.2 刪掉了 CSS 2.1 中的 “but not both simultaneously” 這句，也就是其實 BFC 和 IFC 可以同時使用。</p><p>後來在 <a href="https://www.w3.org/TR/css-display-3/#formatting-context" target="_blank" rel="noopener">CSS Display Module Level 3</a> 內也有定義 formatting context：</p><blockquote><p>A <a href="https://www.w3.org/TR/css-display-3/#formatting-context" target="_blank" rel="noopener">formatting context</a> is the environment into which a set of related boxes are laid out. Different formatting contexts lay out their boxes according to different rules. For example, a <a href="https://www.w3.org/TR/css-flexbox-1/#flex-formatting-context" target="_blank" rel="noopener">flex formatting context</a> lays out boxes according to the <a href="https://www.w3.org/TR/css-flexbox-1/#flex-layout" target="_blank" rel="noopener">flex layout</a> rules <a href="https://www.w3.org/TR/css-display-3/#biblio-css3-flexbox" target="_blank" rel="noopener">[CSS3-FLEXBOX]</a>, whereas a <a href="https://www.w3.org/TR/css-display-3/#block-formatting-context" target="_blank" rel="noopener">block formatting context</a> lays out boxes according to the block-and-inline layout rules <a href="https://www.w3.org/TR/css-display-3/#biblio-css2" target="_blank" rel="noopener">[CSS2]</a>.</p></blockquote><p>也就是說，formatting context 是一種環境，相關的 box 會在此環境中佈局，不同的 formatting context 會根據不同的規則來佈局這些的 box。</p><p>例如：</p><ul><li>BFC (block formatting context) 會根據 <a href="https://www.w3.org/TR/CSS22/visuren.html#normal-flow" target="_blank" rel="noopener">block 和 inline 佈局</a>規則來佈局 box</li><li>FFC (flex formatting context) 會根據 <a href="https://www.w3.org/TR/css-flexbox-1/#flex-layout" target="_blank" rel="noopener">flex 佈局</a>規則來佈局 box</li><li>GFC (grid formatting context) 會根據 <a href="https://www.w3.org/TR/css-grid-1/#grid-layout" target="_blank" rel="noopener">grid 佈局</a>規則來佈局 box</li></ul><h2 id="independent-formatting-context"><a class="header-anchor" href="#independent-formatting-context"></a>independent formatting context</h2><p>一個 box 有兩種選擇：</p><ul><li>建立一個新的 independent formatting context</li><li>繼續參與該 box 的 containing block 的 formatting context</li></ul><p>而 box 建立的 formatting context 的 type 是由其 <a href="https://www.w3.org/TR/css-display-3/#inner-display-type" target="_blank" rel="noopener">inner display type</a> 來決定。</p><p>例如：</p><ul><li><a href="https://www.w3.org/TR/css-grid-1/#grid-container" target="_blank" rel="noopener">grid container</a> 建立新的 <a href="https://www.w3.org/TR/css-grid-1/#grid-formatting-context" target="_blank" rel="noopener">GFC (grid formatting context)</a></li><li><a href="https://www.w3.org/TR/css-ruby-1/#ruby-container" target="_blank" rel="noopener">ruby container</a> 建立新的 <a href="https://www.w3.org/TR/css-ruby-1/#ruby-formatting-context" target="_blank" rel="noopener">RFC (ruby formatting context)</a></li><li><a href="https://www.w3.org/TR/css-display-3/#block-container" target="_blank" rel="noopener">block container</a> 可以建立新的 BFC 和/或新的 IFC</li></ul><div class="danger"><p>詳情可參閱 Spec 中的 <a href="https://www.w3.org/TR/css-display-3/#propdef-display" target="_blank" rel="noopener"><code>display</code></a> 屬性表格。(安麗自己的 <code>display</code> 文章)</p></div><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS21/visuren.html#normal-flow" target="_blank" rel="noopener">CSS 2.1 - 9.4. Normal flow</a></li><li><a href="https://www.w3.org/TR/CSS22/visuren.html#normal-flow" target="_blank" rel="noopener">CSS 2.2 - 9.4. Normal flow</a></li><li><a href="https://www.w3.org/TR/css-display-3/" target="_blank" rel="noopener">CSS Display Module Level 3</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - float</title>
      <link href="/article/css-float.html"/>
      <url>/article/css-float.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>本篇將介紹 CSS 的 <code>float</code> 屬性。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10226157" target="_blank" rel="noopener">重新認識 CSS - float</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>原本 <code>float</code> 屬性是為了可以實作出簡單的文書排版，例如：報紙中的文繞圖。如下圖：</p><p><img src="../images/css-float/2019-10-10-16-09-13.png" alt=""></p><blockquote><p>圖片來源：<a href="https://zh.wikipedia.org/wiki/File:Newspaper_fatima_353.jpg" target="_blank" rel="noopener">Wikipedia</a></p></blockquote><h2 id="float-的特性"><a class="header-anchor" href="#float-的特性"></a><code>float</code> 的特性</h2><p>box 會先根據 normal flow 來佈局，然後 box 會脫離 normal flow，並將 box 在該行 (current line) 向左或向右移動，直到 box 的外邊緣 (outer edge) 接觸到 containing block 的邊緣或另一個 float 的外邊緣。float box 的外部頂端 (outer top) 與當前 line box 的頂端對齊。</p><p>如果水平空間沒有空間可以 float，就會將 box 向下移動，直到有適合 (fits) 的空間或不再有 float 為止。</p><p>因為 float box 脫離了 normal flow，所以在 float box 之前和之後建立的 non-positioned block box 會以垂直排列，就很像 float box 不存在一樣。</p><p>跟 float 元素在同一個 line box 或之後的 line box 都會因 float 元素而縮短 (shortened) line box，如果 float 元素有設定 <code>margin</code>，line box 也會縮短 margin box 所佔用的空間。</p><p>當垂直位置滿足以下所有四個條件時，line box 會與 float 相鄰：</p><ol><li>在 line box 頂端或之下</li><li>在 line box 底部或之上</li><li>在 float 的 top margin edge 之下</li><li>在 float 的 bottom margin edge 之上</li></ol><p>而 float box 的內容會沿著 float box 的那一側排列 (flow along its side)，可以透過 <code>clear</code> 屬性來禁止此行為：</p><ul><li><code>float: left</code>：內容從 left-floated box 的右側往下排列</li><li><code>float: right</code>：內容從 right-floated box 的左側往下排列</li></ul><h3 id="float-box-不會縮短-line-box-的情況"><a class="header-anchor" href="#float-box-不會縮短-line-box-的情況"></a>float box 不會縮短 line box 的情況</h3><p>以下狀況 float box 不會縮短 line box：</p><ul><li>外部高度 (outer height) 為 0</li><li>外部高度為負數</li></ul><p>直接看範例，下面是外部高度為負數的範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>floats with negative outer height not shorten line box<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Lorem ipsum dolor sit...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.container</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">400px</span>;<br>  <span class="hljs-attribute">outline</span>: <span class="hljs-number">3px</span> solid black;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;<br>&#125;<br><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> <span class="hljs-number">20px</span> -<span class="hljs-number">150px</span> <span class="hljs-number">20px</span>;<br>  <span class="hljs-attribute">background-color</span>: lightblue;<br>  <span class="hljs-attribute">color</span>: red;<br>  <span class="hljs-attribute">float</span>: left;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">30px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/oNNgmEm" target="_blank" rel="noopener">Codepen 連結</a></p><p><code>.box</code> 元素：</p><ul><li><code>height</code> 為 100px</li><li><code>margin-top</code> 為 20px</li><li><code>margin-bottom</code> 為 -150px</li></ul><p>所以 <code>.box</code> 元素的外部高度計算為 <code>100 + 20 - 150 = -10px</code>，因此外部高度為負數。如下圖結果，就算 <code>.box</code> 元素有設定 <code>float: left</code> 也不會縮短 line box：</p><p><img src="../images/css-float/2019-10-08-20-52-10.png" alt=""></p><iframe height="265" style="width:100%" scrolling="no" title="floats with negative outer height not shorten line box" src="https://codepen.io/titangene/embed/oNNgmEm?height=265&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/oNNgmEm" target="_blank" rel="noopener">floats with negative outer height not shorten line box</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><p>接著是外部高度為 0 的範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>floats with zero outer height not shorten line box<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Lorem ipsum dolor sit...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.container</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">400px</span>;<br>  <span class="hljs-attribute">outline</span>: <span class="hljs-number">3px</span> solid black;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;<br>&#125;<br><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">color</span>: red;<br>  <span class="hljs-attribute">float</span>: left;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">36px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/MWWYLXE" target="_blank" rel="noopener">Codepen 連結</a></p><p>因為 <code>.box</code> 元素的 <code>height</code> 為 0，而且也沒有設定 <code>margin</code>，所以 <code>.box</code> 元素的外部高度為 0。如下圖結果，就算 <code>.box</code> 元素有設定 <code>float: left</code> 也不會縮短 line box：</p><p><img src="../images/css-float/2019-10-08-21-17-15.png" alt=""></p><iframe height="265" style="width:100%" scrolling="no" title="floats with zero outer height not shorten line box" src="https://codepen.io/titangene/embed/MWWYLXE?height=265&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/MWWYLXE" target="_blank" rel="noopener">floats with zero outer height not shorten line box</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - position</title>
      <link href="/article/css-position.html"/>
      <url>/article/css-position.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>本篇將介紹 CSS 的 <code>position</code> 屬性，包括 <code>static</code>、<code>relative</code>、<code>absolute</code> 和 <code>fixed</code>。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10225808" target="_blank" rel="noopener">重新認識 CSS - position</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="Positioning-schemes-定位方案"><a class="header-anchor" href="#Positioning-schemes-定位方案"></a>Positioning schemes (定位方案)</h2><p>在 CSS 2.2 中，可根據三種定位方案對 box 進行佈局：</p><ol><li>Normal flow：</li></ol><ul><li>block-level box 的 block formatting</li><li>inline-level box 的 inline formatting</li><li>block-level 和 inline-level box 的相對定位</li></ul><ol start="2"><li>Float：在 float model 中，box 會先根據 normal flow 來佈局，然後 box 會被移出 flow，並儘可能的向左或向右移動。內容可能會沿著 float 的那一側排列 (Content may flow along the side of a float.)</li><li>絕對定位：在絕對定位 model 中，box 會從 normal flow 中完全刪除 (它不會影響到以後的 sibling)，並根據 containing block 來分配位置</li></ol><p>如果一個元素是 float 的、絕對定位的或者是 root 元素，則該元素被稱為 out of flow。如果元素不是 out of flow，則稱為 in-flow。</p><h2 id="position-屬性"><a class="header-anchor" href="#position-屬性"></a><code>position</code> 屬性</h2><p>下面是 <code>position</code> 屬性的定義表：</p><p><img src="../images/css-position/2019-10-12-18-46-06.png" alt=""></p><p>圖片來源：<a href="https://www.w3.org/TR/CSS22/visuren.html#choose-position" target="_blank" rel="noopener">CSS 2.2 - 9.3.1. Choosing a positioning scheme: <code>position</code> property</a></p><h3 id="static"><a class="header-anchor" href="#static"></a><code>static</code></h3><ul><li>box 是 normal box，按照 normal flow 來佈局</li><li><code>top</code>、<code>right</code>、<code>bottom</code> 和 <code>left</code> 屬性不適用</li></ul><h3 id="relative"><a class="header-anchor" href="#relative"></a><code>relative</code></h3><ul><li>box 的位置是根據 normal flow 來計算的 (這稱為 normal flow 中的位置)，然後 box 相對於其正常位置 (normal position) 偏移</li><li>當 box B 相對定位時，計算下一個 box 的位置，就好像 B 沒有偏移一樣</li><li><code>position:relative</code> 對 <code>table-row-group</code>、<code>table-header-group</code>、<code>table-footer-group</code>、<code>table-row</code>、<code>table-column-group</code>、<code>table-column</code>、<code>table-cell</code>、<code>table-caption</code> 元素的影響未定義</li></ul><h3 id="absolute"><a class="header-anchor" href="#absolute"></a><code>absolute</code></h3><ul><li>box 的位置 (可能還有大小) 由 <code>top</code>、<code>right</code>、<code>bottom</code> 和 <code>left</code> 屬性指定</li><li>這些屬性指定相對於 box 的 <a href="https://www.w3.org/TR/CSS22/visuren.html#containing-block" target="_blank" rel="noopener">containing block</a> 的偏移量</li><li>絕對定位的 box 會從 normal flow 中取出，也就是說它們不會影響到以後的 sibling 的佈局</li><li>同樣，儘管絕對定位的 box 具有 margin，但它們不會與其他 margin 發生 collapsing margin</li></ul><h3 id="fixed"><a class="header-anchor" href="#fixed"></a><code>fixed</code></h3><ul><li>box 的位置是根據 <code>absolute</code> model 計算得出的，但除此之外，該 box 相對於某些參考是 fixed (固定的)</li><li>與 <code>absolute</code> model 一樣，box 的 margin 不會與其他任何 margin 一起 collapse</li><li>當 media type 為 <code>screen</code> 時，該 box 相對於 viewport 是 fixed，捲動時不會移動</li></ul><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html" target="_blank" rel="noopener">CSS 2.2 - 9. Visual formatting model</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - display</title>
      <link href="/article/css-display.html"/>
      <url>/article/css-display.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>本篇將介紹 CSS 中的各種 <code>display</code> 屬性值。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10225430" target="_blank" rel="noopener">重新認識 CSS - display</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="display-屬性"><a class="header-anchor" href="#display-屬性"></a><code>display</code> 屬性</h2><p><img src="../images/css-display/2019-10-06-20-46-44.png" alt=""></p><ul><li><code>block</code>：使元素產生 principal block box</li><li><code>inline-block</code>：使元素產生 principal inline-level block container (inline-block 的內部被格式化為 block box，元素本身被格式化為 atomic inline-level box)</li><li><code>inline</code>：使元素產生一個或多個 inline box</li><li><code>list-item</code>：使元素 (例如：HTML 中的 <code>li</code> 元素) 產生 principal block box 和 marker box。有關列表的資訊和列表格式 (list formatting) 的範例，請參閱<a href="https://www.w3.org/TR/CSS22/generate.html#lists" target="_blank" rel="noopener">列表</a>的部分</li><li><code>none</code>：<ul><li>使元素不會出現在 <a href="https://www.w3.org/TR/CSS22/intro.html#formatting-structure" target="_blank" rel="noopener">formatting structure</a> 中 (也就是在 visual media 中，該元素不產生任何 box 且對佈局沒有影響)</li><li>descendant 元素也不產生任何 box</li><li>元素及其內容將從 formatting structure 中完全刪除</li><li>如果元素設為 <code>display: none</code> 時，其 descendant 元素無法用其他 <code>display</code> 屬性值來覆蓋父元素的 <code>display</code> 設定</li><li>請注意，<code>display: none</code> 不會建立不可見的 box；它根本不會建立任何 box。CSS 包括使元素能夠在 formatting structure 中產生影響 formatting 但本身不可見的 box 的機制。有關詳細資訊，請查閱 <a href="https://www.w3.org/TR/CSS22/visufx.html#visibility" target="_blank" rel="noopener"><code>visibility</code></a> 部分</li></ul></li><li><code>table</code>、<code>inline-table</code>、<code>table-row-group</code>、<code>table-header-group</code>、<code>table-footer-group</code>、<code>table-row</code>、<code>table-column-group</code>、<code>table-column</code>、<code>table-cell</code>、<code>table-caption</code>：使元素的行為類似於表格元素</li></ul><p>除了定位元素、float 元素 (請參閱 <a href="https://www.w3.org/TR/CSS22/visuren.html#dis-pos-flo" target="_blank" rel="noopener"><code>display</code>、<code>position</code> 和 <code>float</code> 之間的關係</a>) 和 root 元素之外，computed value 與 specified value 相同。對於 root 元素，computed value 將按照 <a href="https://www.w3.org/TR/CSS22/visuren.html#dis-pos-flo" target="_blank" rel="noopener"><code>display</code>、<code>position</code> 和 <code>float</code> 之間的關係</a>部分中所述進行變更。</p><p>請注意，儘管 <code>display</code> 的 initial value 為 <code>inline</code>，但 UA 的預設樣式表中的規則可能會覆蓋該值。請參閱附錄中的 <a href="https://www.w3.org/TR/CSS22/sample.html" target="_blank" rel="noopener">HTML 4 範例樣式表</a>。</p><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html#propdef-display" target="_blank" rel="noopener">CSS 2.2 - 9.2.4. The <code>display</code> property</a></li><li><a href="https://www.w3.org/TR/css-display/" target="_blank" rel="noopener">CSS Display Module Level 3</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Visual formatting model：Box generation (inline box)</title>
      <link href="/article/css-box-generation-inline-box.html"/>
      <url>/article/css-box-generation-inline-box.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>在 visual formatting model 中，document tree 中的每個元素都會根據 box model 生成 0 個或多個 box，box 分為兩種不同的 type：block 和 inline。本篇將介紹 inline box。</p><a id="more"></a><p>使用 <code>display</code> 屬性可以決定 box 的 type，不同的 box type 會影響 UA 在 visual formatting model 中要如何去佈局，之前介紹了 <a href="https://titangene.github.io/article/css-box-generation-block-box.html">block 部份</a>，本篇會來介紹 inline 部份。</p><blockquote><p>如果想瞭解 block 部份，可參閱在此系列中的另一篇「<a href="https://titangene.github.io/article/css-box-generation-block-box.html">重新認識 CSS - Visual formatting model：Box generation (block)</a>」。</p></blockquote><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10225035" target="_blank" rel="noopener">重新認識 CSS - Visual formatting model：Box generation (inline box)</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="Inline-level-elements-and-inline-boxes"><a class="header-anchor" href="#Inline-level-elements-and-inline-boxes"></a>Inline-level elements and inline boxes</h2><p>inline-level 元素：</p><ul><li>source document 中不構成新內容的 block 的元素 (例如：段落內的 <code>em</code> 元素)</li><li>內容以 line 分佈 (例如：段落內的強調 (emphasized) text 片段、inline 圖片等)</li><li>產生 inline-level box 的元素</li><li>當元素的 <code>display</code> 屬性值為 <code>inline</code>、<code>inline-table</code> 或 <code>inline-block</code> 時，則該元素就會成為 inline-level 元素</li></ul><p>inline-level box：</p><ul><li>參與 IFC 的 box</li></ul><p>inline box：</p><ul><li>既是 inline-level box，且該 box 的內容會參與該 box 的 containing IFC 的 box</li><li><code>display</code> 屬性值為 <code>inline</code> 的 non-replaced 元素會產生 inline box</li></ul><p>atomic inline-level box：不是 inline box 的 inline-level box，作為 single opaque (不透明) box 參與該 box 的 IFC，例如：</p><ul><li>replaced inline-level 元素</li><li><code>inline-block</code> 元素 (元素會產生 principal inline-level block container，inline-block 的內部會被格式化為 block box，元素本身會被格式化為 atomic inline-level box)</li><li><code>inline-table</code> 元素 (參與 IFC 的 rectangular block)</li></ul><p>如下圖：</p><p><img src="../images/css-box-generation-inline-box/2019-10-06-00-07-37.png" alt=""></p><h3 id="Anonymous-inline-boxes"><a class="header-anchor" href="#Anonymous-inline-boxes"></a>Anonymous inline boxes</h3><p>任何直接包含在 block container 元素內 (不在 inline 元素內) 的 text 都必須被視為 anonymous inline 元素。</p><p>例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Some <span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>emphasized<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span> text<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>p</code> 元素產生 block box，其中包含幾個 inline box：</p><ul><li>“emphasized” 文字的 box 是由 inline 元素 (也就是 <code>em</code> 元素) 產生的 inline box</li><li>其他 box (“Some” 和 “text”) 都是由 block-level 元素 (也就是 <code>p</code> 元素) 產生的 inline box<ul><li>而此 box 被稱為 anonymous inline box，因為它們都沒有關聯 (associated) 的 inline-level 元素</li></ul></li></ul><p>此類的 anonymous inline box 從其 block parent box 繼承可繼承的屬性。非繼承屬性具有其 initial value。在此範例中，anonymous inline box 的 <code>color</code> 會繼承至 <code>p</code> 元素，但是 <code>background</code> 會是透明的。</p><blockquote><p>本文的內容主要是依據 CSS 2.2 中的定義來說明，如有錯誤之處，歡迎告知，感謝 😃。</p></blockquote><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html#box-gen" target="_blank" rel="noopener">CSS 2.2 - 9.2. Controlling box generation</a></li><li><a href="https://www.w3.org/TR/css-display-3/" target="_blank" rel="noopener">CSS Display Module Level 3</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10222516" target="_blank" rel="noopener">視覺格式化模型-Box generation(中) - iT 邦幫忙</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10222018" target="_blank" rel="noopener">Visual Formatting Model - inline - iT 邦幫忙</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Visual formatting model：Box generation (block box)</title>
      <link href="/article/css-box-generation-block-box.html"/>
      <url>/article/css-box-generation-block-box.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>在 visual formatting model 中，document tree 中的每個元素都會根據 box model 生成 0 個或多個 box，box 分為兩種不同的 type：block 和 inline。本篇將介紹 block box。</p><a id="more"></a><p>使用 <code>display</code> 屬性可以決定 box 的 type，不同的 box type 會影響 UA 在 visual formatting model 中要如何去佈局，本篇來介紹 block 部份，之後則會介紹 <a href="https://titangene.github.io/article/css-box-generation-inline-box.html">inline 部份</a>。</p><blockquote><p>如果想瞭解 inline 部份，可參閱在此系列中的另一篇「<a href="https://titangene.github.io/article/css-box-generation-inline-box.html">重新認識 CSS - Visual formatting model：Box generation (inline)</a>」。</p></blockquote><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10224653" target="_blank" rel="noopener">重新認識 CSS - Visual formatting model：Box generation (block box)</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="Block-level-元素-block-boxes"><a class="header-anchor" href="#Block-level-元素-block-boxes"></a>Block-level 元素 &amp; block boxes</h2><p>block-level 元素：</p><ul><li>source document 中以視覺化的方式格式化為 block 的元素 (例如：<code>p</code> 元素)</li><li>產生 block-level principal box 的元素</li><li>當元素的 <code>display</code> 屬性值為 <code>block</code>、<code>list-item</code> 或 <code>table</code> 時，該元素就會成為 block-level 元素</li></ul><p>block-level box：</p><ul><li>參與 BFC 的 box</li></ul><p>block container 元素：</p><ul><li>當該元素的 principal box 是 block container box 時，則該元素為 block container 元素</li></ul><p>block container box：</p><ul><li>block container 要麼只包含參與 IFC 的 inline-level box，要麼只包含參與 BFC 的 block-level box (可能會產生 anonymous block box 以確保此約束，後面會介紹)</li><li>只包含 inline-level content 的 block container 會建立新的 IFC，然後該元素還會產生一個 <a href="https://www.w3.org/TR/css-inline-3/#root-inline-box" target="_blank" rel="noopener">root inline box</a>，該 root inline box 會 wrap 那些 inline content</li><li>當 non-replaced 元素的 <code>display</code> 屬性值為 <code>block</code>、<code>list-item</code> 或 <code>inline-block</code> 時，該元素會產生 block container box</li></ul><blockquote><p>註：<a href="https://www.w3.org/TR/css-inline-3/#root-inline-box" target="_blank" rel="noopener">root inline box</a> 的概念是在 <a href="https://www.w3.org/TR/css-display/#block-container" target="_blank" rel="noopener">CSS Display Module Level 3</a> 中提出的，此概念取代了在 <a href="https://www.w3.org/TR/CSS22/visuren.html#anonymous" target="_blank" rel="noopener">CSS 2</a> 中提到的 anonymous inline box。</p></blockquote><p>不是所有的 block container box 都是 block-level box，例如以下這些都是 block container box，而不是 block-level box：</p><ul><li>non-replaced inline block</li><li>non-replaced table cell</li></ul><p>相反的，不是所有的 block-level box 都是 block container box，例如以下這些都是 block-level box，而不是 block container box：</p><ul><li>block-level replaced 元素 ( <code>display: block</code> )</li><li>flex container ( <code>display: flex</code> )</li><li>table box</li><li>replaced 元素的 principal box</li></ul><blockquote><p>Block-level boxes that are also block containers are called block boxes.</p><p>The three terms “block-level box,” “block container box,” and “block box” are sometimes abbreviated as “block” where unambiguous.</p></blockquote><p>也就是說，若 box 同時為 block container box 和 block-level box 時，可被稱為 block box，此時也可被簡稱為 “block”。</p><p>如下圖：</p><p><img src="../images/css-box-generation-block-box/2019-10-05-14-37-17.png" alt=""></p><h3 id="Anonymous-block-boxes"><a class="header-anchor" href="#Anonymous-block-boxes"></a>Anonymous block boxes</h3><p>直接看範例，假設 <code>div</code> 元素和 <code>p</code> 元素都是 <code>display：block</code>，<code>div</code> 元素內有 inline 內容和 block 內容：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>  Some text<br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>More text<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="../images/css-box-generation-block-box/2019-10-04-16-23-50.png" alt=""></p><p>上圖說明匿名 block box 如何在匿名內容的周圍出現。</p><p><code>div</code> 元素產生 block container box，裡面有一個 block-level box (也就是範例中的 <code>p</code> 元素所產生的)，那就會強制在 block container box 裡面只會有 block-level box。</p><p>所以在 <code>div</code> 的 box 內有兩個包含 text 的矩形 box：</p><ol><li>第一個是 anonymous block box，內容為 “Some text”</li><li>第二個是 <code>p</code> 元素的 box，內容為 “More text”</li></ol><blockquote><p>本文的內容主要是依據 CSS 2.2 中的定義來說明，如有錯誤之處，歡迎告知，感謝 😃。</p></blockquote><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html#box-gen" target="_blank" rel="noopener">CSS 2.2 - 9.2. Controlling box generation</a></li><li><a href="https://www.w3.org/TR/css-display-3/" target="_blank" rel="noopener">CSS Display Module Level 3</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Containing block</title>
      <link href="/article/css-containing-block.html"/>
      <url>/article/css-containing-block.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>本篇將介紹 CSS 的 Containing block。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10224274" target="_blank" rel="noopener">重新認識 CSS - Containing block</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="Containing-block"><a class="header-anchor" href="#Containing-block"></a>Containing block</h2><p>下面是 CSS 2.2 對於 containing block 的定義：</p><blockquote><p>In CSS 2.2, many box positions and sizes are calculated with respect to the edges of a rectangular box called a containing block. In general, generated boxes act as containing blocks for descendant boxes; we say that a box “establishes” the containing block for its descendants. The phrase “a box’s containing block” means “the containing block in which the box lives,” not the one it generates.</p></blockquote><p>很多 box 的位置和大小都是根據某種矩形框 (rectangular box) 來計算的，在 CSS 定義中，就將此 box 稱為 containing block。通常會把產生的 box 作為 descendant box 的 containing block，也就是說一個 box 會為它的 descendant 建立 containing block。當我們在說 “一個 box 的 containing block” 是代表 “box 所在的 containing block”，而不是該 box 所產生的 containing block。</p><p>元素的 containing block 定義如下：</p><ol><li><p>root 元素 (也就是 <code>&lt;html&gt;</code> ) 所在的 containing block 是一個被稱為 initial containing block 的矩形。對於 continuous media 來說，containing block 的尺寸是由 viewport 的尺寸，並且被固定 (anchored) 在 canvas 的開始位置 (origin)；對於 paged media 來說，containing block 的尺寸就是 page area</p></li><li><p>當其他元素的 <code>position</code> 屬性為 <code>relative</code> 或 <code>relative</code> 時，containing block 是由最近的 ancestor box 的 content edge 所構成，該 ancestor box 是 block container 或建立了 formatting context</p></li><li><p>如果元素為 <code>position: fixed</code> 時，則在 continuous media 的情況下由 viewport 建立 containing block，在 paged media 的情況下由 page area 建立 containing block</p></li><li><p>如果元素為 <code>position: absolute</code> 時，則 containing block 是由最近的 <code>position</code> 屬性為 <code>absolute</code>、<code>relative</code> 或 <code>relative</code> 的 ancestor 建立，方法如下：</p><ol><li>如果該 ancestor 是 inline 元素時，containing block 是為該元素產生的第一個和最後一個 inline box 的 padding box 周圍的 bounding box (邊界框)。在 CSS 2.2 中，如果將 inline 元素分割 (split across) 為多行時，則 containing block 未定義</li><li>否則，containing block 是由該 ancestor 的 padding edge 所構成</li></ol><p>如果沒有這樣的 ancestor，則 containing block 就是 initial containing block</p></li></ol><p>雖然每個 box 都會根據其 containing block 來決定位置，但不會被 containing block 所限制，可能會發生 overflow。當發生 overflow 時，可以使用 CSS 提供的 <code>overflow</code> 屬性來處理，這在之後會提到。</p><blockquote><p>有關 overflow 的詳情，可參閱我之後寫的「<a href="https://ithelp.ithome.com.tw/articles/10227474" target="_blank" rel="noopener">重新認識 CSS - overflow</a>」。</p></blockquote><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/visuren.html#containing-block" target="_blank" rel="noopener">CSS 2.2 - 9.1.2. Containing blocks</a></li><li><a href="https://www.w3.org/TR/CSS22/visudet.html#containing-block-details" target="_blank" rel="noopener">CSS 2.2 - 10.1. Definition of “containing block”</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Collapsing margins</title>
      <link href="/article/css-collapsing-margins.html"/>
      <url>/article/css-collapsing-margins.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>兩個 box 之間的 margin 相鄰 (adjoining) 時，可能會讓 margin 發生合併，這個現象就被稱為 collapsing margin，而合併的 margin 就被稱為 collapsed margin。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10223906" target="_blank" rel="noopener">重新認識 CSS - Collapsing margins</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>兩個 box 之間的 margin 相鄰 (adjoining) 時，可能會讓 margin 發生合併，這個現象就被稱為 collapsing margin，而合併的 margin 就被稱為 collapsed margin。</p><p>在下列這些情況會發生 collapsing margin：</p><ul><li>兩個 block 都是 in-flow <a href="https://www.w3.org/TR/CSS22/visuren.html#block-boxes" target="_blank" rel="noopener">block-level box</a>，且參與相同的 <a href="https://www.w3.org/TR/CSS22/visuren.html#block-formatting" target="_blank" rel="noopener">BFC</a></li><li>兩個 block 沒有 line box、clearance、padding 或沒有 border 將它們的 margin 隔開</li><li>垂直相鄰的 box edge：<ul><li>box 的 <code>margin-top</code> 和第一個 in-flow 子元素的 <code>margin-top</code></li><li>box 的 <code>margin-bottom</code> 和下一個 in-flow 之後的 sibling 的 <code>margin-top</code></li><li>最後一個 in-flow 子元素的 <code>margin-bottom</code> 和其父元素的 <code>margin-bottom</code>，且父元素的高度為 <code>auto</code></li><li>未建立新的 BFC，且 <code>min-height</code> 為 0、<code>height</code> 為 <code>auto</code>，且沒有 in-flow children 的 box 的 <code>margin-top</code> 和 <code>margin-bottom</code></li></ul></li></ul><p>而下面這些情況不會發生 collapsing margin：</p><ul><li>root 元素的 box 的 margin</li><li>有 <a href="https://www.w3.org/TR/CSS22/visuren.html#clearance" target="_blank" rel="noopener">clearance</a></li><li>水平的 margin</li><li>建立新的 BFC (block formatting context) 的元素的 margin 不會與 in-flow 的子元素 collapse，例如：float 的元素、<code>overflow</code> 屬性值不為 <code>visible</code> 的元素</li><li><code>position: absolute</code> 的元素的 margin</li><li>inline-block box 的 margin</li></ul><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/box.html#collapsing-margins" target="_blank" rel="noopener">CSS 2.2 - 8.3.1 Collapsing margins</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - box-sizing</title>
      <link href="/article/css-box-sizing.html"/>
      <url>/article/css-box-sizing.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>本篇將介紹 <code>box-sizing</code> 屬性是如何設定計算元素的總寬度和總高度。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10223434" target="_blank" rel="noopener">重新認識 CSS - box-sizing</a></p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>下圖是 <code>box-sizing</code> 屬性的定義：</p><p><img src="../images/css-box-sizing/2019-10-01-17-47-55.png" alt=""></p><p>可以看到 <code>box-sizing</code> 屬性能用在任何元素，而且初始值為 <code>content-box</code>。</p><p>在 CSS box model 中，對元素指定寬度和高度會應用於 content box，如果又在該元素設定 border 或 padding 時，在視覺上會很像是增加元素的大小。也就是說當你想要讓該元素為某寬度或高度時，需要自行手動減去 border 或 padding 所佔用的空間，才能讓元素符合原本預期的寬高。</p><p>例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box-1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box-2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.box-1</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">background-color</span>: lightgreen;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span>;<br>&#125;<br><span class="hljs-selector-class">.box-2</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">4</span>);<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">10px</span> solid;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>如下圖，<code>.box-1</code> 元素和 <code>.box-2</code> 元素的 <code>width</code> 和 <code>height</code> 都一樣 (都是 100px)：</p><p><img src="../images/css-box-sizing/2019-10-01-18-34-25.png" alt=""></p><p>但是可以看出這兩個元素的大小明顯不同，這是因為 <code>.box-2</code> 元素比 <code>.box-1</code> 元素多了 padding 和 border：</p><p><img src="../images/css-box-sizing/2019-10-01-18-35-58.png" alt=""></p><p>各元素在視覺上所佔用的空間：</p><ul><li><code>.box-1</code> 元素：<ul><li>寬：<code>width</code> (100px)</li><li>高：<code>height</code> (100px)</li></ul></li><li><code>.box-2</code> 元素：<ul><li>寬佔用：<code>border-left-width</code> (10px) + <code>padding-left</code> (10px) + <code>width</code> (100px) + <code>padding-right</code> (10px) + <code>border-right-width</code> (10px) = 140px</li><li>高佔用：<code>border-top-height</code> (10px) + <code>padding-top</code> (10px) + <code>height</code> (100px) + <code>padding-bottom</code> (10px) + <code>border-bottom-height</code> (10px) = 140px</li></ul></li></ul><p>如果要 <code>.box-2</code> 元素要保留 border 和 padding，又要只佔用寬度和高度各 100px 就只能手動減去 border 或 padding，以上面範例就會改成這樣：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.box-2</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">4</span>);<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">10px</span> solid;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="../images/css-box-sizing/2019-10-01-18-46-05.png" alt=""></p><p>雖然在視覺上，<code>.box-1</code> 元素和 <code>.box-2</code> 元素所佔用的空間變成一樣了，但是要自行計算 <code>width</code> 和 <code>height</code> 會很麻煩。這時就可以改用 <code>box-sizing: border-box</code>，它就會幫你自動計算扣除 border 或 padding 所剩餘的空間，應用在 content width 和 content height。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.box-2</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">4</span>);<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">10px</span> solid;<br>  <span class="hljs-attribute">box-sizing</span>: border-box;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>如下圖，不用修改 <code>width</code> 和 <code>height</code> 就可以達到預期的效果：</p><p><img src="../images/css-box-sizing/2019-10-01-18-51-44.png" alt=""></p><p><code>content-box</code>：</p><ul><li><code>box-sizing</code> 屬性的初始值</li><li>指定的寬度和高度 (以及對應的最小/最大屬性) 分別應用於元素 content box 的寬度和高度</li></ul><h2 id="各種-box-sizing-reset-方法"><a class="header-anchor" href="#各種-box-sizing-reset-方法"></a>各種 <code>box-sizing</code> reset 方法</h2><h3 id="舊的-box-sizing-reset-方法"><a class="header-anchor" href="#舊的-box-sizing-reset-方法"></a>舊的 <code>box-sizing</code> reset 方法</h3><p>使用 universal selector 選擇所有元素，並將所有元素都設為 <code>box-sizing: border-box</code>。這個方法雖然可以對所有元素做設定，但沒有對 pseudo-element 設定 <code>box-sizing</code>：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">* &#123;<br>  <span class="hljs-attribute">box-sizing</span>: border-box;<br>&#125;<br></code></pre></td></tr></table></figure><p>例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs css">* &#123;<br>  <span class="hljs-attribute">box-sizing</span>: border-box;<br>&#125;<br><span class="hljs-selector-class">.container</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">400px</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">10px</span> solid gray;<br>&#125;<br><span class="hljs-selector-class">.child</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">10px</span> solid lightblue;<br>  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;<br>&#125;<br><span class="hljs-selector-class">.container</span><span class="hljs-selector-pseudo">::after</span> &#123;<br>  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;<br>  <span class="hljs-attribute">display</span>: block;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">10px</span> solid lightgreen;<br>&#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/xxKvgxE" target="_blank" rel="noopener">Codepen 連結</a></p><p>如下圖，pseudo-element 的 <code>box-sizing</code> 還是預設值 <code>content-box</code>，所以 content box 的寬為 300px，高為 100px：</p><p><img src="../images/css-box-sizing/2019-10-02-11-47-31.png" alt=""></p><blockquote><p>selector 詳情可參考我前幾天寫的：</p><ul><li><a href="https://ithelp.ithome.com.tw/articles/10216566" target="_blank" rel="noopener">重新認識 CSS - CSS Selector (前傳)</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10218712" target="_blank" rel="noopener">重新認識 CSS - Pseudo-element (偽元素)</a></li></ul></blockquote><h3 id="Universal-box-sizing"><a class="header-anchor" href="#Universal-box-sizing"></a>Universal <code>box-sizing</code></h3><p>後來也使用 universal selector 來選擇 pseudo-element：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">*, *<span class="hljs-selector-pseudo">::before</span>, *<span class="hljs-selector-pseudo">::after</span> &#123;<br>  <span class="hljs-attribute">box-sizing</span>: border-box;<br>&#125;<br></code></pre></td></tr></table></figure><p>若延續前面的範例，就可以看到 pseudo-element 也使用了 <code>box-sizing: border-box</code>：</p><p><img src="../images/css-box-sizing/2019-10-02-12-06-07.png" alt=""></p><h3 id="繼承-box-sizing"><a class="header-anchor" href="#繼承-box-sizing"></a>繼承 box-sizing</h3><p>剛剛的方法看似可行，但忽略了有些地方還是有 <code>box-sizing: content-box</code> 的需求：</p><p>如果想要讓所有元素都使用 <code>box-sizing: border-box</code>，最常見的作法是在 <code>html</code> 元素上設定 <code>box-sizing</code> 屬性，而所有其他元素則是使用 <code>inherit</code> 這個關鍵字來繼承該值：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">html</span> &#123;<br>  <span class="hljs-attribute">box-sizing</span>: border-box;<br>&#125;<br>*, *<span class="hljs-selector-pseudo">::before</span>, *<span class="hljs-selector-pseudo">::after</span> &#123;<br>  <span class="hljs-attribute">box-sizing</span>: inherit;<br>&#125;<br></code></pre></td></tr></table></figure><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/css-ui-3/#box-sizing" target="_blank" rel="noopener">CSS Basic User Interface Module Level 3 (CSS3 UI) - 3.1. Changing the Box Model: the box-sizing property</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Box model：border</title>
      <link href="/article/css-border.html"/>
      <url>/article/css-border.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>本篇將介紹 CSS 的 Box model 中的 border。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10223019" target="_blank" rel="noopener">重新認識 CSS - Box model：border</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="Border-width"><a class="header-anchor" href="#Border-width"></a>Border width</h2><p>border width 屬性指定 border area 的寬度。</p><p><img src="../images/css-border/border-width-property-2.png" alt=""></p><p><code>border-top-width</code>、<code>border-right-width</code>、<code>border-bottom-width</code>、<code>border-left-width</code> 屬性：</p><ul><li>initial value：<code>medium</code></li><li>computed value：absolute length；如果 border 樣式為 <code>none</code> 或 <code>hidden</code>，則為 <code>0</code></li></ul><p><code>border-width</code> 是下列屬性的簡寫屬性：</p><ul><li><code>border-top-width</code></li><li><code>border-right-width</code></li><li><code>border-bottom-width</code></li><li><code>border-left-width</code></li></ul><p><img src="../images/css-border/border-width-property.png" alt=""></p><p>此屬性引用的 <code>&lt;border-width&gt;</code> value type 可在以下幾個當中選一個使用：</p><ul><li><code>thin</code></li><li><code>medium</code></li><li><code>thick</code></li><li><code>&lt;length&gt;</code>：指定明確的屬性值，border width 不能使用負數</li></ul><p>前三個值的解譯 (interpretation) 方式取決於 UA。但是，必須滿足以下關係：<code>thin</code> &lt;= <code>medium</code> &lt;= <code>thick</code>。</p><p>例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">border-width</span>: thin; &#125;               <span class="hljs-comment">/* thin thin thin thin */</span><br><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">border-width</span>: thin thick; &#125;         <span class="hljs-comment">/* thin thick thin thick */</span><br><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">border-width</span>: thin thick medium; &#125;  <span class="hljs-comment">/* thin thick medium thick */</span><br><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">border-width</span>: thin thick medium thin; &#125;  <span class="hljs-comment">/* thin thick medium thin */</span><br></code></pre></td></tr></table></figure><h2 id="Border-color"><a class="header-anchor" href="#Border-color"></a>Border color</h2><p>border color 屬性指定 box 的 border 的顏色。</p><p><img src="../images/css-border/border-color-property-2.png" alt=""></p><p><code>border-top-color</code>、<code>border-right-color</code>、<code>border-bottom-color</code>、<code>border-left-color</code> 屬性：</p><ul><li>initial value：<code>color</code> 屬性值</li><li>computed value：<code>color</code> 屬性的 <a href="https://www.w3.org/TR/CSS22/cascade.html#computed-value" target="_blank" rel="noopener">computed value</a>，否則使用指定的顏色</li></ul><p><code>border-color</code> 是下列屬性的簡寫屬性：</p><ul><li><code>border-top-color</code></li><li><code>border-right-color</code></li><li><code>border-bottom-color</code></li><li><code>border-left-color</code></li></ul><p><img src="../images/css-border/border-color-property.png" alt=""></p><p><code>border-color</code> 屬性設定四個 border 的顏色。value 具有以下含義：</p><ul><li><code>&lt;color&gt;</code>：指定顏色值</li><li><code>transparent</code>：透明的 border (就算有設定 border 寬度也會是透明的)</li></ul><p>如果未使用 <code>border</code> 屬性指定元素的 border 顏色，則 UA 必須使用元素的 <code>color</code> 屬性的值作為 border 顏色的 <a href="https://www.w3.org/TR/CSS22/cascade.html#computed-value" target="_blank" rel="noopener">computed value</a>。</p><p>例如：實線 (solid) 的 border：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123; <br>  <span class="hljs-attribute">color</span>: black; <br>  <span class="hljs-attribute">background</span>: white; <br>  <span class="hljs-attribute">border</span>: solid;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Border-style"><a class="header-anchor" href="#Border-style"></a>Border style</h2><p>border 樣式屬性指定 box 的 border 的 line 樣式。</p><p><img src="../images/css-border/border-style-property-2.png" alt=""></p><p><code>border-top-style</code>、<code>border-right-style</code>、<code>border-bottom-style</code>、<code>border-left-style</code> 屬性：</p><ul><li>initial value：<code>none</code>，也就是除非有設定 border 樣式，否則不會顯示任何 border</li><li>computed value：<a href="https://www.w3.org/TR/CSS22/cascade.html#specified-value" target="_blank" rel="noopener">specified value</a></li></ul><p><code>border-style</code> 是下列屬性的簡寫屬性：</p><ul><li><code>border-top-style</code></li><li><code>border-right-style</code></li><li><code>border-bottom-style</code></li><li><code>border-left-style</code></li></ul><p><img src="../images/css-border/border-style-property.png" alt=""></p><p>此屬性引用的 <code>&lt;border-width&gt;</code> value type 可在以下幾個當中選一個使用：<code>none</code>、<code>hidden</code>、<code>dotted</code>、<code>dashed</code>、<code>solid</code>、<code>double</code>、<code>groove</code>、<code>ridge</code>、<code>inset</code>、<code>outset</code>。</p><p>樣式如下圖：</p><p>Demo：<a href="https://codepen.io/titangene/pen/poobYwJ" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-border/border-style-demo.png" alt=""></p><iframe height="496" style="width:100%" scrolling="no" title="border style" src="https://codepen.io/titangene/embed/poobYwJ?height=496&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/poobYwJ" target="_blank" rel="noopener">border style</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h2 id="四個方位的-border-設定"><a class="header-anchor" href="#四個方位的-border-設定"></a>四個方位的 border 設定</h2><p>就如之前所說，<code>border-width</code>、<code>border-color</code>、<code>border-style</code> 和 <code>border</code> 屬性都可以設定 1 至 4 個值，分別代表：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">屬性: 上下左右;<br>屬性: 上下 左右;<br>屬性: 上 左右 下;<br>屬性: 上 右 下 左;<br></code></pre></td></tr></table></figure><p>例如：</p><ul><li>水平 border 為 <code>solid</code></li><li>垂直 border 為 <code>dotted</code></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">border-style</span>: solid dotted; &#125;<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考我之前寫的「<a href="https://titangene.github.io/article/css-box-model.html">重新認識 CSS - Box model (前傳)</a>」，內有使用 1 至 4 個值的實際範例，因此在此不再追述。</p></blockquote><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/box.html#margin-properties" target="_blank" rel="noopener">CSS 2.2 - 8. Box model</a></li><li><a href="https://www.w3.org/TR/css-backgrounds-3/#borders" target="_blank" rel="noopener">CSS Backgrounds and Borders Module Level 3 - 4. Borders</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Box model</title>
      <link href="/article/css-box-model.html"/>
      <url>/article/css-box-model.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>在佈局 document 時，UA 的渲染引擎會根據 CSS box model 將每個元素表示為一個矩形框 (rectangular box)。CSS 會確定這些 box 的大小、位置和屬性 (顏色、背景、border 大小…等)。本篇將介紹 CSS 的 Box model。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10222331" target="_blank" rel="noopener">重新認識 CSS - Box model</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>每個 box 都是由下面這四個區域 (area) 所組成：</p><ul><li>content area (例如：文字、圖片 … 等)</li><li>padding area</li><li>border area</li><li>margin area</li></ul><p>這些區域 (area) 都是由各邊緣 (edge) 所定義：</p><ul><li>content edge<ul><li>環繞著由 box 的 <a href="https://www.w3.org/TR/CSS22/visudet.html#Computing_widths_and_margins" target="_blank" rel="noopener">width</a> 和 [height] 指定的矩形 (rectangle)</li><li>通常取決於元素的 <a href="https://www.w3.org/TR/CSS22/conform.html#rendered-content" target="_blank" rel="noopener">render 內容</a></li></ul></li><li>padding edge<ul><li>padding edge 環繞著 box padding</li><li>如果 <code>padding</code> 為 0 時，那 padding edge 也是 content edge</li></ul></li><li>border edge<ul><li>border edge 環繞著 box border</li><li>如果 <code>border</code> 為 0 時，那 border edge 也是 content edge</li></ul></li><li>margin edge<ul><li>margin edge 環繞著 box margin</li><li>如果 <code>margin</code> 為 0 時，那 margin edge 也是 content edge</li></ul></li></ul><p>如下圖：</p><p><img src="../images/css-box-model/2019-09-29-08-20-00.png" alt=""></p><p>用 Chrome DevTools (開發者工具) 也可以看到 box model：</p><p><img src="../images/css-box-model/2019-09-29-07-51-24.png" alt=""></p><p>上圖中的各種顏色由外而內分別為：</p><ul><li>白色：position (與 box model 無關，之後會介紹此部份)</li><li>橘色：margin</li><li>黃色：border</li><li>綠色：padding</li><li>藍色：content</li></ul><p>圖片來源：<a href="https://www.w3.org/TR/css-box-3/#box-model" target="_blank" rel="noopener">CSS Box Model Module Level 3</a></p><p>margin、border 和 padding 可分為 top、right、bottom 和 left 四個部份，可用各自的 CSS 屬性來設定，語法都很類似。</p><p>如果要各別指定上下左右，下面以 padding 的語法為例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">padding-top</span>: 10<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-right</span>: 20<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-bottom</span>: 30<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-left</span>: 40<span class="hljs-selector-tag">px</span>;<br></code></pre></td></tr></table></figure><p>如果要同時設定多個部份，可以使用簡寫屬性來設定，語法如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">屬性: 上下左右;<br>屬性: 上下 左右;<br>屬性: 上 左右 下;<br>屬性: 上 右 下 左;<br></code></pre></td></tr></table></figure><p>下面以 <code>padding</code> 這個簡寫屬性為例，只在此簡寫屬性指定 1 個屬性值時，代表同時指定 <code>padding</code> 的上下左右部份，例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">padding</span>: 10<span class="hljs-selector-tag">px</span>;<br></code></pre></td></tr></table></figure><p>等同於：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">padding-top</span>: 10<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-right</span>: 10<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-bottom</span>: 10<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-left</span>: 10<span class="hljs-selector-tag">px</span>;<br></code></pre></td></tr></table></figure><p>如果在簡寫屬性指定 2 個屬性值時，代表分別指定 <code>padding</code> 的上下、左右部份，例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">padding</span>: 10<span class="hljs-selector-tag">px</span> 20<span class="hljs-selector-tag">px</span>;<br></code></pre></td></tr></table></figure><p>等同於：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">padding-top</span>: 10<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-right</span>: 20<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-bottom</span>: 10<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-left</span>: 20<span class="hljs-selector-tag">px</span>;<br></code></pre></td></tr></table></figure><p>如果在簡寫屬性指定 3 個屬性值時，代表分別指定 <code>padding</code> 的上、左右和下部份，例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">padding</span>: 10<span class="hljs-selector-tag">px</span> 20<span class="hljs-selector-tag">px</span> 30<span class="hljs-selector-tag">px</span>;<br></code></pre></td></tr></table></figure><p>等同於：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">padding-top</span>: 10<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-right</span>: 20<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-bottom</span>: 30<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-left</span>: 20<span class="hljs-selector-tag">px</span>;<br></code></pre></td></tr></table></figure><p>如果在簡寫屬性指定 4 個屬性值時，代表分別指定 <code>padding</code> 的上、右、下、左部份 (以順時針的方向會比較好記憶)，例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">padding</span>: 10<span class="hljs-selector-tag">px</span> 20<span class="hljs-selector-tag">px</span> 30<span class="hljs-selector-tag">px</span> 40<span class="hljs-selector-tag">px</span>;<br></code></pre></td></tr></table></figure><p>等同於：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">padding-top</span>: 10<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-right</span>: 20<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-bottom</span>: 30<span class="hljs-selector-tag">px</span>;<br><span class="hljs-selector-tag">padding-left</span>: 40<span class="hljs-selector-tag">px</span>;<br></code></pre></td></tr></table></figure><h2 id="content"><a class="header-anchor" href="#content"></a>content</h2><ul><li>content area (例如：文字、圖片 … 等)</li><li>content area 的大小：content width 和 content height，取決於幾個因素：<ul><li>生成該 box 的元素是否設定了 <code>width</code> 或 <code>height</code> 屬性</li><li>該 box 是否包含 text 或其它 box</li><li>該 box 是不是表格</li><li>… 等</li></ul></li><li>通常有 <code>background-color</code> 或 <code>background-image</code></li></ul><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/box.html" target="_blank" rel="noopener">CSS 2.2 - 8. Box model</a></li><li><a href="https://www.w3.org/TR/css-box-3/#box-model" target="_blank" rel="noopener">CSS Box Model Module Level 3</a></li><li><a href="https://dwatow.github.io/2017/12-17-iron-man-2018/iron-man-2018-day7/" target="_blank" rel="noopener">前端新手村 垂直排列 與 Box Model</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - @import</title>
      <link href="/article/css-import.html"/>
      <url>/article/css-import.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>CSS 的 <code>@import</code> 規則可以從其他 style sheet 中 import 樣式規則，本篇將介紹如何使用。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10221956" target="_blank" rel="noopener">重新認識 CSS - @import</a></p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="import-語法"><a class="header-anchor" href="#import-語法"></a><code>@import</code> 語法</h2><p><code>@import</code> 語法有兩種寫法：</p><ul><li><code>url()</code> 內包含 style sheet 的 URI</li><li>直接寫 style sheet 的 URI 的字串</li></ul><p>例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@import</span> <span class="hljs-string">"mystyle.css"</span>;<br><span class="hljs-keyword">@import</span> url(<span class="hljs-string">"mystyle.css"</span>);<br></code></pre></td></tr></table></figure><h2 id="解析語法錯誤處理"><a class="header-anchor" href="#解析語法錯誤處理"></a>解析語法錯誤處理</h2><p>如果 <code>@import</code> 規則符合下面任一項，UA 就會忽略該 <code>@import</code> 規則：</p><ul><li>在其他所有規則之後使用 <code>@import</code> 規則 ( <code>@charset</code> 規則除外)</li><li>在 block 內使用 <code>@import</code> 規則，例如：在 <code>@media</code> block 內使用</li></ul><h3 id="在其他所有規則之後使用-import"><a class="header-anchor" href="#在其他所有規則之後使用-import"></a>在其他所有規則之後使用 <code>@import</code></h3><p>例如：如果 CSS 2.2 parser 遇到以下 style sheet：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@import</span> <span class="hljs-string">"subs.css"</span>;<br><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: blue &#125;<br><span class="hljs-keyword">@import</span> <span class="hljs-string">"list.css"</span>;<br></code></pre></td></tr></table></figure><p>根據 CSS 2.2 規範，上面範例中的第二個 <code>@import</code> 規則 (也就是 <code>@import &quot;list.css&quot;;</code> ) 會無效，因為 <code>@import</code> 必須寫在其他規則的前面，所以 CSS 2.2 parser 會忽略第二個 <code>@import</code> 規則，最後會將 style sheet 縮減以下這樣：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@import</span> <span class="hljs-string">"subs.css"</span>;<br><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: blue &#125;<br></code></pre></td></tr></table></figure><h3 id="在-block-內使用-import"><a class="header-anchor" href="#在-block-內使用-import"></a>在 block 內使用 <code>@import</code></h3><p>例如：如果只想在 <code>print</code> media 上 import style sheet，第二個 <code>@import</code> 規則 (也就是 <code>@import &quot;print-main.css&quot;;</code> ) 會無效，因為此 <code>@import</code> 規則不能在 <code>@media</code> block 內使用：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@import</span> <span class="hljs-string">"subs.css"</span>;<br><span class="hljs-keyword">@media</span> print &#123;<br>  <span class="hljs-keyword">@import</span> <span class="hljs-string">"print-main.css"</span>;<br>  <span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10pt</span> &#125;<br>&#125;<br><span class="hljs-selector-tag">h1</span> &#123;<span class="hljs-attribute">color</span>: blue &#125;<br></code></pre></td></tr></table></figure><p>正確的寫法是在 <code>@import</code> 規則後面加上要指定的 media type，例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@import</span> <span class="hljs-string">"subs.css"</span>;<br><span class="hljs-keyword">@import</span> <span class="hljs-string">"print-main.css"</span> print;<br><span class="hljs-keyword">@media</span> print &#123;<br>  <span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10pt</span> &#125;<br>&#125;<br><span class="hljs-selector-tag">h1</span> &#123;<span class="hljs-attribute">color</span>: blue &#125;<br></code></pre></td></tr></table></figure><blockquote><p>如果想了解其他 media type，可參閱在此系列中的另一篇「<a href="https://ithelp.ithome.com.tw/articles/10221152" target="_blank" rel="noopener">重新認識 CSS - media type</a>」。</p></blockquote><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS2/cascade.html#at-import" target="_blank" rel="noopener">CSS 2.2 - 6.3 The @import rule</a></li><li><a href="https://www.w3.org/TR/CSS22/syndata.html#at-rules" target="_blank" rel="noopener">CSS 2.2 - 4.1.5 At-rules</a></li><li><a href="https://www.w3.org/TR/css3-mediaqueries/" target="_blank" rel="noopener">Media Queries</a></li><li><a href="https://www.w3.org/TR/mediaqueries/#media-types" target="_blank" rel="noopener">Media Queries Level 4</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Media query</title>
      <link href="/article/css-media-query.html"/>
      <url>/article/css-media-query.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>今天來介紹 CSS 的 media query 和 media feature。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10221641" target="_blank" rel="noopener">重新認識 CSS - Media query</a></p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>使用 media query 可以針對指定裝置來指定要應用哪個 style sheet</p><p>複習一下<a href="https://ithelp.ithome.com.tw/articles/10221152" target="_blank" rel="noopener">昨天</a>提到的 media type，如果要在不同 media type 指定不同的 style sheet，可以在 HTML 的 <code>link</code> 元素上的 <code>media</code> 屬性，為外部 style sheet 指定目標 media。</p><p>例如：</p><ul><li>在螢幕上顯示時使用無襯線字體</li><li>在列印時使用襯線字體</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"screen"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"sans-serif.css"</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"print"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"serif.css"</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>其他為 style sheet 指定 media 的方法可參閱在此系列中的另一篇「<a href="https://ithelp.ithome.com.tw/articles/10221152" target="_blank" rel="noopener">重新認識 CSS - media type</a>」。</p></blockquote><h2 id="Media-Queries"><a class="header-anchor" href="#Media-Queries"></a>Media Queries</h2><p>media query 是由 media type 和零個或多個表達式組成，這些表達式會檢查指定的 media feature 條件。</p><p>media query 是一個邏輯表達式，可以為 true 或 false。如果 media query 的 media type 與執行 UA 的裝置的 media type match (例如：“<a href="https://www.w3.org/TR/CSS22/about.html#applies-to" target="_blank" rel="noopener">Applies to</a>” 那行所定義的)，並且 media query 中的所有表達式均為 true，則 media query 為 true。</p><h3 id="all-關鍵字"><a class="header-anchor" href="#all-關鍵字"></a><code>all</code> 關鍵字</h3><p>如果要適用所有 media type 的 media query，可以使用簡寫語法省略掉 <code>all</code> 這個關鍵字 (後面接著 <code>and</code> )。也就是說，如果沒有明確指定 media type 時，就等同於 <code>all</code> 這個關鍵字。例如：</p><p>下面兩個 media query 相同：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@media</span> all <span class="hljs-keyword">and</span> (<span class="hljs-attribute">min-width:</span><span class="hljs-number">500px</span>) &#123; … &#125;<br><span class="hljs-keyword">@media</span> (<span class="hljs-attribute">min-width:</span><span class="hljs-number">500px</span>) &#123; … &#125;<br></code></pre></td></tr></table></figure><p>下面兩個也相同：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@media</span> (<span class="hljs-attribute">orientation:</span> portrait) &#123; … &#125;<br><span class="hljs-keyword">@media</span> all <span class="hljs-keyword">and</span> (<span class="hljs-attribute">orientation:</span> portrait) &#123; … &#125;<br></code></pre></td></tr></table></figure><h3 id="Combining-Media-Queries："><a class="header-anchor" href="#Combining-Media-Queries："></a>Combining Media Queries：</h3><p>可在 media query 列表中組合多個 media query，並以逗號 <code>,</code> 分隔。</p><p>如果 media query 列表的任何 component media query 為 <code>true</code>，則為 <code>true</code>；若所有 component media query 為 <code>false</code> 才會為 <code>false</code>。</p><p>例如：如果 media type 為 <code>screen</code> 且為彩色裝置，或 media type 為 <code>projection</code> 且為彩色裝置：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (color), projection <span class="hljs-keyword">and</span> (color) &#123; … &#125;<br></code></pre></td></tr></table></figure><h3 id="and-關鍵字"><a class="header-anchor" href="#and-關鍵字"></a><code>and</code> 關鍵字</h3><p>下面是在 HTML 的 <code>link</code> 元素上的 <code>media</code> 屬性使用 <code>and</code> 關鍵字：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"screen and (color)"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"test.css"</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>跟上面一樣的 media query，只是下面是在 CSS 中使用 @import-rule 寫的：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@import</span> url(color.css) screen <span class="hljs-keyword">and</span> (color);<br></code></pre></td></tr></table></figure><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/media.html" target="_blank" rel="noopener">CSS 2.2 - 7. Media types</a></li><li><a href="https://www.w3.org/TR/css3-mediaqueries/" target="_blank" rel="noopener">Media Queries</a></li><li><a href="https://www.w3.org/TR/mediaqueries/#media-types" target="_blank" rel="noopener">Media Queries Level 4</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - media type</title>
      <link href="/article/css-media-type.html"/>
      <url>/article/css-media-type.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>如果同將一份文件應用在不同的 media 上呈現，就可以使用 media type 來指定適用的 media。本篇將介紹 CSS 的 media type。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10221152" target="_blank" rel="noopener">重新認識 CSS - Media type</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>有些 CSS 屬性只在某些 media 上適用，例如：<a href="https://www.w3.org/TR/CSS22/page.html#propdef-page-break-before" target="_blank" rel="noopener"><code>page-break-before</code></a> 屬性僅適用於 <code>paged</code> media，而 <code>visual</code> 是 media group，如下圖：</p><p><img src="../images/css-media-type/2019-09-26-19-25-01.png" alt=""></p><p>不同 media type 的 style sheet 可以對同一個元素的同一個屬性進行設定，但是各屬性有不同的設定值。例如：<code>font-size</code> 在電腦螢幕上通常都會比在紙上還要大，所以可以在不同 media type 分別設定不同的字體大小。</p><h2 id="指定與-media-相關的-style-sheet"><a class="header-anchor" href="#指定與-media-相關的-style-sheet"></a>指定與 media 相關的 style sheet</h2><p>下面有幾種方法可以為 style sheet 指定 media：</p><ol><li>使用 <code>@media</code> 規則指定目標 media：</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@media</span> screen &#123;<br>  <span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10pt</span>; &#125;<br>&#125;<br><span class="hljs-keyword">@media</span> print &#123;<br>  <span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10pt</span>; &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>使用 <code>@import</code> 規則指定目標 media：</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@import</span> url(<span class="hljs-string">"style.css"</span>) screen;<br><span class="hljs-keyword">@import</span> url(<span class="hljs-string">"print.css"</span>) print;<br></code></pre></td></tr></table></figure><ol start="3"><li>在 HTML 要引入 style sheet 時，在 <code>link</code> 元素上的 <code>media</code> 屬性指定外部 style sheet 的目標 media：</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"screen"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"./style.css"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"print"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"./print.css"</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="media-規則"><a class="header-anchor" href="#media-規則"></a><code>@media</code> 規則</h2><p>可在同一個 style sheet 內，為各種 media 使用 style sheet 規則：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@media</span> print &#123;<br>  <span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10pt</span>; &#125;<br>&#125;<br><span class="hljs-keyword">@media</span> screen &#123;<br>  <span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>; &#125;<br>&#125;<br><span class="hljs-keyword">@media</span> screen, print &#123;<br>  <span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.2</span>; &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="media-type"><a class="header-anchor" href="#media-type"></a>media type</h2><p>常用的 media type：</p><ul><li><code>all</code>：適用於所有裝置</li><li><code>screen</code>：主要用於彩色電腦螢幕 (包含手機和平版)</li><li><code>speech</code>：適用於語音合成器 (speech synthesizer)、語音朗讀裝置</li><li><code>print</code>：適用於 paged material 和在列印預覽模式下在螢幕上查看的文件，例如：用瀏覽器的「列印預覽」模式察看文件 (如下圖)</li></ul><p><img src="../images/css-media-type/2019-09-27-08-06-25.png" alt=""></p><blockquote><p><code>print</code> 的 paged media 部份可參閱 <a href="https://www.w3.org/TR/CSS22/page.html" target="_blank" rel="noopener">CSS 2.2 - paged media</a>。</p></blockquote><div class="info"><p>在 <a href="https://www.w3.org/TR/CSS2/media.html#media-types" target="_blank" rel="noopener">CSS 2.1</a> 定義了其他幾種比較少見的 media type：<code>braille</code>、<code>embossed</code>、<code>handheld</code>、<code>projection</code>、<code>tty</code>、<code>tv</code> 和 <code>aural</code>，但這些 media type 在 <a href="https://www.w3.org/TR/mediaqueries/#media-types" target="_blank" rel="noopener">Media Queries Level 4</a> 已被棄用，所以不建議使用這些 media type。</p><p>當初在決定有哪些 media type 的時候，不同的 media type 有很大的區別，例如：<code>screen</code> 和 <code>handheld</code>，分別為電腦螢幕和手持裝置 (例如：PDA)，但後來這兩個的界線從愈來愈模糊，變成沒有界線。</p></div><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/media.html" target="_blank" rel="noopener">CSS 2.2 - 7. Media types</a></li><li><a href="https://www.w3.org/TR/CSS22/page.html#propdef-page-break-before" target="_blank" rel="noopener">CSS 2.2 - 13. Paged media</a></li><li><a href="https://www.w3.org/TR/css3-mediaqueries/" target="_blank" rel="noopener">Media Queries</a></li><li><a href="https://www.w3.org/TR/mediaqueries/" target="_blank" rel="noopener">Media Queries Level 4</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Cascading &amp; Specificity</title>
      <link href="/article/css-cascading-and-specificity.html"/>
      <url>/article/css-cascading-and-specificity.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>CSS 可以在同份文件上使用多個 style sheet 來設定文件的樣式。如果你在不同 style sheet 內對同一個元素或屬性設定值時，就會 CSS 會透過 <a href="https://www.w3.org/TR/css-cascade-3/#cascade" target="_blank" rel="noopener">cascading</a> 這個特性來解決這個衝突。本篇將介紹 CSS 的 Cascading 和 specificity。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10220677" target="_blank" rel="noopener">重新認識 CSS - Cascading &amp; Specificity</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="Cascading"><a class="header-anchor" href="#Cascading"></a>Cascading</h2><p>cascade 接受給定 (given) 元素上的給定屬性的 declared value 的無序列表，根據如下所述按照其宣告的優先度對它們進行排序，並輸出一個 cascaded value</p><p>cascade 會使用各元素上屬性的 declared value 的無序列表，透過下面所述的 Cascading 流程，以宣告的優先度從高到低進行排序，並輸出一個 cascaded value：</p><ol><li>Origin and Importance</li><li>Specificity</li><li>Order of Appearance</li></ol><h3 id="Origin-and-Importance"><a class="header-anchor" href="#Origin-and-Importance"></a>Origin and Importance</h3><ul><li>Origin：根據宣告的<a href="https://www.w3.org/TR/css-cascade-3/#origin" target="_blank" rel="noopener">來源 (origin)</a></li><li>Importance：該屬性值是否被宣告為 <code>!important</code></li></ul><p>各種來源的優先度按降序 (高到低) 排列：</p><ol><li>Transition declarations <a href="https://www.w3.org/TR/css-transitions-1/" target="_blank" rel="noopener">CSS Transitions</a></li><li>Important user agent declarations</li><li>Important user declarations</li><li>Important author declarations</li><li>Animation declarations <a href="https://www.w3.org/TR/css-animations-1/" target="_blank" rel="noopener">CSS Animations Level 1</a></li><li>Normal author declarations</li><li>Normal user declarations</li><li>Normal user agent declarations</li></ol><h3 id="Specificity"><a class="header-anchor" href="#Specificity"></a>Specificity</h3><p>選擇器的 specificity 計算方式的背後是計算 <code>a</code>、<code>b</code>、<code>c</code> 和 <code>d</code> 個四個數字，此方法會分別在各個 selector 上計算，四個數字各別如下：</p><ul><li><code>a</code>：如果在直接在 HTML 元素上設定 <code>style</code> 屬性，那 <code>a = 1</code>，否則為 0</li><li><code>b</code>：計算使用 ID selector 的數量</li><li><code>c</code>：計算使用 class selector、attributes selector 和 pseudo-class 的數量</li><li><code>d</code>：計算使用 type selector 和 pseudo-element 的數量</li></ul><p>另外還有幾點要特別注意：</p><ul><li>specificity 會忽略 universal selector</li><li>如果你用 attributes selector 來 match <code>id</code> 屬性 (例如：<code>[id=titan]</code> )，也還是算成 attributes selector (也就是 <code>a = 0</code>、<code>b = 0</code>、<code>c = 1</code> 和 <code>d = 0</code> )</li></ul><p>下面是 <a href="https://www.w3.org/TR/CSS22/cascade.html#specificity" target="_blank" rel="noopener">CSS 2.2</a> 提供的 specificity 範例：</p><p><img src="../images/css-cascading-and-specificity/specificity.png" alt=""></p><p>下面舉個實際的範例；</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span><br><span class="css">    <span class="hljs-selector-id">#titan</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"titan"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color: green"</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><p>因為 <code>p</code> 元素有設定 <code>style</code> 屬性，會覆蓋 <code>style</code> 元素中 以 ID selector <code>#titan</code> 的宣告 (因為 <code>style</code> 屬性的 specificity 更高)，所以 <code>p</code> 元素的文字結果為綠色。</p><h3 id="Order-of-Appearance"><a class="header-anchor" href="#Order-of-Appearance"></a>Order of Appearance</h3><p>越放在 HTML 最後的宣告優先度越高：</p><ul><li><a href="https://www.w3.org/TR/css-cascade-3/#at-ruledef-import" target="_blank" rel="noopener">imported style sheet</a> 中的宣告會按順序來排序</li><li>HTML 外部連結的 style sheet 中的宣告會按順序來排序</li><li><code>style</code> 屬性的宣告是根據 <code>style</code> 屬性出現在該元素的文件順序來排序，並且全部放在任何 style sheet 之後</li></ul><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/cascade.html" target="_blank" rel="noopener">CSS 2.2 - 6. Assigning property values, Cascading, and Inheritance</a></li><li><a href="https://www.w3.org/TR/css-cascade-3/" target="_blank" rel="noopener">CSS Cascading and Inheritance Level 3</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - CSS 如何處理屬性值</title>
      <link href="/article/css-value-processing.html"/>
      <url>/article/css-value-processing.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>今天來介紹 CSS 如何處理屬性值。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10220084" target="_blank" rel="noopener">重新認識 CSS - CSS 如何處理屬性值</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>每個屬性的定義表 (definition table) 都定義了：</p><ul><li>Name：屬性名稱</li><li>Value：屬性值</li><li>Initial：initial value 為何</li><li>Applies to：此屬性適用於哪些元素</li><li>Inherited：是否為 <a href="https://www.w3.org/TR/css-cascade-3/#inherited-property" target="_blank" rel="noopener">inherited properties</a></li><li>Percentages：百分比值如何 interpreted</li><li>Media：該屬性適用於哪些 media group</li><li>Computed value：如何計算 Computed value</li></ul><p>如下圖：</p><p><img src="../images/css-value-processing/2019-09-26-17-08-25.png" alt=""></p><p>圖片來源：<a href="https://www.w3.org/TR/CSS22/about.html#property-defs" target="_blank" rel="noopener">CSS 2.2 - 1.4.2 CSS property definitions</a></p><blockquote><p>詳情可參閱 <a href="https://www.w3.org/TR/CSS22/about.html#property-defs" target="_blank" rel="noopener">CSS 2.2 Spec - 1.4.2 CSS property definitions</a></p></blockquote><h2 id="Value-Processing"><a class="header-anchor" href="#Value-Processing"></a>Value Processing</h2><p>UA 解析了文件並在建構了 <a href="https://www.w3.org/TR/CSS22/conform.html#doctree" target="_blank" rel="noopener">document tree</a> 之後，UA 必須為 tree 中的每個元素以及 formatting structure (格式化結構) 中的每個 box 分配對應於目標 <a href="https://www.w3.org/TR/CSS22/media.html" target="_blank" rel="noopener">media type</a> 的屬性值。</p><div class="info"><p>document tree：source document (原始文件，在這邊可以指 HTML 或 XML) 中編碼的元素的 tree。該 tree 中的每個元素都只有一個父元素，但 root 元素 (在 HTML 中就是 <code>&lt;html&gt;</code> 元素) 除外。</p></div><p>所以每個屬性都會有一個值，而這些值 (也就是說元素或 box 的 CSS 屬性的 final value) 會通過下面幾個步驟來計算決定。</p><p>在說明步驟之前先來說這個計算過程中會用到的幾種值：</p><ul><li>declared value</li><li>cascaded value</li><li>specified value</li><li>computed value</li><li>used value</li><li>actual value</li></ul><h3 id="Declared-values"><a class="header-anchor" href="#Declared-values"></a>Declared values</h3><p>為了找到 declared value，應用於每個元素的每個屬性宣告，都會以 <a href="https://www.w3.org/TR/css-cascade-3/#filtering" target="_blank" rel="noopener">filtering declarations (過濾宣告)</a> 的方式來標識出 (identify) 可以適用於每個元素的所有宣告。只要符合下列情況，宣告就適用於各元素：</p><ul><li>宣告屬於當前適用於此文件的 style sheet</li><li>宣告不符合，帶有錯誤條件的條件規則 <a href="https://www.w3.org/TR/css3-conditional/" target="_blank" rel="noopener">CSS Conditional Rules Module Level 3</a></li><li>宣告屬於該 <a href="https://www.w3.org/TR/selectors-3/" target="_blank" rel="noopener">selector 與該元素 match 的樣式規則</a>。 (必要時需要考慮<a href="https://www.w3.org/TR/selectors-4/#scoping" target="_blank" rel="noopener">範圍 (scope)</a> )</li><li>有效語法：宣告的屬性是已知的屬性名稱，並且 declared value 與該屬性的語法 match</li></ul><p>適用於每個元素上的每個屬性的 declared value 會形成 declared value 的列表，此列表會由 cascade 來進行優先度排序。</p><h3 id="Cascaded-values"><a class="header-anchor" href="#Cascaded-values"></a>Cascaded values</h3><p>cascade 會使用各元素上屬性的 declared value 的無序列表，透過 <a href="https://www.w3.org/TR/css-cascade-3/#cascading" target="_blank" rel="noopener">Cascading</a> (明天會介紹) 流程選擇一個 “winning value”，也就是按照宣告的優先度來進行排序，優先度最高的宣告就會輸出一個 cascaded value (也可以說是在 <a href="https://www.w3.org/TR/css-cascade-3/#output-of-the-cascade" target="_blank" rel="noopener">cascade 的輸出 (output of the cascade)</a> 中排在最前面的值)。</p><p>如果 cascade 的輸出為空 (empty) 列表時，則沒有 cascade value。</p><div class="info"><p>cascade 的輸出 (output of the cascade)：每元素上的每個屬性的 declared value 的排序列表 (可能為 empty)。</p></div><h3 id="Specified-Values"><a class="header-anchor" href="#Specified-Values"></a>Specified Values</h3><p>Specified value 是由 style sheet 的作者 (也就是網頁開發者) 針對該元素指定的屬性值。</p><p>cascaded value 會透過 <a href="https://www.w3.org/TR/css-cascade-3/#defaulting" target="_blank" rel="noopener">defaulting</a> 流程來計算 specified value，以確保每個元素上的每個屬性都有一個 specified value，流程如下：</p><ul><li>是否為 <a href="https://www.w3.org/TR/css-cascade-3/#inherited-property" target="_blank" rel="noopener">inherited properties</a>：<ul><li>是：通過繼承從該父元素中取得 initial value</li><li>否：採用該屬性的 initial value</li></ul></li><li>Explicit Defaulting (顯式預設)：當 cascaded value 為下面某個 <a href="https://www.w3.org/TR/css3-values/#css-wide-keywords" target="_blank" rel="noopener">CSS-wide keywords</a> 時 (所有屬性都可以使用這些關鍵字)，會有對應的處理方式<ul><li><code>initial</code>：將 initial value 作為屬性的 specified value</li><li><code>inherit</code>：將 computed value 作為屬性的 specified value 和 computed value</li><li><code>unset</code>：是否為 inherited property：<ul><li>是：等同於 <code>inherit</code> 的作用</li><li>否：等同於 <code>initial</code> 的作用</li></ul></li></ul></li></ul><p>如果沒有 cascaded value 時，也會依照上面流程來決定 specified value。</p><h3 id="Computed-Values"><a class="header-anchor" href="#Computed-Values"></a>Computed Values</h3><ul><li>computed value 是解析屬性定義表 (definition table) 中的 “Computed Value” 定義的 specified value 的計算結果</li><li>通常將其絕對化以準備<a href="https://www.w3.org/TR/css-cascade-3/#inheritance" target="_blank" rel="noopener">繼承</a></li></ul><h3 id="Order-of-Appearance"><a class="header-anchor" href="#Order-of-Appearance"></a>Order of Appearance</h3><p>越放在 HTML 最後的宣告優先度越高：</p><ul><li><a href="https://www.w3.org/TR/css-cascade-3/#at-ruledef-import" target="_blank" rel="noopener">imported style sheet</a> 中的宣告會按順序來排序</li><li>HTML 外部連結的 style sheet 中的宣告會按順序來排序</li><li><code>style</code> 屬性的宣告是根據 <code>style</code> 屬性出現在該元素的文件順序來排序，並且全部放在任何 style sheet 之後</li></ul><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/cascade.html" target="_blank" rel="noopener">CSS 2.2 - 6. Assigning property values, Cascading, and Inheritance</a></li><li><a href="https://www.w3.org/TR/css-cascade-3/" target="_blank" rel="noopener">CSS Cascading and Inheritance Level 3</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs plain">4.1 Declared Values<br>4.2 Cascaded Values<br>4.3 Specified Values<br>4.4 Computed Values x<br><br>5 Filtering<br>6 Cascading 上半部，詳細順序還沒提到，下一篇會提到<br>### Origin and Importance<br>### Specificity<br>### Order of Appearance x<br><br>7 Defaulting<br>7.1 Initial Values<br>7.2 Inheritance<br>7.3 Explicit Defaulting<br><br>之後寫：<br>- Cascaded values<br>  - Cascading<br>- Specified Values<br>  - Defaulting<br>  - Explicit Defaulting：三個 CSS-wide keywords<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Inheritance (繼承)</title>
      <link href="/article/css-inheritance.html"/>
      <url>/article/css-inheritance.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>今天來介紹 CSS 的 Inheritance (繼承) 以及 <code>inherit</code> 這個關鍵字的屬性值。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10219679" target="_blank" rel="noopener">重新認識 CSS - Inheritance (繼承)</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="Inheritance-繼承"><a class="header-anchor" href="#Inheritance-繼承"></a>Inheritance (繼承)</h2><p>某些值是由 document tree 中的元素的 children 繼承。每個屬性都<a href="https://www.w3.org/TR/CSS22/about.html#property-defs" target="_blank" rel="noopener">定義</a>了是否繼承。</p><p>像下圖是 <a href="https://www.w3.org/TR/CSS22/colors.html#propdef-color" target="_blank" rel="noopener"><code>color</code></a> 屬性的定義，可以看到在 <code>Inherited</code> 欄位中是定義為可被繼承：</p><p><img src="../images/css-Inheritance/2019-09-23-18-40-59.png" alt=""></p><p>例如：下面範例中，如果沒有在 <code>em</code> 元素設定 <code>color</code> 屬性，就會繼承 <code>h1</code> 元素的 <code>color</code> 屬性：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>The headline <span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>is<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span> important!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure><p>如果 <code>h1</code> 元素的 <code>color</code> 設為藍色，那 <code>em</code> 元素的 <code>color</code> 也會是藍色：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: blue; &#125;<br></code></pre></td></tr></table></figure><p>發生繼承時，元素會繼承 computed value。來自父元素的 computed value 會同時成為子元素上的 specified value 和 computed value。</p><p>例如以下範例：</p><ul><li><code>h1</code> 元素的 <code>font-size</code> 屬性的 computed value 會是 13px ( <code>130% x 10px</code>，也就是使用父元素 <code>body</code> 的 <code>font-size</code> 屬性值：<code>10px</code>，乘上 <code>h1</code> 元素的 <code>130%</code> )</li><li><code>em</code> 元素繼承了 <code>h1</code> 元素的 <code>font-size</code> 屬性的 computed value，因此 <code>em</code> 元素也會是 <code>13px</code> 的 computed value</li><li>如果 UA 沒有可用的 <code>13px</code> 字體，則 <code>h1</code> 和 <code>em</code> 元素的 <code>font-size</code> 的 actual value 可能會是 <code>12px</code> (例如：瀏覽器預設最小字體為 <code>12px</code> )</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>A <span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>large<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span> heading<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10px</span>; &#125;<br><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">130%</span>; &#125;<br></code></pre></td></tr></table></figure><h3 id="繼承屬性值：inherit"><a class="header-anchor" href="#繼承屬性值：inherit"></a>繼承屬性值：<code>inherit</code></h3><p>每個屬性都可以使用 <code>inherit</code> 這個繼承屬性值，只要設定了這個值，該屬性就會將元素的 parent 的 computed value 作為 specified value，也就是說，<code>inherit</code> 這個值是用於強制繼承，也可用於原本在屬性定義表中定義為 <code>Inherited: no</code> 的屬性，讓該屬性變成可繼承的父元素。</p><p>如果在 root 元素的屬性上設定了 <code>inherit</code> 值，則會為該屬性設定其 initial value。</p><p>例如：</p><ul><li>在 <code>body</code> 元素上設定了 <a href="https://www.w3.org/TR/CSS22/colors.html#propdef-color" target="_blank" rel="noopener"><code>color</code></a> 和 <a href="https://www.w3.org/TR/CSS22/colors.html#propdef-background" target="_blank" rel="noopener"><code>background</code></a> 屬性</li><li>所有其他元素的 <code>color</code> 屬性設為 <code>inherit</code>，並且 <code>background</code> 屬性設為 <code>transparent</code> (也就是透明背景)</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">color</span>: black <span class="hljs-meta">!important</span>; <br>  <span class="hljs-attribute">background</span>: white <span class="hljs-meta">!important</span>;<br>&#125;<br>* &#123; <br>  <span class="hljs-attribute">color</span>: inherit <span class="hljs-meta">!important</span>; <br>  <span class="hljs-attribute">background</span>: transparent <span class="hljs-meta">!important</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>如果上面這些規則都是使用者的 style sheet，則會在整個文件中強制使用白底黑字 (因為其他元素的 <code>color</code> 屬性會繼承 <code>body</code> 元素的黑色，而其他元素都被設為透明色的背景)。</p><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/cascade.html" target="_blank" rel="noopener">CSS 2.2 - 6. Assigning property values, Cascading, and Inheritance</a></li><li><a href="https://www.w3.org/TR/css-cascade-3/" target="_blank" rel="noopener">CSS Cascading and Inheritance Level 3</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - CSS 屬性值</title>
      <link href="/article/css-attribute-value.html"/>
      <url>/article/css-attribute-value.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>在介紹各種 CSS 屬性之前，先來介紹屬性值，CSS 的屬性值分為：整數和實數、Lengths (長度)、百分比、URLs 和 URIs、Counters (計數器)、顏色、字串。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10219238" target="_blank" rel="noopener">重新認識 CSS - CSS 屬性值</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>屬性值分為：</p><ul><li>整數和實數</li><li>Lengths (長度)</li><li>百分比</li><li>URLs &amp; URIs</li><li>Counters (計數器)</li><li>顏色</li><li>字串</li></ul><h2 id="整數和實數"><a class="header-anchor" href="#整數和實數"></a>整數和實數</h2><ul><li>整數 (包括正整數、0 和負整數)，例如：<code>16</code>、<code>-10</code>。</li><li><a href="https://zh.wikipedia.org/wiki/%E5%AE%9E%E6%95%B0" target="_blank" rel="noopener">實數</a> (包括整數、小數…等)，例如：<code>7.5</code>。</li></ul><h2 id="Lengths-長度"><a class="header-anchor" href="#Lengths-長度"></a>Lengths (長度)</h2><p>格式為實數 + 單位，例如：<code>16px</code>、<code>-10px</code>、<code>7.5em</code>。</p><p>有些屬性可以使用負長度值，但這樣可能會使 formatting model 複雜化，並且可能會有某些實作上的限制。如果不支援負長度值，則應換成可支援的最接近值。</p><p>如果在不支援負長度值的屬性使用，就會忽略該宣告。如果不支援長度值，UA 必須將它近似為<a href="https://www.w3.org/TR/CSS22/cascade.html#actual-value" target="_blank" rel="noopener">實際值 (actual value)</a>。</p><p>長度單位有兩種：</p><ul><li>相對單位</li><li>絕對單位</li></ul><h3 id="相對單位"><a class="header-anchor" href="#相對單位"></a>相對單位</h3><p>相對單位有：</p><ul><li><code>em</code>：等於使用該元素的 <a href="https://www.w3.org/TR/CSS22/fonts.html#propdef-font-size" target="_blank" rel="noopener"><code>font-size</code></a> 屬性的<a href="https://www.w3.org/TR/CSS22/cascade.html#computed-value" target="_blank" rel="noopener">計算值</a></li><li><code>ex</code>：由元素的第一個可用字體定義，關於字體的 “x-height”</li></ul><div class="info"><h4 id="x-height"><a class="header-anchor" href="#x-height"></a>x-height</h4><ul><li>通常等於小寫字母 “x” 的高度</li><li>即使不包含 “x” 的字體也定義了 <code>ex</code></li></ul><p>字體的 x-height 可以通過不同的方式找到：</p><ul><li>某些字體本身就有包含 x-height 的資訊 (可靠指標，reliable metrics)</li><li>如果沒有可靠的字體指標，UA 可以根據小寫字形的 height 來確定 x-height<ul><li>例如：以小寫字母 “o” 的字形 (glyph) 在 baseline 以下延伸的距離，並從其 bounding box (邊界框) 的頂端減去該值</li></ul></li><li>如果還是無法確定 x-height，就會將 x-height 設為 <code>0.5em</code></li></ul><p><img src="../images/css-attribute-value/2019-09-22-18-51-25.png" alt=""></p><p>圖片來源：<a href="https://www.w3.org/TR/css-inline-3/#baseline-synthesis-fonts" target="_blank" rel="noopener">CSS Inline Layout Module Level 3</a></p></div><p>只要在 <code>font-size</code> 屬性值中使用 <code>em</code> 和 <code>ex</code> 單位，各別就會引用父元素的 <code>em</code> 或 <code>ex</code> 單位。</p><p>例如：原本 <code>p</code> 元素的預設字體大小為 16px，如果這時設定以下樣式：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Lorem ipsum dolor sit amet.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2em</span>; &#125;<br></code></pre></td></tr></table></figure><p><code>p</code> 元素的計算值就會是 <code>2 x 16px</code>，所以計算值的結果為 32px，並且上下的 margin 也會變成各 32px，因為瀏覽器預設 margin 為 1em：</p><p><img src="../images/css-attribute-value/2019-09-22-18-29-08.png" alt=""></p><p><img src="../images/css-attribute-value/2019-09-22-18-23-58.png" alt=""></p><p>如果在 <code>p</code> 元素的容器上設定，CSS 樣式變成這樣：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.box</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10px</span>; &#125;<br><span class="hljs-selector-tag">p</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2em</span>; &#125;<br></code></pre></td></tr></table></figure><p>那 <code>p</code> 元素的字體大小就不會是剛剛的 32px，而是變成 20px。這是因為 <code>em</code> 這個單位會拿容器的大小來算出計算值，也就是 <code>2 x 10px</code>，所以計算值的結果為 20px，並且上下的 margin 也會變成各 20px：</p><p><img src="../images/css-attribute-value/2019-09-22-18-35-52.png" alt=""></p><p>將 <code>em</code> 單位用在 <code>line-height</code> 是常見的用法。例如：設定以下樣式，就代表將 <code>h1</code> 元素的 line height 設定成比 <code>h1</code> 元素的字體大 20%：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.2em</span>; &#125;<br></code></pre></td></tr></table></figure><p>另外，當使用 <code>em</code> 和 <code>ex</code> 單位時，子元素是繼承父元素的<a href="https://www.w3.org/TR/CSS22/cascade.html#computed-value" target="_blank" rel="noopener">計算值</a>，不是繼承父元素指定的相對值。</p><p>例如：<code>h1</code> 元素是 <code>body</code> 元素的子元素，<code>h1</code> 元素的 <a href="https://www.w3.org/TR/CSS22/text.html#propdef-text-indent" target="_blank" rel="noopener"><code>text-indent</code></a> 屬性的計算值會是 36px，而不是 45px：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Lorem ipsum dolor sit amet.<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;<br>  <span class="hljs-attribute">text-indent</span>: <span class="hljs-number">3em</span>;  <span class="hljs-comment">/* i.e., 36px */</span><br>&#125;<br><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">15px</span>; &#125;<br></code></pre></td></tr></table></figure><p>(O)：因為在 <code>body</code> 元素的 <code>text-indent</code> 屬性的計算值是 36px，而子元素 <code>p</code> 只會繼承父元素 <code>body</code> 的計算值 36px。<br>(X)：而不是因為 <code>p</code> 元素的字體大小為 15px，所以 <code>p</code> 元素的 <code>text-indent</code> 屬性的計算值是 45px。</p><h3 id="絕對單位"><a class="header-anchor" href="#絕對單位"></a>絕對單位</h3><p>絕對單位有：</p><ul><li><code>in</code>：inches (英寸)，1in 等於 2.54cm</li><li><code>cm</code>：公分</li><li><code>mm</code>：毫米</li><li><code>pt</code>：points (點)，CSS 使用的 points 等於 1/72nd of 1in</li><li><code>pc</code>：picas (派卡)，1pc 等於 12pt</li><li><code>px</code>：pixel units (像素單位)，1px 等於 0.75pt</li></ul><p>各種絕對單位之間的關係：<code>1in</code> = <code>2.54cm</code> = <code>25.4mm</code> = <code>72pt</code> = <code>6pc</code>。</p><p>當解析度為 <code>72dpi</code> 時，<code>1px = 1pt</code>。</p><h2 id="百分比"><a class="header-anchor" href="#百分比"></a>百分比</h2><p>每個 CSS 屬性都會定義是否可以使用百分比值，如果可以使用會引用哪裡的值來作為依據。百分比值可以是：</p><ul><li>相同元素的另一個屬性的值</li><li>ancestor 元素的屬性的值</li><li>formatting context 的值 (例如：<a href="https://www.w3.org/TR/CSS22/visuren.html#containing-block" target="_blank" rel="noopener">containing block</a> 的寬度，containing block 的部份之後會說明)</li></ul><p>下面是「相同元素的另一個屬性的值」的範例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">120%</span>;  <span class="hljs-comment">/* 120% of 'font-size' */</span><br>&#125;<br></code></pre></td></tr></table></figure><p>將 <code>p</code> 元素的字體大小設為 10px，如果又再 <code>p</code> 元素上設定 <code>line-height: 120%</code>，那 <code>p</code> 元素的 <code>line-height</code> 的計算值結果會是 12px (因為 <code>10px x 120%</code> )。</p><p>下面是「ancestor 元素的屬性的值」的範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Lorem<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> ipsum dolor sit amet.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span> &#123; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>; &#125;<br><span class="hljs-selector-tag">span</span> &#123; <span class="hljs-attribute">line-height</span>: <span class="hljs-number">120%</span>; &#125;<br></code></pre></td></tr></table></figure><p>將 <code>p</code> 元素的字體大小設為 20px，<code>span</code> 元素的 <code>line-height</code> 屬性會繼承父元素 <code>p</code> 的 <code>font-size</code> 值 20px，所以 <code>span</code> 元素的 <code>line-height</code> 屬性的計算值結果就會是 24px (因為 <code>20px x 120%</code> )。</p><h2 id="URLs-URIs"><a class="header-anchor" href="#URLs-URIs"></a>URLs &amp; URIs</h2><p>有些 CSS 的屬性值可以使用 URI，語法範例如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">"http://www.ex.com/image.png"</span>); &#125;<br></code></pre></td></tr></table></figure><blockquote><p>URI (Uniform Resource Identifiers) 包括 URL、URN 等，詳情請參閱 <a href="https://www.ietf.org/rfc/rfc3986" target="_blank" rel="noopener">RFC3986</a> 標準。</p></blockquote><p><code>url()</code> 內的雙引號 ( <code>&quot;</code> ) 也可以改為單引號 ( <code>'</code> )。</p><p>另外，在前單引號或前單引號之前，以及後雙引號或後雙引號之後都可以加上可選的<a href="https://www.w3.org/TR/CSS22/syndata.html#whitespace" target="_blank" rel="noopener">空白字元 (white space)</a>，可依照各自偏好來決定 coding style，例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>( <span class="hljs-string">"http://www.ex.com/image.png"</span> ); &#125;<br><span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>( <span class="hljs-string">'http://www.ex.com/image.png'</span> ); &#125;<br></code></pre></td></tr></table></figure><h3 id="沒有引號"><a class="header-anchor" href="#沒有引號"></a>沒有引號</h3><p>下面是沒有引號的範例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">li</span> &#123; <span class="hljs-attribute">list-style</span>: <span class="hljs-built_in">url</span>(http://www.ex.com/titan.png) disc; &#125;<br></code></pre></td></tr></table></figure><p>如果在沒有加引號的 URI 中使用某些字元，例如：括號 ( <code>(</code>、<code>)</code> )、空白字元 ( <code></code> )、單引號 ( <code>'</code> ) 和雙引號 ( <code>&quot;</code> )，就必須在該字元之前加上反斜線跳脫 (escaped with a backslash)，例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">li</span> &#123; <span class="hljs-attribute">list-style</span>: <span class="hljs-built_in">url</span>(http://www.ex.com/titan\(test\).png) disc; &#125;<br></code></pre></td></tr></table></figure><p>也可以將上述字元按照 <a href="https://www.ietf.org/rfc/rfc3986" target="_blank" rel="noopener">RFC3986</a> 中的描述，轉換成 URI 換碼字元，例如：<code>(</code> 等於 <code>%28</code>，而 <code>)</code> 等於 <code>%29</code>。剛剛上面的範例就會變成：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">li</span> &#123; <span class="hljs-attribute">list-style</span>: <span class="hljs-built_in">url</span>(http://www.ex.com/titan%<span class="hljs-number">28</span>test%<span class="hljs-number">29</span>.png) disc; &#125;<br></code></pre></td></tr></table></figure><h3 id="相對-URI"><a class="header-anchor" href="#相對-URI"></a>相對 URI</h3><p>另外也可以使用相對 URI。例如下面的 CSS 檔案放在：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">http:&#x2F;&#x2F;www.ex.org&#x2F;style&#x2F;basic.css<br></code></pre></td></tr></table></figure><p>CSS 檔內如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">"titan.png"</span>); &#125;<br></code></pre></td></tr></table></figure><p>那這個 <code>&quot;titan.png&quot;</code> 的完整 URI 就會是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">http:&#x2F;&#x2F;www.ex.org&#x2F;style&#x2F;titan.png<br></code></pre></td></tr></table></figure><p>也就代表相對 URI 會使用 base URI 來解析成完整的 URI。不過要注意的是，對 CSS style sheet 來說，base URI 是 style sheet 的 base URI (在上面範例中是 <code>http://www.ex.org/style/</code> )，而不是 source document (原始文件，也就是 HTML 文件) 的 base URI。</p><blockquote><p>在 <a href="https://www.ietf.org/rfc/rfc3986" target="_blank" rel="noopener">RFC3986</a> 的第五節定義了此過程的規範演算法。</p></blockquote><h3 id="不可用在-URI-中使用註解"><a class="header-anchor" href="#不可用在-URI-中使用註解"></a>不可用在 URI 中使用註解</h3><p>下面範例看似註解了 <code>x</code> 這個字元，但其實此 URI 還是 <code>/*x*/pic.png</code>，而不是 <code>pic.png</code>：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">background</span>: <span class="hljs-built_in">url</span>(/*x*/pic.png); &#125;<br></code></pre></td></tr></table></figure><div class="info"><p>註：在 CSS 中的註解語法是：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-comment">/* 我是註解 */</span><br></code></pre></td></tr></table></figure></div><h2 id="Counters-計數器"><a class="header-anchor" href="#Counters-計數器"></a>Counters (計數器)</h2><p>直接看範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>First<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>First-First<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Lorem ipsum dolor sit amet.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>First-Second<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Lorem ipsum dolor sit amet.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Second<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Second-First<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Lorem ipsum dolor sit amet.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Second-Second<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Lorem ipsum dolor sit amet.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">counter-reset</span>: chapter; &#125;<br><span class="hljs-selector-tag">h1</span><span class="hljs-selector-pseudo">::before</span> &#123;<br>  <span class="hljs-attribute">content</span>: <span class="hljs-string">"Chapter "</span> <span class="hljs-built_in">counter</span>(chapter) <span class="hljs-string">". "</span>;<br>  <span class="hljs-attribute">counter-increment</span>: chapter;<br>&#125;<br><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">counter-reset</span>: section; &#125;<br><span class="hljs-selector-tag">h2</span><span class="hljs-selector-pseudo">::before</span> &#123;<br>  <span class="hljs-attribute">content</span>: <span class="hljs-built_in">counter</span>(chapter) <span class="hljs-string">"."</span> <span class="hljs-built_in">counter</span>(section) <span class="hljs-string">". "</span>;<br>  <span class="hljs-attribute">counter-increment</span>: section;<br>&#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/poobELL" target="_blank" rel="noopener">Codepen 連結</a></p><p>讓 <code>h1</code> 和 <code>h2</code> 元素的文字之前會自動為章節編號：</p><p><img src="../images/css-attribute-value/2019-10-16-14-07-03.png" alt=""></p><iframe height="559" style="width:100%" scrolling="no" title="automatic counters and numbering" src="https://codepen.io/titangene/embed/poobELL?height=559&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/poobELL" target="_blank" rel="noopener">automatic counters and numbering</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><blockquote><p>詳情可參考：</p><ul><li><a href="https://www.w3.org/TR/CSS22/syndata.html#counter" target="_blank" rel="noopener">CSS 2.2 - 4.3.5. Counters</a></li><li><a href="https://www.w3.org/TR/CSS22/generate.html#counters" target="_blank" rel="noopener">CSS 2.2 - 12.4. Automatic counters and numbering</a></li></ul></blockquote><h2 id="顏色"><a class="header-anchor" href="#顏色"></a>顏色</h2><p><code>&lt;color&gt;</code> 可用關鍵字或數字 RGB 規範的數值。</p><h3 id="基本顏色關鍵字"><a class="header-anchor" href="#基本顏色關鍵字"></a>基本顏色關鍵字</h3><p>在 CSS 2.2 中定義了 13 種顏色關鍵字：<code>aqua</code>、<code>black</code>、<code>blue</code>、<code>fuchsia</code>、<code>gray</code>、<code>green</code>、<code>lime</code>、<code>maroon</code>、<code>navy</code>、<code>olive</code>、<code>orange</code>、<code>purple</code>、<code>red</code>、<code>silver</code>、<code>teal</code>、<code>white</code> 和 <code>yellow</code>。</p><p>下面是這 17 種顏色各別對應的色碼：</p><p><img src="../images/css-attribute-value/color-keywords.png" alt=""></p><p>使用範例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span> &#123;<span class="hljs-attribute">color</span>: black; <span class="hljs-attribute">background</span>: white; &#125;<br><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: maroon; &#125;<br><span class="hljs-selector-tag">h2</span> &#123; <span class="hljs-attribute">color</span>: olive; &#125;<br></code></pre></td></tr></table></figure><h3 id="Numerical-color-values"><a class="header-anchor" href="#Numerical-color-values"></a>Numerical color values</h3><h4 id="RGB-color-values"><a class="header-anchor" href="#RGB-color-values"></a>RGB color values</h4><p>RGB 分別代表紅色、綠色和藍色。下面是 RGB 顏色值的格式：</p><ul><li>十六進位表示法<ul><li>有兩種格式：<ul><li>三個字元：<code>#rgb</code>，例如：<code>#f00</code></li><li>六個字元：<code>#rrggbb</code>，例如：<code>#ff0000</code></li></ul></li><li><code>#ffbb00</code> 可簡寫為 <code>#fb0</code>，兩者代表相同的顏色</li><li>三位 RGB 表示法 ( <code>#rgb</code> ) 是通過複製數字，而不是通過加零轉換為六位形式 ( <code>#rrggbb</code> )</li></ul></li><li><code>rgb(r,g,b)</code>：<ul><li><code>r</code>、<code>g</code> 和 <code>b</code> 用逗號 ( <code>,</code> ) 分隔，三個數值可以都是整數值或百分比值</li><li>整數值的 <code>255</code> 等於百分比值的 <code>100%</code></li><li>十六進位表示法中的 <code>F</code> 或 <code>FF</code>：<ul><li><code>rgb(255, 255, 255)</code> = <code>rgb(100%, 100%, 100%)</code> = <code>#FFF</code></li></ul></li><li>例如：<ul><li><code>rgb(255, 0, 0)</code></li><li><code>rgb(100%, 0%, 0%)</code></li></ul></li></ul></li></ul><p>使用範例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-number">#f00</span>; &#125;              <span class="hljs-comment">/* #rgb */</span><br><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-number">#ff0000</span>; &#125;           <span class="hljs-comment">/* #rrggbb */</span><br><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); &#125;<br><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">100%</span>, <span class="hljs-number">0%</span>, <span class="hljs-number">0%</span>); &#125;<br></code></pre></td></tr></table></figure><h4 id="RGBA-color-values"><a class="header-anchor" href="#RGBA-color-values"></a>RGBA color values</h4><p>而 RGBA 顏色值的格式只是在 RGB 顏色值的格式最後再加上一個 “alpha” 值。</p><p>“alpha” 值：</p><ul><li>可指定顏色的透明度</li><li>值的範圍為 <code>0.0</code> 至 <code>1.0</code><ul><li><code>0.0</code>：完全透明</li><li><code>1.0</code>：不透明</li></ul></li></ul><div class="info"><p>註：使用十六進位表示法 (也就是 <code>#rgb</code> 或 <code>#rrggbb</code> ) 無法指定顏色的透明度。</p></div><p>當 “alpha” 值為 <code>1.0</code> 時，代表不透明，因此下面四個都為相同顏色：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); &#125;        <span class="hljs-comment">/* 紅色 */</span><br><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>); &#125;    <span class="hljs-comment">/* 紅色 */</span><br><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">100%</span>, <span class="hljs-number">0%</span>, <span class="hljs-number">0%</span>); &#125;     <span class="hljs-comment">/* 紅色 */</span><br><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">100%</span>, <span class="hljs-number">0%</span>, <span class="hljs-number">0%</span>, <span class="hljs-number">1</span>); &#125; <span class="hljs-comment">/* 紅色 */</span><br></code></pre></td></tr></table></figure><p>使用範例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>); &#125;      <br><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">100%</span>, <span class="hljs-number">0%</span>, <span class="hljs-number">0%</span>, <span class="hljs-number">0.5</span>); &#125;<br></code></pre></td></tr></table></figure><h4 id="HSL-color-values"><a class="header-anchor" href="#HSL-color-values"></a>HSL color values</h4><p>HSL 是 hue-saturation-lightness 的縮寫，分別代表色相、飽和度和亮度。</p><p>有 RGB 就夠用了，為何還需要有 HSL？這是因為 HSL 使用起來會更加直覺，用色相、飽和度和亮度可以更直觀的指定顏色，RGB 還需要思考光的三原色：紅色、綠色、藍色，要分別設定多少才會變成指定顏色。</p><p>使用範例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css">* &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">50%</span>) &#125;   <span class="hljs-comment">/* red */</span><br>* &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">120</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">50%</span>) &#125; <span class="hljs-comment">/* lime */</span><br>* &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">120</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">25%</span>) &#125; <span class="hljs-comment">/* dark green */</span><br>* &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">120</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">75%</span>) &#125; <span class="hljs-comment">/* light green */</span><br>* &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">120</span>, <span class="hljs-number">75%</span>, <span class="hljs-number">75%</span>) &#125;  <span class="hljs-comment">/* pastel green */</span><br></code></pre></td></tr></table></figure><h4 id="HSLA-color-values"><a class="header-anchor" href="#HSLA-color-values"></a>HSLA color values</h4><p>而 HSLA 顏色值的格式只是在 HSL 顏色值的格式最後再加上一個 “alpha” 值。</p><p>“alpha” 值：</p><ul><li>可指定顏色的透明度</li><li>值的範圍為 <code>0.0</code> 至 <code>1.0</code><ul><li><code>0.0</code>：完全透明</li><li><code>1.0</code>：不透明</li></ul></li></ul><p>當 “alpha” 值為 <code>1.0</code> 時，代表不透明，因此下面兩個都為相同顏色：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsl</span>(<span class="hljs-number">120</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">50%</span>); &#125;      <span class="hljs-comment">/* 純綠色  */</span><br><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsla</span>(<span class="hljs-number">120</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">50%</span>, <span class="hljs-number">1</span>); &#125;  <span class="hljs-comment">/* 純綠色  */</span><br></code></pre></td></tr></table></figure><p>使用範例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsla</span>(<span class="hljs-number">30</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">50%</span>, <span class="hljs-number">0.1</span>); &#125;  <span class="hljs-comment">/* 半透明的純藍色  */</span><br><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsla</span>(<span class="hljs-number">240</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">50%</span>, <span class="hljs-number">0.5</span>); &#125;  <span class="hljs-comment">/* 很透明的純橘色  */</span><br></code></pre></td></tr></table></figure><h4 id="transparent-color-keyword"><a class="header-anchor" href="#transparent-color-keyword"></a><code>transparent</code> color keyword</h4><ul><li>顧名思義就是透明色</li><li><a href="https://www.w3.org/TR/css-backgrounds-3/#the-background-color" target="_blank" rel="noopener"><code>background-color</code></a> 屬性的 initial value 就是 <code>transparent</code></li></ul><p>使用範例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">em</span> &#123; <span class="hljs-attribute">background-color</span>: transparent; &#125;<br></code></pre></td></tr></table></figure><h3 id="currentColor-color-keyword"><a class="header-anchor" href="#currentColor-color-keyword"></a><code>currentColor</code> color keyword</h3><p>CSS1 和 CSS2 將 <a href="https://www.w3.org/TR/CSS1/#border-color" target="_blank" rel="noopener"><code>border-color</code></a> 屬性的 initial value 定義為 <a href="https://www.w3.org/TR/css-color-3/#color0" target="_blank" rel="noopener"><code>color</code></a> 屬性的值，但未定義相應的關鍵字。SVG 意識到了這種遺漏，因此 <a href="https://www.w3.org/TR/SVG10/color.html#ColorProperty" target="_blank" rel="noopener">SVG 1.0</a> 為 <code>fill</code>、<code>stroke</code>、<code>stop-color</code>、<code>flood-color</code> 和 <code>lighting-color</code> 屬性引入了 <code>currentColor</code> 值。</p><p>在 CSS3 時，擴充了顏色值，新增 <code>currentColor</code> 這個關鍵字，以允許其與接受顏色值的所有屬性一起使用，這樣就簡化了 CSS3 中的這些屬性的定義。</p><p><code>currentColor</code> 關鍵字：</p><ul><li><code>color</code> 屬性的值</li><li><code>currentColor</code> 關鍵字的 used value 是 <code>color</code> 屬性的 computed value</li><li>如果在 <code>color</code> 屬性本身上設定了 <code>currentColor</code> 關鍵字，則將其視為 <code>color: inherit</code></li></ul><p>例如：<code>border-color</code> 屬性使用了 <code>currentColor</code> 關鍵字，此關鍵字的 used value 就是 <code>color</code> 屬性的 computed value，所以就等同於是將 <code>border-color</code> 設為 <code>blue</code> (也就是 <code>color</code> 屬性的顏色)。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.box</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;<br>  <span class="hljs-attribute">background-color</span>: lightblue;<br>  <span class="hljs-attribute">border-width</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">border-style</span>: solid;<br>  <span class="hljs-attribute">border-color</span>: currentColor;<br>  <span class="hljs-attribute">color</span>: blue;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>如果想更多顏色值的相關內容，詳情可參考：</p><ul><li><a href="https://www.w3.org/TR/CSS22/syndata.html#color-units" target="_blank" rel="noopener">CSS 2.2 - 4.3.6. Colors</a></li><li><a href="https://www.w3.org/TR/css-color-3/" target="_blank" rel="noopener">CSS Color Module Level 3</a>。</li></ul></blockquote><h2 id="字串"><a class="header-anchor" href="#字串"></a>字串</h2><p>字串可用雙引號 ( <code>&quot;</code> ) pair 或單引號 ( <code>'</code> ) pair 包起來。</p><p>使用範例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span><span class="hljs-selector-pseudo">::before</span> &#123; <span class="hljs-attribute">content</span>: <span class="hljs-string">'hello '</span>; &#125;<br><span class="hljs-selector-tag">p</span><span class="hljs-selector-pseudo">::after</span> &#123; <span class="hljs-attribute">content</span>: <span class="hljs-string">"!"</span>; &#125;<br></code></pre></td></tr></table></figure><h3 id="字串中的引號字元要使用跳脫字元"><a class="header-anchor" href="#字串中的引號字元要使用跳脫字元"></a>字串中的引號字元要使用跳脫字元</h3><p>雙引號 pair 裡面不能直接使用雙引號，同理，單引號也是如此，除非在引號 pair 之前加上跳脫字元。</p><ul><li>雙引號：使用 <code>\&quot;</code> 或 <code>\22</code></li><li>單引號：使用 <code>\'</code> 或 <code>\27</code></li></ul><p>使用範例：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-comment">/* 雙引號 */</span><br><span class="hljs-selector-class">.test1</span><span class="hljs-selector-pseudo">::before</span> &#123; <span class="hljs-attribute">content</span>: <span class="hljs-string">"this is a \"string\""</span>; &#125;<br><span class="hljs-selector-class">.test2</span><span class="hljs-selector-pseudo">::before</span> &#123; <span class="hljs-attribute">content</span>: <span class="hljs-string">'this is a \22string\22'</span>; &#125;<br><br><span class="hljs-comment">/* 單引號 */</span><br><span class="hljs-selector-class">.test3</span><span class="hljs-selector-pseudo">::before</span> &#123; <span class="hljs-attribute">content</span>: <span class="hljs-string">'this is a \'string\''</span>; &#125;<br><span class="hljs-selector-class">.test4</span><span class="hljs-selector-pseudo">::before</span> &#123; <span class="hljs-attribute">content</span>: <span class="hljs-string">'this is a \27string\27'</span>; &#125;<br></code></pre></td></tr></table></figure><p>如果不想另外加上跳脫字元，可以在改在雙引號字串中使用單引號，或是在單引號字串中使用雙引號，例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.test5</span><span class="hljs-selector-pseudo">::before</span> &#123; <span class="hljs-attribute">content</span>: <span class="hljs-string">"this is a 'string'"</span>; &#125;<br><span class="hljs-selector-class">.test6</span><span class="hljs-selector-pseudo">::before</span> &#123; <span class="hljs-attribute">content</span>: <span class="hljs-string">'this is a "string"'</span>; &#125;<br></code></pre></td></tr></table></figure><h3 id="換行字元-newline"><a class="header-anchor" href="#換行字元-newline"></a>換行字元 (newline)</h3><p>字串不能直接包含換行字元 (newline)。要在字串中包含換行字元，請使用跳脫字元來表示 ISO-10646 ( <code>U+000A</code> ) 中的換行字元，例如：<code>\A</code> 或 <code>\00000a</code> 這些字元都代表 CSS 中的換行字元。</p><p>使用範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Titan<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span><span class="hljs-selector-pseudo">:before</span> &#123;<br>  <span class="hljs-attribute">white-space</span>: pre;<br>  <span class="hljs-attribute">content</span>: <span class="hljs-string">"hello\A"</span><br>&#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/BaazWQz" target="_blank" rel="noopener">Codepen 連結</a></p><p>如範例，<code>hello</code> 字串之後會換行就是因為使用了 <code>\A</code> 這個換行字元：</p><p><img src="../images/css-attribute-value/2019-10-16-17-00-44.png" alt=""></p><h3 id="將字串分成多行"><a class="header-anchor" href="#將字串分成多行"></a>將字串分成多行</h3><p>如果要將字串分成多行，換行字元本身必須使用反斜線 ( <code>\</code> ) 來進行跳脫 (escaped)。</p><p>使用範例：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">a</span><span class="hljs-selector-attr">[title=<span class="hljs-string">"a not s\</span></span><br>o very long title"] &#123; ... &#125;<br></code></pre></td></tr></table></figure><p>等同於：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">a[title="a not so very long title"] &#123; ... &#125;<br></code></pre></td></tr></table></figure><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/syndata.html" target="_blank" rel="noopener">CSS 2.2 - 4. Syntax and basic data types</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%AE%9E%E6%95%B0" target="_blank" rel="noopener">實數 - Wikipedia</a></li><li><a href="https://www.w3.org/TR/css-inline-3/" target="_blank" rel="noopener">CSS Inline Layout Module Level 3</a></li><li><a href="https://www.w3.org/TR/css-values-3/" target="_blank" rel="noopener">CSS Values and Units Module Level 3</a></li><li><a href="https://www.w3.org/TR/css-values-4/" target="_blank" rel="noopener">CSS Values and Units Module Level 4</a></li><li><a href="https://www.w3.org/TR/css-color-3/" target="_blank" rel="noopener">CSS Color Module Level 3</a></li><li><a href="https://www.w3.org/TR/css-backgrounds-3/" target="_blank" rel="noopener">CSS Backgrounds and Borders Module Level 3</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10218632" target="_blank" rel="noopener">鉄人28號FX　鉄人6號「字級羊」font-size - 鉄人28號FX系列 - iT 邦幫忙</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Pseudo-element (偽元素)</title>
      <link href="/article/css-selector-pseudo-element.html"/>
      <url>/article/css-selector-pseudo-element.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>Selector (選擇器) 可用來選擇 HTML 和 XML 文件中的節點，並將樣式屬性綁定到文件 (HTML 和 XML) 中的元素上。當選擇器與某元素 match 的時候，就可以對選到的元素進行 CSS 樣式設定。本篇會介紹 pseudo-element (偽元素)，包括 <code>::before</code> 和 <code>::after</code>。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10218712" target="_blank" rel="noopener">重新認識 CSS - Pseudo-element (偽元素)</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="Pseudo-elements"><a class="header-anchor" href="#Pseudo-elements"></a>Pseudo-elements</h2><p>pseudo-element 代表不直接存在於 document tree 中的元素。</p><p>document language (文件語言) 不提供存取元素內容的第一個字母或第一行的機制，但是可以用 <code>::first-letter</code> 和 <code>::first-line</code> 這兩個 pseudo-element 選到，這樣就可以對這些元素設定樣式。</p><p>另外，pseudo-element 還可以表示原始文件 (source document) 中根本不存在的內容，例如 <code>::before</code> 和 <code>::after</code> 這兩個 pseudo-element 可以在任何元素的內容之前或之後插入其他內容。</p><p>pseudo-class 和 pseudo-element 都不會出現在 document source 或 document tree 中，或是不會對其進行修改。所以，pseudo-class 和 pseudo-element 都不會影響到 <a href="https://titangene.github.io/article/css-selector-pseudo-class-2.html">structural pseudo-class</a> 或與它們的 <a href="https://www.w3.org/TR/selectors-4/#originating-element" target="_blank" rel="noopener">originating (原始) 元素</a> 或其 tree 有關的其他 selector 的解譯 (interpretation)。</p><blockquote><p>Structural pseudo-class 詳情可參考我前幾天寫的「<a href="https://titangene.github.io/article/css-selector-pseudo-class-2.html">重新認識 CSS - Pseudo-class (偽類) (2)</a>」。</p></blockquote><div class="info"><h3 id="originating-原始-元素是什麼？"><a class="header-anchor" href="#originating-原始-元素是什麼？"></a>originating (原始) 元素是什麼？</h3><p>pseudo-element 綁定到頁面上的某個元素，而此元素就稱為 originating 元素。例如：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">::before</span> &#123; <span class="hljs-attribute">content</span>: <span class="hljs-string">'Hi '</span>; &#125;<br></code></pre></td></tr></table></figure><p>在 selector <code>div a::before</code> 中，與 selector match 的 <code>a</code> 元素就是 originating 元素。</p></div><p>如果想更了解 pseudo-element，可以看它在以下這些 CSS Spec 的定義：</p><ul><li><a href="https://www.w3.org/TR/CSS2/selector.html" target="_blank" rel="noopener">CSS 2.1</a></li><li><a href="https://www.w3.org/TR/selectors-3/#pseudo-elements" target="_blank" rel="noopener">Selectors Level 3</a></li><li><a href="https://www.w3.org/TR/css-pseudo-4/" target="_blank" rel="noopener">CSS Pseudo-Elements Module Level 4</a></li></ul><h3 id="Generated-Content-Pseudo-elements-before-and-after"><a class="header-anchor" href="#Generated-Content-Pseudo-elements-before-and-after"></a>Generated Content Pseudo-elements: <code>::before</code> and <code>::after</code></h3><ul><li><code>::before</code>：在 originating 元素的內容之前建立的 child pseudo-element</li><li><code>::after</code>：在 originating 元素的內容之後建立的 child pseudo-element</li></ul><p><code>::before</code> 和 <code>::after</code> 的 CSS <a href="https://www.w3.org/TR/css-content-3/#propdef-content" target="_blank" rel="noopener"><code>content</code></a> 屬性的<a href="https://www.w3.org/TR/css-cascade/#initial-values" target="_blank" rel="noopener">初始值</a>為 <a href="https://www.w3.org/TR/css-content-3/#valdef-content-normal" target="_blank" rel="noopener"><code>normal</code></a>，<a href="https://www.w3.org/TR/css-cascade/#computed" target="_blank" rel="noopener">計算值</a>為 <a href="https://www.w3.org/TR/css-content-3/#valdef-content-none" target="_blank" rel="noopener"><code>none</code></a>。</p><p>當 <code>::before</code> 和 <code>::after</code> 的計算 <a href="https://www.w3.org/TR/css-content-3/#propdef-content" target="_blank" rel="noopener"><code>content</code></a> 值不為 <a href="https://www.w3.org/TR/css-content-3/#valdef-content-none" target="_blank" rel="noopener"><code>none</code></a> 時，這些 pseudo-element 就會產生 box，就好像它們是其 <a href="https://www.w3.org/TR/selectors-4/#originating-element" target="_blank" rel="noopener">originating (原始) 元素</a>的直接子元素一樣，並且可以像在 document tree 中任何 normal document-sourced (基於文件) 的元素一樣進行樣式設定</p><p>例如：</p><ul><li>在 class 為 <code>note</code> 的 <code>p</code> 元素的內容之前插入字串 &quot;Note: &quot;</li><li>在 class 為 <code>note</code> 的 <code>p</code> 元素的內容之後插入字串 “!”</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"note"</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.note</span><span class="hljs-selector-pseudo">::before</span> &#123; <span class="hljs-attribute">content</span>: <span class="hljs-string">"Note: "</span>; &#125;<br><span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.note</span><span class="hljs-selector-pseudo">::after</span> &#123; <span class="hljs-attribute">content</span>: <span class="hljs-string">"!"</span>; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/QWLzNjE" target="_blank" rel="noopener">Codepen 連結</a></p><p><code>::before</code> 和 <code>::after</code> 的 <code>display</code> 的初始值為 <code>inline</code>，所以會生成 inline box。與 <code>p</code> 元素的其他 inline children 一樣，它會參與 <code>p</code> 元素的 <a href="https://www.w3.org/TR/CSS22/visuren.html#inline-formatting" target="_blank" rel="noopener">IFC (inline formatting context)</a>，有可能與其他內容共享一行。</p><p>就如下面範例那樣，因為 <code>::before</code> 和 <code>::after</code> 都是 <code>display: inline</code>，並且在 <code>p</code> 元素的內容 <code>test</code> 之前加上 <code>::before</code> 的內容 <code>&quot;Note: &quot;</code>，以及在 <code>test</code> 之後加上 <code>::after</code> 的內容 <code>&quot;！&quot;</code>，所以在畫面上顯示的結果就變成 <code>Note: test!</code>。</p><p><img src="../images/css-selector-pseudo-element/2019-09-21-19-06-11.png" alt=""></p><p><img src="../images/css-selector-pseudo-element/2019-09-21-19-07-00.png" alt=""></p><iframe height="202" style="width:100%" scrolling="no" title="Generated Content Pseudo-elements: `::before` and `::after`" src="https://codepen.io/titangene/embed/QWLzNjE?height=202&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/QWLzNjE" target="_blank" rel="noopener">Generated Content Pseudo-elements: `::before` and `::after`</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h4 id="content-字串換行"><a class="header-anchor" href="#content-字串換行"></a><code>content</code> 字串換行</h4><p>如果想在 <code>content</code> 屬性內將字串換行要怎麼做？只要在字串中加入 <code>\A</code> 這個 escape sequence (轉義序列)，它就會在 generated content 中包含 newline，而這個插入的 line break 也會受到 <a href="https://www.w3.org/TR/CSS22/text.html#propdef-white-space" target="_blank" rel="noopener"><code>white-space</code></a> 屬性的影響。有關 <code>\A</code> escape sequence 的詳情可參 CSS 2 的 <a href="https://www.w3.org/TR/CSS22/syndata.html#strings" target="_blank" rel="noopener">字串</a> 和 <a href="https://www.w3.org/TR/CSS2/syndata.html#escaped-characters" target="_blank" rel="noopener">字元與大小寫</a> 部份。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h2</span><span class="hljs-selector-pseudo">:before</span> &#123;<br>  <span class="hljs-attribute">display</span>: block;<br>  <span class="hljs-attribute">text-align</span>: center;<br>  <span class="hljs-attribute">white-space</span>: pre;<br>  <span class="hljs-attribute">content</span>: <span class="hljs-string">"Hello\A Titan"</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="最後"><a class="header-anchor" href="#最後"></a>最後</h2><p>今天介紹一些 <code>::before</code> 和 <code>::after</code> 這兩個 pseudo-element，接下來幾天會接續介紹其他 selector。</p><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/selector.html" target="_blank" rel="noopener">CSS 2.2 Specification - Selectors</a></li><li><a href="https://www.w3.org/TR/selectors-3/" target="_blank" rel="noopener">Selectors Level 3</a></li><li><a href="https://www.w3.org/TR/selectors-4/" target="_blank" rel="noopener">Selectors Level 4</a></li><li><a href="https://www.w3.org/TR/css-pseudo-4/" target="_blank" rel="noopener">CSS Pseudo-Elements Module Level 4</a></li><li><a href="https://www.w3.org/TR/css-content-3/#propdef-content" target="_blank" rel="noopener">CSS Generated Content Module Level 3</a></li><li><a href="https://www.w3.org/TR/css-cascade-4/" target="_blank" rel="noopener">CSS Cascading and Inheritance Level 4</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Pseudo-class (偽類) (2)</title>
      <link href="/article/css-selector-pseudo-class-2.html"/>
      <url>/article/css-selector-pseudo-class-2.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>Selector (選擇器) 可用來選擇 HTML 和 XML 文件中的節點，並將樣式屬性綁定到文件 (HTML 和 XML) 中的元素上。當選擇器與某元素 match 的時候，就可以對選到的元素進行 CSS 樣式設定。本篇會介紹 structural pseudo-class (偽類)，包括 <code>:root</code>、<code>nth-child</code>、<code>nth-of-type</code> …等 selector。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10218197" target="_blank" rel="noopener">重新認識 CSS - Pseudo-class (偽類) (2)</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>之前有提到以下這些都是 simple selector：</p><ul><li>type selector</li><li>universal selector</li><li>attribute selector</li><li>class selector</li><li>ID selector</li><li>pseudo-class</li></ul><blockquote><p>本篇會介紹 pseudo-class，如果想了解其他 simple selector 可參閱之前介紹的 <a href="https://ithelp.ithome.com.tw/articles/10216566" target="_blank" rel="noopener">重新認識 CSS - Simple Selector &amp; Groups of selector</a>。</p></blockquote><p>如之前所說，pseudo-class 是以 <code>:</code> 為開頭，後面接著 pseudo-class 的名稱，有些會在後面加上括號 <code>()</code>，並在括號之間加上值。例如：<code>:nth-child(2)</code>。</p><div class="warning"><p>注意：</p><ul><li>pseudo-class 和 pseudo-element 不相同</li><li>pseudo-class 是以 <code>:</code> 為開頭</li><li>pseudo-element 是以 <code>::</code> 為開頭，但也可以以 <code>:</code> 為開頭，因為在舊版的 W3C Spec 中沒有將 pseudo-class 和 pseudo-element 區分成 <code>:</code> 和 <code>::</code>。如果你寫 pseudo-element 是用 <code>:</code>，大部份瀏覽器也還是會支援這種語法。</li></ul></div><h2 id="Structural-pseudo-classes"><a class="header-anchor" href="#Structural-pseudo-classes"></a>Structural pseudo-classes</h2><p>當使用 structural pseudo-class 時，它會計算各 sibling 元素的位置：</p><ul><li>不計算 standalone (獨立) text 和其他非元素節點</li><li>index 編號從 1 開始</li><li>只適用於 document tree 中的元素，不會 match 到 pseudo-element</li></ul><h3 id="root-pseudo-class"><a class="header-anchor" href="#root-pseudo-class"></a><code>:root</code> pseudo-class</h3><ul><li><code>:root</code> pseudo-class 代表文件的 root 元素</li><li>在 DOM 文件中，<code>:root</code> pseudo-class 與 <a href="https://dom.spec.whatwg.org/#document" target="_blank" rel="noopener"><code>Document</code></a> 物件的 root 元素會 match</li><li>在 HTML 中，root 元素就是 <a href="https://html.spec.whatwg.org/multipage/semantics.html#the-html-element" target="_blank" rel="noopener"><code>&lt;html&gt;</code></a> 元素</li></ul><h3 id="Child-indexed-Pseudo-classes"><a class="header-anchor" href="#Child-indexed-Pseudo-classes"></a>Child-indexed Pseudo-classes</h3><p>此 pseudo-class 會根據 <a href="https://dom.spec.whatwg.org/#concept-tree-inclusive-sibling" target="_blank" rel="noopener">inclusive sibling</a> 之間的 index 來選擇元素。</p><p>選擇 index 為多少的 sibling (兄弟，同層) 元素，元素的第一個子元素的 index 是 1。</p><p>只有開頭為 <code>nth</code> 的 Child-indexed Pseudo-classes 和 Typed Child-indexed Pseudo-classes 都可以在 <code>()</code> 括號裡面可以使用下面這幾種值：</p><ul><li><code>an + b</code>：<ul><li><code>n</code> 可以是任何​​正整數或 0 的數值</li><li><code>a</code> 和 <code>b</code> 的值必須是整數 (正數、負數或 0)</li><li>當 <code>a</code> 和 <code>b</code> 都大於 0 時，可以更好的將 sibling 元素劃分為元素群組 (groups of a elements)，並選擇每個群組的第 <code>b</code> 個元素， 例如：<ul><li><code>3n + 1</code> 可以 match 到第 1、4、7…等子元素</li><li><code>0n + 5</code> 等同於 <code>5</code></li></ul></li><li>當 <code>a</code> 為負值，且 <code>n &gt;= 0</code> 時，只有 <code>an + b</code> 為正值才可以代表 document tree 中的元素</li></ul></li><li><code>odd</code>：奇數的所有 sibling 元素，等同於 <code>2n + 1</code></li><li><code>even</code>偶數的所有 sibling 元素，等同於 <code>2n</code></li></ul><blockquote><p>語法詳情可參閱 Selectors Level 3 的「<a href="https://www.w3.org/TR/selectors-3/#nth-child-pseudo" target="_blank" rel="noopener">6.6.5.2. :nth-child() pseudo-class</a>」章節部份。</p></blockquote><p>Child-indexed Pseudo-classes 有下面這些 selector：</p><ul><li><code>:nth-child(an+b)</code>：<ul><li>選擇指定 index 的所有 sibling 元素，從第一個 sibling 元素開始數</li></ul></li><li><code>:nth-last-child(an+b)</code>：<ul><li>選擇指定 index 的所有 sibling 元素，從最後一個 sibling 元素開始數</li></ul></li><li><code>:first-child()</code>：<ul><li>選擇 sibling 列表中的第一個元素</li><li>等同於 <code>:nth-child(1)</code></li></ul></li><li><code>:last-child()</code>：<ul><li>選擇 sibling 列表中的最後一個元素</li><li>等同於 <code>:nth-last-child(1)</code></li></ul></li><li><code>:only-child()</code>：<ul><li>選擇沒有 sibling 的元素</li><li>等同於 <code>:first-child:last-child</code> 或 <code>:nth-child(1):nth-last-child(1)</code>，但 <a href="https://www.w3.org/TR/CSS22/cascade.html#specificity" target="_blank" rel="noopener">specificity</a> 較低</li></ul></li></ul><h3 id="Typed-Child-indexed-Pseudo-classes"><a class="header-anchor" href="#Typed-Child-indexed-Pseudo-classes"></a>Typed Child-indexed Pseudo-classes</h3><p>此 pseudo-class 類似於 Child Index Pseudo-classes，但此 pseudo-class 是基於 sibling 列表中相同 <a href="https://www.w3.org/TR/selectors-4/#type-selectors" target="_blank" rel="noopener">type (tag 名稱)</a> 的元素之間的元素 index 來解析。</p><p>Typed Child-indexed Pseudo-classes 有下面這些 selector：</p><ul><li><code>:nth-of-type(an+b)</code>：<ul><li>選擇指定 index 的所有相同 type 的 sibling 元素，從第一個 sibling 元素開始數</li></ul></li><li><code>:nth-last-of-type(an+b)</code><ul><li>選擇指定 index 的所有相同 type 的 sibling 元素，從最後一個 sibling 元素開始數</li></ul></li><li><code>:first-of-type()</code><ul><li>選擇 sibling 列表中的第一個相同 type 的元素</li><li>等同於 <code>:nth-of-type(1)</code></li></ul></li><li><code>:last-of-type()</code><ul><li>選擇 sibling 列表中的最後一個相同 type 的元素</li><li>等同於 <code>:nth-last-of-type(1)</code></li></ul></li><li><code>:only-of-type()</code><ul><li>選擇沒有相同 type 的 sibling 元素</li><li>等同於 <code>:first-of-type:last-of-type</code> 或 <code>:nth-of-type(1):nth-last-of-type(1)</code>，但 <a href="https://www.w3.org/TR/CSS22/cascade.html#specificity" target="_blank" rel="noopener">specificity</a> 較低</li></ul></li></ul><h3 id="nth-of-type-與-nth-child-的差異"><a class="header-anchor" href="#nth-of-type-與-nth-child-的差異"></a><code>:nth-of-type()</code> 與 <code>:nth-child()</code> 的差異</h3><p>下面是 <code>:nth-of-type()</code> 和 <code>:nth-child()</code> 的範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1 (1 li)<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>2 (2 li)<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>3 (div)<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>4 (3 li)<br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nested-list"</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>4-1<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>4-2<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>4-3<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>4-4<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>4-5<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>5 (4 li)<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>6 (5 li)<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1 (1 li)<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>2 (2 li)<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>3 (div)<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>4 (3 li)<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>5 (4 li)<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>6 (5 li)<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">div</span> &#123; <span class="hljs-attribute">color</span>: olive; &#125;<br><br><span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-of-type(odd)</span> &#123;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">2px</span>;<br>  <span class="hljs-attribute">outline</span>: <span class="hljs-number">2px</span> solid red;<br>&#125;<br><br><span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-child(odd)</span> &#123;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid blue;<br>&#125;<br></code></pre></td></tr></table></figure><p>這個範例有兩個 <code>ul</code> 元素，裡面各有五個 <code>li</code> 元素，而且在與第二個 <code>li</code> 元素同層的後面加上一個 <code>div</code> 元素，這是用來驗證 <code>:nth-of-type()</code> 和 <code>:nth-child()</code> 的差異用的。另外，在第一個 <code>ul</code> 元素裡面還有一個巢狀 <code>&lt;ul class=&quot;nested-list&quot;&gt;</code> 元素，它放在第四個 <code>li</code> 元素裡面，這是用來巢狀的元素也可以被 selector 選到。</p><p>每個元素的前面都有一個編號，代表在 sibling 元素之間的 index。而後面的括號是用來告訴你它是 <code>li</code> 元素還是 <code>div</code> 元素，如果是 <code>li</code> 元素就會註記是第幾個 <code>li</code> 元素。例如：<code>4 (3 li)</code> 就代表是第四個 sibling 元素，並且是第三個 <code>li</code> 元素。</p><p>可以看到那些有紅色 <code>outline</code> 的元素都有 match 到 <code>li:nth-of-type(odd)</code>，因為此 pseudo-class 是以 <code>of-type</code> 為結尾，所以此 selector 只會找相同 type 的 sibling 元素 (OS：就很像是忽略了 <code>div</code> 元素的存在)。只要是奇數的 sibling 元素都會被選起來，套用紅色的 outline 樣式。</p><p>而那些有藍色 <code>border</code> 的元素都有 match 到 <code>li:nth-child(odd)</code>，因為此 pseudo-class 是以 <code>child</code> 為結尾，所以此 selector 會直接找是 <code>li</code> 的 sibling 元素，並且要是奇數的 sibling 元素。不過，第三個 sibling 元素是 <code>div</code> 元素，不是 <code>li</code> 元素，因此 <code>li:nth-child(odd)</code> 就不會 match 到此 <code>div</code> 元素</p><p>而巢狀 <code>&lt;ul class=&quot;nested-list&quot;&gt;</code> 元素裡面只有五個 <code>li</code> 元素，沒有其他 type 的元素，所以都會選到奇數的 sibling 元素 (因為沒有亂路的元素)。</p><p>Demo：<a href="https://codepen.io/titangene/pen/NWKEwmo" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-selector-pseudo-class-2/2019-09-20-16-37-11.png" alt=""></p><iframe height="541" style="width:100%" scrolling="no" title=":nth-child &amp; :nth-of-type" src="https://codepen.io/titangene/embed/NWKEwmo/?height=541&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/NWKEwmo/" target="_blank" rel="noopener">:nth-child &amp; :nth-of-type</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h3 id="The-negation-pseudo-class"><a class="header-anchor" href="#The-negation-pseudo-class"></a>The negation pseudo-class</h3><p><code>:not(X)</code> 是一個函數符號，可將一個 simple selector (不包括 <code>:not(X)</code> 本身) 作為參數。<code>:not(X)</code> 代表不選擇 match 到 <code>X</code> simple selector 的元素。</p><blockquote><p>註：以下這些都是 simple selector：</p><ul><li>type selector：例如 <code>div</code></li><li>universal selector：例如 <code>*</code></li><li>attribute selector：例如 <code>div[foo]</code></li><li>class selector：例如 <code>.myclass</code></li><li>ID selector：例如 <code>#myid</code></li><li>pseudo-class：例如 <code>a:hover</code></li></ul></blockquote><p>不能巢狀使用，所以 <code>:not(:not(...))</code> 是無效的。另外請注意，因為 pseudo-element 不是 simple selector，所以 pseudo-element 不是 <code>:not()</code> 的有效參數。</p><p>例如：match HTML 文件中所有未被禁用的 <code>button</code> 元素：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:not(</span><span class="hljs-selector-attr">[disable]</span>)<br></code></pre></td></tr></table></figure><blockquote><p>註：<code>[disable]</code> 是 attribute selector，詳情請參閱我前幾天寫的「<a href="https://titangene.github.io/article/css-attribute-selector.html">重新認識 CSS - Attribute selector (屬性選擇器)</a>」。</p></blockquote><p>match 除了 <code>#titan</code> 元素之外的所有元素：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">*<span class="hljs-selector-pseudo">:not(</span><span class="hljs-selector-id">#titan</span>)<br></code></pre></td></tr></table></figure><blockquote><p>註：<code>#titan</code> 是 ID selector，詳情請參閱我前幾天寫的「<a href="https://titangene.github.io/article/css-selector-1.html">重新認識 CSS - Simple Selector &amp; Groups of selector</a>」。</p></blockquote><h2 id="最後"><a class="header-anchor" href="#最後"></a>最後</h2><p>今天介紹一些 structural pseudo-class，接下來幾天會接續介紹其他 selector。</p><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/selector.html" target="_blank" rel="noopener">CSS 2.2 Specification - Selectors</a></li><li><a href="https://www.w3.org/TR/selectors-3/" target="_blank" rel="noopener">Selectors Level 3</a></li><li><a href="https://www.w3.org/TR/selectors-4/" target="_blank" rel="noopener">Selectors Level 4</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Pseudo-class (偽類) (1)</title>
      <link href="/article/css-selector-pseudo-class-1.html"/>
      <url>/article/css-selector-pseudo-class-1.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>Selector (選擇器) 可用來選擇 HTML 和 XML 文件中的節點，並將樣式屬性綁定到文件 (HTML 和 XML) 中的元素上。當選擇器與某元素 match 的時候，就可以對選到的元素進行 CSS 樣式設定。本篇會介紹 pseudo-class (偽類)。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10217730" target="_blank" rel="noopener">重新認識 CSS - Pseudo-class (偽類) (1)</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><p>之前有提到以下這些都是 simple selector：</p><ul><li>type selector</li><li>universal selector</li><li>attribute selector</li><li>class selector</li><li>ID selector</li><li>pseudo-class</li></ul><blockquote><p>本篇會介紹 pseudo-class，如果想了解其他 simple selector 可參閱之前介紹的「<a href="https://ithelp.ithome.com.tw/articles/10216566" target="_blank" rel="noopener">重新認識 CSS - Simple Selector &amp; Groups of selector</a>」。</p></blockquote><h2 id="Pseudo-classes"><a class="header-anchor" href="#Pseudo-classes"></a>Pseudo-classes</h2><p>pseudo-class 是以 <code>:</code> 為開頭，後面接著 pseudo-class 的名稱，有些會在後面加上括號 <code>()</code>，並在括號之間加上值。例如：<code>:nth-child(2)</code>。</p><div class="warning"><p>注意：</p><ul><li>pseudo-class 和 pseudo-element 不相同</li><li>pseudo-class 是以 <code>:</code> 為開頭</li><li>pseudo-element 是以 <code>::</code> 為開頭，但也可以以 <code>:</code> 為開頭，因為在舊版的 W3C Spec 中沒有將 pseudo-class 和 pseudo-element 區分成 <code>:</code> 和 <code>::</code>。如果你寫 pseudo-element 是用 <code>:</code>，大部份瀏覽器也還是會支援這種語法。</li></ul></div><h3 id="Dynamic-pseudo-classes"><a class="header-anchor" href="#Dynamic-pseudo-classes"></a>Dynamic pseudo-classes</h3><p>Dynamic pseudo-classes 不會出現在 document source 或 document tree 中。</p><p>Dynamic pseudo-classes 又分為：</p><ul><li>link pseudo-classes：<code>:link</code> 和 <code>:visited</code></li><li>user action pseudo-classes：<code>:hover</code>、<code>:active</code> 和 <code>:focus</code></li></ul><h4 id="The-link-pseudo-classes：-link-和-visited"><a class="header-anchor" href="#The-link-pseudo-classes：-link-和-visited"></a>The link pseudo-classes：<code>:link</code> 和 <code>:visited</code></h4><p><a href="https://www.w3.org/TR/CSS22/conform.html#user-agent" target="_blank" rel="noopener">UA</a> (User agent，對 HTML 來說就是瀏覽器) 以不同的方式來顯示連結是否已訪問：</p><ul><li><code>:link</code>：未訪問過的連結</li><li><code>:visited</code>：已訪問過的連結</li></ul><p>不過，過了一段時間之後，UA 可以將已訪問的連結從 <code>:visited</code> 變回 <code>:link</code> 的狀態。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://titangene.github.io"</span>&gt;</span>Titangene Blog<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://titangene.github.io/article/css-selector-pseudo-class-1.html"</span>&gt;</span>重新認識 CSS - CSS Selector (3)<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:visited</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:link</span> &#123; <span class="hljs-attribute">color</span>: green; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/jONejbv" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-selector-pseudo-class-1/2019-09-19-16-40-27.png" alt=""></p><iframe height="215" style="width:100%" scrolling="no" title="link pseudo-class: :visited &amp; :link" src="https://codepen.io/titangene/embed/jONejbv/?height=215&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/jONejbv/" target="_blank" rel="noopener">link pseudo-class: :visited &amp; :link</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h4 id="The-user-action-pseudo-classes：-hover、-active-和-focus"><a class="header-anchor" href="#The-user-action-pseudo-classes：-hover、-active-和-focus"></a>The user action pseudo-classes：<code>:hover</code>、<code>:active</code> 和 <code>:focus</code></h4><p>用於 response 使用者的操作：</p><ul><li><code>:hover</code>：<ul><li>當 cursor (滑鼠指標) hover 在元素上時，visual UA 就可以應用此 pseudo-class</li><li>不支援 <a href="https://www.w3.org/TR/CSS22/media.html#media-groups" target="_blank" rel="noopener">互動式 media</a> 的 UA 不用支援此 pseudo-class</li></ul></li><li><code>:active</code>：<ul><li>在使用者按下滑鼠按鈕並放開它之間的時間會應用此 pseudo-class</li><li>如果滑鼠上有多個按鈕時，<code>:active</code> 只適用於主要或主要 actived 的按鈕 (通常為滑鼠左鍵) …等</li></ul></li><li><code>:focus</code>：當元素有焦點時會應用此 pseudo-class，例如：按鍵盤的 Tab 鍵所選到的元素</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://titangene.github.io"</span>&gt;</span>Titangene Blog<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://titangene.github.io/article/css-selector-pseudo-class-1.html"</span>&gt;</span>重新認識 CSS - CSS Selector (3)<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">a</span> &#123; <span class="hljs-attribute">color</span>: black; &#125;<br><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:focus</span> &#123; <span class="hljs-attribute">color</span>: gray; &#125;<br><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:active</span> &#123; <span class="hljs-attribute">color</span>: purple; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/YzKJobe" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-selector-pseudo-class-1/user-action-pseudo-class.gif" alt=""></p><iframe height="227" style="width:100%" scrolling="no" title="user action pseudo-class" src="https://codepen.io/titangene/embed/YzKJobe/?height=227&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/YzKJobe/" target="_blank" rel="noopener">user action pseudo-class</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><p>也可以一次使用多個 dynamic pseudo-class，如下範例：</p><ul><li>同時有 <code>:focus</code> 和 <code>:hover</code> 的狀態</li><li>同時有 <code>:link</code> 和 <code>:active</code> 的狀態</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:focus</span><span class="hljs-selector-pseudo">:hover</span> &#123; <span class="hljs-attribute">color</span>: teal; &#125;<br><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:link</span><span class="hljs-selector-pseudo">:active</span> &#123; <span class="hljs-attribute">color</span>: fuchsia; &#125;<br></code></pre></td></tr></table></figure><h3 id="The-target-pseudo-classes：-target"><a class="header-anchor" href="#The-target-pseudo-classes：-target"></a>The target pseudo-classes：<code>:target</code></h3><p>有些 URI 的最後會以 <code>#</code> (number sign) 為結尾，後面會接著 anchor identifier (也稱為 fragment identifier)，代表該 URI 是指向資源中的某個位置。通常帶有 fragment identifier 的 URL 會 link 到文件中的某些元素，該元素被稱為 target 元素。</p><p>例如：在下面的 HTML 文件中有名為 <code>hello</code> 的 anchor (錨點) (也就是 <code>&lt;a href=&quot;#hello&quot;&gt;Hello&lt;/a&gt;</code> 這個連結)：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#hello"</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hello"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Target<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-id">#hello</span><span class="hljs-selector-pseudo">:target</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/jONegME" target="_blank" rel="noopener">Codepen 連結</a></p><p>如果此 HTML 的 URL 為：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">https:&#x2F;&#x2F;s.codepen.io&#x2F;titangene&#x2F;debug&#x2F;jONegME&#x2F;vWkRwRNmBvOM<br></code></pre></td></tr></table></figure><p>在還沒點擊 <code>#hello</code> 錨點時，畫面如下：</p><p><img src="../images/css-selector-pseudo-class-1/2019-09-19-18-59-06.png" alt=""></p><p>只要點擊 <code>#hello</code> 錨點後，下面的 “Target” 文字就會變成紅色 (也就是會應用 <code>#hello:target</code> 的樣式)，畫面如下：</p><p><img src="../images/css-selector-pseudo-class-1/2019-09-19-18-59-29.png" alt=""></p><p>並且 URL 的最後會加上 <code>#hello</code>，而 <code>#hello</code> 就是 fragment identifier。</p><p>剛剛點擊的錨點會 link 到 target 元素，而 target 元素就是 <code>&lt;div id=&quot;hello&quot;&gt;</code>，所以 selector 才會 match 到 <code>#hello:target</code>。</p><iframe height="227" style="width:100%" scrolling="no" title="target pseudo-classes :target" src="https://codepen.io/titangene/embed/jONegME/?height=227&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/jONegME/" target="_blank" rel="noopener">target pseudo-classes :target</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><p>在 <a href="https://developer.mozilla.org/zh-TW/docs/Web/CSS/:target#Creating_a_pure_CSS_lightbox" target="_blank" rel="noopener">MDN</a> 有一個範例也蠻有趣的，可以用 <code>:target</code> pseudo-class 來實作 lightbox：</p><p><img src="../images/css-selector-pseudo-class-1/lightbox.gif" alt=""></p><p>運作原理是用 <code>display: none</code> 和 <code>display: block</code> 來控制 lightbox 是否開啟，觸發的機制就是用剛剛介紹的 <code>:target</code> pseudo-class 來做的。</p><blockquote><p>這個範例很有趣，以前用 JavaScript 才能做到的事情，沒想到也能用純 CSS 來實作出來。</p></blockquote><h3 id="UI-element-states-pseudo-classes"><a class="header-anchor" href="#UI-element-states-pseudo-classes"></a>UI element states pseudo-classes</h3><p>分為：</p><ul><li><code>:enabled</code>：處於啟用狀態的 UI 元素</li><li><code>:disabled</code>：處於禁用狀態的 UI 元素</li><li><code>:checked</code>：選取 radio 或勾選 checkbox 元素時會應用</li></ul><h4 id="enabled-disabled-pseudo-class"><a class="header-anchor" href="#enabled-disabled-pseudo-class"></a><code>:enabled</code> &amp; <code>:disabled</code> pseudo-class</h4><p>直接看範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"enabledField"</span>&gt;</span>enabled field:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"enabledField"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Lorem"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"disabledField"</span>&gt;</span>disabled field:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"disabledField"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Lorem"</span> <span class="hljs-attr">disabled</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"enabledCheckbox"</span>&gt;</span>enabled checkbox:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"enabledCheckbox"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"disabledCheckbox"</span>&gt;</span>disabled checkbox:<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"disabledCheckbox"</span> <span class="hljs-attr">disabled</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Submit"</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:enabled</span> &#123; <span class="hljs-attribute">outline</span>: <span class="hljs-number">3px</span> solid red; &#125;<br><span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:disabled</span> &#123; <span class="hljs-attribute">outline</span>: <span class="hljs-number">3px</span> solid blue; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/qBWQBEd" target="_blank" rel="noopener">Codepen 連結</a></p><p>只要被加上 <code>disabled</code> 屬性的 <code>input</code> 元素都代表該元素處於禁用狀態，所以這些元素就會套用 <code>input:disabled</code> 此 selector 的樣式。其餘的元素則會套用 <code>input:enabled</code> 此 selector 的樣式。</p><p><img src="../images/css-selector-pseudo-class-1/2019-09-19-19-37-25.png" alt=""></p><div class="info"><p>不過要注意的事元素有無啟用，跟一些會影響使用者互動 UI 元素的 CSS 屬性沒關係，這些都不會影響 selector 是否 match 到 <code>:enabled</code> 或 <code>:disabled</code>。</p><p>例如：<code>display</code> 和 <code>visibility</code> 屬性都會讓元素在畫面上消失，但是都不會影響到啟用或禁用的狀態。</p><ul><li><code>display: none</code> 不會讓元素出現在 <a href="https://www.w3.org/TR/CSS22/intro.html#formatting-structure" target="_blank" rel="noopener">formatting structure</a> 中，很像不在畫面上，會完全消失</li><li><code>visibility: hidden</code> 生成的 box 是看不見的，完全透明，不會 draw 任何內容，但會影響佈局，也就是會在畫面上佔用空間，但會看不到元素的樣子</li></ul></div><iframe height="299" style="width:100%" scrolling="no" title=":enabled and :disabled pseudo-classes" src="https://codepen.io/titangene/embed/qBWQBEd/?height=299&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/qBWQBEd/" target="_blank" rel="noopener">:enabled and :disabled pseudo-classes</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h4 id="checked-pseudo-class"><a class="header-anchor" href="#checked-pseudo-class"></a><code>:checked</code> pseudo-class</h4><p>直接看範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"firstCheckbox"</span> <span class="hljs-attr">checked</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"firstCheckbox"</span>&gt;</span>First checkbox<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"secondCheckbox"</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"secondCheckbox"</span>&gt;</span>Second checkbox<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"firstRadio"</span> <span class="hljs-attr">checked</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"firstRadio"</span>&gt;</span>First radio<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"secondRadio"</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"secondRadio"</span>&gt;</span>Second radio<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">input</span> + <span class="hljs-selector-tag">label</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br><span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:checked</span> + <span class="hljs-selector-tag">label</span> &#123; <span class="hljs-attribute">color</span>: blue; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/vYBQYrW" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-selector-pseudo-class-1/2019-09-19-20-02-40.png" alt=""></p><iframe height="280" style="width:100%" scrolling="no" title=":checked pseudo-class" src="https://codepen.io/titangene/embed/vYBQYrW/?height=280&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/vYBQYrW/" target="_blank" rel="noopener">:checked pseudo-class</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h2 id="最後"><a class="header-anchor" href="#最後"></a>最後</h2><p>今天介紹一些 pseudo-class，接下來幾天會接續介紹其他 selector。</p><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/selector.html" target="_blank" rel="noopener">CSS 2.2 Specification - Selectors</a></li><li><a href="https://www.w3.org/TR/selectors-3/" target="_blank" rel="noopener">Selectors Level 3</a></li><li><a href="https://www.w3.org/TR/selectors-4/" target="_blank" rel="noopener">Selectors Level 4</a></li><li><a href="https://developer.mozilla.org/zh-TW/docs/Web/CSS/:target" target="_blank" rel="noopener">:target - CSS | MDN</a></li></ul><blockquote><p>About MDN by Mozilla Contributors is licensed under CC-BY-SA 2.5</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Attribute selector (屬性選擇器)</title>
      <link href="/article/css-attribute-selector.html"/>
      <url>/article/css-attribute-selector.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>Selector (選擇器) 可用來選擇 HTML 和 XML 文件中的節點，並將樣式屬性綁定到文件 (HTML 和 XML) 中的元素上。當選擇器與某元素 match 的時候，就可以對選到的元素進行 CSS 樣式設定。本篇會介紹 attribute selector (屬性選擇器)。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10217082" target="_blank" rel="noopener">重新認識 CSS - Attribute selector (屬性選擇器)</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="Attribute-selector"><a class="header-anchor" href="#Attribute-selector"></a>Attribute selector</h2><p>Selector 允許表示元素的屬性。當 selector 作為 expression (表達式) 來 match 元素時，如果該元素具有與 attribute selector (屬性選擇器) 表示的屬性 match 的屬性，則必須將 attribute selector 視為與元素 match。</p><h3 id="Attribute-presence-and-value-selector"><a class="header-anchor" href="#Attribute-presence-and-value-selector"></a>Attribute presence and value selector</h3><p><a href="https://www.w3.org/TR/CSS22/selector.html#attribute-selectors" target="_blank" rel="noopener">CSS2</a> 引入了四個 attribute selector：</p><ul><li><code>[att]</code>：代表具有 <code>att</code> 屬性的元素，無論屬性的值為何</li><li><code>[att=val]</code>：代表具有 <code>att</code> 屬性的元素，且該屬性值為 <code>val</code></li><li><code>[att~=val]</code>：代表具有 <code>att</code> 屬性的元素，該屬性的值是以空格分隔的單詞列表，其中一個正好是 <code>val</code><ul><li>如果 <code>val</code> 包含空格，就不會 match 任何內容 (因為單字之間是用空格來分隔)</li><li>如果 <code>val</code> 是空字串，就不會 match 任何內容</li></ul></li><li><code>[att|=val]</code>：代表具有 <code>att</code> 屬性的元素，且該屬性值為 <code>val</code> 或以 <code>val</code> 為開頭，後面接著 <code>-</code> (也就是以 <code>val-</code> 為開頭)</li></ul><p>直接看範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Titan<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"hello"</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"titan"</span>&gt;</span>Titan<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"hello"</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"titan"</span>&gt;</span>Titan<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"highlight"</span>&gt;</span>highlight Titan<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"titan"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"highlight"</span>&gt;</span>highlight Titan<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text text-primary text-bold"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-primary text"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"textPrimary"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-primary"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert-primary"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span><span class="hljs-selector-attr">[title]</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br><span class="hljs-selector-tag">h2</span><span class="hljs-selector-attr">[title=<span class="hljs-string">"titan"</span>]</span> &#123; <span class="hljs-attribute">color</span>: green; &#125;<br><span class="hljs-selector-tag">h1</span><span class="hljs-selector-attr">[title=<span class="hljs-string">"titan"</span>]</span><span class="hljs-selector-attr">[class=<span class="hljs-string">"highlight"</span>]</span> &#123; <span class="hljs-attribute">color</span>: blue; &#125;<br><span class="hljs-selector-tag">h1</span><span class="hljs-selector-attr">[class~=<span class="hljs-string">"text"</span>]</span> &#123; <span class="hljs-attribute">color</span>: purple; &#125;<br><span class="hljs-selector-tag">h2</span><span class="hljs-selector-attr">[class|=<span class="hljs-string">"text"</span>]</span> &#123; <span class="hljs-attribute">color</span>: olive; &#125;<br><span class="hljs-selector-tag">h1</span><span class="hljs-selector-attr">[class=<span class="hljs-string">"alert"</span>]</span>, <span class="hljs-selector-tag">h1</span><span class="hljs-selector-attr">[class=<span class="hljs-string">"alert-primary"</span>]</span> &#123; <span class="hljs-attribute">color</span>: gray; &#125;<br></code></pre></td></tr></table></figure><ul><li><code>h1[title]</code>：帶有 <code>title</code> 屬性的 <code>h1</code> 元素</li><li><code>h2[title=&quot;titan&quot;]</code>：帶有 <code>title</code> 屬性的 <code>h2</code> 元素，並且該屬性值為 <code>titan</code></li><li><code>h1[title=&quot;titan&quot;][class=&quot;highlight&quot;]</code>：帶有 <code>title</code> 和 <code>class</code> 屬性的 <code>h1</code> 元素，並且 <code>title</code> 的屬性值為 <code>titan</code> 以及 <code>class</code> 屬性值為 <code>highlight</code></li><li><code>h1[class~=&quot;text&quot;]</code>：帶有 <code>class</code> 屬性的 <code>h1</code> 元素，並且該屬性值需包含 <code>text</code></li><li><code>h2[class|=&quot;text&quot;]</code>：帶有 <code>class</code> 屬性的 <code>h2</code> 元素，並且該屬性值為需為 <code>text</code> 或以 <code>text-</code> 為開頭</li><li><code>h1[class=&quot;alert&quot;], h1[class=&quot;alert-primary&quot;]</code>：帶有 <code>class</code> 屬性的 <code>h1</code> 元素，並且該屬性值為 <code>alert</code>，以及帶有 <code>class</code> 屬性的 <code>h1</code> 元素，並且該屬性值為 <code>alert-primary</code></li></ul><div class="info"><p>註：<code>[title=&quot;titan&quot;]</code> 中的 <code>title</code> 是屬性名稱，<code>titan</code> 是名為 <code>title</code> 的屬性值。</p></div><p>Demo：<a href="https://codepen.io/titangene/pen/MWgPyyG" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-attribute-selector/attribute-presence-and-value-selector.png" alt=""></p><iframe height="590" style="width:100%" scrolling="no" title="Attribute presence and value selectors" src="https://codepen.io/titangene/embed/MWgPyyG/?height=590&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/MWgPyyG/" target="_blank" rel="noopener">Attribute presence and value selectors</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><p>如上述所說，<code>[att~=val]</code> 有以下兩項語法規則，下面會分別以範例來說明：</p><ul><li>如果 <code>val</code> 包含空格，就不會 match 任何內容 (因為單字之間是用空格來分隔)</li><li>如果 <code>val</code> 是空字串，就不會 match 任何內容</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text text-primary text-bold"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-primary text"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span><span class="hljs-selector-attr">[class~=<span class="hljs-string">"text"</span>]</span> &#123; <span class="hljs-attribute">color</span>: olive; &#125;<br><br><span class="hljs-comment">/* 以下 selector 都不會 match 任何內容 */</span><br><span class="hljs-selector-tag">h1</span><span class="hljs-selector-attr">[class~=<span class="hljs-string">"text "</span>]</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br><span class="hljs-selector-tag">h1</span><span class="hljs-selector-attr">[class~=<span class="hljs-string">" text"</span>]</span> &#123; <span class="hljs-attribute">color</span>: green; &#125;<br><span class="hljs-selector-tag">h1</span><span class="hljs-selector-attr">[class~=<span class="hljs-string">" text "</span>]</span> &#123; <span class="hljs-attribute">color</span>: blue; &#125;<br><span class="hljs-selector-tag">h1</span><span class="hljs-selector-attr">[class~=<span class="hljs-string">" "</span>]</span> &#123; <span class="hljs-attribute">color</span>: purple; &#125;<br><span class="hljs-selector-tag">h1</span><span class="hljs-selector-attr">[class~=<span class="hljs-string">""</span>]</span> &#123; <span class="hljs-attribute">color</span>: gray; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/qBBbxJp" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-attribute-selector/attribute-presence-and-value-selector-2.png" alt=""></p><iframe height="396" style="width:100%" scrolling="no" title="Attribute presence and value selectors：[att~=val]" src="https://codepen.io/titangene/embed/qBBbxJp?height=396&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/qBBbxJp" target="_blank" rel="noopener">Attribute presence and value selectors：[att~=val]</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h3 id="Substring-matching-attribute-selector"><a class="header-anchor" href="#Substring-matching-attribute-selector"></a>Substring matching attribute selector</h3><p>在 <a href="https://www.w3.org/TR/selectors-3/#attribute-substrings" target="_blank" rel="noopener">Selectors Level 3</a> 提供了三個額外的 attribute selector，用於 match 屬性值中的子字串：</p><ul><li><code>[att^=val]</code>：代表具有 <code>att</code> 屬性的元素，該屬性值以 <code>val</code> 為開頭。如果 <code>val</code> 是空字串，則 selector 不會 match 任何內容</li><li><code>[att$=val]</code>：代表具有 <code>att</code> 屬性的元素，該屬性值以 <code>val</code> 為結尾。如果 <code>val</code> 是空字串，則 selector 不會 match 任何內容</li><li><code>[att*=val]</code>：代表具有 <code>att</code> 屬性的元素，該屬性值至少包含 <code>val</code> 這個子字串。如果 <code>val</code> 是空字串，則 selector 不會 match 任何內容</li></ul><p>直接看範例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"textPrimary"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-primary"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://titangene.github.io/article/css-attribute-selector.html"</span>&gt;</span>重新認識 CSS - CSS Selector (2)<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://titangene.github.io"</span>&gt;</span>Titangene Blog<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-alert"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"myAlertPrimary"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-alert-primary"</span>&gt;</span>Text<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h2</span><span class="hljs-selector-attr">[class^=<span class="hljs-string">"text"</span>]</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br><span class="hljs-selector-tag">a</span><span class="hljs-selector-attr">[href$=<span class="hljs-string">".html"</span>]</span> &#123; <span class="hljs-attribute">color</span>: gray; &#125;<br><span class="hljs-selector-tag">h2</span><span class="hljs-selector-attr">[class*=<span class="hljs-string">"alert"</span>]</span> &#123; <span class="hljs-attribute">color</span>: green; &#125;<br></code></pre></td></tr></table></figure><ul><li><code>h2[class^=&quot;text&quot;]</code>：代表具有 <code>class</code> 屬性的元素，該屬性值以 <code>text</code> 為開頭</li><li><code>a[href$=&quot;.html&quot;]</code>：代表具有 <code>href</code> 屬性的元素，該屬性值以 <code>.html</code> 為結尾 (也就是該頁面為 <code>.html</code> 檔)</li><li><code>h2[class*=&quot;alert&quot;]</code>：代表具有 <code>class</code> 屬性的元素，該屬性值至少包含 <code>alert</code> 這個子字串</li></ul><p>Demo：<a href="https://codepen.io/titangene/pen/vYBVKEm" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-attribute-selector/substring-matching-attribute-selector.png" alt=""></p><iframe height="383" style="width:100%" scrolling="no" title="Substring matching attribute selectors" src="https://codepen.io/titangene/embed/vYBVKEm/?height=383&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/vYBVKEm/" target="_blank" rel="noopener">Substring matching attribute selectors</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h2 id="最後"><a class="header-anchor" href="#最後"></a>最後</h2><p>今天介紹一些 attribute selector，接下來幾天會接續介紹其他 selector。</p><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/selector.html" target="_blank" rel="noopener">CSS 2.2 - 5. Selectors</a></li><li><a href="https://www.w3.org/TR/selectors-3/" target="_blank" rel="noopener">Selectors Level 3</a></li><li><a href="https://www.w3.org/TR/selectors-4/" target="_blank" rel="noopener">Selectors Level 4</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - Simple Selector &amp; Groups of selector</title>
      <link href="/article/css-selector-1.html"/>
      <url>/article/css-selector-1.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>Selector (選擇器) 可用來選擇 HTML 和 XML 文件中的節點，並將樣式屬性綁定到文件 (HTML 和 XML) 中的元素上。當選擇器與某元素 match 的時候，就可以對選到的元素進行 CSS 樣式設定。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p><p>本文同步發表於 iT 邦幫忙：<a href="https://ithelp.ithome.com.tw/articles/10216566" target="_blank" rel="noopener">重新認識 CSS - Simple Selector &amp; Groups of selector</a></p><p>「重新認識 CSS」系列文章發文於：</p><ul><li><a href="https://ithelp.ithome.com.tw/users/20117586/ironman/2617" target="_blank" rel="noopener">iT 邦幫忙</a></li><li><a href="https://titangene.github.io/tags/it-%E9%90%B5%E4%BA%BA%E8%B3%BD/">Titangene Blog</a></li></ul></blockquote><h2 id="Selector-語法"><a class="header-anchor" href="#Selector-語法"></a>Selector 語法</h2><p>Selector 是由一個或多個 sequence of simple selector (簡單選擇器) 所組合，並用 combinator 分隔的一串東西。</p><p>sequence of simple selectors：</p><ul><li>由多個 simple selector 組成，沒有被 combinator 分隔</li><li>以 type selector 或 universal selector 為開頭</li></ul><p>以下這些都是 simple selector：</p><ul><li>type selector：例如 <code>E</code></li><li>universal selector：例如 <code>*</code></li><li>attribute selector：例如 <code>E[foo]</code></li><li>class selector：例如 <code>.myclass</code></li><li>ID selector：例如 <code>#myid</code></li><li>pseudo-class：例如 <code>E:hover</code></li></ul><p>combinator 是 <code></code> (空白字元)、<code>&gt;</code>、<code>+</code>、<code>~</code>，例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">E F &#123; color: red; &#125;<br>E &gt; F &#123; color: red; &#125;<br>E + F &#123; color: red; &#125;<br>E ~ F &#123; color: red; &#125;<br></code></pre></td></tr></table></figure><p>simple selector 與 combinator 之間可以加上空白，不加空白也可以。例如：下面兩個選擇器是相同的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">E &gt; F<br>E&gt;F<br></code></pre></td></tr></table></figure><p>不過，通常在之間都會加空白，因為可讀性較佳。</p><p>所有 CSS 語法在 ASCII 範圍內都不分大小寫 (也就是 <code>[a-z]</code> 等於 <code>[A-Z]</code> )，但不受 CSS 控制的部分除外。例如：HTML 的 <code>id</code> 和 <code>class</code> 屬性值、字體名稱和 URI 是否分大小寫都超出 CSS Spec 的定義範圍。另外，HTML 的元素名稱是不分大小寫的，但在 XML 就有分大小寫。</p><p>雖然在 <a href="https://www.w3.org/TR/CSS22/selector.html#pseudo-elements" target="_blank" rel="noopener">CSS 2.2 spec</a> 是說 pseudo-element 和 pseudo-class 的名稱不分大小寫，但通常會使用小寫。</p><p>在 CSS 中，identifier (包括 selector 中的元素名稱、class 和 ID) 只能包含字元 <code>[a-zA-Z0-9]</code> 和 ISO 10646 字元中的 U+0080 及之後的字元，以及 hyphen ( <code>-</code> ) 和底線 ( <code>_</code> )；它們不能以數字、兩個 hyphen 或 hyphen 後面接著數字為開頭。</p><blockquote><p>詳情可參閱 <a href="https://www.w3.org/TR/CSS22/syndata.html#characters" target="_blank" rel="noopener">CSS 2.2 - 4.1.3. Characters and case</a>。</p></blockquote><h2 id="Groups-of-selector"><a class="header-anchor" href="#Groups-of-selector"></a>Groups of selector</h2><p>當多個選擇器共享相同的宣告時，它們可以用逗號來分隔每個選擇器，每個選擇器都會選到 match 的所有元素，例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>header 1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>header 2<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>header 3<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br><span class="hljs-selector-tag">h2</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br><span class="hljs-selector-tag">h3</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>等同於：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span>, <span class="hljs-selector-tag">h2</span>, <span class="hljs-selector-tag">h3</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/ExYevee" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-selector-1/2019-09-17-15-40-57.png" alt=""></p><p><img src="../images/css-selector-1/2019-09-17-15-41-34.png" alt=""></p><iframe height="244" style="width:100%" scrolling="no" title="Groups of selector" src="https://codepen.io/titangene/embed/ExYevee/?height=244&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/ExYevee/" target="_blank" rel="noopener">Groups of selector</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><p>不要要注意的是，上面兩個範例會有一樣的結果是因為所有選擇器都是有效的選擇器 (valid selector)。如果其中一個選擇器為無效時，就會讓整個選擇器群組都無效。不過，若將三個選擇器分開宣告時，就只有那一個會失效。例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>header 1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>header 2<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>header 3<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br><span class="hljs-selector-tag">h2</span>.<span class="hljs-selector-class">.foo</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br><span class="hljs-selector-tag">h3</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>不等於：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span>, <span class="hljs-selector-tag">h2</span>.<span class="hljs-selector-class">.foo</span>, <span class="hljs-selector-tag">h3</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/gOYdxQP" target="_blank" rel="noopener">Codepen 連結</a></p><p>如下圖，因為上面其中的 <code>h2..foo</code> 是無效選擇器 (invalid selector)，所以會造成 <code>h1, h2..foo, h3</code> 完全無效，並且會刪除這個樣式規則：</p><p><img src="../images/css-selector-1/2019-09-17-15-37-08.png" alt=""></p><p>如果是分開宣告，就只會刪除 <code>h2..foo</code> 這個樣式規則，如下圖：</p><p><img src="../images/css-selector-1/2019-09-17-15-38-56.png" alt=""></p><iframe height="268" style="width:100%" scrolling="no" title="Groups of selector: valid selector" src="https://codepen.io/titangene/embed/gOYdxQP/?height=268&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/gOYdxQP/" target="_blank" rel="noopener">Groups of selector: valid selector</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h2 id="Simple-selector"><a class="header-anchor" href="#Simple-selector"></a>Simple selector</h2><p>以下這些都是 simple selector：</p><ul><li>type selector</li><li>universal selector</li><li>attribute selector</li><li>class selector</li><li>ID selector</li><li>pseudo-class</li></ul><h3 id="Type-selector"><a class="header-anchor" href="#Type-selector"></a>Type selector</h3><p>與 HTML 的 element type 的名稱 (也就是 HTML tag 名稱) match。</p><p>例如：match 所有 <code>h1</code> 元素：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>header 1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/JjPaMpm" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-selector-1/2019-09-17-15-45-55.png" alt=""></p><iframe height="265" style="width:100%" scrolling="no" title="type selector" src="https://codepen.io/titangene/embed/JjPaMpm/?height=265&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/JjPaMpm/" target="_blank" rel="noopener">type selector</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h3 id="Universal-Selector"><a class="header-anchor" href="#Universal-Selector"></a>Universal Selector</h3><p>Universal selector 是使用 <code>*</code> 來 match 任何 element type 的名稱。</p><p>例如：下面範例可以選到所有元素：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>header 1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>header 2<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>header 3<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://titangene.github.io/"</span>&gt;</span>Titangene Blog<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">* &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/NWKLvQg" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-selector-1/2019-09-17-15-47-50.png" alt=""></p><iframe height="285" style="width:100%" scrolling="no" title="Universal Selector" src="https://codepen.io/titangene/embed/NWKLvQg/?height=285&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/NWKLvQg/" target="_blank" rel="noopener">Universal Selector</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h3 id="Class-selector"><a class="header-anchor" href="#Class-selector"></a>Class selector</h3><p>如果要對多個元素需要相同的樣式時，就可以用 <code>class</code> 這個屬性來標識它們。在 CSS 是使用 <code>.</code> 來代表 class 屬性，也等同於 <code>~=</code> 表示法 (notation)，屬性值必須在 <code>.</code> 之後。例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>header 1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"highlight"</span>&gt;</span>highlight header 1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span><span class="hljs-selector-class">.highlight</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>等同於：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span><span class="hljs-selector-attr">[class~=highlight]</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/gOYdXOe" target="_blank" rel="noopener">Codepen 連結</a></p><p>第一個 <code>h1</code> 元素的字體顏色不會變成紅色，只有第二個 <code>h1</code> 元素才會變紅色：</p><p><img src="../images/css-selector-1/2019-09-17-16-46-57.png" alt=""></p><p><img src="../images/css-selector-1/2019-09-17-16-47-15.png" alt=""></p><iframe height="240" style="width:100%" scrolling="no" title="class selector" src="https://codepen.io/titangene/embed/gOYdXOe/?height=240&theme-id=dark&default-tab=css,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/gOYdXOe/" target="_blank" rel="noopener">class selector</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><p>如果只單獨使用 class selector (也就是 <code>.</code> )，也等同於在前面加上 universal selector (也就是 <code>*</code> )。例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>header 1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"highlight"</span>&gt;</span>highlight header 1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>header 2<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"highlight"</span>&gt;</span>highlight header 2<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">*<span class="hljs-selector-class">.highlight</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.highlight</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/GRKXOZx" target="_blank" rel="noopener">Codepen 連結</a></p><p>第一個 <code>h1</code> 和 <code>h2</code> 元素的字體顏色不會變成紅色，只有第二個 <code>h1</code> 和 <code>h2</code> 元素才會變紅色：</p><p><img src="../images/css-selector-1/2019-09-17-16-53-46.png" alt=""></p><p><img src="../images/css-selector-1/2019-09-17-16-55-21.png" alt=""></p><iframe height="320" style="width:100%" scrolling="no" title="class selector &amp; universal selector" src="https://codepen.io/titangene/embed/GRKXOZx/?height=320&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/GRKXOZx/" target="_blank" rel="noopener">class selector &amp; universal selector</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><p>如果需要同時指定某元素上的兩個 class，可以寫成這樣：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>header 1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-primary highlight"</span>&gt;</span>highlight header 1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>header 2<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"highlight"</span>&gt;</span>highlight header 2<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.text-primary</span><span class="hljs-selector-class">.highlight</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><div class="info"><p>註：在 HTML 要對某元素上同時設定多個 class，是使用空白字元來分隔多個 class。以上面範例來說，第二個 <code>h1</code> 上有兩個 class，分別是 <code>text-primary</code> 和 <code>highlight</code>。</p></div><p>Demo：<a href="https://codepen.io/titangene/pen/WNegdxr" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-selector-1/2019-09-17-17-27-15.png" alt=""></p><iframe height="320" style="width:100%" scrolling="no" title="multi class selector" src="https://codepen.io/titangene/embed/WNegdxr/?height=320&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/WNegdxr/" target="_blank" rel="noopener">multi class selector</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h3 id="ID-selector"><a class="header-anchor" href="#ID-selector"></a>ID selector</h3><p>如果要對某個元素作唯一的標示，就可以用 <code>id</code> 這個屬性來標識它們。在 CSS 是使用 <code>#</code> 來代表 id 屬性，屬性值必須在 <code>#</code> 之後。例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>header 1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"titan"</span>&gt;</span>header 1<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>header 2<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"titan"</span>&gt;</span>header 2<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-id">#titan</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/GRKXyjb" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-selector-1/2019-09-17-17-52-36.png" alt=""></p><iframe height="320" style="width:100%" scrolling="no" title="id selector" src="//codepen.io/titangene/embed/GRKXyjb/?height=320&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/GRKXyjb/" target="_blank" rel="noopener">id selector</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><p>如果只想選擇帶有 <code>titan</code> 這個 id 的 <code>h2</code> 元素，可以寫成這樣：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h2</span><span class="hljs-selector-id">#titan</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>Demo：<a href="https://codepen.io/titangene/pen/KKPxZma" target="_blank" rel="noopener">Codepen 連結</a></p><p><img src="../images/css-selector-1/2019-09-17-17-56-01.png" alt=""></p><iframe height="320" style="width:100%" scrolling="no" title="id selector: specific element" src="//codepen.io/titangene/embed/KKPxZma/?height=320&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/KKPxZma/" target="_blank" rel="noopener">id selector: specific element</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h3 id="Pseudo-class"><a class="header-anchor" href="#Pseudo-class"></a>Pseudo-class</h3><blockquote><p>pseudo-class 會在之後的兩篇中介紹到：</p><ul><li><a href="https://ithelp.ithome.com.tw/articles/10217730" target="_blank" rel="noopener">重新認識 CSS - Pseudo-class (偽類) (1)</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10218197" target="_blank" rel="noopener">重新認識 CSS - Pseudo-class (偽類) (2)</a></li></ul></blockquote><h2 id="最後"><a class="header-anchor" href="#最後"></a>最後</h2><p>今天介紹一些 simple selector，接下來幾天會接續介紹其他 selector。</p><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/CSS22/selector.html" target="_blank" rel="noopener">CSS 2.2 - 5. Selectors</a></li><li><a href="https://www.w3.org/TR/CSS22/syndata.html#characters" target="_blank" rel="noopener">CSS 2.2 - 4.1.3. Characters and case</a></li><li><a href="https://www.w3.org/TR/selectors-3/" target="_blank" rel="noopener">Selectors Level 3</a></li><li><a href="https://www.w3.org/TR/selectors-4/" target="_blank" rel="noopener">Selectors Level 4</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新認識 CSS - CSS 簡介</title>
      <link href="/article/css-introduction.html"/>
      <url>/article/css-introduction.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/css.png" alt=""></p><p>CSS 是 Cascading Style Sheets 的縮寫，是一種 style sheet (樣式表) 語言，可將自訂的樣式 (例如：字體、顏色) 附加在 HTML 文件上。這篇會先簡介 CSS，以及如何在 HTML 設定 CSS。</p><a id="more"></a><h2 id="前言"><a class="header-anchor" href="#前言"></a>前言</h2><blockquote><p>「重新認識 CSS」這個系列名稱的由來就如其名，我想要重新認識它。雖然以前就有學過 CSS，但這次想從 CSS Spec 中學到最原始的定義和內容，更加了解 CSS 的原理，讓我在切版的時候可以更加確定自己在做什麼，我踩到的雷只是因為我不夠了解它才會炸開。</p><p>在這 30 天的內容中，會將 Spec 內看到的資料整理成這個系列，也希望正在學 CSS 的各位可以更加了解它。另外我也會同時將文章發至我的 Blog，如果想直接看文內的程式碼 Demo 畫面，可以到我的 Blog 來看 😃。</p></blockquote><p>CSS 規則是由 selector 和宣告 (declaration) 組成，以下面程式碼的 CSS 規則為例，<code>h1</code> 就是 selector，<code>color: red</code> 就是宣告。在 HTML 中，元素名稱不分大小寫，例如：<code>H1</code> 和 <code>h1</code> 相同，但通常會寫小寫。</p><p>宣告又由屬性名稱和屬性值組成，以下面程式碼為例，<code>color</code> 就是屬性名稱，<code>red</code> 就是屬性值。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><h2 id="在-HTML-設定-CSS"><a class="header-anchor" href="#在-HTML-設定-CSS"></a>在 HTML 設定 CSS</h2><p>要在 HTML 內設定 CSS 有三種方法：</p><ul><li>Inline CSS：元素上的 <code>style</code> 屬性</li><li>Internal CSS：<code>style</code> 元素</li><li>External CSS：<code>link</code> 元素引入外部 CSS</li></ul><h3 id="Inline-CSS：元素上的-style-屬性"><a class="header-anchor" href="#Inline-CSS：元素上的-style-屬性"></a>Inline CSS：元素上的 <code>style</code> 屬性</h3><ul><li>在指定的元素上透過 <code>style</code> 屬性來設定 CSS 樣式</li><li>相同的樣式無法共用，如果要在不同元素設定相同的樣式，就需要在每個元素上設定 <code>style</code> 屬性</li><li>CSS 樣式與 HTML 結構寫在一起，可讀性差，不建議這樣寫</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color: red;"</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color: red;"</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Demo：</p><p><img src="../images/css-introduction/css-style-attr.png" alt=""></p><iframe height="214" style="width:100%" scrolling="no" title="Inline CSS" src="https://codepen.io/titangene/embed/JjPBmzR/?height=214&theme-id=dark&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen>See the Pen <a href="https://codepen.io/titangene/pen/JjPBmzR/" target="_blank" rel="noopener">Inline CSS</a> by Titangene (<a href="https://codepen.io/titangene" target="_blank" rel="noopener">@titangene</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</iframe><h3 id="Internal-CSS：style-元素"><a class="header-anchor" href="#Internal-CSS：style-元素"></a>Internal CSS：<code>style</code> 元素</h3><ul><li>直接在 HTML 原始碼內利用 <code>style</code> 元素來設定 CSS</li><li>只能在單獨的 HTML 內使用 <code>style</code> 元素裡的樣式</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><br><span class="css">      <span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Demo：</p><p><img src="../images/css-introduction/title-red.png" alt=""></p><h3 id="External-CSS：link-元素引入外部-CSS"><a class="header-anchor" href="#External-CSS：link-元素引入外部-CSS"></a>External CSS：<code>link</code> 元素引入外部 CSS</h3><ul><li>使用 <code>link</code> 元素引入外部 CSS 檔案內的樣式</li><li>可將 HTML 與 CSS 的原始碼分開管理<ul><li>若要更改樣式，只要更換成其他 CSS 檔案或修改外部 CSS 檔案內的樣式</li></ul></li><li>同一份 CSS 樣式可套用至多個 HTML 文件使用</li><li>常見會使用 CDN (Content Delivery Network)</li></ul><p><a href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" target="_blank" rel="noopener"><code>link</code> 元素</a> 上的設定：</p><ul><li>用 <code>rel</code> 屬性 (relationships) 設定連結類型：<code>stylesheet</code></li><li>用 <code>href</code> 屬性 (hyperlink reference) 指定的 CSS 路徑</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"./style.css"</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>下面內容為 <code>style.css</code>：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>Demo：</p><p><img src="../images/css-introduction/title-red.png" alt=""></p><h3 id="Multiple-Style-Sheets"><a class="header-anchor" href="#Multiple-Style-Sheets"></a>Multiple Style Sheets</h3><p>如果以不同的方式來對同一個元素設定樣式，則會使用最後設定的樣式。</p><p>例如：同時使用 internal CSS 和 external CSS 的方式設定 CSS：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"./style.css"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><br><span class="css">      <span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: green; &#125;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>下面內容為 <code>style.css</code>：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: red; &#125;<br></code></pre></td></tr></table></figure><p>那 <code>h1</code> 的顏色會是綠色：</p><p><img src="../images/css-introduction/title-green.png" alt=""></p><p>如果更換 <code>style</code> 和 <code>link</code> 元素的順序，<code>h1</code> 的顏色則會是紅色：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><br><span class="css">      <span class="hljs-selector-tag">h1</span> &#123; <span class="hljs-attribute">color</span>: green; &#125;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"./style.css"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="../images/css-introduction/title-red.png" alt=""></p><p>資料來源：</p><ul><li><a href="https://www.w3.org/TR/html401/present/styles.html" target="_blank" rel="noopener">Style Sheets in HTML documents</a></li><li><a href="https://html.spec.whatwg.org/multipage/semantics.html#the-link-element" target="_blank" rel="noopener">HTML Standard - 4.2.4 The link element</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
          <category> HTML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IT 鐵人賽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>套用自訂 HackMD 暗主題</title>
      <link href="/article/hackmd-dark-theme.html"/>
      <url>/article/hackmd-dark-theme.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/hackmd-dark-theme.jpg" alt=""></p><p>HackMD 是我常用的寫作平台，因官方沒有提供暗主題的瀏覽模式，所以我就刻了自訂的暗主題，也將自訂主題<a href="https://github.com/titangene/hackmd-dark-theme" target="_blank" rel="noopener">開源在 GitHub</a>，歡迎大家發 PR 給我，並記得幫我按個 ⭐️ 星。</p><a id="more"></a><p>應該有很多人在瀏覽器安裝 <a href="https://chrome.google.com/webstore/detail/dark-reader/eimadpbcbfnmbkopoojfekhnkhdbieeh" target="_blank" rel="noopener">Dark reader</a> 這個擴充功能吧？通常使用的原因大多是想把畫面變成深色瀏覽模式，比較保護眼睛。但是有些網站使用這個擴充功能之後，有些顏色不是你習慣或喜歡的，尤其是在個人常用的網站上會感覺沒那麼習慣。</p><p>而 <a href="https://hackmd.io/" target="_blank" rel="noopener">HackMD</a> 是我常用來寫技術筆記的寫作平台，尤其是程式碼的 highlight，我個人偏好 VS Code 預設的暗主題 (Dark+ 這個主題)，所以我就在網頁上加上自己自訂的 CSS 去改成我想要的主題。</p><p>那如何將自定的 CSS 加在指定的網站上呢？原本我是用 <a href="https://userstyles.org/" target="_blank" rel="noopener">Stylish</a> 來管理自訂的網頁樣式，但後來因為<a href="https://forum.userstyles.org/discussion/53233/announcement-to-the-community" target="_blank" rel="noopener">一些原因這個擴充功能多了在背景上傳資訊的功能</a> (雖然官方說不會上傳個資)，於是我就改用 <a href="https://github.com/openstyles/stylus" target="_blank" rel="noopener">Stylus</a> 來管理樣式。Stylus 是 Stylish 的分支，刪除了任何與分析、回傳資料的功能。</p><h2 id="如何使用主題"><a class="header-anchor" href="#如何使用主題"></a>如何使用主題</h2><ol><li>在瀏覽器安裝 <a href="https://github.com/openstyles/stylus" target="_blank" rel="noopener">Stylus</a> 擴充功能，Stylus 目前提供這幾種瀏覽器版本的擴充功能：<ul><li><a href="https://chrome.google.com/webstore/detail/stylus/clngdbkpkpeebahjckkjfobafhncgmne" target="_blank" rel="noopener">Chrome</a></li><li><a href="https://addons.mozilla.org/zh-TW/firefox/addon/styl-us/" target="_blank" rel="noopener">Firefox</a></li><li><a href="https://addons.opera.com/zh-tw/extensions/details/stylus/" target="_blank" rel="noopener">Opera</a></li></ul></li><li>下載我自定的 <a href="https://userstyles.org/styles/147272/hackmd-dark-theme" target="_blank" rel="noopener">HackMD dark theme</a> 至 Stylus</li></ol><p><img src="../images/hackmd-dark-theme/install-style.png" alt=""></p><ol start="3"><li>下載樣式後會自動套用，開啟 HackMD 就會看到介面變成暗主題囉！如果是之前就開啟的 HackMD 頁面，有時會需要重新整理頁面才會套用暗主題。</li></ol><p>就是這麼簡單 😄。</p><p>這邊要另外說明一下，雖然剛剛提到因為 Stylish 有收集資料的問題，所以我改用 Stylus 來管理自定樣式，但是要將自定的樣是分享給別人使用，還是要註冊 <a href="https://userstyles.org/" target="_blank" rel="noopener">Stylish</a> 官方平台的帳號，將要分享的樣式上傳至這個平台，讓其他人可以下載使用。</p><p>不過如果只是下載別人的主題是不需要註冊帳號，所以不用擔因。</p><h2 id="原始碼"><a class="header-anchor" href="#原始碼"></a>原始碼</h2><p>這就是我自定 HackMD 樣式的原始碼：<a href="https://github.com/titangene/hackmd-dark-theme" target="_blank" rel="noopener">titangene/hackmd-dark-theme</a></p><p>如果發現需修正的地方，歡迎發 pull request 給我 😎。<br>如果喜歡，記得幫我按個 ⭐️ 星，Thanks。</p><h2 id="畫面截圖"><a class="header-anchor" href="#畫面截圖"></a>畫面截圖</h2><h3 id="Overview"><a class="header-anchor" href="#Overview"></a>Overview</h3><p><img src="../images/hackmd-dark-theme/overview.png" alt=""></p><h3 id="Recent"><a class="header-anchor" href="#Recent"></a>Recent</h3><p><img src="../images/hackmd-dark-theme/recent.png" alt=""></p><h3 id="View-mode"><a class="header-anchor" href="#View-mode"></a>View mode</h3><p><img src="../images/hackmd-dark-theme/view.png" alt=""></p><h3 id="Book-mode"><a class="header-anchor" href="#Book-mode"></a>Book mode</h3><p><img src="../images/hackmd-dark-theme/book-mode.png" alt=""></p><h3 id="Slide-mode"><a class="header-anchor" href="#Slide-mode"></a>Slide mode</h3><p><img src="../images/hackmd-dark-theme/slide.png" alt=""></p><h3 id="Emoji-Todo-list-Code-block-highlight"><a class="header-anchor" href="#Emoji-Todo-list-Code-block-highlight"></a>Emoji &amp; Todo list &amp; Code block highlight</h3><p><img src="../images/hackmd-dark-theme/emoji_todo-list_code-block.png" alt=""></p><h3 id="Github-Gist"><a class="header-anchor" href="#Github-Gist"></a>Github Gist</h3><p><img src="../images/hackmd-dark-theme/gist.png" alt=""></p><h3 id="LaTeX-UML"><a class="header-anchor" href="#LaTeX-UML"></a>LaTeX &amp; UML</h3><p><img src="../images/hackmd-dark-theme/latex_uml.png" alt=""></p><h3 id="Table"><a class="header-anchor" href="#Table"></a>Table</h3><p><img src="../images/hackmd-dark-theme/table.png" alt=""></p><h3 id="ToC-Table-of-Contents"><a class="header-anchor" href="#ToC-Table-of-Contents"></a>ToC (Table of Contents)</h3><p><img src="../images/hackmd-dark-theme/toc.png" alt=""></p><h3 id="History"><a class="header-anchor" href="#History"></a>History</h3><p><img src="../images/hackmd-dark-theme/history.png" alt=""></p><h3 id="Permission"><a class="header-anchor" href="#Permission"></a>Permission</h3><p><img src="../images/hackmd-dark-theme/permission.png" alt=""></p><h3 id="Comment"><a class="header-anchor" href="#Comment"></a>Comment</h3><p><img src="../images/hackmd-dark-theme/comment.png" alt=""></p><h2 id="小結"><a class="header-anchor" href="#小結"></a>小結</h2><p>其實這個 side project 我在 2017 年 8 月就開始做了，期間做了一些不定期的更新，這次的更新算是所有我發現想改的部分 (洞) 都填好了 (有可能我眼殘沒發現的部分也需要改 XD，歡迎大家發 PR 給我)，包括最近 HackMD 官方推出的可分享文件給指定帳號的功能，我也把介面變成暗主題了。</p><h2 id="套用暗主題的其他秘訣"><a class="header-anchor" href="#套用暗主題的其他秘訣"></a>套用暗主題的其他秘訣</h2><p>在 HackMD 擔任 Developer 的 <a href="https://www.facebook.com/yukaihuangtw" target="_blank" rel="noopener">黃鈺凱</a> 在我發文的 Facebook 社團 <a href="https://www.facebook.com/groups/markdown.tw/permalink/1535146039952824/" target="_blank" rel="noopener">Markdown 台灣</a>，跟大家分享另一種可以套用暗主題的小秘訣，而且這個方法可以將你自定的樣式，套用至你分享的筆記，或是跟夥伴參與的共筆，讓大家都能共享同樣的暗主題。</p><p>這個祕訣就是在筆記內，加上 HackMD 的內嵌筆記語法，例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;%hackmd BJrTq20hE %&#125;<br></code></pre></td></tr></table></figure><p>以 <a href="https://hackmd.io/IpJEFpXkQg2yvdsY9IbTVg?both" target="_blank" rel="noopener">https://hackmd.io/IpJEFpXkQg2yvdsY9IbTVg?both</a> (這個連結是由 <a href="https://www.facebook.com/yukaihuangtw" target="_blank" rel="noopener">黃鈺凱</a> 大大提供) 這個筆記為例，在這個筆記內可以看到 HackMD 的內嵌筆記語法，而且可以看到我沒有在 Stylus 開啟我自定的 <a href="https://userstyles.org/styles/147272/hackmd-dark-theme" target="_blank" rel="noopener">HackMD dark theme</a>，竟然還可以保有暗主題的樣式：</p><p><img src="../images/hackmd-dark-theme/2019-05-19-23-38-41.png" alt=""></p><p>原因就發生在這個 HackMD 的內嵌筆記語法，因為這個語法背後幫你多加了暗主題的樣式。那是怎麼做到的呢？於是我就從 <code>BJrTq20hE</code> 這個看似奇怪亂碼的東西下手。</p><p>馬上就直覺想到，其實 <code>BJrTq20hE</code> 是另一篇筆記的編號，這個筆記的完整連結像是下面這樣，網址其中的 <code>s</code> 是 HackMD 的發表模式 (應該是叫這樣吧？)：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">https:&#x2F;&#x2F;hackmd.io&#x2F;s&#x2F;BJrTq20hE<br></code></pre></td></tr></table></figure><p>進入這個連結後，可以看到整個筆記畫面沒有任何文字內容，但是一樣在沒有套用自訂暗主題的情況下，還能有暗主題的樣式。</p><p><img src="../images/hackmd-dark-theme/2019-05-19-23-46-11.png" alt=""></p><p>接著我進入這個筆記的編輯模式就發現答案已揭曉，原來這個看似沒內文的筆記中，有我寫的暗主題樣式，這些樣式直接被寫在這篇 HackMD 的筆記裡面，並且放在 <code>&lt;style&gt;</code> 的 HTML element 內：</p><p><img src="../images/hackmd-dark-theme/2019-05-19-23-48-02.png" alt=""></p><p>也就是說如果未來想在其他筆記也套用相同的主題樣式，只要建立專門放樣式的筆記，然後將這個筆記透過 HackMD 的內嵌筆記語法套用至其他筆記上，這樣那些筆記都會共享相同的樣式囉！好神奇啊！感謝 HackMD Developer 大大的分享！</p>]]></content>
      
      
      <categories>
          
          <category> Blog </category>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
            <tag> Dark Theme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>透過 Docker Compose 設定 network</title>
      <link href="/article/networking-in-docker-compose.html"/>
      <url>/article/networking-in-docker-compose.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/docker-compose.jpg" alt=""></p><p>Docker Compose 預設會建立 default network，這篇會告訴你如何自訂 network、如何使用現有的 network，以及如何自訂 network 名稱。</p><a id="more"></a><p>Docker Compose 預設會幫你的應用程式設定一個 network，service 的每個容器都會加入 default network，並且該 network 上的其他容器都可以連接 (reachable) 以及發現 (discoverable) 與容器名稱相同的 hostname。</p><p>預設的 network 名稱是基於 “專案目錄名稱”，並加上 <code>_default</code>。例如：你的應用程式放在名為 <code>myapp</code> 的專案目錄中，而 <code>docker-compose.yml</code> 的內容如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3'</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">'8000:8000'</span><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">'8001:5432'</span><br></code></pre></td></tr></table></figure><p>當你執行 <code>docker-compose up</code> 指令時，會發生以下情況：</p><ol><li>建立一個名為 <code>myapp_default</code> 的 network</li><li>使用 <code>web</code> 的設定建立容器，並以 <code>web</code> 這個名稱加入名為 <code>myapp_default</code> 的 network</li><li>使用 <code>db</code> 的設定建立容器，並以 <code>db</code> 這個名稱加入名為 <code>myapp_default</code> 的 network</li></ol><div class="info"><p>當然你也可以使用 <a href="https://docs.docker.com/compose/reference/overview/" target="_blank" rel="noopener"><code>--project-name</code> (可簡寫成 <code>-p</code> ) 參數</a> 或使用 <code>COMPOSE_PROJECT_NAME</code> 這個 <a href="https://docs.docker.com/compose/reference/envvars/#compose-project-name" target="_blank" rel="noopener">環境變數</a> 來複寫專案名稱。</p></div><p>現在，每個容器都可以找到名為 <code>web</code> 或 <code>db</code> 的 hostname，並獲得對應容器的 IP 位址。例如：<code>web</code> 的應用程式的程式碼可以連接到 <code>postgres://db:5432</code> 的 URL，並開始使用 Postgres 資料庫。</p><p>不過要注意 <code>HOST_PORT</code> 和 <code>CONTAINER_PORT</code> 之間的差別。以上面範例中的 <code>db</code> 來說，<code>HOST_PORT</code> 是 <code>8001</code>，<code>CONTAINER_PORT</code> 是 <code>5432</code> (postgres 的預設 port)。Networked service-to-service 通訊使用 <code>CONTAINER_PORT</code>。定義 <code>HOST_PORT</code> 之後，service 也可以在 swarm 外部存取。</p><p>在 <code>web</code> 的容器中，如果要連接到 <code>db</code> 的連接字串會看起來像是 <code>postgres://db:5432</code> 這樣，而從 host machine 來看，連接字串看起來像是 <code>postgres://{DOCKER_IP}:8001</code>。</p><h2 id="更新容器"><a class="header-anchor" href="#更新容器"></a>更新容器</h2><p>如果有變更 service 的設定，請執行 <code>docker-compose up</code> 指令來更新 service，它會刪除舊的容器，而新容器會以不同的 IP 位址加入相同名稱的 network。執行中的容器可以找到該名稱並連接到新的 IP 位址，而舊的 IP 位址就無法使用。</p><p>如果任何容器對舊容器開放連線，那這些容器就會被關閉連線。容器有責任檢測這個情況，再次找到名稱並重新連接。</p><h2 id="Links"><a class="header-anchor" href="#Links"></a>Links</h2><p>link 到另一個 service 中的容器。透過 link 可以指定 service 名稱和 link 別名 ( <code>SERVICE:ALIAS</code> ），或僅指定 service 名稱。透過該別名可以從其他 service 存取到 service。link 不需要啟用 service 進行通訊 - 預設情況下，任何 service 都可以通過該 service 的名稱存取任何其他 service。</p><p>鏈接 (linked) service 的容器可在別名相同的 hostname 上存取，如果未指定別名，則可以存取 service 名稱。</p><p>在下面範例中，可以從 <code>web</code> 的 hostname <code>db</code> 和 <code>database</code> 存取到 <code>db</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3'</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">'db:database'</span><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres</span><br></code></pre></td></tr></table></figure><p><code>link</code> 和 <a href="https://docs.docker.com/compose/compose-file/#depends_on" target="_blank" rel="noopener"><code>depends_on</code></a> 都是以相同的方式表達 service 之間的依賴關係，因此可以使用它們來決定 service 啟動的順序。</p><div class="info"><ul><li>如果同時定義 <code>links</code> 和 <code>networks</code>，則它們之間具有 <code>links</code> 的 service 必須共享至少一個共同的網絡才能進行通訊。建議使用 network</li><li><a href="https://docs.docker.com/engine/reference/commandline/stack_deploy/" target="_blank" rel="noopener">在 swarm 模式下使用 Compose 檔案 (v3) 部署 stack 時</a>，會忽略 <code>links</code> 這個 option</li></ul></div><div class="warning"><p><code>--link</code> 參數為 legacy 功能，可能會被刪除。不建議使用 <code>--link</code>，建議使用 <a href="https://docs.docker.com/network/" target="_blank" rel="noopener">user-defined networks</a> (使用者定義的網路) 來促成兩個容器之間的溝通。user-defined networks 不支援你用 <code>--link</code> 參數在容器之間共享環境變數。但是，你可以使用其他機制 (例如：volume)，以更可控的方式在容器之間共享環境變數。</p></div><blockquote><p>詳情可參考官方的 <a href="https://docs.docker.com/compose/compose-file/#links" target="_blank" rel="noopener">Compose file version 3 reference | Docker Documentation</a> 文件。</p></blockquote><h2 id="Multi-host-networking"><a class="header-anchor" href="#Multi-host-networking"></a>Multi-host networking</h2><div class="info"><p>注意：本節中的說明只適用於 <a href="https://docs.docker.com/compose/swarm/" target="_blank" rel="noopener">legacy Docker Swarm</a> 的相關操作，並且只有目標為 legacy Swarm 叢集才有用。有關將 compose 專案部署至較新的整合 swarm mode，請參考<a href="https://docs.docker.com/compose/bundles/" target="_blank" rel="noopener">Docker Stacks</a> 文件。</p></div><p>將 <a href="https://docs.docker.com/compose/swarm/" target="_blank" rel="noopener">Compose 應用程式部署至 Swarm 叢集</a> 時，可以使用內建的 <code>overlay</code> driver 在容器之間啟用 multi-host 通訊，而無需更改 Compose 檔案或應用程式的程式碼。</p><p>想了解如何設定 Swarm 叢集可參考官方的 <a href="https://docs.docker.com/network/overlay-standalone.swarm/" target="_blank" rel="noopener">Multi-host networking</a> 這篇。叢集預設是使用 <code>overlay</code> driver，不過也可以參考下一節指定其他 driver。</p><h2 id="指定自定-network"><a class="header-anchor" href="#指定自定-network"></a>指定自定 network</h2><p>若不想使用預設的 app network，可以使用 <a href="https://docs.docker.com/compose/compose-file/#network-configuration-reference" target="_blank" rel="noopener">top-level <code>networks</code> key</a> 來指定自己的 network，讓你可以建立更複雜的拓撲，並指定 <a href="https://docs.docker.com/engine/extend/plugins_network/" target="_blank" rel="noopener">custom network driver</a> 和 option。還可以使用它，將 service 連接到不由 Compose 管理，而是由外部建立的 network。</p><p>每個 service 都可以使用 <a href="https://docs.docker.com/compose/compose-file/#networks" target="_blank" rel="noopener">service-level <code>networks</code> key</a> 指定要連接的 network，該 key 是引用至 <a href="https://docs.docker.com/compose/compose-file/#network-configuration-reference" target="_blank" rel="noopener">top-level <code>networks</code> key</a> 下的名稱。</p><p>以下面定義的兩個自定 network 的 Compose 檔案為例，<code>proxy</code> service 與 <code>db</code> service 隔離，因為它們不共享共同的 network，只有 <code>app</code> 可以與兩者溝通：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3'</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">proxy:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">./proxy</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">frontend</span><br>  <span class="hljs-attr">app:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">./app</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">frontend</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">frontend:</span><br>    <span class="hljs-comment"># Use a custom driver</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">custom-driver-1</span><br>  <span class="hljs-attr">backend:</span><br>    <span class="hljs-comment"># Use a custom driver which takes special options</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">custom-driver-2</span><br>    <span class="hljs-attr">driver_opts:</span><br>      <span class="hljs-attr">foo:</span> <span class="hljs-string">'1'</span><br>      <span class="hljs-attr">bar:</span> <span class="hljs-string">'2'</span><br></code></pre></td></tr></table></figure><p>通過為每個連接 (attached) 的 network 設定 <a href="https://docs.docker.com/compose/compose-file/#ipv4_address-ipv6_address" target="_blank" rel="noopener"><code>ipv4_address</code> 和/或 <code>ipv6_address</code></a>，可以為 network 設定靜態 IP 位址。</p><h2 id="設定-default-network"><a class="header-anchor" href="#設定-default-network"></a>設定 default network</h2><p>透過在 top-level <code>networks</code> key 內，名為 <code>default</code> network 下定義 entry，來更改應用程序範圍 (app-wide) 的 default network 的設定：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3'</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">'8000:8000'</span><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">default:</span><br>    <span class="hljs-comment"># Use a custom driver</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">custom-driver-1</span><br></code></pre></td></tr></table></figure><h2 id="使用-pre-existing-network"><a class="header-anchor" href="#使用-pre-existing-network"></a>使用 pre-existing network</h2><p>如果希望容器加入預先定義好的 network，就可以使用 <code>external</code> option。</p><p>如果 <code>external</code> 設為 <code>true</code>，就會指定已在 Compose 之外先建立的那個 network，所以 <code>docker-compose up</code> 不會嘗試建立此 network。</p><p>如果此 network 不存在，會因為找不到參考的目標 network 而發生錯誤。錯誤如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> docker-compose up</span><br>ERROR: Network my_network declared as external, but could be found. Please create the network manually using `docker network create my_network` and try again.<br></code></pre></td></tr></table></figure><p>如果找不到此 network，可以執行 <code>docker network create [network_name]</code> 來建立 network。</p><p>在 Compose v3.3 以及更舊版的檔案格式下，<code>external</code> 不能跟其他 network configuration keys 一起使用，包括：<code>driver</code>、<code>driver_opts</code>、<code>ipam</code> 和 <code>internal</code> 。Compose <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34" target="_blank" rel="noopener">v3.4</a> 以及更新版的格式就沒有這個限制。</p><p>下面範例的 Compose 會找到名為 <code>my-network-name</code> 的已存在的 network，並將應用程式的容器連接到該 network，這樣就不會嘗試建立一個名為 <code>[projectname]_default</code> 的 network：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.7"</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">app:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">whatever</span><br>  <span class="hljs-attr">networks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">my-network</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">my-network:</span><br>    <span class="hljs-attr">external:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">my-network-name</span><br></code></pre></td></tr></table></figure><p>在下面範例中，<code>proxy</code> 是通往外部世界的 gateway，所以不需要建立一個名為 <code>[projectname]_outside</code> 的 network。Compose 會找到一個名為 <code>outside</code> 的已存在的 network，並將 <code>proxy</code> service 的容器連接到 <code>outside</code> network。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.7"</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">proxy:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">./proxy</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">outside</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">default</span><br>  <span class="hljs-attr">app:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">./app</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">default</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">outside:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>下面範例的 Compose 不會嘗試建立一個名為 <code>[projectname]_default</code> 的 network，Compose 會找到名為 <code>my-pre-existing-network</code> 的 network，並將應用程式的容器連接到該 network。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.7"</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">default:</span><br>    <span class="hljs-attr">external:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">my-pre-existing-network</span><br></code></pre></td></tr></table></figure><div class="info"><p><code>external.name</code> 在 <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-35" target="_blank" rel="noopener">Compose v3.5 檔案格式</a> 中已被棄用，請改用同版本新增的 <code>name</code>，下一節會說明。</p></div><h2 id="自訂-network-名稱"><a class="header-anchor" href="#自訂-network-名稱"></a>自訂 network 名稱</h2><p>network 也可以自訂名稱，<code>name</code> 屬性可引用包含特殊字元的 network。</p><p>下面以這個 Compose 為例，介紹如何自訂 network 名稱：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.5'</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">app:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">whatever</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">my-network</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">my-network:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">my-app-network</span><br></code></pre></td></tr></table></figure><p>在 <a href="https://docs.docker.com/compose/compose-file/#network-configuration-reference" target="_blank" rel="noopener">top-level <code>networks</code> key</a></p><ol><li>先把 Compose 裡面的 <code>version</code> 改成 3.5 以上，因為在 v3.5 版才開始提供自訂 network 名稱 (也就是增加 <code>name</code> 屬性)</li><li>在 <a href="https://docs.docker.com/compose/compose-file/#networks" target="_blank" rel="noopener">service-level <code>networks</code> key</a> 裡面 (也就是自訂的 service 內的 <code>networks</code> )，加入自訂的 network 名稱 (此範例為 <code>my-network</code> )</li><li>network 的詳細定義是寫在 <a href="https://docs.docker.com/compose/compose-file/#network-configuration-reference" target="_blank" rel="noopener">top-level <code>networks</code> key</a> (也就是通常寫在檔案最後面的 <code>networks</code> ) 裡面。這裡的 network 名稱要和 service-level <code>networks</code> key 裡面自訂的名稱對應 (也就是 <code>my-network</code> 這個 network 名稱要和上面 <code>services</code> 內的一樣)，在 <code>my-network</code> 下面就可以使用 <code>name</code> 屬性來自定 network 名稱 ( <code>my-app-network</code> 就是你真正自訂的 network 名稱 )</li></ol><blockquote><p>詳情可參考官方的 <a href="https://docs.docker.com/compose/compose-file/#name-1" target="_blank" rel="noopener">Compose file version 3 reference | Docker Documentation</a> 文件。</p></blockquote><p>也可以與 <code>external</code> 屬性一起使用：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.7"</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">network1:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">my-app-network</span><br></code></pre></td></tr></table></figure><h2 id="參考來源"><a class="header-anchor" href="#參考來源"></a>參考來源</h2><ul><li><a href="https://docs.docker.com/compose/networking" target="_blank" rel="noopener">Networking in Compose | Docker Documentation</a></li><li><a href="https://docs.docker.com/compose/compose-file" target="_blank" rel="noopener">Compose file version 3 reference | Docker Documentation</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Container </tag>
            
            <tag> Docker Compose </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 GCP 建立 Network Load Balancer 和 HTTP Load Balancer</title>
      <link href="/article/gcp-network-and-http-load-balancer.html"/>
      <url>/article/gcp-network-and-http-load-balancer.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/gcp.jpg" alt=""></p><p>本篇是紀錄在 Google 的 Qwiklab 平台內，完成「<a href="https://www.qwiklabs.com/focuses/558?parent=catalog" target="_blank" rel="noopener">Set Up Network and HTTP Load Balancers</a>」這個 quest 所學到的內容，包括如何建立多個 web server instance，以及如何建立 network load balancer 和 HTTP load balancer。</p><a id="more"></a><p><img src="../images/gcp-network-and-http-load-balancer/2019-04-24-22-19-00.png" alt=""></p><p>在此 lab 中，你將了解 network load balancer 和 HTTP load balancer 之間的差異，以及如何為 Google Compute Engine (GCE) VM 上執行的應用程式設定 load balancer。</p><p>你可通過多種方式<a href="https://cloud.google.com/load-balancing/docs/load-balancing-overview#a_closer_look_at_cloud_load_balancers" target="_blank" rel="noopener">在 GCP 內進行負載平衡 (load balance)</a>。此 lab 將教你完成以下 load balancer 的設定：</p><ul><li>L3 (Network Layer) <a href="https://cloud.google.com/compute/docs/load-balancing/network/" target="_blank" rel="noopener">Network Load Balancer</a></li><li>L7 (Application Layer) <a href="https://cloud.google.com/compute/docs/load-balancing/http/" target="_blank" rel="noopener">HTTP(s) Load Balancer</a></li></ul><h2 id="本篇將會做什麼？"><a class="header-anchor" href="#本篇將會做什麼？"></a>本篇將會做什麼？</h2><ul><li>設定 network load balancer</li><li>設定 HTTP load balancer</li><li>透過實作，了解 network load balancer 和 HTTP load balancer 之間的差異</li></ul><h2 id="準備"><a class="header-anchor" href="#準備"></a>準備</h2><p>在點擊「Start Lab」之前，準備好網路瀏覽器 (推薦用 Google Chrome)，並且至少 40 分鐘可以專注的時間，因為 lab 是有時間限制，當你按下「Start Lab」開始學習時，無法暫停倒數計時，你只能在這段時間內使用 lab 提供給你的全新暫時 GCP Console 可用帳號，時間到之後的幾分鐘就會自動登出。</p><div class="warning"><p>注意：如果你有自己的個人 GCP 帳號或專案，請不要在此 lab 使用</p></div><h2 id="開始你的-Lab，然後登入-GCP-Console"><a class="header-anchor" href="#開始你的-Lab，然後登入-GCP-Console"></a>開始你的 Lab，然後登入 GCP Console</h2><ol><li>如果準備要開始，可以點擊右上角的「Start Lab」開始：</li></ol><p><img src="../images/getting-started-with-cloud-shell-gcloud-and-gsutil/2019-04-16-00-25-52.png" alt=""></p><ol start="2"><li>接著會出現這個畫面，因為我參加 <a href="https://www.facebook.com/events/2005848903055499/" target="_blank" rel="noopener">GDG Tainan</a> 的活動，活動有提供 Qwiklabs 一個月的免費額度，所以我點選下圖左邊的「Use Subscription」：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-21-15.png" alt=""></p><ol start="3"><li>Lab 會提供給你免費暫時的 GCP 帳號，複製帳號和密碼，然後點擊「Open Google Console」開啟 <a href="https://cloud.google.com/storage/docs/cloud-console" target="_blank" rel="noopener">GCP Console</a>：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-15-33-31.png" alt=""></p><p>圖片來源：<a href="https://www.qwiklabs.com/focuses/3563?parent=catalog" target="_blank" rel="noopener">Creating a Virtual Machine | Qwiklabs</a></p><ol start="4"><li>接著就會開啟登入頁面，建議另外開 Chrome 無痕模式來登入 lab 提供的帳號和密碼，因為 Chrome 會紀錄帳密，現在登入的只是暫時帳號，未來不需要用到：</li></ol><div class="warning"><p>注意：這邊是登入 lab 提供的帳號 (也就是 email 必須為 <code>googlexxxxxx_student@qwiklabs.net</code> )，如果你有自己的 GCP 帳號，請不要用於此 lab，避免產生費用</p><blockquote><p>類似於 <code>googlexxxxxx_student@qwiklabs.net</code> 的帳號是一個 Google 帳號，專為 Qwiklabs 學生使用而建立的。它具有特定的域名 (也就是 <code>qwiklabs.net</code> )，並且已分配了 IAM 角色，允許你去存取該 GCP 專案。</p></blockquote></div><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-22-30.png" alt=""></p><ol start="5"><li>接受 terms 和 conditions：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-22-59.png" alt=""></p><ol start="6"><li>不要新增 recovery options 或 two-factor authentication (因為這是一個臨時帳號)：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-23-18.png" alt=""></p><ol start="7"><li>勾選同意服務條款：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-24-15.png" alt=""></p><p>之後就可以開始使用 GCP Console 囉：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-14-14-23-55.png" alt=""></p><h2 id="啟動-Google-Cloud-Shell"><a class="header-anchor" href="#啟動-Google-Cloud-Shell"></a>啟動 Google Cloud Shell</h2><p>Google Cloud Shell 是載入了開發工具的 VM，它提供 5GB 的 home 目錄，並在 Google Cloud 上執行。可用 Google Cloud Shell 提供的 command-line 來存取 GCP 的資源。</p><ol><li>在 GCP console 的右上方工具列中，點擊「Activate Cloud Shell」按鈕：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-24-42.png" alt=""></p><ol start="2"><li>在打開的對話框內，點擊「START CLOUD SHELL」：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-25-23.png" alt=""></p><ol start="3"><li>連接和提供環境需要一些時間：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-26-05.png" alt=""></p><ol start="4"><li>連接後，就代表你已經過身份驗證，專案已設置為 <code>PROJECT_ID</code>，以下圖的為例，此專案的 ID 為 <code>qwiklabs-gcp-f9d61ede8167e6b0</code>：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-26-34.png" alt=""></p><p><code>gcloud</code> 是 GCP 的 command-line 工具，他已預先安裝在 Cloud Shell 上，並且支援 tab 自動補齊 (tab-completion)。</p><p>使用下面指令可列出有效帳號名稱：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud auth list</span><br>          Credentialed Accounts<br>ACTIVE  ACCOUNT<br>*       google3043863_student@qwiklabs.net<br><br>To set the active account, run:<br>    $ gcloud config set account `ACCOUNT`<br></code></pre></td></tr></table></figure><p>可以使用以下指令列出專案 ID：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config list project</span><br>[core]<br>project = qwiklabs-gcp-f9d61ede8167e6b0<br><br>Your active configuration is: [cloudshell-9292]<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/sdk/gcloud/" target="_blank" rel="noopener">Google Cloud gcloud Overview</a> 文件。</p></blockquote><h2 id="為所有資源設定預設的-region-和-zone"><a class="header-anchor" href="#為所有資源設定預設的-region-和-zone"></a>為所有資源設定預設的 region 和 zone</h2><p>在 Cloud Shell 中，執行以下指令設定預設 zone 為 <code>us-central1-a</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config <span class="hljs-built_in">set</span> compute/zone us-central1<span class="hljs-_">-a</span></span><br>Updated property [compute/zone].<br></code></pre></td></tr></table></figure><p>在 Cloud Shell 中，執行以下指令設定預設 region 為 <code>us-central1</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config <span class="hljs-built_in">set</span> compute/region us-central1</span><br>Updated property [compute/region].<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/compute/docs/regions-zones/" target="_blank" rel="noopener">Regions &amp; Zones</a> 文件。</p></blockquote><div class="info"><p>注意：在自己的機器上執行 <code>gcloud</code> 時，<code>config</code> 設定在 session 中保持不變 (persist across)。在 Cloud Shell 中，你需要為每個新的 session 或重新連接設定此項。</p></div><h2 id="建立多個-web-server-instance"><a class="header-anchor" href="#建立多個-web-server-instance"></a>建立多個 web server instance</h2><p>為了模擬來至一個叢集主機的服務，請使用 <a href="https://cloud.google.com/compute/docs/instance-templates" target="_blank" rel="noopener">Instance Templates</a> 和 <a href="https://cloud.google.com/compute/docs/instance-groups/" target="_blank" rel="noopener">Managed Instance Groups</a> 建立一個簡單的 Nginx web server 叢集來提供靜態內容。Instance Templates 定義叢集中每個 VM 的規格 (硬碟、CPU、記憶體…等)，Managed Instance Groups 使用 Instance Templates 實例化 (instantiate) 多個 VM instance。</p><p>要建立一個 Nginx web server 叢集，請建立以下內容：</p><ul><li>一個用來在每個 VM instance 啟動時設定 Nginx server 的 startup script</li><li>一個要使用 startup script 的 instance template</li><li>一個 target pool</li><li>一個使用 instance template 的 managed instance group</li></ul><h3 id="建立-startup-script"><a class="header-anchor" href="#建立-startup-script"></a>建立 startup script</h3><p>在 Cloud Shell 執行下面指令，建立要讓每個 VM instance 使用的 startup script。此 script 會在啟動時設定 Nginx server：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">cat &lt;&lt; EOF &gt; startup.sh<br><span class="hljs-meta">#! /bin/bash</span><br>apt-get update<br>apt-get install -y nginx<br>service nginx start<br>sed -i -- <span class="hljs-string">'s/nginx/Google Cloud Platform - '</span><span class="hljs-string">"\$HOSTNAME"</span><span class="hljs-string">'/'</span> /var/www/html/index.nginx-debian.html<br>EOF<br></code></pre></td></tr></table></figure><h3 id="建立-instance-template"><a class="header-anchor" href="#建立-instance-template"></a>建立 instance template</h3><p>建立一個使用 startup script 的 instance template：</p><ul><li><code>nginx-template</code>：instance template 的名稱</li><li><code>--metadata-from-file startup-script=startup.sh</code>：<code>--metadata-from-file</code> 參數會從 local 檔案中找到指定的 startup script</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute instance-templates create nginx-template \</span><br>         --metadata-from-file startup-script=startup.sh<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-.../global/instanceTemplates/nginx-template].<br>NAME            MACHINE_TYPE   PREEMPTIBLE  CREATION_TIMESTAMP<br>nginx-template  n1-standard-1               2019-04-22T04:53:53.045-07:00<br></code></pre></td></tr></table></figure><p>如果上面指令沒有提供明確的 template 設定，<code>gcloud compute</code> 會使用以下預設值建立 template：</p><ul><li>機型：<code>n1-standard-1</code></li><li>image：最新版的 Debian image</li><li>開機磁碟：以 instance 命名的新標準開機磁碟</li><li>網路：<code>default</code> VPC 網路</li><li>IP 位址：臨時的外部 IP 位址</li></ul><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/sdk/gcloud/reference/compute/instance-templates/" target="_blank" rel="noopener"><code>gcloud compute instance-templates</code></a> 文件。</p></blockquote><blockquote><p>若想了解更多建立 instance template 的方法，詳情可參考官方的 <a href="https://cloud.google.com/compute/docs/instance-templates/create-instance-templates" target="_blank" rel="noopener">Creating Instance Templates</a> 文件。</p></blockquote><h3 id="建立-target-pool"><a class="header-anchor" href="#建立-target-pool"></a>建立 target pool</h3><p>target pool 資源定義了一組可以從 forwarding rules 接收收到流量的 instance。當 forwarding rules 將流量導向到 target pool 時，Google Cloud Load Balancing 會根據 source IP 和 port 以及目標 IP 和 port 的 hash 值，從這些 target pool 中選擇一個 instance。</p><p>建立 target pool，target pool 允許單個存取點到群組中的所有 instance，而且對於之後步驟的負載平衡來說是必需的：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute target-pools create nginx-pool</span><br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-.../regions/us-central1/targetPools/nginx-pool].<br>NAME        REGION       SESSION_AFFINITY  BACKUP  HEALTH_CHECKS<br>nginx-pool  us-central1  NONE<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考官方文件：</p><ul><li>建立 target pool 指令：<a href="https://cloud.google.com/sdk/gcloud/reference/compute/target-pools/create" target="_blank" rel="noopener"><code>gcloud compute target-pools create</code></a></li><li><a href="https://cloud.google.com/load-balancing/docs/network/" target="_blank" rel="noopener">Network Load Balancing Concepts</a></li><li><a href="https://cloud.google.com/load-balancing/docs/target-pools" target="_blank" rel="noopener">Using Target Pools</a></li></ul></blockquote><h3 id="建立-managed-instance-group"><a class="header-anchor" href="#建立-managed-instance-group"></a>建立 managed instance group</h3><p>使用 instance template 建立 managed instance group：</p><ul><li><code>nginx-group</code>：instance group 的名稱</li><li><code>--base-instance-name nginx</code>：其中的 <code>nginx</code> 是指在此 managed instance group 中建立的 instance 使用的名稱。由於這些 instance 都一樣，系統會用隨機字串來作為 instance 名稱的一部分，例如：如果 base 名稱是 <code>nginx</code>，instance 的名稱就可能會是 <code>nginx-cl3t</code>、<code>nginx-sqgw</code> … 等</li><li><code>--size 2</code>：instance group 的大小</li><li><code>--template nginx-template</code>：用於此群組的 instance template 的名稱</li><li><code>--target-pool nginx-pool</code>：要新增此 instance group 的 target pool 的名稱 (可多個 target pool)</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute instance-groups managed create nginx-group \</span><br>         --base-instance-name nginx \<br>         --size 2 \<br>         --template nginx-template \<br>         --target-pool nginx-pool<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-.../zones/us-central1-a/instanceGroupManagers/nginx-group].<br>NAME         LOCATION       SCOPE  BASE_INSTANCE_NAME  SIZE  TARGET_SIZE  INSTANCE_TEMPLATE  AUTOSCALED<br>nginx-group  us-central1-a  zone   nginx               0     2            nginx-template     no<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/compute/docs/instance-groups/creating-groups-of-managed-instances" target="_blank" rel="noopener">Creating groups of managed instances</a> 文件。</p></blockquote><p>執行上面的指令後，會建立兩個 VM instance，名稱會以 <code>nginx-</code> 為前綴，可能需要等幾分鐘。</p><p>接著查看已建立的所有 compute engine instance：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute instances list</span><br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME        ZONE           MACHINE_TYPE   PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP     STATUS<br>nginx-cl3t  us-central1-a  n1-standard-1               10.128.0.3   35.193.149.246  RUNNING<br>nginx-sqgw  us-central1-a  n1-standard-1               10.128.0.2   130.211.208.12  RUNNING<br></code></pre></td></tr></table></figure><h3 id="設定防火牆"><a class="header-anchor" href="#設定防火牆"></a>設定防火牆</h3><p>設定防火牆後，就可以透過 <code>EXTERNAL_IP</code> 位址和 80 port 來連接機器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute firewall-rules create www-firewall --allow tcp:80</span><br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">Creating firewall...⠛Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-.../global/firewalls/www-firewall].<br>Creating firewall...done.<br>NAME          NETWORK  DIRECTION  PRIORITY  ALLOW   DENY  DISABLED<br>www-firewall  default  INGRESS    1000      tcp:80        False<br></code></pre></td></tr></table></figure><p>執行上面的指令後，應該就能透過外部 IP 位址 (也就是 <code>http://EXTERNAL_IP/</code> ) 來連接剛剛建立的兩個 instance，可以在各別的頁面中，看到各個 instance 的名稱：</p><p><img src="../images/gcp-network-and-http-load-balancer/2019-04-22-20-01-58.png" alt=""></p><p><img src="../images/gcp-network-and-http-load-balancer/2019-04-22-20-02-42.png" alt=""></p><h2 id="建立-Network-Load-Balancer"><a class="header-anchor" href="#建立-Network-Load-Balancer"></a>建立 Network Load Balancer</h2><p>Network load balancing 允許你依據收到的 IP 協定資料 (例如：位址、port 和協定類型) 來平衡系統的負載。你還可以取得 HTTP(S) load balancing 沒有提供的一些選項。例如：可以對其他基於 TCP/UDP 的協定 (例如：SMTP 流量) 進行負載平衡。如果你的應用程式對 TCP 連接相關的特性感興趣，network load balancing 也允許你的應用程式去檢查封包，而 HTTP(S) load balancing 則沒有提供。</p><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/compute/docs/load-balancing/network/" target="_blank" rel="noopener">Setting Up Network Load Balancing</a> 文件。</p></blockquote><p>針對你的 instance group 來建立 L3 network load balancer：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute forwarding-rules create nginx-lb \</span><br>         --region us-central1 \<br>         --ports=80 \<br>         --target-pool nginx-pool<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-.../regions/us-central1/forwardingRules/nginx-lb].<br></code></pre></td></tr></table></figure><p>Forwarding rule 要與 target pool 一起使用，以支援 load balancing 功能，要使用 load balancing 就必須建立 forwarding rule，這樣才會將流量導向到特定的 target pool (用於 load balancing)，而下面指令中的 <code>--ports=80</code> 代表指向 target pool 的外部 port 範圍。</p><p>列出專案中所有 Google Compute Engine (GCE) 的 Forwarding rule：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute forwarding-rules list</span><br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME      REGION       IP_ADDRESS      IP_PROTOCOL  TARGET<br>nginx-lb  us-central1  35.202.173.185  TCP          us-central1/targetPools/nginx-pool<br></code></pre></td></tr></table></figure><p>接著透過 <code>http://IP_ADDRESS/</code> 來存取 load balancer，<code>IP_ADDRESS</code> 是上面執行的指令中所輸出的 IP 位址。</p><p><img src="../images/gcp-network-and-http-load-balancer/2019-04-22-20-05-28.png" alt=""></p><h2 id="建立-HTTP-S-Load-Balancer"><a class="header-anchor" href="#建立-HTTP-S-Load-Balancer"></a>建立 HTTP(S) Load Balancer</h2><p>HTTP(S) Load Balancing 提供全球性的 load balancing，能將 HTTP 請求送往你的 instance。你可以設定 URL 規則，將一些 URL 路由 (route) 到一組 instance，並將其他 URL 路由到其他 instance。請求都會路由到最接近使用者的 instance group，前提是該 group 具有足夠的資源，並且適合請求。如果最近的 group 沒有足夠的資源，那請求將會送至具有足夠資源，並且是最接近使用者的 group。</p><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/compute/docs/load-balancing/http/" target="_blank" rel="noopener">HTTP(S) Load Balancer</a> 文件。</p></blockquote><p>首先，建立 <a href="https://cloud.google.com/compute/docs/load-balancing/health-checks" target="_blank" rel="noopener">health check</a>。health check 可以確認 instance 是否有回應 HTTP 或 HTTPS 流量，其他的 <code>http-basic-check</code> 是 legacy health check 的名稱。在專案中，每個 legacy health check 的名稱不能重複：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute http-health-checks create http-basic-check</span><br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-.../global/httpHealthChecks/http-basic-check].<br>NAME              HOST  PORT  REQUEST_PATH<br>http-basic-check        80    /<br></code></pre></td></tr></table></figure><p>定義 HTTP service，並將 port 號 map 到 instance group 的相關 port。現在 load balancing service 可以將流量 forward 到指定的 port 號：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute instance-groups managed \</span><br>       set-named-ports nginx-group \<br>       --named-ports http:80<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Updated [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-.../zones/us-central1-a/instanceGroups/nginx-group].<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/compute/docs/instance-groups/creating-groups-of-managed-instances" target="_blank" rel="noopener">Creating groups of managed instances</a> 文件。</p></blockquote><p>建立 <a href="https://cloud.google.com/compute/docs/reference/latest/backendServices" target="_blank" rel="noopener">後端服務 (backend service)</a>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute backend-services create nginx-backend \</span><br>      --protocol HTTP \<br>      --http-health-checks http-basic-check \<br>      --global<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-.../global/backendServices/nginx-backend].<br>NAME           BACKENDS  PROTOCOL<br>nginx-backend            HTTP<br></code></pre></td></tr></table></figure><p>將 instance group 加到後端服務中：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute backend-services add-backend nginx-backend \</span><br>    --instance-group nginx-group \<br>    --instance-group-zone us-central1-a \<br>    --global<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Updated [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-.../global/backendServices/nginx-backend].<br></code></pre></td></tr></table></figure><p>建立一個預設的 URL map，將所有收到的請求導向你的所有 instance：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute url-maps create web-map \</span><br>    --default-service nginx-backend<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-.../global/urlMaps/web-map].<br>NAME     DEFAULT_SERVICE<br>web-map  backendServices/nginx-backend<br></code></pre></td></tr></table></figure><blockquote><p>若要根據請求的 URL 將流量導向不同的 instance，詳情可參考官方的 <a href="https://cloud.google.com/compute/docs/load-balancing/http/content-based-example" target="_blank" rel="noopener">content-based routing</a> 文件。</p></blockquote><p>建立 target HTTP proxy，將請求路由到 URL map：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute target-http-proxies create http-lb-proxy \</span><br>    --url-map web-map<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-.../global/targetHttpProxies/http-lb-proxy].<br>NAME           URL_MAP<br>http-lb-proxy  web-map<br></code></pre></td></tr></table></figure><p>建立 <a href="https://cloud.google.com/load-balancing/docs/https/global-forwarding-rules" target="_blank" rel="noopener">global forwarding rule</a>，以處理和路由收到的請求。forwarding rule 會根據指定的 IP 位址、IP 協定和 port，將流量送至特定的 target HTTP 或 HTTPS proxy。global forwarding rule 不支援多 port。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute forwarding-rules create http-content-rule \</span><br>        --global \<br>        --target-http-proxy http-lb-proxy \<br>        --ports 80<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-.../global/forwardingRules/http-content-rule].<br></code></pre></td></tr></table></figure><p>建立 global forwarding rule 後，設定可能需要幾分鐘才能傳播 (propagate)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute forwarding-rules list</span><br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME               REGION       IP_ADDRESS      IP_PROTOCOL  TARGET<br>http-content-rule               34.96.77.47     TCP          http-lb-proxy<br>nginx-lb           us-central1  35.202.173.185  TCP          us-central1/targetPools/nginx-pool<br></code></pre></td></tr></table></figure><p>複製 forwarding rule 內的 <code>http-content-rule</code> 中的 <code>IP_ADDRESS</code>。</p><p>你可能需要幾分鐘才能透過瀏覽器連接到 <code>http://IP_ADDRESS/</code>。如果無法連接 (就像下圖這樣)，請稍等一下，再重新整理瀏覽器：</p><p><img src="../images/gcp-network-and-http-load-balancer/2019-04-22-20-15-02.png" alt=""></p><p>下面兩張圖就是多次連接 <code>http://IP_ADDRESS/</code> 的時候，常會看到畫面在這兩個之前建立的 VM instance 間切換：</p><p><img src="../images/gcp-network-and-http-load-balancer/2019-04-22-20-16-47.png" alt=""></p><p><img src="../images/gcp-network-and-http-load-balancer/2019-04-22-20-17-26.png" alt=""></p><h2 id="參考來源"><a class="header-anchor" href="#參考來源"></a>參考來源</h2><ul><li><a href="https://www.qwiklabs.com/focuses/558?parent=catalog" target="_blank" rel="noopener">Set Up Network and HTTP Load Balancers</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GCP </tag>
            
            <tag> HTTP </tag>
            
            <tag> Load Balancer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Google Kubernetes Engine (GKE) 入門</title>
      <link href="/article/getting-started-with-google-k8s-engine.html"/>
      <url>/article/getting-started-with-google-k8s-engine.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/gke.jpg" alt=""></p><p>本篇是紀錄在 Google 的 Qwiklab 平台內，完成「<a href="https://www.qwiklabs.com/focuses/878?parent=catalog" target="_blank" rel="noopener">Kubernetes Engine: Qwik Start</a>」這個 quest 所學到的內容，包括如何透過 GKE 建立容器和部署容器化應用程式。</p><a id="more"></a><p><img src="../images/getting-started-with-google-k8s-engine/2019-04-18-23-36-15.png" alt=""></p><p><a href="https://cloud.google.com/kubernetes-engine/" target="_blank" rel="noopener">Google Kubernetes Engine</a> (GKE) 提供了一個代管環境，可以使用 Google 基礎架構來部署、管理和擴展容器化應用程式。GKE 提供的環境是由多台機器 (特別是 <a href="https://cloud.google.com/compute" target="_blank" rel="noopener">Google Compute Engine</a> instance) 組成，組成一個<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-architecture" target="_blank" rel="noopener">容器叢集</a>。在此 lab 中，你將透過 GKE 來實際練習如何建立容器和部署應用程式。</p><h2 id="GKE-的叢集編排管理-orchestration"><a class="header-anchor" href="#GKE-的叢集編排管理-orchestration"></a>GKE 的叢集編排管理 (orchestration)</h2><p>GKE 叢集是由 <a href="https://kubernetes.io/" target="_blank" rel="noopener">Kubernetes</a> 開源叢集管理系統提供技術支援。你可以透過 Kubernetes 提供的機制與容器叢集互動。可以使用 Kubernetes 指令和資源來部署以及管理應用程式、執行管理任務、制訂政策，以及監控已部署工作負載 (workload) 的健康狀態。</p><p>Kubernetes 採用相同的設計原則來執行常用的 Google 服務，並提供相同的優勢：應用程序容器的自動管理、監控與有效性探測 (liveness probe)、自動擴展，滾動升級…等。當您在容器叢集上執行應用程序時，你所使用的技術是由 Google 在容器中執行 production 工作負載的十餘年經驗的技術。</p><h2 id="GCP-上的-Kubernetes"><a class="header-anchor" href="#GCP-上的-Kubernetes"></a>GCP 上的 Kubernetes</h2><p>執行 GKE 叢集時，你也可以獲得 GCP 所提供的進階叢集管理功能優點，其中包括：</p><ul><li>Google Compute Engine (GCE) instances 提供的<a href="https://cloud.google.com/compute/docs/load-balancing-and-autoscaling" target="_blank" rel="noopener">負載平衡</a></li><li><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/node-pools" target="_blank" rel="noopener">節點池 (Node Pools)</a> 可以指定叢集中的子集節點，以獲得額外的靈活性</li><li><a href="https://cloud.google.com/kubernetes-engine/docs/cluster-autoscaler" target="_blank" rel="noopener">自動擴展 (Automatic scaling)</a> 叢集的節點 instance 數量</li><li><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/node-auto-upgrades" target="_blank" rel="noopener">自動升級</a>叢集的節點軟體</li><li><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/node-auto-repair" target="_blank" rel="noopener">自動修復節點</a>：可維護節點的健康狀態和可用性</li><li>使用 Stackdriver 來<a href="https://cloud.google.com/kubernetes-engine/docs/how-to/logging" target="_blank" rel="noopener">記錄 (logging)</a> 和<a href="https://cloud.google.com/kubernetes-engine/docs/how-to/monitoring" target="_blank" rel="noopener">監控</a>，用於查看叢集的狀態</li></ul><h2 id="準備"><a class="header-anchor" href="#準備"></a>準備</h2><p>在點擊「Start Lab」之前，準備好網路瀏覽器 (推薦用 Google Chrome)，並且至少 40 分鐘可以專注的時間，因為 lab 是有時間限制，當你按下「Start Lab」開始學習時，無法暫停倒數計時，你只能在這段時間內使用 lab 提供給你的全新暫時 GCP Console 可用帳號，時間到之後的幾分鐘就會自動登出。</p><div class="warning"><p>注意：如果你有自己的個人 GCP 帳號或專案，請不要在此 lab 使用</p></div><h2 id="開始你的-Lab，然後登入-GCP-Console"><a class="header-anchor" href="#開始你的-Lab，然後登入-GCP-Console"></a>開始你的 Lab，然後登入 GCP Console</h2><ol><li>如果準備要開始，可以點擊右上角的「Start Lab」開始：</li></ol><p><img src="../images/getting-started-with-cloud-shell-gcloud-and-gsutil/2019-04-16-00-25-52.png" alt=""></p><ol start="2"><li>接著會出現這個畫面，因為我參加 <a href="https://www.facebook.com/events/2005848903055499/" target="_blank" rel="noopener">GDG Tainan</a> 的活動，活動有提供 Qwiklabs 一個月的免費額度，所以我點選下圖左邊的「Use Subscription」：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-21-15.png" alt=""></p><ol start="3"><li>Lab 會提供給你免費暫時的 GCP 帳號，複製帳號和密碼，然後點擊「Open Google Console」開啟 <a href="https://cloud.google.com/storage/docs/cloud-console" target="_blank" rel="noopener">GCP Console</a>：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-15-33-31.png" alt=""></p><p>圖片來源：<a href="https://www.qwiklabs.com/focuses/3563?parent=catalog" target="_blank" rel="noopener">Creating a Virtual Machine | Qwiklabs</a></p><ol start="4"><li>接著就會開啟登入頁面，建議另外開 Chrome 無痕模式來登入 lab 提供的帳號和密碼，因為 Chrome 會紀錄帳密，現在登入的只是暫時帳號，未來不需要用到：</li></ol><div class="warning"><p>注意：這邊是登入 lab 提供的帳號 (也就是 email 必須為 <code>googlexxxxxx_student@qwiklabs.net</code> )，如果你有自己的 GCP 帳號，請不要用於此 lab，避免產生費用</p><blockquote><p>類似於 <code>googlexxxxxx_student@qwiklabs.net</code> 的帳號是一個 Google 帳號，專為 Qwiklabs 學生使用而建立的。它具有特定的域名 (也就是 <code>qwiklabs.net</code> )，並且已分配了 IAM 角色，允許你去存取該 GCP 專案。</p></blockquote></div><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-22-30.png" alt=""></p><ol start="5"><li>接受 terms 和 conditions：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-22-59.png" alt=""></p><ol start="6"><li>不要新增 recovery options 或 two-factor authentication (因為這是一個臨時帳號)：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-23-18.png" alt=""></p><ol start="7"><li>勾選同意服務條款：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-24-15.png" alt=""></p><p>之後就可以開始使用 GCP Console 囉：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-14-14-23-55.png" alt=""></p><h2 id="啟動-Google-Cloud-Shell"><a class="header-anchor" href="#啟動-Google-Cloud-Shell"></a>啟動 Google Cloud Shell</h2><p>Google Cloud Shell 是載入了開發工具的 VM，它提供 5GB 的 home 目錄，並在 Google Cloud 上執行。可用 Google Cloud Shell 提供的 command-line 來存取 GCP 的資源。</p><ol><li>在 GCP console 的右上方工具列中，點擊「Activate Cloud Shell」按鈕：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-24-42.png" alt=""></p><ol start="2"><li>在打開的對話框內，點擊「START CLOUD SHELL」：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-25-23.png" alt=""></p><ol start="3"><li>連接和提供環境需要一些時間：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-26-05.png" alt=""></p><ol start="4"><li>連接後，就代表你已經過身份驗證，專案已設置為 <code>PROJECT_ID</code>，以下圖的為例，此專案的 ID 為 <code>qwiklabs-gcp-f9d61ede8167e6b0</code>：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-26-34.png" alt=""></p><p><code>gcloud</code> 是 GCP 的 command-line 工具，他已預先安裝在 Cloud Shell 上，並且支援 tab 自動補齊 (tab-completion)。</p><p>使用下面指令可列出有效帳號名稱：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud auth list</span><br>          Credentialed Accounts<br>ACTIVE  ACCOUNT<br>*       google3043863_student@qwiklabs.net<br><br>To set the active account, run:<br>    $ gcloud config set account `ACCOUNT`<br></code></pre></td></tr></table></figure><p>可以使用以下指令列出專案 ID：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config list project</span><br>[core]<br>project = qwiklabs-gcp-f9d61ede8167e6b0<br><br>Your active configuration is: [cloudshell-9292]<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/sdk/gcloud/" target="_blank" rel="noopener">Google Cloud gcloud Overview</a> 文件。</p></blockquote><h2 id="設定預設的-compute-zone"><a class="header-anchor" href="#設定預設的-compute-zone"></a>設定預設的 compute zone</h2><p><a href="https://cloud.google.com/compute/docs/regions-zones/#available" target="_blank" rel="noopener">compute zone</a> 是你的叢集及其資源所在的大概區域位置，例如：<code>us-central1-a</code> 是 <code>us-central1</code> region 中的一個 zone。</p><p>在 Cloud Shell 中啟用新的 session 並執行以下指令，將預設 compute zone 設為 <code>us-central1-a</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config <span class="hljs-built_in">set</span> compute/zone us-central1<span class="hljs-_">-a</span></span><br>Updated property [compute/zone].<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/managing-clusters#before_you_begin" target="_blank" rel="noopener">Managing clusters</a> 文件。</p></blockquote><h2 id="建立-GKE-叢集"><a class="header-anchor" href="#建立-GKE-叢集"></a>建立 GKE 叢集</h2><p>一個<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-architecture" target="_blank" rel="noopener">叢集</a>包含至少一個叢集主要 (master) 機器和多個稱為 node 的工作 (worker) 機器組成。node 是 <a href="https://cloud.google.com/compute/docs/instances/" target="_blank" rel="noopener">Google Compute Engine (GCE) 的 VM instance</a>，執行 Kubernetes 的必要程序 (process)，使它們成為叢集的一部分。</p><p>若要建立叢集，請執行以下指令，並將 <code>[CLUSTER-NAME]</code> 替換為自訂的叢集名稱 (例如：<code>my-cluster</code> )。叢集名稱必須以字母開頭，結尾必須是字母或數字，且不能超過 40 個字元。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud container clusters create [CLUSTER-NAME]</span><br></code></pre></td></tr></table></figure><p>你可以無視下面這些輸出內的任何警告：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">WARNING: In June 2019, node auto-upgrade will be enabled by default for newly created clusters and node pools. To disable it, use the `--no-enable-autoupgrade`flag.<br>WARNING: Starting in 1.12, new clusters will have basic authentication disabled by default. Basic authentication can be enabled (or disabled) manually using the `--[no-]enable-basic-auth` flag.<br>WARNING: Starting in 1.12, new clusters will not have a client certificate issued. You can manually enable (or disable) the issuance of the client certificate using the `--[no-]issue-client-certificate` flag.<br>WARNING: Currently VPC-native is not the default mode during cluster creation. In the future, this will become the default mode and can be disabled using `--no-enable-ip-alias` flag. Use `--[no-]enable-ip-alias` flag to suppress this warning.<br>WARNING: Starting in 1.12, default node pools in new clusters will have their legacy Compute Engine instance metadata endpoints disabled by default. To create a cluster with legacy instance metadata endpoints disabled in the default node pool, run `clusters create` with the flag `--metadata disable-legacy-endpoints=true`.<br>This will enable the autorepair feature for nodes. Please see https://cloud.google.com/kubernetes-engine/docs/node-auto-repair for more information on node autorepairs.<br>WARNING: Starting in Kubernetes v1.10, new clusters will no longer get compute-rw and storage-ro scopes added to what is specified in --scopes (though the latter will remain included in the default --scopes). To use these scopes, add them explicitly to --scopes. To use the new behavior, set container/new_scopes_behavior property (gcloud config set container/new_scopes_behavior true).<br></code></pre></td></tr></table></figure><p>建立叢集可能需要一些時間，很快應該會看到類似下面的輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME        LOCATION       MASTER_VERSION  MASTER_IP      MACHINE_TYPE   NODE_VERSION   NUM_NODES  STATUS<br>my-cluster  us-central1-a  1.11.7-gke.12   104.154.18.48  n1-standard-1  1.11.7-gke.12  3          RUNNING<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/creating-a-cluster" target="_blank" rel="noopener">Creating a cluster</a> 文件。</p></blockquote><h2 id="取得叢集的驗證憑證"><a class="header-anchor" href="#取得叢集的驗證憑證"></a>取得叢集的驗證憑證</h2><p>建立叢集後，需要取得驗證憑證 (authentication credentials) 才能操作叢集。</p><p>執行下面指定來對叢集進行驗證，將 <code>[CLUSTER-NAME]</code> 替換成叢集名成：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud container clusters get-credentials [CLUSTER-NAME]</span><br></code></pre></td></tr></table></figure><p>輸出如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">Fetching cluster endpoint and auth data.<br>kubeconfig entry generated for my-cluster.<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-access-for-kubectl" target="_blank" rel="noopener">Cluster access for kubectl</a> 文件。</p></blockquote><h2 id="將應用部署至叢集"><a class="header-anchor" href="#將應用部署至叢集"></a>將應用部署至叢集</h2><p>現在你已經建立了一個叢集，可以將<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/kubernetes-engine-overview" target="_blank" rel="noopener">容器化應用程式</a>部署到該叢集。在此 lab 中，你將在叢集中執行 <code>hello-app</code>。</p><p>GKE 使用 Kubernetes 物件來建立和管理叢集的資源。Kubernetes 提供 <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener">Deployment</a> 物件來部署 stateless 的應用，例如：web server。<a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noopener">Service</a> 物件定義了從網際網路上存取應用程式的規則和負載平衡。</p><p>在 Cloud Shell 中執行下面的 <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#run" target="_blank" rel="noopener"><code>kubectl run</code></a> 指令，從 <code>hello-app</code> 容器 image 建立新的名為 <code>hello-server</code> 的 <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener">Deployment</a>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> kubectl run hello-server --image=gcr.io/google-samples/hello-app:1.0 --port 8080</span><br>deployment.apps "hello-server" created<br></code></pre></td></tr></table></figure><blockquote><p>我在 Github 上面找到 <code>hello-app</code> image 的專案原始碼：<a href="https://github.com/GoogleCloudPlatform/kubernetes-engine-samples/tree/master/hello-app" target="_blank" rel="noopener">GoogleCloudPlatform/kubernetes-engine-samples</a></p></blockquote><blockquote><p>如果想在自己的專案上使用自己建置的容器 image，並將此 image 的應用部署至 GKE，可參考官方的 <a href="https://cloud.google.com/kubernetes-engine/docs/tutorials/hello-app" target="_blank" rel="noopener">Deploying a containerized web application</a> 文件。</p></blockquote><p>此 Kubernetes 指令建立一個代表 <code>hello-app</code> 的 Deployment 物件。在此指令中：</p><ul><li><code>--image</code>：指定要部署的容器 image。在這種情況下，該指令從 <a href="https://cloud.google.com/container-registry/docs" target="_blank" rel="noopener">Google Container Registry</a> bucket 中 pull 範例 image。<code>gcr.io/google-samples/hello-app:1.0</code> 代表這個指令要 pull 的特定 image 版本。如果未指定版本，會使用最新版</li><li><code>--port</code>：指定容器要公開的 port</li></ul><h2 id="將應用公開發佈到網際網路"><a class="header-anchor" href="#將應用公開發佈到網際網路"></a>將應用公開發佈到網際網路</h2><p>根據預設，在 GKE 上執行的容器無法從網際網路存取，因為這些容器沒有外部 IP 位址。所以你必須執行 <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#expose" target="_blank" rel="noopener"><code>kubectl expose</code></a> 這個指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> kubectl expose deployment hello-server --<span class="hljs-built_in">type</span>=<span class="hljs-string">"LoadBalancer"</span></span><br>service/hello-server exposed<br></code></pre></td></tr></table></figure><p>此指令會建立一個 Kubernetes Service，它是一個 Kubernetes 資源。GKE 會為應用程式建立外部 IP，明確地將應用程序公開給來自網際網路的流量 (外部流量)。加上 <code>type=&quot;LoadBalancer&quot;</code> 參數會為容器建立一個 GCE 的 Load Balancer (在自己的專案上使用<a href="https://cloud.google.com/compute/pricing#lb" target="_blank" rel="noopener">需要計費</a>)。</p><p>GKE 會將外部 IP 位址指派給 Service 資源，而不是指派給 Deployment。如果你想要找出 GKE 為應用程式佈建 (provisioned) 的外部 IP，可執行 <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#get" target="_blank" rel="noopener"><code>kubectl get service</code></a> 來檢查 <code>hello-server</code> Service：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> kubectl get service hello-server</span><br></code></pre></td></tr></table></figure><div class="info"><p>產生外部 IP 位址可能需要一分鐘。如果 <code>EXTERNAL-IP</code> 欄位顯示為 <code>pending</code> 狀態時 (如下)，請等待一段時間後，再次執行上面的指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME           TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE<br>hello-server   LoadBalancer   10.39.249.21   &lt;pending&gt;     8080:31693/TCP   51s<br></code></pre></td></tr></table></figure></div><p>確認應用程式的外部 IP 位址後 ( <code>EXTERNAL-IP</code> 欄位提供的 IP)，請複製此 IP 位址，以下面的輸出範例來說，要複製的 Service 外部 IP 位址就是 <code>35.222.35.96</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME           TYPE           CLUSTER-IP     EXTERNAL-IP    PORT(S)          AGE<br>hello-server   LoadBalancer   10.39.249.21   35.222.35.96   8080:31693/TCP   1m<br></code></pre></td></tr></table></figure><p>接著將剛剛複製的外部 IP 位址，加上公開的 port，網址格式就會像下面這樣：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">http:&#x2F;&#x2F;[EXTERNAL-IP]:8080<br></code></pre></td></tr></table></figure><p>使用瀏覽器開啟此網址，查看應用程式是否能存取。</p><p>看到的頁面應該會像下圖這樣：</p><p><img src="../images/getting-started-with-google-k8s-engine/2019-04-18-23-26-18.png" alt=""></p><h2 id="清除"><a class="header-anchor" href="#清除"></a>清除</h2><p>執行下面的指令來刪除 Service，此步驟將取消分配為你的 Service 所建立的 Cloud Load Balancer：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> kubectl delete service hello-server</span><br></code></pre></td></tr></table></figure><p>執行下面的指令來刪除容器叢集，此步驟會一併刪除容器叢集的組成資源，例如：運算執行個體、磁碟和網路資源：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud container clusters delete [CLUSTER-NAME]</span><br>The following clusters will be deleted.<br> - [my-cluster] in [us-central1-a]<br><br>Do you want to continue (Y/n)?<br></code></pre></td></tr></table></figure><p>當出現提示時，輸入 <code>Y</code> 進行確認。刪除叢集可能需要一些時間。刪除叢集後的輸出會像下面這樣：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">The following clusters will be deleted.<br> - [my-cluster] in [us-central1-a]<br><br>Do you want to continue (Y/n)?  y<br><br>Deleting cluster my-cluster...done.<br>Deleted [https://container.googleapis.com/v1/projects/qwiklabs-gcp-deb218c6553ee39c/zones/us-central1-a/clusters/my-cluster].<br></code></pre></td></tr></table></figure><blockquote><p>詳情可查看官方的 <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/deleting-a-cluster" target="_blank" rel="noopener">Deleting a cluster | Google Kubernetes Engine</a> 文件。</p></blockquote><h2 id="參考來源"><a class="header-anchor" href="#參考來源"></a>參考來源</h2><ul><li><a href="https://www.qwiklabs.com/focuses/878?parent=catalog" target="_blank" rel="noopener">Kubernetes Engine: Qwik Start | Qwiklabs</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Container </tag>
            
            <tag> GCP </tag>
            
            <tag> Load Balancer </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Google Cloud Shell 入門：gcloud &amp; gsutil</title>
      <link href="/article/getting-started-with-cloud-shell-gcloud-and-gsutil.html"/>
      <url>/article/getting-started-with-cloud-shell-gcloud-and-gsutil.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/gcp.jpg" alt=""></p><p>本篇是紀錄在 Google 的 Qwiklab 平台內，完成「<a href="https://www.qwiklabs.com/focuses/563?parent=catalog" target="_blank" rel="noopener">Getting Started with Cloud Shell &amp; gcloud</a>」這個 quest 所學到的內容，包括如何使用 <code>gcloud</code> 指令，以及如何使用 <code>gsutil</code> 工具來管理 Cloud Storage 資源，將檔案上傳至指定的 bucket。</p><a id="more"></a><p><img src="../images/getting-started-with-cloud-shell-gcloud-and-gsutil/2019-04-16-01-56-04.png" alt=""></p><p>Google Cloud Shell 為你提供 <code>gcloud</code> command-line 存取 GCP 上託管的運算資源。Cloud Shell 是基於 Debian 的 VM，具有 5 GB persistent disk 的 home 目錄，讓你可以輕鬆管理 GCP 專案和資源。你需要的 Cloud SDK <code>gcloud</code> 和其他工具都已預裝在 Cloud Shell 中，讓你可以快速啟動和執行。</p><blockquote><p>若想了解如何 <a href="./gcp-vm-nignx-web-server.html">在 GCP 上建立 VM 架設 NIGNX Web server</a> 可參考此篇。<br>若想了解如何 <a href="./gcp-vm-windows-server.html">在 GCP 上建立 VM 架設 Windows Server</a> 可參考此篇。</p></blockquote><h2 id="準備"><a class="header-anchor" href="#準備"></a>準備</h2><p>在點擊「Start Lab」之前，準備好網路瀏覽器 (推薦用 Google Chrome)，並且至少 40 分鐘可以專注的時間，因為 lab 是有時間限制，當你按下「Start Lab」開始學習時，無法暫停倒數計時，你只能在這段時間內使用 lab 提供給你的全新暫時 GCP Console 可用帳號，時間到之後的幾分鐘就會自動登出。</p><div class="warning"><p>注意：如果你有自己的個人 GCP 帳號或專案，請不要在此 lab 使用</p></div><h2 id="開始你的-Lab，然後登入-GCP-Console"><a class="header-anchor" href="#開始你的-Lab，然後登入-GCP-Console"></a>開始你的 Lab，然後登入 GCP Console</h2><ol><li>如果準備要開始，可以點擊右上角的「Start Lab」開始：</li></ol><p><img src="../images/getting-started-with-cloud-shell-gcloud-and-gsutil/2019-04-16-00-25-52.png" alt=""></p><ol start="2"><li>接著會出現這個畫面，因為我參加 <a href="https://www.facebook.com/events/2005848903055499/" target="_blank" rel="noopener">GDG Tainan</a> 的活動，活動有提供 Qwiklabs 一個月的免費額度，所以我點選下圖左邊的「Use Subscription」：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-21-15.png" alt=""></p><ol start="3"><li>Lab 會提供給你免費暫時的 GCP 帳號，複製帳號和密碼，然後點擊「Open Google Console」開啟 <a href="https://cloud.google.com/storage/docs/cloud-console" target="_blank" rel="noopener">GCP Console</a>：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-15-33-31.png" alt=""></p><p>圖片來源：<a href="https://www.qwiklabs.com/focuses/3563?parent=catalog" target="_blank" rel="noopener">Creating a Virtual Machine | Qwiklabs</a></p><ol start="4"><li>接著就會開啟登入頁面，建議另外開 Chrome 無痕模式來登入 lab 提供的帳號和密碼，因為 Chrome 會紀錄帳密，現在登入的只是暫時帳號，未來不需要用到：</li></ol><div class="warning"><p>注意：這邊是登入 lab 提供的帳號 (也就是 email 必須為 <code>googlexxxxxx_student@qwiklabs.net</code> )，如果你有自己的 GCP 帳號，請不要用於此 lab，避免產生費用</p><blockquote><p>類似於 <code>googlexxxxxx_student@qwiklabs.net</code> 的帳號是一個 Google 帳號，專為 Qwiklabs 學生使用而建立的。它具有特定的域名 (也就是 <code>qwiklabs.net</code> )，並且已分配了 IAM 角色，允許你去存取該 GCP 專案。</p></blockquote></div><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-22-30.png" alt=""></p><ol start="5"><li>接受 terms 和 conditions：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-22-59.png" alt=""></p><ol start="6"><li>不要新增 recovery options 或 two-factor authentication (因為這是一個臨時帳號)：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-23-18.png" alt=""></p><ol start="7"><li>勾選同意服務條款：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-24-15.png" alt=""></p><p>之後就可以開始使用 GCP Console 囉：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-14-14-23-55.png" alt=""></p><h2 id="啟動-Google-Cloud-Shell"><a class="header-anchor" href="#啟動-Google-Cloud-Shell"></a>啟動 Google Cloud Shell</h2><p>Google Cloud Shell 是載入了開發工具的 VM，它提供 5GB 的 home 目錄，並在 Google Cloud 上執行。可用 Google Cloud Shell 提供的 command-line 來存取 GCP 的資源。</p><ol><li>在 GCP console 的右上方工具列中，點擊「Activate Cloud Shell」按鈕：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-24-42.png" alt=""></p><ol start="2"><li>在打開的對話框內，點擊「START CLOUD SHELL」：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-25-23.png" alt=""></p><ol start="3"><li>連接和提供環境需要一些時間：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-26-05.png" alt=""></p><ol start="4"><li>連接後，就代表你已經過身份驗證，專案已設置為 <code>PROJECT_ID</code>，以下圖的為例，此專案的 ID 為 <code>qwiklabs-gcp-f9d61ede8167e6b0</code>：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-26-34.png" alt=""></p><p><code>gcloud</code> 是 GCP 的 command-line 工具，他已預先安裝在 Cloud Shell 上，並且支援 tab 自動補齊 (tab-completion)。</p><p>使用下面指令可列出有效帳號名稱：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud auth list</span><br>          Credentialed Accounts<br>ACTIVE  ACCOUNT<br>*       google3043863_student@qwiklabs.net<br><br>To set the active account, run:<br>    $ gcloud config set account `ACCOUNT`<br></code></pre></td></tr></table></figure><p>可以使用以下指令列出專案 ID：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config list project</span><br>[core]<br>project = qwiklabs-gcp-f9d61ede8167e6b0<br><br>Your active configuration is: [cloudshell-9292]<br></code></pre></td></tr></table></figure><h2 id="理解-Regions-和-Zones"><a class="header-anchor" href="#理解-Regions-和-Zones"></a>理解 Regions 和 Zones</h2><p>Compute Engine 資源位於不同的 regions (地區) 或 zones (區域)。region 是你可以執行資源的所在特定地理位置。每個 region 都有一個或多個 zones。例如，<code>us-central1</code> region 代表美國中部地區，其中包含的 Zones 有 <code>us-central1-a</code>、<code>us-central1-b</code>、<code>us-central1-c</code> 與 <code>us-central1-f</code>。</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-17-58-23.png" alt=""></p><p>圖片來源：<a href="https://www.qwiklabs.com/focuses/3563?parent=catalog" target="_blank" rel="noopener">Creating a Virtual Machine | Qwiklabs</a></p><p>位於 zone 中的資源都稱為 zonel (區域) 資源，VM instance (實例) 和 persistent disk (永久磁碟) 都位於 zone 中，如果要將 persistent disk 附加到 VM instance，這兩個資源都必須位於同一個 zone 中。同樣，如果要將靜態 IP 位址分配到 instance，此 instance 就必須與靜態 IP 位於同一個 region 中。</p><blockquote><p>詳情可參考 GCP 官方的 <a href="https://cloud.google.com/compute/docs/regions-zones/" target="_blank" rel="noopener">Regions &amp; Zones</a> 文件。</p></blockquote><h2 id="使用-command-line"><a class="header-anchor" href="#使用-command-line"></a>使用 command line</h2><p>在 GCP console 的右上方工具列中，點擊「Activate Cloud Shell」按鈕開啟新的 Cloud Shell session：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-24-42.png" alt=""></p><p>啟用 Cloud Shell 後，你可以使用 command line invoke Cloud SDK <code>gcloud</code> 指令或 VM instance 上可用的其他工具，還可以在不同專案和 Cloud Shell session 之間，將要存取的檔案儲存在 persistent disk storage 的 <code>$HOME</code> 目錄內。<code>$HOME</code> 目錄是私有的，其他使用者無法存取。</p><p>可以在任何 <code>gcloud</code> 指令的末端加上 <code>-h</code> 參數來查看使用指南：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud -h</span><br></code></pre></td></tr></table></figure><p>加上 <code>--help</code> 參數或執行 <code>gcloud help</code> 可以查看更詳細的 help 內容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config --<span class="hljs-built_in">help</span></span><br></code></pre></td></tr></table></figure><p>透過按 <code>Enter</code> 或空白建來捲動瀏覽 help 內容，按 <code>q</code> 按鍵會退出內容。</p><p>下面兩個指令是一樣的意思，都是用來查看詳細的 help 內容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config --<span class="hljs-built_in">help</span></span><br><span class="hljs-meta">$</span><span class="bash"> gcloud <span class="hljs-built_in">help</span> config</span><br></code></pre></td></tr></table></figure><h2 id="使用你的-home-目錄"><a class="header-anchor" href="#使用你的-home-目錄"></a>使用你的 home 目錄</h2><p>現在讓我們試試你的 <code>HOME</code> 目錄。就算去終止和重啟 VM，Cloud Shell <code>HOME</code> 錄的內容都會在所有 Cloud Shell session 之間的專案中保留。</p><p>變更目前的工作目錄：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> <span class="hljs-variable">$HOME</span></span><br></code></pre></td></tr></table></figure><p>使用 <code>vi</code> 打開 <code>.bashrc</code> 設定檔：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> vi ./.bashrc</span><br></code></pre></td></tr></table></figure><h2 id="使用-gcloud-指令"><a class="header-anchor" href="#使用-gcloud-指令"></a>使用 gcloud 指令</h2><p>檢視環境內的設定列表：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config list</span><br></code></pre></td></tr></table></figure><p>如果要檢查其他屬性的設定，請在指令後面加上 <code>--all</code> 參數：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config list --all</span><br></code></pre></td></tr></table></figure><h2 id="管理-Cloud-Storage-資料"><a class="header-anchor" href="#管理-Cloud-Storage-資料"></a>管理 Cloud Storage 資料</h2><p>可以使用 Cloud Shell 中的 <code>gsutil</code> 工具來管理 Cloud Storage 資源，包括建立和刪除 bucket 和物件、複製和移動儲存資料以及管理 bucket 和物件 ACLs (Access Control List)。<code>gsutil</code> 還能將資料傳入和傳出 Cloud Shell instance。</p><p>bucket 是用於儲存資料的基本容器，儲存在 Cloud Storage 的所有資料都必須放在 bucket 中。你可以用 bucket 來整理資料、控制資料的存取權，但 bucket 不能像目錄和資料夾可以巢狀儲存。由於<a href="https://cloud.google.com/storage/quotas" target="_blank" rel="noopener">建立和刪除 bucket 有一些限制</a>，所以你設計的儲存應用程式應儘量執行密集的物件作業和相對較少的 bucket 作業。</p><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/storage/docs/key-terms#buckets" target="_blank" rel="noopener">Buckets</a>、<a href="https://cloud.google.com/storage/docs/creating-buckets#storage-create-bucket-gsutil" target="_blank" rel="noopener">Creating Storage Buckets</a> 和 <a href="https://cloud.google.com/storage/docs/access-control/lists?hl=zh-tw" target="_blank" rel="noopener">Access Control List (ACL)</a> 文件。</p></blockquote><p>嘗試建立 Cloud Storage bucket，bucket 名稱不能重複，因此請將 <code>unique-name</code> 替換為其他名稱，或者 append 名稱讓它不重複。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gsutil mb gs://unique-name</span><br></code></pre></td></tr></table></figure><p>像我是使用名為 <code>unique-name-titan</code> 的 bucket，剛好沒有重複，所以成功建立了 bucket：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gsutil mb gs://unique-name-titan</span><br>Creating gs://unique-name-titan/...<br></code></pre></td></tr></table></figure><p>如果使用重複的 bucket 名稱就會出現類似下面的訊息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gsutil mb gs://unique-name</span><br>Creating gs://unique-name/...<br>ServiceException: 409 Bucket unique-name already exists.<br></code></pre></td></tr></table></figure><p>現在來建立一些資料，上傳到你的 bucket。首先，建立一個測試檔案：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> vi test.dat</span><br></code></pre></td></tr></table></figure><p>加一些資料進去：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Welcome to gcloud!<br></code></pre></td></tr></table></figure><p>存儲檔案：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">:wq<br></code></pre></td></tr></table></figure><p>現在，上傳一些檔案到你建立的 bucket，請將 <code>unique-name</code> 取代成你的 storage bucket：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gsutil cp test.dat gs://unique-name</span><br></code></pre></td></tr></table></figure><p>剛剛我是使用 <code>unique-name-titan</code> 的 bucket，所以上傳指令如下，可以看到我已成功上傳：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gsutil cp test.dat gs://unique-name-titan</span><br>Copying file://test.dat [Content-Type=application/octet-stream]...<br>- [1 files][   19.0 B/   19.0 B]<br>Operation completed over 1 objects/19.0 B.<br></code></pre></td></tr></table></figure><p>如果是使用重複的 bucket 名稱上傳，就會出現類似下面的訊息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gsutil cp test.dat gs://unique-name</span><br>Copying file://test.dat [Content-Type=application/octet-stream]...<br>BadRequestException: 400 Project does not exist: 666160882299<br></code></pre></td></tr></table></figure><p>若要查看你的 bucket 和檔案，請開啟導航選單，然後選擇「Storage &gt; Browser」：</p><p><img src="../images/getting-started-with-cloud-shell-gcloud-and-gsutil/2019-04-16-01-52-25.png" alt=""></p><p>然後點擊你的 bucket：</p><p><img src="../images/getting-started-with-cloud-shell-gcloud-and-gsutil/2019-04-16-01-53-17.png" alt=""></p><p>你應該會看到 <code>test.dat</code> 這個檔案：</p><p><img src="../images/getting-started-with-cloud-shell-gcloud-and-gsutil/2019-04-16-01-53-59.png" alt=""></p><h2 id="參考來源"><a class="header-anchor" href="#參考來源"></a>參考來源</h2><ul><li><a href="https://www.qwiklabs.com/focuses/563?parent=catalog" target="_blank" rel="noopener">Getting Started with Cloud Shell &amp; gcloud | Qwiklabs</a> (本篇大多數的圖片來源)</li></ul>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GCP </tag>
            
            <tag> VM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 GCP 上建立 VM 架設 Windows Server</title>
      <link href="/article/gcp-vm-windows-server.html"/>
      <url>/article/gcp-vm-windows-server.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/gcp.jpg" alt=""></p><p>本篇是紀錄在 Google 的 Qwiklab 平台內，完成「<a href="https://www.qwiklabs.com/focuses/560?parent=catalog" target="_blank" rel="noopener">Compute Engine: Qwik Start - Windows</a>」這個 quest 所學到的內容，包括如何透過 GCP Console 在 GCP 建立 instance 架設 Windows Server，以及如何使用 <a href="https://chrome.google.com/webstore/detail/chrome-rdp-for-google-clo/mpbbnannobiobpnfblimoapbephgifkm" target="_blank" rel="noopener">Chrome RDP for GCP</a> 擴充功能直接從瀏覽器進行 RDP 連接至 Windows Server。</p><a id="more"></a><p><img src="../images/gcp-vm-windows-server/2019-04-16-00-21-39.png" alt=""></p><p>Google Compute Engine 可讓你在 Google 基礎架構上建立和執行 VM。 Compute Engine 提供擴展、效能和價值，讓你可以輕鬆地在 Google 基礎架構上啟動大型運算群集。</p><p>你可以在 Google Compute Engine 上執行 Windows 應用程式，並利用 VM instance 可用的許多優勢，例如：可靠的<a href="https://cloud.google.com/compute/docs/disks/" target="_blank" rel="noopener">儲存選項</a>、<a href="https://cloud.google.com/compute/docs/vpc" target="_blank" rel="noopener">Google 網路</a>的速度和<a href="https://cloud.google.com/compute/docs/autoscaler/" target="_blank" rel="noopener">自動擴展 (Autoscaling)</a>。</p><p>在此 lab 中，你將學習如何在 Google Compute Engine 中啟動 Windows Server instance，並使用遠端桌面協定連接到該 instance。</p><blockquote><p>若想了解如何 <a href="./gcp-vm-nignx-web-server.html">在 GCP 上建立 VM 架設 NIGNX Web server</a> 可參考此篇。</p></blockquote><p>如果你未在 local 主機上使用 Windows，請安裝第三方的 RDP client，例如：FusionLabs 的 <a href="https://chrome.google.com/webstore/detail/chrome-rdp/cbkkbcmdlboombapidmoeolnmdacpkch" target="_blank" rel="noopener">Chrome RDP</a>。</p><h2 id="準備"><a class="header-anchor" href="#準備"></a>準備</h2><p>在點擊「Start Lab」之前，準備好網路瀏覽器 (推薦用 Google Chrome)，並且至少 40 分鐘可以專注的時間，因為 lab 是有時間限制，當你按下「Start Lab」開始學習時，無法暫停倒數計時，你只能在這段時間內使用 lab 提供給你的全新暫時 GCP Console 可用帳號，時間到之後的幾分鐘就會自動登出。</p><div class="warning"><p>注意：如果你有自己的個人 GCP 帳號或專案，請不要在此 lab 使用</p></div><h2 id="開始你的-Lab，然後登入-GCP-Console"><a class="header-anchor" href="#開始你的-Lab，然後登入-GCP-Console"></a>開始你的 Lab，然後登入 GCP Console</h2><ol><li>如果準備要開始，可以點擊右上角的「Start Lab」開始：</li></ol><p><img src="../images/gcp-vm-windows-server/2019-04-16-00-56-15.png" alt=""></p><ol start="2"><li>接著會出現這個畫面，因為我參加 <a href="https://www.facebook.com/events/2005848903055499/" target="_blank" rel="noopener">GDG Tainan</a> 的活動，活動有提供 Qwiklabs 一個月的免費額度，所以我點選下圖左邊的「Use Subscription」：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-21-15.png" alt=""></p><ol start="3"><li>Lab 會提供給你免費暫時的 GCP 帳號，複製帳號和密碼，然後點擊「Open Google Console」開啟 <a href="https://cloud.google.com/storage/docs/cloud-console" target="_blank" rel="noopener">GCP Console</a>：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-15-33-31.png" alt=""></p><p>圖片來源：<a href="https://www.qwiklabs.com/focuses/3563?parent=catalog" target="_blank" rel="noopener">Creating a Virtual Machine | Qwiklabs</a></p><ol start="4"><li>接著就會開啟登入頁面，建議另外開 Chrome 無痕模式來登入 lab 提供的帳號和密碼，因為 Chrome 會紀錄帳密，現在登入的只是暫時帳號，未來不需要用到：</li></ol><div class="warning"><p>注意：這邊是登入 lab 提供的帳號 (也就是 email 必須為 <code>googlexxxxxx_student@qwiklabs.net</code> )，如果你有自己的 GCP 帳號，請不要用於此 lab，避免產生費用</p><blockquote><p>類似於 <code>googlexxxxxx_student@qwiklabs.net</code> 的帳號是一個 Google 帳號，專為 Qwiklabs 學生使用而建立的。它具有特定的域名 (也就是 <code>qwiklabs.net</code> )，並且已分配了 IAM 角色，允許你去存取該 GCP 專案。</p></blockquote></div><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-22-30.png" alt=""></p><ol start="5"><li>接受 terms 和 conditions：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-22-59.png" alt=""></p><ol start="6"><li>不要新增 recovery options 或 two-factor authentication (因為這是一個臨時帳號)</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-23-18.png" alt=""></p><ol start="7"><li>勾選同意服務條款：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-24-15.png" alt=""></p><p>之後就可以開始使用 GCP Console 囉：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-14-14-23-55.png" alt=""></p><h2 id="建立-VM-instance"><a class="header-anchor" href="#建立-VM-instance"></a>建立 VM instance</h2><p>在 GCP Console 的左上角，點選「Navigation menu &gt; Compute Engine &gt; VM Instances」：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-18-16-42.png" alt=""></p><p>接著點擊「Create」按鈕建立新的 instance：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-31-03.png" alt=""></p><p>在「Boot disk」部分中，點擊「Change」按鈕以開始配置 boot disk：</p><p><img src="../images/gcp-vm-windows-server/2019-04-15-23-10-06.png" alt=""></p><p>選擇「Windows Server 2012 R2 Datacenter」，然後點擊「Select」按鈕：</p><p><img src="../images/gcp-vm-windows-server/2019-04-15-23-38-30.png" alt=""></p><p>將所有其他設定都保留為預設值。設定好之後，點擊「Create」按鈕建立 instance：</p><p><img src="../images/gcp-vm-windows-server/2019-04-15-23-09-42.png" alt=""></p><h2 id="啟動-Google-Cloud-Shell"><a class="header-anchor" href="#啟動-Google-Cloud-Shell"></a>啟動 Google Cloud Shell</h2><p>Google Cloud Shell 是載入了開發工具的 VM，它提供 5GB 的 home 目錄，並在 Google Cloud 上執行。可用 Google Cloud Shell 提供的 command-line 來存取 GCP 的資源。</p><ol><li>在 GCP console 的右上方工具列中，點擊「Activate Cloud Shell」按鈕：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-24-42.png" alt=""></p><ol start="2"><li>在打開的對話框內，點擊「START CLOUD SHELL」：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-25-23.png" alt=""></p><ol start="3"><li>連接和提供環境需要一些時間：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-26-05.png" alt=""></p><ol start="4"><li>連接後，就代表你已經過身份驗證，專案已設置為 <code>PROJECT_ID</code>，以下圖的為例，此專案的 ID 為 <code>qwiklabs-gcp-f9d61ede8167e6b0</code>：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-26-34.png" alt=""></p><p>使用下面指令可列出有效帳號名稱：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud auth list</span><br>          Credentialed Accounts<br>ACTIVE  ACCOUNT<br>*       google3043863_student@qwiklabs.net<br><br>To set the active account, run:<br>    $ gcloud config set account `ACCOUNT`<br></code></pre></td></tr></table></figure><p>可以使用以下指令列出專案 ID：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config list project</span><br>[core]<br>project = qwiklabs-gcp-f9d61ede8167e6b0<br><br>Your active configuration is: [cloudshell-9292]<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/sdk/gcloud" target="_blank" rel="noopener">Google Cloud gcloud Overview</a> 文件。</p></blockquote><h2 id="測試-Windows-Startup-的狀態"><a class="header-anchor" href="#測試-Windows-Startup-的狀態"></a>測試 Windows Startup 的狀態</h2><p>在「VM Instances」頁面上看到帶有綠色狀態的 icon 就代表該 instance 已建立完成，如下圖：</p><p><img src="../images/gcp-vm-windows-server/2019-04-15-23-40-28.png" alt=""></p><p>但是，它可能尚未準備好接受 RDP 連接，因為所有 OS 元件初始化都需要一段時間。</p><p>要查看 server 是否已準備好進行 RDP 連接，請在 Cloud Shell terminal command-line 中執行以下指令，其中的 <code>instance-1</code> 是剛剛建立的 instance 名稱：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute instances get-serial-port-output instance-1 --zone us-central1<span class="hljs-_">-a</span></span><br></code></pre></td></tr></table></figure><p>重複這個指令，直到指令輸出以下內容為止。這個指令的輸出會告訴你 OS 元件已初始化，並且 Windows Server 已準備好接受 RDP 連接 (嘗試下一步)。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Finished running startup scripts.<br></code></pre></td></tr></table></figure><p>這個指令完整的輸出訊息會類似下面這樣：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute instances get-serial-port-output instance-1 --zone us-central1<span class="hljs-_">-a</span></span><br>SeaBIOS (version 1.8.2-20190322_093631-google)<br>Total RAM Size = 0x00000000f0000000 = 3840 MiB<br>CPUs found: 1     Max CPUs supported: 1<br>found virtio-scsi at 0:3<br>virtio-scsi vendor='Google' product='PersistentDisk' rev='1' type=0 removable=0<br>virtio-scsi blksize=512 sectors=104857600 = 51200 MiB<br>drive 0x000f29f0: PCHS=0/0/0 translation=lba LCHS=1024/255/63 s=104857600<br>Booting from Hard Disk 0...<br>2019/04/15 15:39:21 GCEWindowsAgent: GCE Agent Started (version 4.6.0@1)<br>2019/04/15 15:39:56 GCEInstanceSetup: Starting sysprep specialize phase.<br>2019/04/15 15:39:57 GCEInstanceSetup: All networks set to DHCP.<br>2019/04/15 15:39:57 GCEInstanceSetup: Running 'netsh' with arguments 'interface ipv4 set interface Ethernet mtu=1460'<br>2019/04/15 15:39:57 GCEInstanceSetup: --&gt; Ok.<br>2019/04/15 15:39:58 GCEInstanceSetup: MTU set to 1460.<br>2019/04/15 15:39:58 GCEInstanceSetup: Running 'route' with arguments '/p add 169.254.169.254 mask 255.255.255.255 0.0.0.0 if 12 metric 1'<br>2019/04/15 15:39:58 GCEInstanceSetup: --&gt; OK!<br>2019/04/15 15:39:58 GCEInstanceSetup: Added persistent route to metadata netblock via first netkvm adapter.<br>2019/04/15 15:39:58 GCEInstanceSetup: Getting hostname from metadata server.<br>2019/04/15 15:39:58 GCEInstanceSetup: Changing hostname from WIN-MQ2QFF14J03 to instance-1.<br>2019/04/15 15:39:58 GCEInstanceSetup: Renamed from WIN-MQ2QFF14J03 to instance-1.<br>2019/04/15 15:39:58 GCEMetadataScripts: Starting specialize scripts (version 4.2.1@1).<br>2019/04/15 15:39:58 GCEMetadataScripts: No specialize scripts to run.<br>2019/04/15 15:39:58 GCEMetadataScripts: Finished running specialize scripts.<br>2019/04/15 15:39:58 GCEInstanceSetup: Finished with sysprep specialize phase, restarting...<br>2019/04/15 15:39:59 GCEWindowsAgent: GCE Agent Stopped<br>SeaBIOS (version 1.8.2-20190322_093631-google)<br>Total RAM Size = 0x00000000f0000000 = 3840 MiB<br>CPUs found: 1     Max CPUs supported: 1<br>found virtio-scsi at 0:3<br>virtio-scsi vendor='Google' product='PersistentDisk' rev='1' type=0 removable=0<br>virtio-scsi blksize=512 sectors=104857600 = 51200 MiB<br>drive 0x000f29f0: PCHS=0/0/0 translation=lba LCHS=1024/255/63 s=104857600<br>Booting from Hard Disk 0...<br>2019/04/15 15:40:36 GCEWindowsAgent: GCE Agent Started (version 4.6.0@1)<br>2019/04/15 15:40:43 GCEInstanceSetup: Disabled Ctrl + Alt + Del.<br>2019/04/15 15:40:43 GCEInstanceSetup: Enable RDP firewall rules.<br>2019/04/15 15:40:43 GCEInstanceSetup: Running 'netsh' with arguments 'advfirewall firewall set rule group=remote desktop new enable=Yes'<br>2019/04/15 15:40:43 GCEInstanceSetup: --&gt; Updated 3 rule(s).<br>2019/04/15 15:40:43 GCEInstanceSetup: --&gt; Ok.<br>2019/04/15 15:40:43 GCEInstanceSetup: Restarting Terminal Service services, to enable RDP.<br>2019/04/15 15:40:44 GCEInstanceSetup: Enabled Remote Desktop.<br>2019/04/15 15:40:44 GCEInstanceSetup: Configuring WinRM...<br>2019/04/15 15:40:47 GCEInstanceSetup: Running 'netsh' with arguments 'advfirewall firewall add rule profile=any name=Windows Remote Management (HTTPS-In) dir=in localport=5986 protocol=TCP action=allow'<br>2019/04/15 15:40:47 GCEInstanceSetup: --&gt; Ok.<br>2019/04/15 15:40:48 GCEInstanceSetup: Setup of WinRM complete.<br>2019/04/15 15:40:48 GCEInstanceSetup: Running startup scripts from metadata server.<br>2019/04/15 15:40:48 GCEInstanceSetup: Running 'schtasks' with arguments '/run /tn GCEStartup'<br>2019/04/15 15:40:48 GCEInstanceSetup: --&gt; SUCCESS: Attempted to run the scheduled task "GCEStartup".<br>2019/04/15 15:40:48 GCEInstanceSetup: ------------------------------------------------------------<br>2019/04/15 15:40:48 GCEInstanceSetup: Instance setup finished. instance-1 is ready to use.<br>2019/04/15 15:40:48 GCEInstanceSetup: ------------------------------------------------------------<br>2019/04/15 15:40:51 GCEInstanceSetup: Checking instance license activation status.<br>2019/04/15 15:40:51 GCEInstanceSetup: instance-1 needs to be activated by a KMS Server.<br>2019/04/15 15:40:51 GCEInstanceSetup: Key Management Service machine name set to kms.windows.googlecloud.com successfully.<br>2019/04/15 15:40:51 GCEInstanceSetup: Installed product key W3GGN-FT8W3-Y4M27-J84CP-Q3VJ9 successfully.<br>2019/04/15 15:40:51 GCEInstanceSetup: Activating instance...<br>2019/04/15 15:40:52 GCEInstanceSetup: Activating Windows(R), ServerDatacenter edition (00091344-1ea4-4f37-b789-01750ba6988c) ...<br>2019/04/15 15:40:52 GCEInstanceSetup: Product activated successfully.<br>2019/04/15 15:40:52 GCEInstanceSetup: Activation successful.<br>2019/04/15 15:40:53 GCEMetadataScripts: Starting startup scripts (version 4.2.1@1).<br>2019/04/15 15:40:53 GCEMetadataScripts: No startup scripts to run.<br>2019/04/15 15:40:53 GCEMetadataScripts: Finished running startup scripts.<br><br><br>Specify --start=4643 in the next get-serial-port-output invocation to get only the new output starting from here.<br></code></pre></td></tr></table></figure><h2 id="連接-instance"><a class="header-anchor" href="#連接-instance"></a>連接 instance</h2><p>點擊 VM 的名稱：</p><p><img src="../images/gcp-vm-windows-server/2019-04-15-23-09-15.png" alt=""></p><p>在「Remote Access」部分點擊「Set Windows Password」按鈕：</p><p><img src="../images/gcp-vm-windows-server/2019-04-15-23-11-50.png" alt=""></p><p>輸入 username 後，點擊「Set」按鈕來產生此 Windows instance 的密碼。如果沒有此 username 的 Windows 帳號，就會建立該帳號並使用新密碼，如果已有此帳號，密碼則會被重設：</p><p><img src="../images/gcp-vm-windows-server/2019-04-15-23-50-21.png" alt=""></p><p>複製密碼並儲存，稍後登入 instance 時會用到：</p><p><img src="../images/gcp-vm-windows-server/2019-04-15-23-14-07.png" alt=""></p><h2 id="使用遠端桌面-RDP-進入-Windows-Server"><a class="header-anchor" href="#使用遠端桌面-RDP-進入-Windows-Server"></a>使用遠端桌面 (RDP) 進入 Windows Server</h2><p>可以使用 <a href="https://chrome.google.com/webstore/detail/chrome-rdp-for-google-clo/mpbbnannobiobpnfblimoapbephgifkm" target="_blank" rel="noopener">Chrome RDP for Google Cloud Platform</a> 擴充功能直接從瀏覽器進行 RDP 連接，點擊「RDP」按鈕進行連接：</p><p><img src="../images/gcp-vm-windows-server/2019-04-15-23-16-16.png" alt=""></p><div class="info"><p>如果剛剛是用 Chrome 的無痕模式登入帳號，就會發生點擊「RDP」按鈕沒有反應的狀況，換成原本的模式就可以正常使用。</p></div><p>它會提示你安裝 RDP 擴充功能。安裝完成後，GCP 會打開像下圖的登入畫面，請使用 Windows 使用者和密碼登入 (貼上之前儲存的密碼)：</p><p><img src="../images/gcp-vm-windows-server/2019-04-15-23-17-26.png" alt=""></p><p>點擊「Continue」按鈕以確認你要連接：</p><p><img src="../images/gcp-vm-windows-server/2019-04-15-23-17-54.png" alt=""></p><p>打開 Server Manager 時，就會連接到 Windows Server 上的 VM instance。</p><p><img src="../images/gcp-vm-windows-server/2019-04-15-23-59-49.png" alt=""></p><h2 id="使用-RDP-client-複製和貼上"><a class="header-anchor" href="#使用-RDP-client-複製和貼上"></a>使用 RDP client 複製和貼上</h2><p>登入到 instance 後，可以按 <code>Ctrl + V</code> 貼上資料 (如果是 Mac 的使用者，按 <code>Cmd + V</code> 會無法貼上）。如果要貼至 PuTTY 和 Powershell，請按滑鼠右鍵就可以貼上。如果在 Powershell 視窗中，請確保已點擊該視窗，否則會無法貼上。</p><h2 id="參考來源"><a class="header-anchor" href="#參考來源"></a>參考來源</h2><ul><li><a href="https://www.qwiklabs.com/focuses/560?parent=catalog" target="_blank" rel="noopener">Compute Engine: Qwik Start - Windows</a> (本篇大多數的圖片來源)</li></ul>]]></content>
      
      
      <categories>
          
          <category> Windows Server </category>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GCP </tag>
            
            <tag> VM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GCP (Google Cloud Platform) 入門</title>
      <link href="/article/getting-started-with-gcp.html"/>
      <url>/article/getting-started-with-gcp.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/gcp.jpg" alt=""></p><p>本篇是紀錄在 Google 的 Qwiklab 平台內，完成「<a href="https://www.qwiklabs.com/focuses/2794?parent=catalog" target="_blank" rel="noopener">A Tour of Qwiklabs and the Google Cloud Platform</a>」這個 quest 所學到的內容，包括如何使用以及認識 Qwiklab 和 GCP。</p><a id="more"></a><p><img src="../images/getting-started-with-gcp/2019-04-15-21-49-27.png" alt=""></p><p><a href="https://cloud.google.com/" target="_blank" rel="noopener">Google Cloud Platform</a> (GCP) 是託管在 Google 基礎架構上的一套雲端服務，從計算和儲存，到資料分析、機器學習、網路、GCP 提供各種服務和 API，可以與任何雲端計算應用程式或專案整合 - 無論是個人還是企業。</p><p>在這個入門等級的 lab 中，可透過使用 <a href="https://cloud.google.com/cloud-console/" target="_blank" rel="noopener">GCP console</a> (瀏覽器內的 UI，可讓您存取和管理 Google Cloud 服務) 來練習使用 GCP，了解 GCP 的主要功能，必了解 Qwiklabs 的環境。</p><h2 id="你會學到什麼"><a class="header-anchor" href="#你會學到什麼"></a>你會學到什麼</h2><ul><li>了解如何使用特定憑證存取 GCP console</li><li>認識 GCP 專案</li><li>了解如何使用 GCP 的導航選單來識別 GCP 服務的類型</li><li>了解 primitive roles 並使用 Cloud IAM 服務檢查特定使用者的可用操作</li><li>了解 Cloud Shell 並使用 <code>gcloud</code> toolkit 來執行指令</li><li>了解 API library 並查看其主要功能</li></ul><blockquote><p>若想了解如何 <a href="./gcp-vm-nignx-web-server.html">在 GCP 上建立 VM 架設 NIGNX Web server</a> 可參考此篇。<br>若想了解如何 <a href="./gcp-vm-windows-server.html">在 GCP 上建立 VM 架設 Windows Server</a> 可參考此篇。</p></blockquote><blockquote><p>其他關於 Qwiklab 的介紹，可至原文 <a href="https://www.qwiklabs.com/focuses/2794?parent=catalog" target="_blank" rel="noopener">A Tour of Qwiklabs and the Google Cloud Platform</a> 查看。</p></blockquote><h2 id="存取-GCP-Console"><a class="header-anchor" href="#存取-GCP-Console"></a>存取 GCP Console</h2><p>如果已經點擊右上角的「Start Lab」開始，應該會看到左側的「Open Google Console」按鈕變成可以被點擊，而且可以看到有帳號、密碼以及 GCP 專案 ID：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-15-33-31.png" alt=""></p><h3 id="GCP-專案-ID"><a class="header-anchor" href="#GCP-專案-ID"></a>GCP 專案 ID</h3><p><a href="https://cloud.google.com/docs/overview/#projects" target="_blank" rel="noopener">GCP 專案</a>是你的 Google 雲端資源的組織實體，包含資源和服務，例如：可以包含一個 VM 的 pool，一組資料庫以及將它們彼此連接的網路，專案還包含設定和權限，這些設定和權限可以指定安全規則以及設定誰有權存取哪些資源。而 GCP Project ID 不會重複，用於將 GCP 資源和 API 連接到你的特定專案。</p><h3 id="帳號和密碼"><a class="header-anchor" href="#帳號和密碼"></a>帳號和密碼</h3><p>帳號和密碼是表示在 GCP 身份和存取管理 (Identity and Access Management，IAM) 服務中，具有存取權限身份 (一個或多個角色) 的憑證，允許你在已分配的專案中使用 GCP 資源。這些憑證是臨時的，只能在 lab 限制的存取時間內使用，所以只要計時器倒數到 0 之後，你就無法再使用這些憑證存取這個的 GCP 專案。</p><h2 id="登入-GCP"><a class="header-anchor" href="#登入-GCP"></a>登入 GCP</h2><ol><li>Lab 會提供給你免費暫時的 GCP 帳號，複製帳號和密碼，然後點擊「Open Google Console」開啟 <a href="https://cloud.google.com/storage/docs/cloud-console" target="_blank" rel="noopener">GCP Console</a>：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-15-33-31.png" alt=""></p><ol start="2"><li>接著就會開啟登入頁面，建議另外開 Chrome 無痕模式來登入 lab 提供的帳號和密碼，因為 Chrome 會紀錄帳密，現在登入的只是暫時帳號，未來不需要用到：</li></ol><div class="warning"><p>注意：這邊是登入 lab 提供的帳號 (也就是 email 必須為 <code>googlexxxxxx_student@qwiklabs.net</code> )，如果你有自己的 GCP 帳號，請不要用於此 lab，避免產生費用</p><blockquote><p>類似於 <code>googlexxxxxx_student@qwiklabs.net</code> 的帳號是一個 Google 帳號，專為 Qwiklabs 學生使用而建立的。它具有特定的域名 (也就是 <code>qwiklabs.net</code> )，並且已分配了 IAM 角色，允許你去存取該 GCP 專案。</p></blockquote></div><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-22-30.png" alt=""></p><ol start="3"><li>接受 terms 和 conditions：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-22-59.png" alt=""></p><ol start="4"><li>不要新增 recovery options 或 two-factor authentication (因為這是一個臨時帳號)</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-23-18.png" alt=""></p><ol start="5"><li>勾選同意服務條款：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-24-15.png" alt=""></p><p>之後就可以開始使用 GCP Console 囉：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-14-14-23-55.png" alt=""></p><h2 id="GCP-Console-中的專案"><a class="header-anchor" href="#GCP-Console-中的專案"></a>GCP Console 中的專案</h2><p>GCP Console 的左上角，會看到一個名為 Project info 的面板，畫面如下：</p><p><img src="../images/getting-started-with-gcp/2019-04-14-14-23-05.png" alt=""></p><p>一個專案會有名稱、ID、編號，在使用 GCP 服務時會經常使用這些東西。不過你可以存取多個 GCP 專案。在某些 lab 中，可能會使用多個專案來完成分配的任務。如果點擊帶有專案名稱的下拉式選單並選擇「ALL」，就會看到「Qwiklabs Resources」專案也可見：</p><p><img src="../images/getting-started-with-gcp/2019-04-14-14-31-05.gif" alt=""></p><div class="info"><p>目前不要切換到 Qwiklabs 資源專案！但是，你可以稍後在其他 lab 中使用它。</p></div><p>GCP 的大型企業或有經驗的使用者擁有數十到數千個 GCP 專案的情況還蠻常見的，組織會以不同的方式使用 GCP，因此專案分離在雲端運算服務 (以團隊或產品為例) 是個好方法。</p><p>“Qwiklabs Resources” 是一個包含某些 lab 的檔案，資料集和機器 image 的專案，可以從每個 GCP lab 環境存取。要注意是 “Qwiklabs Resources” 與所有 Qwiklabs 使用者共享資源 (read only)，也就代表你無法刪除或修改它。</p><p>你正在使用名為類似於 <code>qwiklabs-gcp-xxx</code> 的 GCP 專案是臨時的，也就代表專案及其包含的所有內容會在 lab 結束後刪除。每次使用的 lab 都可以存取一個或多個新的 GCP 專案，並且在那裡 (不是 “Qwiklabs Resources” ) 執行所有 lab 的步驟。</p><h2 id="導航選單和服務"><a class="header-anchor" href="#導航選單和服務"></a>導航選單和服務</h2><p>在畫面的左上角有一個類似「三」的 icon：</p><p><img src="../images/getting-started-with-gcp/2019-04-14-15-46-30.png" alt=""></p><p>點擊此按鈕會顯示 (或隱藏) GCP 核心服務的導航選單，如果選單沒有打開，請點擊此 icon 並捲動查看所有提供的服務類型：</p><p><img src="../images/getting-started-with-gcp/2019-04-14-14-32-42.gif" alt=""></p><p>在導航選單可以快速存取平台的服務，可看到共有 7 類 GCP 的服務：</p><ul><li>Compute：包含支援任何類型的工作負載的各種機型。通過不同的運算選項，可以決定你希望如何參與 operational details 和基礎架構等</li><li>Storage：結構化或非結構化、關係資料或非關係資料的資料儲存和資料庫選項</li><li>Networking：平衡應用程式流量和提供安全規則的服務</li><li>Stackdriver：一套跨雲端日誌記錄 (cross-cloud logging)、監控、追蹤和其他服務的可靠性工具</li><li>Tools：管理部署和應用程式建置 pipeline 的開發人員的服務</li><li>Big Data：用於處理和分析大量資料集的服務</li><li>Artificial Intelligence (AI)：可在 GCP 上執行特定的 AI 和機器學習 (ML，machine learning) 任務的一套 API</li></ul><blockquote><p>詳情可查看官方的 <a href="https://cloud.google.com/docs/overview/cloud-platform-services" target="_blank" rel="noopener">About the GCP Services | Google Cloud</a> 文件。</p></blockquote><h2 id="角色和權限"><a class="header-anchor" href="#角色和權限"></a>角色和權限</h2><p>除了雲端運算服務之外，GCP 還包含一組權限和角色，用於定義誰可以存取哪些資源，我們就可以使用雲端身份和存取管理 (<a href="https://cloud.google.com/iam/" target="_blank" rel="noopener">Cloud Identity and Access Management，IAM</a>) 服務來檢查和修改角色和權限。</p><p>請打開導航選單，然後點擊「IAM &amp; admin」，畫面會跳至包含使用者列表的頁面，該頁面指定給予特定帳號的權限和角色。嘗試篩選這些並找到你登入的 “@qwiklabs” 此使用者名稱：</p><p><img src="../images/getting-started-with-gcp/2019-04-14-15-48-30.gif" alt=""></p><p>類似下圖：</p><p><img src="../images/getting-started-with-gcp/2019-04-14-16-27-50.png" alt=""></p><p>member 欄位被設為 <code>google23396_student@qwiklabs.net</code>（與你登入的帳號一樣），name 欄位被設為 <code>google23396_student@qwiklabs.net student</code>。會看到 Role 欄位被設為 <code>Editor</code>，這是 GCP 提供的三種 primitive roles 的其中之一。除非另有指定，否則 primitive roles 是設定專案等級的權限，它們控制對所有 GCP 服務的存取和管理。</p><p>下表是從<a href="https://cloud.google.com/iam/docs/understanding-roles#primitive_roles" target="_blank" rel="noopener">角色文件</a>中提取的定義，其中提供了 viewer、editor 和 owner 角色權限的 overview：</p><table><thead><tr><th>角色名稱</th><th>權限</th></tr></thead><tbody><tr><td>roles/viewer</td><td>不影響狀態的 read-only 操作的權限，例如：查看 (但不能修改) 現有的資源或資料</td></tr><tr><td>roles/editor</td><td>所有 viewer 的權限，以及修改狀態的操作的權限，例如：修改現有資源</td></tr><tr><td>roles/owner</td><td>所有 editor 權限和以下操作的權限：<br>- 管理專案的角色和權限以及專案中的所有資源<br>- 設定專案的計費方式</td></tr></tbody></table><p>因此 editor 能夠建立、修改和刪除 GCP 資源。但是無法在 GCP 專案中新增或刪除 member。</p><h2 id="API-和服務"><a class="header-anchor" href="#API-和服務"></a>API 和服務</h2><p>Google Cloud API 是 GCP 中重要的部分。與服務類似，從企業管理到機器學習等領域的 200 多個 API 都可以輕鬆地與 GCP 專案和應用程式整合。</p><p>API 是 “Application Programming Interfaces”，可以直接或通過 Google Cloud client library 呼叫 (call) 它們。 Cloud API 使用官方的 <a href="https://cloud.google.com/apis/design/" target="_blank" rel="noopener">Google API Design Guide</a> 中描述的資源導向的設計原則。</p><p>當 Qwiklabs 為 lab instance 提供新的 GCP 專案時，它可以在背後啟用大多數的 API，以便你可以立即處理 lab 的任務。但要注意的事，當你在 Qwiklabs 之外建立自己的 GCP 專案時，必須自己啟用某些 API。</p><p>大多數雲端 API 會為你提供有關專案使用該 API 的詳細資訊 (包括流量、錯誤率、延遲時間)，幫助你快速找到使用 Google服務的應用程序問題。你可以通過打開導航選單並點擊「APIs &amp; Services &gt; Library」來查看此資訊：</p><p><img src="../images/getting-started-with-gcp/2019-04-14-17-53-30.gif" alt=""></p><p>在 API 搜尋欄中，輸入 “Dialogflow” 並選擇 Dialogflow API 後，就會看到下圖的頁面：</p><p><img src="../images/getting-started-with-gcp/2019-04-15-17-55-00.png" alt=""></p><p>Dialogflow API 可讓你建置對話式 (conversational) 應用程式 (例如，for Google Assistant)，而無需擔心底層機器學習和自然語言理解 (Natural Language Understanding) schema。</p><p>點擊「ENABLE」按鈕後會跳至新頁面，接著點擊瀏覽器的返回按鈕就可看到「API enabled」：</p><p><img src="../images/getting-started-with-gcp/2019-04-15-18-08-40.png" alt=""></p><p>點擊「Try this API」按鈕會以新分頁的方式開啟 Dialogflow API 的文件，並且可以指定可用的 API 方法。</p><p><img src="../images/getting-started-with-gcp/2019-04-15-22-01-55.png" alt=""></p><blockquote><p>詳情可查看 Google Cloud 中名為 <a href="https://developers.google.com/apis-explorer/#p/" target="_blank" rel="noopener">APIs Explorer</a> 的 hands-on 工具。</p></blockquote><h2 id="Cloud-Shell"><a class="header-anchor" href="#Cloud-Shell"></a>Cloud Shell</h2><p><a href="https://cloud.google.com/shell/docs/features" target="_blank" rel="noopener">Cloud Shell</a> 是在瀏覽器內的指令提示 (command prompt) 執行環境，允許你在終端提示 (terminal prompt) 下輸入指令來管理 GCP 專案中的資源和服務。Cloud Shell 能讓你在不離開 console 的情況下執行所有 shell 指令，並有預裝的 command-line 工具。</p><p>在 console 的右上角點擊「Activate Cloud Shell」按鈕，然後在出現提示時點擊「START CLOUD SHELL」按鈕：</p><p><img src="../images/getting-started-with-gcp/2019-04-15-19-08-40.gif" alt=""></p><p>接著會在 console 底部出現一個新的黑色視窗，視窗內會出現類似以下內容的訊息和提示，這代表你已啟動並執行 Cloud Shell session：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">Welcome to Cloud Shell! Type "help" to get started.<br>Your Cloud Platform project in this session is set to qwiklabs-gcp-76ad0f1342e20013.<br>Use "gcloud config set project [PROJECT_ID]" to change to a different project.<br>gcpstaging23396_student@cloudshell:~ (qwiklabs-gcp-76ad0f1342e20013)$<br></code></pre></td></tr></table></figure><p>接著將下面指令複製並貼 (或輸入) 至 Cloud Shell 上，然後按 Enter 鍵執行，應該會看到類似下面的輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud auth list</span><br>Credentialed Accounts<br>ACTIVE  ACCOUNT<br>*       gcpstaging23396_student@qwiklabs.net<br>To set the active account, run:<br>    $ gcloud config set account `ACCOUNT`<br></code></pre></td></tr></table></figure><p>其中 <code>ACTIVE ACCOUNT</code> 是設為你的 GCP IAM 身份 (也就是 <code>googlexxxxxx_student@qwiklabs.net</code> )，<a href="https://cloud.google.com/sdk/gcloud/reference/auth/list" target="_blank" rel="noopener"><code>gcloudauth list</code></a> 指令會列出 GCP 專案中有憑證的帳號。此帳號名稱與之前登入到 console 的 Qwiklabs 帳號相同。：</p><p>如之前所說的，Cloud Shell 預裝了特定的 command-line 工具，主要的 GCP toolkit 是 <a href="https://cloud.google.com/sdk/gcloud/" target="_blank" rel="noopener"><code>gcloud</code></a>，是用於平台上的許多任務，例如：資源管理和使用者身份驗證。除了預裝的 toolkit，Cloud Shell 還附帶標準的 unix CLI 工具和 <a href="https://www.nano-editor.org/" target="_blank" rel="noopener">nano</a> 等文字編輯器，在 Cloud Shell 中可以利用它們來建立和編輯檔案。</p><h2 id="參考來源"><a class="header-anchor" href="#參考來源"></a>參考來源</h2><ul><li><a href="https://www.qwiklabs.com/focuses/2794?parent=catalog" target="_blank" rel="noopener">A Tour of Qwiklabs and the Google Cloud Platform</a> (本篇大多數的圖片來源)</li></ul>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GCP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 GCP 上建立 VM 架設 NIGNX Web server</title>
      <link href="/article/gcp-vm-nignx-web-server.html"/>
      <url>/article/gcp-vm-nignx-web-server.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/gcp.jpg" alt=""></p><p>本篇是紀錄在 Google 的 Qwiklab 平台內，完成「<a href="https://www.qwiklabs.com/focuses/3563?parent=catalog" target="_blank" rel="noopener">Creating a Virtual Machine</a>」這個 quest 所學到的內容，包括如何透過 GCP Console 和 command-line 工具 <code>gcloud</code> 在 GCP 建立 instance，如何使用 <code>gcloud</code> 透過 SSH 連接到你的 instance，以及如何在 VM 上部署 NIGNX web server。</p><a id="more"></a><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-13-47-05.png" alt=""></p><p>透過 Google Compute Engine，可在 Google 基礎架構上，建立執行不同作業系統的 VM (virtual machine，虛擬機)，包括多種 Linux (Debian、Ubuntu、Suse、Red Hat、CoreOS) 和 Windows Server。</p><p>可以學到如何使用 Google Cloud Platform (GCP) Console 和 <code>gcloud</code> command-line 建立各種機器類型的虛擬機 instance (實例)，還能學習如何將 NGINX web server 連接到 VM。</p><blockquote><p>若想了解如何 <a href="./gcp-vm-windows-server.html">在 GCP 上建立 VM 架設 Windows Server</a> 可參考此篇。</p></blockquote><h2 id="本篇將會做什麼？"><a class="header-anchor" href="#本篇將會做什麼？"></a>本篇將會做什麼？</h2><ul><li>使用 GCP Console 建立 VM</li><li>使用 <code>gcloud</code> command-line 建立 VM</li><li>在 VM 上部署 web server</li></ul><h2 id="準備"><a class="header-anchor" href="#準備"></a>準備</h2><p>在點擊「Start Lab」之前，準備好網路瀏覽器 (推薦用 Google Chrome)，並且至少 40 分鐘可以專注的時間，因為 lab 是有時間限制，當你按下「Start Lab」開始學習時，無法暫停倒數計時，你只能在這段時間內使用 lab 提供給你的全新暫時 GCP Console 可用帳號，時間到之後的幾分鐘就會自動登出。</p><div class="warning"><p>注意：如果你有自己的個人 GCP 帳號或專案，請不要在此 lab 使用</p></div><h2 id="開始你的-Lab，然後登入-GCP-Console"><a class="header-anchor" href="#開始你的-Lab，然後登入-GCP-Console"></a>開始你的 Lab，然後登入 GCP Console</h2><ol><li>如果準備要開始，可以點擊右上角的「Start Lab」開始：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-13-47-32.png" alt=""></p><ol start="2"><li>接著會出現這個畫面，因為我參加 <a href="https://www.facebook.com/events/2005848903055499/" target="_blank" rel="noopener">GDG Tainan</a> 的活動，活動有提供 Qwiklabs 一個月的免費額度，所以我點選下圖左邊的「Use Subscription」：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-21-15.png" alt=""></p><ol start="3"><li>Lab 會提供給你免費暫時的 GCP 帳號，複製帳號和密碼，然後點擊「Open Google Console」開啟 <a href="https://cloud.google.com/storage/docs/cloud-console" target="_blank" rel="noopener">GCP Console</a>：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-15-33-31.png" alt=""></p><p>圖片來源：<a href="https://www.qwiklabs.com/focuses/3563?parent=catalog" target="_blank" rel="noopener">Creating a Virtual Machine | Qwiklabs</a></p><ol start="4"><li>接著就會開啟登入頁面，建議另外開 Chrome 無痕模式來登入 lab 提供的帳號和密碼，因為 Chrome 會紀錄帳密，現在登入的只是暫時帳號，未來不需要用到：</li></ol><div class="warning"><p>注意：這邊是登入 lab 提供的帳號 (也就是 email 必須為 <code>googlexxxxxx_student@qwiklabs.net</code> )，如果你有自己的 GCP 帳號，請不要用於此 lab，避免產生費用</p><blockquote><p>類似於 <code>googlexxxxxx_student@qwiklabs.net</code> 的帳號是一個 Google 帳號，專為 Qwiklabs 學生使用而建立的。它具有特定的域名 (也就是 <code>qwiklabs.net</code> )，並且已分配了 IAM 角色，允許你去存取該 GCP 專案。</p></blockquote></div><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-22-30.png" alt=""></p><ol start="5"><li>接受 terms 和 conditions：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-22-59.png" alt=""></p><ol start="6"><li>不要新增 recovery options 或 two-factor authentication (因為這是一個臨時帳號)</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-23-18.png" alt=""></p><ol start="7"><li>勾選同意服務條款：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-24-15.png" alt=""></p><p>之後就可以開始使用 GCP Console 囉：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-14-14-23-55.png" alt=""></p><h2 id="啟動-Google-Cloud-Shell"><a class="header-anchor" href="#啟動-Google-Cloud-Shell"></a>啟動 Google Cloud Shell</h2><p>Google Cloud Shell 是載入了開發工具的 VM，它提供 5GB 的 home 目錄，並在 Google Cloud 上執行。可用 Google Cloud Shell 提供的 command-line 來存取 GCP 的資源。</p><ol><li>在 GCP console 的右上方工具列中，點擊「Activate Cloud Shell」按鈕：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-24-42.png" alt=""></p><ol start="2"><li>在打開的對話框內，點擊「START CLOUD SHELL」：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-25-23.png" alt=""></p><ol start="3"><li>連接和提供環境需要一些時間：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-26-05.png" alt=""></p><ol start="4"><li>連接後，就代表你已經過身份驗證，專案已設置為 <code>PROJECT_ID</code>，以下圖的為例，此專案的 ID 為 <code>qwiklabs-gcp-f9d61ede8167e6b0</code>：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-26-34.png" alt=""></p><p><code>gcloud</code> 是 GCP 的 command-line 工具，他已預先安裝在 Cloud Shell 上，並且支援 tab 自動補齊 (tab-completion)。</p><p>未來可使用 <code>gcloud</code> 的下面指令並透過 <code>PROJECT_ID</code> 來更換成其他專案：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config <span class="hljs-built_in">set</span> project [PROJECT_ID]</span><br></code></pre></td></tr></table></figure><p>使用下面指令可列出有效帳號名稱：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud auth list</span><br>          Credentialed Accounts<br>ACTIVE  ACCOUNT<br>*       google3043863_student@qwiklabs.net<br><br>To set the active account, run:<br>    $ gcloud config set account `ACCOUNT`<br></code></pre></td></tr></table></figure><p>可以使用以下指令列出專案 ID：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config list project</span><br>[core]<br>project = qwiklabs-gcp-f9d61ede8167e6b0<br><br>Your active configuration is: [cloudshell-9292]<br></code></pre></td></tr></table></figure><h2 id="理解-Regions-和-Zones"><a class="header-anchor" href="#理解-Regions-和-Zones"></a>理解 Regions 和 Zones</h2><p>Compute Engine 資源位於不同的 regions (地區) 或 zones (區域)。region 是你可以執行資源的所在特定地理位置。每個 region 都有一個或多個 zones。例如，<code>us-central1</code> region 代表美國中部地區，其中包含的 Zones 有 <code>us-central1-a</code>、<code>us-central1-b</code>、<code>us-central1-c</code> 與 <code>us-central1-f</code>。</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-17-58-23.png" alt=""></p><p>圖片來源：<a href="https://www.qwiklabs.com/focuses/3563?parent=catalog" target="_blank" rel="noopener">Creating a Virtual Machine | Qwiklabs</a></p><p>位於 zone 中的資源都稱為 zonel (區域) 資源，VM instance (實例) 和 persistent disk (永久磁碟) 都位於 zone 中，如果要將 persistent disk 附加到 VM instance，這兩個資源都必須位於同一個 zone 中。同樣，如果要將靜態 IP 位址分配到 instance，此 instance 就必須與靜態 IP 位於同一個 region 中。</p><blockquote><p>詳情可參考 GCP 官方的 <a href="https://cloud.google.com/compute/docs/regions-zones/" target="_blank" rel="noopener">Regions &amp; Zones</a> 文件。</p></blockquote><h2 id="從-Cloud-Console-建立新的-instance"><a class="header-anchor" href="#從-Cloud-Console-建立新的-instance"></a>從 Cloud Console 建立新的 instance</h2><p>在 GCP Console 的右上角，點選「Navigation menu &gt; Compute Engine &gt; VM Instances」：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-18-16-42.png" alt=""></p><p>接著點擊「Create」建立新的 instance：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-31-03.png" alt=""></p><p>建立新的 instance 時可以設定很多參數。在此 lab 中會使用以下設定：</p><table><thead><tr><th>欄位</th><th>值</th><th>額外資訊</th></tr></thead><tbody><tr><td>name</td><td><code>gcelab</code></td><td></td></tr><tr><td>region</td><td><code>us-central1 (Iowa)</code><br>或<br><code>asia-south1 (Mumbai)</code></td><td><a href="https://cloud.google.com/compute/docs/regions-zones/" target="_blank" rel="noopener">更多關於 regions 的資訊</a></td></tr><tr><td>zone</td><td><code>us-central1-c</code><br>或<br><code>asia-south1-c</code><br>注意：記住你選擇的 zone，之後會用到</td><td><a href="https://cloud.google.com/compute/docs/regions-zones/" target="_blank" rel="noopener">更多關於 zones 的資訊</a></td></tr><tr><td>Machine Type</td><td><code>2 vCPU</code><br>這是一個 ( <code>n1-standard-2</code> )<br>2-CPU, 7.5 GB RAM instance<br><br>有很多機型可以選擇，從 micro instance 類型的到 32-core/208 GB RAM 的都有，詳情可參考<a href="https://cloud.google.com/compute/docs/machine-types" target="_blank" rel="noopener">機型種類</a>文件</td><td>注意：新專案具有預設的<a href="https://cloud.google.com/compute/quotas" target="_blank" rel="noopener">資源配額</a>，可能會限制 CPU 核心數。可在此 lab 之外的專案上申請到更高的規格</td></tr><tr><td>Boot Disk</td><td><code>New 10 GB standard persistent disk</code><br><code>OS Image: Debian GNU/Linux 9 (Stretch)</code></td><td>有很多 images 可以選擇，包括：Debian、Ubuntu、CoreOS，以及 premium images，像是 RedHat Enterprise Linux 和 Windows Server，詳情可參考 <a href="https://cloud.google.com/compute/docs/images" target="_blank" rel="noopener">OS</a> 文件</td></tr><tr><td>Firewall</td><td>勾選 <code>Allow HTTP traffic</code>，勾選此選項才能存取之後安裝的 web server</td><td>注意：這會自動建立防火牆規則，允許 80 port 的 HTTP 流量</td></tr></tbody></table><p>設定好之後，點擊「Create」：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-32-27.png" alt=""></p><p>等待 instance 建立：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-34-20.png" alt=""></p><p>看到下面畫面就代表 instance 已建立完成，接著點擊右邊的「SSH」按鈕，會開啟新的瀏覽器頁面：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-18-44-40.png" alt=""></p><p>此頁面是直接從瀏覽器啟動 SSH client 連接到 VM：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-35-45.png" alt=""></p><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/compute/docs/instances/connecting-to-instance" target="_blank" rel="noopener">Connect to an instance using ssh</a> 文件。</p></blockquote><h2 id="安裝-NGINX-web-server"><a class="header-anchor" href="#安裝-NGINX-web-server"></a>安裝 NGINX web server</h2><ol><li>透過 SSH 連接 VM 之後，請使用 <code>sudo</code> 取得 <code>root</code> 的存取權限：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo su -</span><br></code></pre></td></tr></table></figure><ol start="2"><li>更新 OS：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> apt-get update</span><br>Get:1 http://security.debian.org stretch/updates InRelease [94.3 kB]<br>Ign:2 http://deb.debian.org/debian stretch InRelease      <br>Get:3 http://deb.debian.org/debian stretch-updates InRelease [91.0 kB]     <br>...<br></code></pre></td></tr></table></figure><ol start="3"><li>安裝 NGINX：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> apt-get install nginx -y</span><br></code></pre></td></tr></table></figure><ol start="4"><li>檢查 NGINX 是否正在執行：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ps auwx | grep nginx</span><br>root      2339  0.0  0.0 159532  1628 ?        Ss   06:37   0:00 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;<br>www-data  2340  0.0  0.0 159864  3200 ?        S    06:37   0:00 nginx: worker process<br>www-data  2341  0.0  0.0 159864  3200 ?        S    06:37   0:00 nginx: worker process<br>root      2350  0.0  0.0  12780   952 pts/0    S+   06:37   0:00 grep nginx<br></code></pre></td></tr></table></figure><div class="info"><p>註：如果關掉 NGINX 就不會出現關於 NGINX 的 process：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">$ service nginx stop<br><br>$ ps auwx | grep nginx<br>root      2359  0.0  0.0  12780  1012 pts&#x2F;0    S+   14:23   0:00 grep nginx<br></code></pre></td></tr></table></figure><p>使用下面指令可以啟動 NGINX：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> service nginx start</span><br></code></pre></td></tr></table></figure></div><ol start="5"><li>回到 Cloud Console，並點擊 VM instance 的 External IP 連結：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-38-31.png" alt=""></p><ol start="6"><li>就會開啟新分頁，可以看到 NGINX web server 的預設網頁：</li></ol><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-41-35.png" alt=""></p><h2 id="使用-gcloud-建立新的-instance"><a class="header-anchor" href="#使用-gcloud-建立新的-instance"></a>使用 gcloud 建立新的 instance</h2><p>前面介紹的是利用 GCP Console 來建立 VM instance，這邊要介紹的是可以使用預裝在 <a href="https://cloud.google.com/shell/#how_do_i_get_started" target="_blank" rel="noopener">Google Cloud Shell</a> 中的 command-line 工具 <code>gcloud</code> 來完成一樣的事。Cloud Shell 是基於 Debian 的 VM，預載你所需的所有開發工具 (<code>gcloud</code>、<code>git</code> … 等其他)，並提供 5 GB persistent disk 的 home 目錄。</p><blockquote><p>詳情可參考 <a href="https://cloud.google.com/sdk/gcloud/" target="_blank" rel="noopener">gcloud command line tool guide</a>。</p></blockquote><p>在 Cloud Shell 使用 command-line 工具 <code>gcloud</code> 建立一台新的 VM instance，將 <code>[YOUR_ZONE]</code> 替換成前面使用的 zone：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute instances create gcelab2 --machine-type n1-standard-2 --zone [your_zone]</span><br></code></pre></td></tr></table></figure><p>像我前面的 zone 是用 <code>asia-south1-c</code>，所以指令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute instances create gcelab2 --machine-type n1-standard-2 --zone asia-south1-c</span><br>Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-f9d61ede8167e6b0/zones/asia-south1-c/instances/gcelab2].<br>NAME     ZONE           MACHINE_TYPE   PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP   STATUS<br>gcelab2  asia-south1-c  n1-standard-2               10.160.0.3   35.244.6.170  RUNNING<br></code></pre></td></tr></table></figure><p>建立的 instance 具有以下預設值：</p><ul><li>最新的 <a href="https://cloud.google.com/compute/docs/images#debian" target="_blank" rel="noopener">Debian 9 (stretch)</a> image</li><li>預設機型 (machine type) 為 <code>n1-standard-2</code>，在此 lab 中，你也可以使用 <code>n1-highmem-4</code> 或 <code>n1-highcpu-4</code> 其他<a href="https://cloud.google.com/compute/docs/machine-types" target="_blank" rel="noopener">機型</a>。在 lab 之外的專案可以指定<a href="https://cloud.google.com/compute/docs/instances/creating-instance-with-custom-machine-type" target="_blank" rel="noopener">自訂的機型</a></li><li>root persistent disk 預設與 instance 的名稱一樣，disk 會自動附加到 instance</li></ul><p>執行下面指令可以查看所有預設值：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute instances create --<span class="hljs-built_in">help</span></span><br></code></pre></td></tr></table></figure><div class="info"><p>Note：如果你總是使用同一個 region/zone，並且不希望每次都使用 <code>--zone</code> 參數，就可以使用下面指令，將指定的 region 和 zones 設為預設：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud config <span class="hljs-built_in">set</span> compute/zone ...</span><br><span class="hljs-meta">$</span><span class="bash"> gcloud config <span class="hljs-built_in">set</span> compute/region ...</span><br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考官方的 <a href="https://cloud.google.com/compute/docs/gcloud-compute/#default-properties" target="_blank" rel="noopener">gcloud compute | Compute Engine Documentation</a> 文件。</p></blockquote></div><p>若要查看剛剛建立的 instance 是否成功建立，就要回到「Navigation menu &gt; Compute Engine &gt; VM Instances」頁面，如果還是沒有看到，就可以點擊「REFRESH」按鈕重新整理此頁面，應該就會看到剛剛建立名為 <code>gcelab2</code> 的 instance：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-45-59.png" alt=""></p><p>接著你也可以使用 <code>gcloud</code> 透過 SSH 連接到你的 instance，連線時，請確認指令後面 <code>--zone</code> 參數的 <code>[YOUR_ZONE]</code> 是否和當初建立的一樣，或是如果你已在全域設定預設 (上面 Note 提到的部分)，就可以省略 <code>--zone</code> 參數：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute ssh gcelab2 --zone [YOUR_ZONE]</span><br></code></pre></td></tr></table></figure><p>像我沒有在全域設定預設，所以需要在指令後面加上 <code>--zone</code> 參數，<code>[YOUR_ZONE]</code> 則是當初建立的 <code>asia-south1-c</code>，指令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute ssh gcelab2 --zone asia-south1-c</span><br>WARNING: The public SSH key file for gcloud does not exist.<br>WARNING: The private SSH key file for gcloud does not exist.<br>WARNING: You do not have an SSH key for gcloud.<br>WARNING: SSH keygen will be executed to generate a key.<br>This tool needs to create the directory<br>[/home/google3043863_student/.ssh] before being able to generate SSH<br>keys.<br><br>Do you want to continue (Y/n)?<br></code></pre></td></tr></table></figure><p>接著會出現下面畫面，請輸入 <code>Y</code> 繼續：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Do you want to continue (Y/n)?  y<br></code></pre></td></tr></table></figure><p>此時會產生一對公鑰 (public key) 和私鑰 (private key)，接著按 <code>Enter</code> 鍵，不輸入也不設定 passphrase (如果是在真正的專案就建議輸入 passphrase，因為當別人拿走你的私鑰時，就無法直接登入主機，還要輸入 passphrase，安全性會比較高)：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs plain">Generating public&#x2F;private rsa key pair.<br>Enter passphrase (empty for no passphrase):<br>Enter same passphrase again:<br>Your identification has been saved in &#x2F;home&#x2F;google3043863_student&#x2F;.ssh&#x2F;google_compute_engine.<br>Your public key has been saved in &#x2F;home&#x2F;google3043863_student&#x2F;.ssh&#x2F;google_compute_engine.pub.<br>The key fingerprint is:<br>SHA256:LJMylIaZY1aNf2v0uP&#x2F;a83TSVw506GazmtvrTyPCxqU google3043863_student@cs-6000-devshell-vm-8e6e4e18-0f7e-4771-ac48-22ab57ceb161<br>The key&#39;s randomart image is:<br>+---[RSA 2048]----+<br>|    .o           |<br>|   &#x3D;...        . |<br>|  B +.        o .|<br>| o +  .oo    o . |<br>|    o +oS+   .* .|<br>|     o o+ + oo *.|<br>|       . . E .+.*|<br>|        . ..o&#x3D;.+o|<br>|         .oo*&#x3D;&#x3D;o.|<br>+----[SHA256]-----+<br>Warning: Permanently added &#39;compute.3226821850929314737&#39; (ECDSA) to the list of known hosts.<br>Linux gcelab2 4.9.0-8-amd64 #1 SMP Debian 4.9.144-3.1 (2019-02-19) x86_64<br><br>The programs included with the Debian GNU&#x2F;Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in &#x2F;usr&#x2F;share&#x2F;doc&#x2F;*&#x2F;copyright.<br><br>Debian GNU&#x2F;Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Creating directory &#39;&#x2F;home&#x2F;google3043863_student&#39;.<br></code></pre></td></tr></table></figure><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-48-46.png" alt=""></p><h2 id="使用-gcloud-設定防火牆"><a class="header-anchor" href="#使用-gcloud-設定防火牆"></a>使用 gcloud 設定防火牆</h2><p>如果我已經跟著之前的步驟安裝完 NGINX 了，就會發現剛剛建立的 instance 沒有做防火牆設定，也就是不允許 80 port 的 HTTP 流量，所以就可以是用下面指令來設定：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud compute firewall-rules create nginx --allow tcp:80</span><br></code></pre></td></tr></table></figure><p>執行指令後會看到下面訊息，訊息內容是無法建立防火牆，這是因為請求的身分權限不足：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Creating firewall...failed.<br>ERROR: (gcloud.compute.firewall-rules.create) Could not fetch resource:<br> - Insufficient Permission: Request had insufficient authentication scopes.<br></code></pre></td></tr></table></figure><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-55-44.png" alt=""></p><p>那如何知道目前的有效帳號名稱？可以使用下面指令來查看，可以看到目前的帳號不是之前 lab 暫時給我們用的帳號：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud auth list</span><br>                  Credentialed Accounts<br>ACTIVE  ACCOUNT<br>*       721269751803-compute@developer.gserviceaccount.com<br><br>To set the active account, run:<br>    $ gcloud config set account `ACCOUNT`<br></code></pre></td></tr></table></figure><p>所以必須登入之前的帳號，可以使用下面指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud auth login</span><br>You are running on a Google Compute Engine virtual machine.<br>It is recommended that you use service accounts for authentication.<br><br>You can run:<br><br><span class="hljs-meta">  $</span><span class="bash"> gcloud config <span class="hljs-built_in">set</span> account `ACCOUNT`</span><br><br>to switch accounts if necessary.<br><br>Your credentials may be visible to others with access to this<br>virtual machine. Are you sure you want to authenticate with<br>your personal account?<br><br>Do you want to continue (Y/n)?<br></code></pre></td></tr></table></figure><p>接著會出現下面畫面，請輸入 <code>Y</code> 繼續：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Do you want to continue (Y/n)?<br></code></pre></td></tr></table></figure><p>接著會出現一長串的連結，點擊這個連結：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">Do you want to continue (Y/n)?  y<br><br>Go to the following link in your browser:<br><br>    https://accounts.google.com/o/oauth2/auth?redirect_uri=urn%3Aietf%3Awg%3Aoauth%3A2.0%3Aoob&amp;prompt=select_account&amp;response_type=code&amp;client_id=32555940559.apps.googleusercontent.com&amp;scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fappengine.admin+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcompute+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Faccounts.reauth&amp;access_type=offline<br><br><br>Enter verification code:<br></code></pre></td></tr></table></figure><p>該連結就是要你用 lab 提供的帳號登入：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-56-52.png" alt=""></p><p>接著要同意 Google Cloud SDK 存取此帳號：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-14-57-02.png" alt=""></p><p>接著複製此授權碼，將授權碼貼至剛剛的 shell：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-20-16-05.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">Enter verification code: 4&#x2F;KwEnGIyzJ0P_ZvFeKt5264lP_3CdzZhUb-ZXoEJ0TbVFQVUQyYSBF58<br>WARNING: &#96;gcloud auth login&#96; no longer writes application default credentials.<br>If you need to use ADC, see:<br>  gcloud auth application-default --help<br><br>You are now logged in as [google3043863_student@qwiklabs.net].<br>Your current project is [qwiklabs-gcp-f9d61ede8167e6b0].  You can change this setting by running:<br>  $ gcloud config set project PROJECT_ID<br></code></pre></td></tr></table></figure><p>登入成功後，可以再次執行下面指令看一下目前有效帳號的名稱，變成 lab 暫時給我們用的帳號囉：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> gcloud auth list</span><br>                  Credentialed Accounts<br>ACTIVE  ACCOUNT<br>        721269751803-compute@developer.gserviceaccount.com<br>*       google3043863_student@qwiklabs.net<br><br>To set the active account, run:<br>    $ gcloud config set account `ACCOUNT`<br></code></pre></td></tr></table></figure><p>接著再次執行下面指令，就可以成功設定防火牆：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">$ gcloud compute firewall-rules create nginx --allow tcp:80<br>Creating firewall...⠶Created [https:&#x2F;&#x2F;www.googleapis.com&#x2F;compute&#x2F;v1&#x2F;projects&#x2F;qwiklabs-gcp-f9d61ede8167e6b0&#x2F;global&#x2F;firewalls&#x2F;nginx].<br>Creating firewall...done.<br>NAME   NETWORK  DIRECTION  PRIORITY  ALLOW   DENY  DISABLED<br>nginx  default  INGRESS    1000      tcp:80        False<br></code></pre></td></tr></table></figure><p>雖然 GCP Console 介面上 VM instance 的 External IP 沒有變成可以點擊的連結，但可以將 External IP 複製到新的瀏覽器分頁：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-15-00-02.png" alt=""></p><p>就能成功看到 NGINX web server 的預設網頁：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-21-04-14.png" alt=""></p><p>下圖就是我成功完成此 quest 的畫面：</p><p><img src="../images/gcp-vm-nignx-web-server/2019-04-13-15-01-08.png" alt=""></p><h2 id="參考來源"><a class="header-anchor" href="#參考來源"></a>參考來源</h2><ul><li><a href="https://www.qwiklabs.com/focuses/3563?parent=catalog" target="_blank" rel="noopener">Creating a Virtual Machine | Qwiklabs</a></li><li><a href="https://google.qwiklabs.com/focuses/2794?parent=catalog" target="_blank" rel="noopener">A Tour of Qwiklabs and the Google Cloud Platform | Qwiklabs</a></li><li><a href="https://tn710617.github.io/zh-tw/createAVirtualMachineInGCP/" target="_blank" rel="noopener">在 GCP 上開立一台虛擬機 | Ray’s Coding Journey</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GCP </tag>
            
            <tag> VM </tag>
            
            <tag> NIGNX </tag>
            
            <tag> Web Server </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python 爬蟲常用技巧 (持續更新)</title>
      <link href="/article/python-crawler-note.html"/>
      <url>/article/python-crawler-note.html</url>
      
        <content type="html"><![CDATA[<p>紀錄個人常用的 Python 爬蟲技巧，未來還會持續更新其他技巧。</p><a id="more"></a><h2 id="載入常用套件"><a class="header-anchor" href="#載入常用套件"></a>載入常用套件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> shutil<br><span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> ET<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlparse, parse_qs, urlunparse<br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">from</span> user_agent <span class="hljs-keyword">import</span> generate_user_agent<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br></code></pre></td></tr></table></figure><h2 id="解析-HTML"><a class="header-anchor" href="#解析-HTML"></a>解析 HTML</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><br>response = requests.get(url)<br>soup = BeautifulSoup(response.text, <span class="hljs-string">'lxml'</span>)<br>html = soup.find(id=<span class="hljs-string">'some_id'</span>)<br></code></pre></td></tr></table></figure><h2 id="解析網址"><a class="header-anchor" href="#解析網址"></a>解析網址</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlparse, parse_qs, urlunparse<br><br>url = <span class="hljs-string">'http://xxx.com/api/data?id=123&amp;sub_code=06A1297'</span><br>link_parse = urlparse(url)<br>print(link_parse)<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">ParseResult(scheme&#x3D;&#39;http&#39;, netloc&#x3D;&#39;xxx.com&#39;, path&#x3D;&#39;&#x2F;api&#x2F;data&#39;, params&#x3D;&#39;&#39;, query&#x3D;&#39;id&#x3D;123&amp;sub_code&#x3D;06A1297&#39;, fragment&#x3D;&#39;&#39;)<br></code></pre></td></tr></table></figure><h3 id="將-ParseResult-物件轉成網址字串"><a class="header-anchor" href="#將-ParseResult-物件轉成網址字串"></a>將 <code>ParseResult</code> 物件轉成網址字串</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">url = urlunparse(link_parse)<br>print(url)<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#39;http:&#x2F;&#x2F;xxx.com&#x2F;api&#x2F;data?id&#x3D;123&amp;sub_code&#x3D;06A1297&#39;<br></code></pre></td></tr></table></figure><h3 id="解析網址-query"><a class="header-anchor" href="#解析網址-query"></a>解析網址 query</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">link_query = parse_qs(link_parse.query)<br>print(link_query)<br><br>id = link_query[<span class="hljs-string">'id'</span>][<span class="hljs-number">0</span>]<br>sub_code = link_query[<span class="hljs-string">'sub_code'</span>][<span class="hljs-number">0</span>]<br>print(id, sub_code)<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;&#39;id&#39;: [&#39;123&#39;], &#39;sub_code&#39;: [&#39;06A1297&#39;]&#125;<br>123 06A1297<br></code></pre></td></tr></table></figure><h2 id="隨機生成-user-agent"><a class="header-anchor" href="#隨機生成-user-agent"></a>隨機生成 user-agent</h2><h3 id="fake-useragent-套件"><a class="header-anchor" href="#fake-useragent-套件"></a>fake_useragent 套件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> fake_useragent <span class="hljs-keyword">import</span> UserAgent<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_header_user_agent</span><span class="hljs-params">()</span>:</span><br>    user_agent = UserAgent()<br>    <span class="hljs-keyword">return</span> user_agent.random<br><br>user_agent = set_header_user_agent()<br>response = requests.get(url, headers=&#123; <span class="hljs-string">'user-agent'</span>: user_agent &#125;)<br></code></pre></td></tr></table></figure><h3 id="user-agent-套件"><a class="header-anchor" href="#user-agent-套件"></a>user_agent 套件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> user_agent <span class="hljs-keyword">import</span> generate_user_agent<br><br>user_agent = generate_user_agent()<br>response = requests.get(url, headers=&#123; <span class="hljs-string">'user-agent'</span>: user_agent &#125;)<br></code></pre></td></tr></table></figure><h2 id="讀取表格資料"><a class="header-anchor" href="#讀取表格資料"></a>讀取表格資料</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br>response = requests.get(url)<br>soup = BeautifulSoup(response.text, <span class="hljs-string">'lxml'</span>)<br>html = soup.find(id=<span class="hljs-string">'table_id'</span>)<br>df = pd.read_html(str(html), header=<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><h2 id="讀取-解析-JSON"><a class="header-anchor" href="#讀取-解析-JSON"></a>讀取/解析 JSON</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><br><span class="hljs-comment"># 讀取</span><br><span class="hljs-keyword">with</span> open(<span class="hljs-string">'data.json'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> file:<br>    datas = json.load(file)<br><br><span class="hljs-comment"># 解析</span><br><span class="hljs-keyword">with</span> open(<span class="hljs-string">'data.json'</span>, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> file:<br>    json.dump(datas, file, ensure_ascii=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure><h2 id="讀取-解析-XML"><a class="header-anchor" href="#讀取-解析-XML"></a>讀取/解析 XML</h2><h3 id="讀取-XML-檔"><a class="header-anchor" href="#讀取-XML-檔"></a>讀取 XML 檔</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> ET<br><br>tree = ET.parse(<span class="hljs-string">'data.xml'</span>)<br>root = tree.getroot()<br></code></pre></td></tr></table></figure><h3 id="讀取-XML-字串"><a class="header-anchor" href="#讀取-XML-字串"></a>讀取 XML 字串</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> ET<br><br>root = ET.fromstring(some_xml_strings)<br></code></pre></td></tr></table></figure><p>以下面的 XML 為範例：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bookstore</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">ISBN</span>=<span class="hljs-string">"10-000000-001"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Book 1<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>300<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">comments</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">userComment</span> <span class="hljs-attr">rating</span>=<span class="hljs-string">"4"</span>&gt;</span>xxx...<span class="hljs-tag">&lt;/<span class="hljs-name">userComment</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">userComment</span> <span class="hljs-attr">rating</span>=<span class="hljs-string">"2"</span>&gt;</span>yyy...<span class="hljs-tag">&lt;/<span class="hljs-name">userComment</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">comments</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">ISBN</span>=<span class="hljs-string">"10-000000-999"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Book 2<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>500<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">comments</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">userComment</span> <span class="hljs-attr">rating</span>=<span class="hljs-string">"3"</span>&gt;</span>zzz...<span class="hljs-tag">&lt;/<span class="hljs-name">userComment</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">comments</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bookstore</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="迴圈取得子元素"><a class="header-anchor" href="#迴圈取得子元素"></a>迴圈取得子元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> root:<br>    print(child.tag, child.attrib)<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">book &#123;&#39;ISBN&#39;: &#39;10-000000-001&#39;&#125;<br>book &#123;&#39;ISBN&#39;: &#39;10-000000-999&#39;&#125;<br></code></pre></td></tr></table></figure><h3 id="用-index-取得某元素"><a class="header-anchor" href="#用-index-取得某元素"></a>用 index 取得某元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">root[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>].tag<br>root[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>].text<br>root[<span class="hljs-number">0</span>].attrib<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#39;price&#39;<br>&#39;300&#39;<br>&#123;&#39;ISBN&#39;: &#39;10-000000-001&#39;&#125;<br></code></pre></td></tr></table></figure><h3 id="搜尋指定元素"><a class="header-anchor" href="#搜尋指定元素"></a>搜尋指定元素</h3><p>使用 <code>root.iter()</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> comment <span class="hljs-keyword">in</span> root.iter(<span class="hljs-string">'userComment'</span>):<br>    print(comment.attrib)<br>    print(<span class="hljs-string">'comment: &#123;&#125;'</span>.format(comment.text))<br></code></pre></td></tr></table></figure><p>輸出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;&#39;rating&#39;: &#39;4&#39;&#125;<br>comment: xxx...<br>&#123;&#39;rating&#39;: &#39;2&#39;&#125;<br>comment: yyy...<br>&#123;&#39;rating&#39;: &#39;3&#39;&#125;<br>comment: zzz...<br></code></pre></td></tr></table></figure><p>使用 <code>root.findall()</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> root.findall(<span class="hljs-string">'book'</span>):<br>    ISBN = book.get(<span class="hljs-string">'ISBN'</span>)<br>    title = book.find(<span class="hljs-string">'title'</span>).text<br>    print(ISBN, title)<br></code></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">10-000000-001 Book 1<br>10-000000-999 Book 2<br></code></pre></td></tr></table></figure><h2 id="下載圖片"><a class="header-anchor" href="#下載圖片"></a>下載圖片</h2><p><code>response.raw</code> 是 file-like 物件，預設不會解壓縮 response (使用 gzip 或 deflate，參考至 <a href="https://github.com/kennethreitz/requests/blob/master/requests/utils.py#L808" target="_blank" rel="noopener">Requests 原始碼</a>)，可以透過在 <code>requests.get()</code> 方法中，新增參數 <code>stream=True</code> 來強制解壓縮，並且可以避免立即將大的 response 內容讀入記憶體內，接著使用 <code>shutil.copyfileobj()</code> 讓 Python 將 串流資料轉成檔案物件。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> shutil<br><br>url = <span class="hljs-string">"http://www.xxx.com/xxx.png"</span><br>response = requests.get(url, stream=<span class="hljs-literal">True</span>)<br>file_name = url.split(<span class="hljs-string">'/'</span>)[<span class="hljs-number">-1</span>]<br><span class="hljs-keyword">with</span> open(file_name, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> file:<br>    shutil.copyfileobj(response.raw, file)<br></code></pre></td></tr></table></figure><p>如果要下載檔案大的圖片，可參考下個段落「<a href="#%E4%B8%8B%E8%BC%89%E5%A4%A7%E6%AA%94%E6%A1%88">下載大檔案</a>」。</p><div class="info"><p><code>shutil.copyfileobj(fsrc, fdst[, length])</code>：將 file-like 物件 <code>fsrc</code> 的內容複製到 file-like 物件 <code>fdst</code>。<code>length</code> 參數 (int) 是 buffer 的大小。如果 <code>length</code> 為負數則代表是複製資料，而不以 chunk 的形式循環原始資料；預設是資料以 chunk 的形式讀取，以避免不受控制的記憶體消耗。請注意，如果 <code>fsrc</code> 物件的當前檔案位置不為 0，則只複製從當前檔案位置到檔案末端的內容。</p><blockquote><p>參考至 <a href="https://docs.python.org/3/library/shutil.html#shutil.copyfileobj" target="_blank" rel="noopener">shutil - High-level file operations - Python 3.7.3 documentation</a> 官方文件。</p></blockquote></div><blockquote><p>參考來源：<a href="https://stackoverflow.com/questions/13137817/how-to-download-image-using-requests" target="_blank" rel="noopener">python - How to download image using requests - Stack Overflow</a></p></blockquote><h2 id="下載大檔案"><a class="header-anchor" href="#下載大檔案"></a>下載大檔案</h2><p>以迭代的方式取得，預設會以每 128 byte 為一個 chunk 來讀取資料 (參考至 <a href="https://github.com/kennethreitz/requests/blob/master/requests/models.py#L688" target="_blank" rel="noopener">Requests 原始碼</a>)：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>response = requests.get(url, stream=<span class="hljs-literal">True</span>)<br>file_name = url.split(<span class="hljs-string">'/'</span>)[<span class="hljs-number">-1</span>]<br><span class="hljs-keyword">with</span> open(file_name, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> file:<br>    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> response:<br>        file.write(chunk)<br></code></pre></td></tr></table></figure><p>若要自訂 chunk 大小，可使用 <a href="https://github.com/kennethreitz/requests/blob/master/requests/models.py#L729" target="_blank" rel="noopener"><code>Response.iter_content()</code></a> 方法自訂：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>file_name = url.split(<span class="hljs-string">'/'</span>)[<span class="hljs-number">-1</span>]<br><span class="hljs-keyword">with</span> requests.get(url, stream=<span class="hljs-literal">True</span>) <span class="hljs-keyword">as</span> response:<br>    response.raise_for_status()<br>    <span class="hljs-keyword">with</span> open(file_name, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> file:<br>        <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> response.iter_content(chunk_size=<span class="hljs-number">8192</span>):<br>            <span class="hljs-keyword">if</span> chunk: <span class="hljs-comment"># filter out keep-alive new chunks</span><br>                file.write(chunk)<br>                <span class="hljs-comment"># file.flush()</span><br></code></pre></td></tr></table></figure><blockquote><p>參考來源：<a href="https://stackoverflow.com/questions/16694907/download-large-file-in-python-with-requests" target="_blank" rel="noopener">Download large file in python with requests - Stack Overflow</a></p></blockquote><p>若想要以一次一行的方式迭代 response 資料，可使用 <a href="https://github.com/kennethreitz/requests/blob/master/requests/models.py#L784" target="_blank" rel="noopener"><code>Response.iter_lines()</code></a> 方法，此方法預設一個 chunk 的大小為 512 byte，若要設定分隔符號，可加上 <code>delimiter</code> 參數：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> requests<br><br>r = requests.get(url, stream=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> r.iter_lines():<br>    <span class="hljs-comment"># filter out keep-alive new lines</span><br>    <span class="hljs-keyword">if</span> line:<br>        print(json.loads(line))<br></code></pre></td></tr></table></figure><blockquote><p>參考來源：<a href="https://www.cnblogs.com/linxiyue/p/3980003.html" target="_blank" rel="noopener">Python Requests 庫：HTTP for Humans - 再見紫羅蘭 - 博客園</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> Crawler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python Requests </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Hexo 主題內新增程式碼片段複製功能</title>
      <link href="/article/hexo-copy-code-snippet-to-clipboard.html"/>
      <url>/article/hexo-copy-code-snippet-to-clipboard.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/hexo-copy-code-snippet-to-clipboard.jpg" alt=""></p><p>為了提高 blog 的使用體驗，本文將說明如何在 Hexo 主題內，提供程式碼片段複製至剪貼簿的功能。</p><a id="more"></a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// copy to clipboard</span><br><span class="hljs-keyword">var</span> clipboard = <span class="hljs-built_in">document</span>.querySelectorAll(<span class="hljs-string">'pre'</span>);<br></code></pre></td></tr></table></figure><h2 id="載入-clipboard-js"><a class="header-anchor" href="#載入-clipboard-js"></a>載入 clipboard.js</h2><p>在 <code>themes\material-flow\layout\_partial\scripts.ejs</code> 檔案內的載入 clipboard.js：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="新增程式碼片段複製功能"><a class="header-anchor" href="#新增程式碼片段複製功能"></a>新增程式碼片段複製功能</h2><p>每個程式碼片段內都要新增複製功能按鈕，下面說明新增複製按鈕的處理邏輯：</p><ol><li>首先要找到所有程式碼區塊：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> snippets = <span class="hljs-built_in">document</span>.querySelectorAll(<span class="hljs-string">'figure.highlight'</span>);<br></code></pre></td></tr></table></figure><ol start="2"><li>準備要新增的按鈕結構：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> htmlCopyButton = <span class="hljs-string">`</span><br><span class="hljs-string">  &lt;button class="codecopy-btn tooltipped tooltipped-sw" aria-label="Copy to clipboard"&gt;</span><br><span class="hljs-string">    &lt;i class="far fa-copy" aria-hidden="true"&gt;&lt;/i&gt;</span><br><span class="hljs-string">  &lt;/button&gt;`</span>;<br></code></pre></td></tr></table></figure><ol start="3"><li>在原本的程式碼區塊的 <code>&lt;figure&gt;</code> 標籤外多包了一層 <code>&lt;div&gt;</code> 標籤</li><li>在 <code>&lt;div&gt;</code> 標籤上新增 <code>.code-highlight</code> class 樣式</li><li>在 <code>&lt;div&gt;</code> 標籤上新增 <code>data-lang</code> 屬性用於記錄此程式碼區塊內的程式碼是哪種程式語言</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript">snippets.forEach(<span class="hljs-function"><span class="hljs-params">snippet</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">var</span> parent = snippet.parentNode;<br>  <span class="hljs-keyword">var</span> wrapper = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);<br><br>  parent.replaceChild(wrapper, snippet);<br>  wrapper.appendChild(snippet);<br><br>  wrapper.classList.add(<span class="hljs-string">'code-highlight'</span>);<br>  wrapper.firstChild.insertAdjacentHTML(<span class="hljs-string">'beforebegin'</span>, htmlCopyButton);<br><br>  <span class="hljs-keyword">var</span> lang = (snippet.classList[<span class="hljs-number">1</span>] || <span class="hljs-string">'code'</span>).toUpperCase();<br>  wrapper.setAttribute(<span class="hljs-string">'data-lang'</span>, lang);<br>&#125;);<br></code></pre></td></tr></table></figure><ol start="6"><li>接著將名為 <code>.codecopy-btn</code> 的 element 上新增複製功能，複製的內容是 <code>&lt;figure&gt;</code> 標籤內的程式碼：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> clipboard = <span class="hljs-keyword">new</span> ClipboardJS(<span class="hljs-string">'.codecopy-btn'</span>, &#123;<br>  target: <span class="hljs-function"><span class="hljs-params">trigger</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> trigger.nextSibling;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure><ol start="7"><li>只要按複製按鈕且複製成功，就會顯示 <code>Copied!</code> 提示已成功複製程式碼片段：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript">clipboard.on(<span class="hljs-string">'success'</span>, e =&gt; &#123;<br>  e.trigger.setAttribute(<span class="hljs-string">'aria-label'</span>, <span class="hljs-string">'Copied!'</span>);<br>  e.clearSelection();<br>&#125;);<br></code></pre></td></tr></table></figure><ol start="8"><li>將每個複製按鈕新增兩個監聽事件，分別是 <code>mouseleave</code> 和 <code>click</code>：<ul><li><code>mouseleave</code>：滑鼠離開按鈕就將提示文字變成 <code>Copy to clipboard</code></li><li><code>click</code>：取消事件的預設行為</li></ul></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> btns = <span class="hljs-built_in">document</span>.querySelectorAll(<span class="hljs-string">'.codecopy-btn'</span>);<br><br>btns.forEach(<span class="hljs-function"><span class="hljs-params">btn</span> =&gt;</span> &#123;<br>  btn.addEventListener(<span class="hljs-string">'mouseleave'</span>, e =&gt; &#123;<br>    e.target.setAttribute(<span class="hljs-string">'aria-label'</span>, <span class="hljs-string">'Copy to clipboard'</span>);<br>    e.target.blur();<br>  &#125;);<br><br>  btn.addEventListener(<span class="hljs-string">'click'</span>, e =&gt; &#123;<br>    e.preventDefault();<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="完整程式碼"><a class="header-anchor" href="#完整程式碼"></a>完整程式碼</h3><p>在 <code>themes\material-flow\source\js</code> 目錄內建立 <code>clipboard-use.js</code>，檔案內容如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-comment">// ref: https://github.com/zenorocha/codecopy/blob/master/src/scripts/main.js</span><br>  <span class="hljs-keyword">var</span> snippets = <span class="hljs-built_in">document</span>.querySelectorAll(<span class="hljs-string">'figure.highlight'</span>);<br>  <span class="hljs-keyword">var</span> htmlCopyButton = <span class="hljs-string">`</span><br><span class="hljs-string">    &lt;button class="codecopy-btn tooltipped tooltipped-sw" aria-label="Copy to clipboard"&gt;</span><br><span class="hljs-string">      &lt;i class="far fa-copy" aria-hidden="true"&gt;&lt;/i&gt;</span><br><span class="hljs-string">    &lt;/button&gt;`</span>;<br><br>  snippets.forEach(<span class="hljs-function"><span class="hljs-params">snippet</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">var</span> parent = snippet.parentNode;<br>    <span class="hljs-keyword">var</span> wrapper = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);<br><br>    parent.replaceChild(wrapper, snippet);<br>    wrapper.appendChild(snippet);<br><br>    wrapper.classList.add(<span class="hljs-string">'code-highlight'</span>);<br>    wrapper.firstChild.insertAdjacentHTML(<span class="hljs-string">'beforebegin'</span>, htmlCopyButton);<br><br>    <span class="hljs-keyword">var</span> lang = (snippet.classList[<span class="hljs-number">1</span>] || <span class="hljs-string">'code'</span>).toUpperCase();<br>    wrapper.setAttribute(<span class="hljs-string">'data-lang'</span>, lang);<br>  &#125;);<br><br>  <span class="hljs-comment">// Add copy to clipboard functionality and user feedback</span><br>  <span class="hljs-keyword">var</span> clipboard = <span class="hljs-keyword">new</span> ClipboardJS(<span class="hljs-string">'.codecopy-btn'</span>, &#123;<br>    target: <span class="hljs-function"><span class="hljs-params">trigger</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">return</span> trigger.nextSibling;<br>    &#125;,<br>  &#125;);<br><br>  clipboard.on(<span class="hljs-string">'success'</span>, e =&gt; &#123;<br>    e.trigger.setAttribute(<span class="hljs-string">'aria-label'</span>, <span class="hljs-string">'Copied!'</span>);<br>    e.clearSelection();<br>  &#125;);<br><br>  <span class="hljs-comment">// Replace tooltip message when mouse leaves button</span><br>  <span class="hljs-comment">// and prevent page refresh after click button</span><br>  <span class="hljs-keyword">var</span> btns = <span class="hljs-built_in">document</span>.querySelectorAll(<span class="hljs-string">'.codecopy-btn'</span>);<br><br>  btns.forEach(<span class="hljs-function"><span class="hljs-params">btn</span> =&gt;</span> &#123;<br>    btn.addEventListener(<span class="hljs-string">'mouseleave'</span>, e =&gt; &#123;<br>      e.target.setAttribute(<span class="hljs-string">'aria-label'</span>, <span class="hljs-string">'Copy to clipboard'</span>);<br>      e.target.blur();<br>    &#125;);<br><br>    btn.addEventListener(<span class="hljs-string">'click'</span>, e =&gt; &#123;<br>      e.preventDefault();<br>    &#125;);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure><p>接著在 <code>themes\material-flow\layout\_partial\scripts.ejs</code> 檔案內的載入 <code>clipboard-use.js</code>：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">js</span>('<span class="hljs-attr">js</span>/<span class="hljs-attr">clipboard-use.js</span>') %&gt;</span><br></code></pre></td></tr></table></figure><h2 id="CSS-樣式"><a class="header-anchor" href="#CSS-樣式"></a>CSS 樣式</h2><h3 id="提示文字樣式"><a class="header-anchor" href="#提示文字樣式"></a>提示文字樣式</h3><p>在 <code>themes\material-flow\source\less</code> 目錄內建立 <code>_tooltipped.less</code>，檔案內容如下：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">// ref: https://github.com/primer/primer/blob/master/modules/primer-tooltips/lib/tooltips.scss</span><br><span class="hljs-selector-class">.tooltipped</span> &#123;<br>  <span class="hljs-attribute">position</span>: relative;<br>&#125;<br><br><span class="hljs-comment">// This is the tooltip bubble</span><br><span class="hljs-selector-class">.tooltipped</span><span class="hljs-selector-pseudo">::after</span> &#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1000000</span>;<br>  <span class="hljs-attribute">display</span>: none;<br>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.5em</span> <span class="hljs-number">0.75em</span>;<br>  <span class="hljs-attribute">-webkit-font-smoothing</span>: subpixel-antialiased;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;<br>  <span class="hljs-attribute">text-align</span>: center;<br>  <span class="hljs-attribute">text-decoration</span>: none;<br>  <span class="hljs-attribute">text-shadow</span>: none;<br>  <span class="hljs-attribute">text-transform</span>: none;<br>  <span class="hljs-attribute">letter-spacing</span>: normal;<br>  <span class="hljs-attribute">word-wrap</span>: break-word;<br>  <span class="hljs-attribute">white-space</span>: pre;<br>  <span class="hljs-attribute">pointer-events</span>: none;<br>  <span class="hljs-attribute">content</span>: attr(aria-label);<br>  <span class="hljs-attribute">background</span>: <span class="hljs-number">#616161</span>;<br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">3px</span>;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// This is the tooltip arrow</span><br><span class="hljs-selector-class">.tooltipped</span><span class="hljs-selector-pseudo">::before</span> &#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1000001</span>;<br>  <span class="hljs-attribute">display</span>: none;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#616161</span>;<br>  <span class="hljs-attribute">pointer-events</span>: none;<br>  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">6px</span> solid transparent;<br>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// delay animation for tooltip</span><br><span class="hljs-keyword">@keyframes</span> tooltip-appear &#123;<br>  <span class="hljs-selector-tag">from</span> &#123;<br>    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;<br>  &#125;<br><br>  <span class="hljs-selector-tag">to</span> &#123;<br>    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// This will indicate when we'll activate the tooltip</span><br><span class="hljs-selector-class">.tooltipped</span><span class="hljs-selector-pseudo">:hover</span>,<br><span class="hljs-selector-class">.tooltipped</span><span class="hljs-selector-pseudo">:active</span>,<br><span class="hljs-selector-class">.tooltipped</span><span class="hljs-selector-pseudo">:focus</span> &#123;<br>  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-pseudo">::before</span>,<br>  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-pseudo">::after</span> &#123;<br>    <span class="hljs-attribute">display</span>: inline-block;<br>    <span class="hljs-attribute">text-decoration</span>: none;<br>    <span class="hljs-attribute">animation-name</span>: tooltip-appear;<br>    <span class="hljs-attribute">animation-duration</span>: <span class="hljs-number">0.1s</span>;<br>    <span class="hljs-attribute">animation-fill-mode</span>: forwards;<br>    <span class="hljs-attribute">animation-timing-function</span>: ease-in;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// Tooltipped south</span><br><span class="hljs-selector-class">.tooltipped-s</span>,<br><span class="hljs-selector-class">.tooltipped-sw</span> &#123;<br>  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-pseudo">::after</span> &#123;<br>    <span class="hljs-attribute">top</span>: <span class="hljs-number">100%</span>;<br>    <span class="hljs-attribute">right</span>: <span class="hljs-number">50%</span>;<br>    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">6px</span>;<br>  &#125;<br><br>  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-pseudo">::before</span> &#123;<br>    <span class="hljs-attribute">top</span>: auto;<br>    <span class="hljs-attribute">right</span>: <span class="hljs-number">50%</span>;<br>    <span class="hljs-attribute">bottom</span>: -<span class="hljs-number">7px</span>;<br>    <span class="hljs-attribute">margin-right</span>: -<span class="hljs-number">6px</span>;<br>    <span class="hljs-attribute">border-bottom-color</span>: <span class="hljs-number">#616161</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-selector-class">.tooltipped-sw</span><span class="hljs-selector-pseudo">::after</span> &#123;<br>  <span class="hljs-attribute">margin-right</span>: -<span class="hljs-number">16px</span>;<br>&#125;<br><br><span class="hljs-comment">// Move the tooltip body to the center of the object.</span><br><span class="hljs-selector-class">.tooltipped-s</span><span class="hljs-selector-pseudo">::after</span> &#123;<br>  <span class="hljs-attribute">transform</span>: translateX(<span class="hljs-number">50%</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>接著在 <code>themes\material-flow\source\style.less</code> 檔案內的載入 <code>_tooltipped.less</code>：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-keyword">@import</span> <span class="hljs-string">'less/_tooltipped.less'</span>;<br></code></pre></td></tr></table></figure><h3 id="其他樣式"><a class="header-anchor" href="#其他樣式"></a>其他樣式</h3><p>可參考本站的完整樣式：<a href="https://github.com/titangene/hexo-blog/blob/master/themes/material-flow/source/less/_article.less" target="_blank" rel="noopener">原始碼</a></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">figure</span> &#123;<br>  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-class">.highlight</span> &#123;<br>    <span class="hljs-attribute">position</span>: relative;<br>    <span class="hljs-attribute">margin</span>: <span class="hljs-number">1rem</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">22px</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-selector-class">.code-highlight</span> &#123;<br>  <span class="hljs-attribute">position</span>: relative;<br><br>  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-pseudo">::before</span> &#123;<br>    <span class="hljs-attribute">content</span>: attr(data-lang);<br>    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Roboto Mono'</span>, Consolas, monospace, sans-serif;<br>    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.6em</span>;<br>    <span class="hljs-attribute">color</span>: <span class="hljs-number">#b1b1b1</span>;<br>    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">18px</span>;<br>    <span class="hljs-attribute">position</span>: absolute;<br>    <span class="hljs-attribute">top</span>: <span class="hljs-number">4px</span>;<br>    <span class="hljs-attribute">right</span>: <span class="hljs-number">7px</span>;<br>    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-selector-class">.codecopy-btn</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">24px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">26px</span>;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;<br>  <span class="hljs-attribute">right</span>: -<span class="hljs-number">24px</span>;<br>  <span class="hljs-attribute">border</span>: none;<br>  <span class="hljs-attribute">box-shadow</span>: none;<br>  <span class="hljs-attribute">background</span>: none;<br>  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;<br>  <span class="hljs-attribute">transition</span>: color <span class="hljs-number">0.2s</span>;<br><br>  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>    <span class="hljs-attribute">color</span>: <span class="hljs-number">#7bf</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Demo"><a class="header-anchor" href="#Demo"></a>Demo</h2><p>下面是原本的 HTML：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">figure</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"highlight javascript"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"gutter"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"line"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"code"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">code</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"hljs javascript"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span><br></code></pre></td></tr></table></figure><p>使用後的 HTML：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"code-highlight"</span> <span class="hljs-attr">data-lang</span>=<span class="hljs-string">"JAVASCRIPT"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"codecopy-btn tooltipped tooltipped-sw"</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"Copy to clipboard"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"far fa-copy"</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">"true"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">figure</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"highlight javascript"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"gutter"</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"line"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"code"</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">code</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"hljs javascript"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">code</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>畫面：</p><p><img src="../images/hexo-copy-code-snippet-to-clipboard/copy-to-clipboard.gif" alt=""></p><h2 id="參考連結"><a class="header-anchor" href="#參考連結"></a>參考連結</h2><ul><li><a href="https://clipboardjs.com/" target="_blank" rel="noopener">clipboard.js — Copy to clipboard without Flash</a></li><li><a href="https://github.com/primer/primer/tree/master/modules/primer-tooltips" target="_blank" rel="noopener">GitHub’s Primer Tooltips</a></li><li><a href="https://github.com/zenorocha/codecopy" target="_blank" rel="noopener">zenorocha/codecopy: A browser extension that adds copy to clipboard buttons on every code block</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Code Snippet </tag>
            
            <tag> Clipboard </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 Docker 下建立並使用 MSSQL Server for Linux</title>
      <link href="/article/docker-mssql-server-for-linux.html"/>
      <url>/article/docker-mssql-server-for-linux.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/docker-mssql-server-for-linux.jpg" alt=""></p><p>在 SQL Server 2017 時，微軟推出了 Linux 版，同時也在 Docker Hub 上提供了 <a href="https://hub.docker.com/r/microsoft/mssql-server-linux/" target="_blank" rel="noopener">microsoft/mssql-server-linux</a> 的 Docker image。本篇會介紹如何在 Docker 下，透過此 image 來建立並使用 MSSQL Server for Linux。</p><a id="more"></a><h2 id="MSSQL-Server-for-Linux-要求"><a class="header-anchor" href="#MSSQL-Server-for-Linux-要求"></a>MSSQL Server for Linux 要求</h2><ul><li>必須 Docker Engine 1.8+，支援任何平台 (Windows/Mac/Linux)</li><li>硬碟空間至少 2 GB</li><li>RAM 至少 2 GB</li><li>image 必要的環境變數：<ul><li><code>ACCEPT_EULA=Y</code>：確認同意授權合約</li><li><code>MSSQL_SA_PASSWORD=&lt;YourStrong!Passw0rd&gt;</code>：設定 SA 密碼</li></ul></li><li>A strong system administrator (SA) 密碼必須符合以下規則：<ul><li>至少 8 個字元</li><li>必需包含英文大寫、英文小寫、數字、非字母數字符號四者中的其中三種即可</li></ul></li></ul><blockquote><p>詳情可參考官方的 <a href="https://docs.microsoft.com/zh-tw/sql/linux/sql-server-linux-setup?view=sql-server-2017#system" target="_blank" rel="noopener">SQL Server on Liunx 的系統需求</a> 文件。</p></blockquote><h2 id="建立-Container"><a class="header-anchor" href="#建立-Container"></a>建立 Container</h2><p>Docker Hub：<a href="https://hub.docker.com/r/microsoft/mssql-server-linux/" target="_blank" rel="noopener">microsoft/mssql-server-linux</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 從 Docker Hub 提取 SQL Server 2017 Linux container image</span><br><span class="hljs-meta">$</span><span class="bash"> docker pull microsoft/mssql-server-linux:2017-latest</span><br><br><span class="hljs-meta">#</span><span class="bash"> 建立並執行 Docker container</span><br><span class="hljs-meta">$</span><span class="bash"> docker run -e <span class="hljs-string">'ACCEPT_EULA=Y'</span> -e <span class="hljs-string">'MSSQL_SA_PASSWORD=&lt;YourStrong!Passw0rd&gt;'</span> \</span><br>  -p 1401:1433 --name sql1 \<br>  -d microsoft/mssql-server-linux:2017-latest<br></code></pre></td></tr></table></figure><ul><li><code>-e 'ACCEPT_EULA=Y'</code>：確認同意授權合約</li><li><code>-e 'MSSQL_SA_PASSWORD=&lt;YourStrong!Passw0rd&gt;'</code>：必需是強密碼並至少 8 個字元。強密碼英文大寫、英文小寫、數字、非字母數字符號四者中的其中三種即可。</li><li><code>-p hostPort:containerPort</code>：host 對外開 1401 port，container 內開 1433 port</li><li><code>--name</code>：指定 container 名稱</li><li><code>-d</code>：背景執行</li><li><code>microsoft/mssql-server-linux:2017-latest</code>：使用 SQL Server 2017 Linux image 建立 container</li></ul><p>如果列表 <code>NAMES</code> 顯示 sql1 並且 <code>STATUS</code> 顯示 UP 就代表 SQL Server 已在背景執行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看 container 的狀態</span><br><span class="hljs-meta">$</span><span class="bash"> docker ps</span><br>CONTAINER ID   IMAGE                                      COMMAND                  CREATED          STATUS          PORTS                    NAMES<br>08e2f151d579   microsoft/mssql-server-linux:2017-latest   "/bin/sh -c /opt/mss…"   31 minutes ago   Up 31 minutes   0.0.0.0:1401-&gt;1433/tcp   sql1<br></code></pre></td></tr></table></figure><h2 id="連接至-SQL-Server"><a class="header-anchor" href="#連接至-SQL-Server"></a>連接至 SQL Server</h2><p>使用 SQL Server 命令列工具 <code>sqlcmd</code>，連接到 SQL Server container：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 在外部向執行中的 container 內部下指令，啟動 Container 內部的互動式 bash shell，來執行你下的指令</span><br><span class="hljs-meta">$</span><span class="bash"> docker <span class="hljs-built_in">exec</span> -it sql1 bash</span><br><br><span class="hljs-meta">#</span><span class="bash"> 使用 SQL Server 命令列工具 `sqlcmd`，並登入帳號密碼連接到 SQL Server</span><br><span class="hljs-meta">$</span><span class="bash"> /opt/mssql-tools/bin/sqlcmd -S localhost -U SA</span><br>Password:<br><br><span class="hljs-meta">#</span><span class="bash"> 出現 <span class="hljs-string">"1&gt;"</span> 就代表已成功登入並已進入 sqlcmd</span><br><span class="hljs-meta">1&gt;</span><br></code></pre></td></tr></table></figure><h2 id="變更-SA-的密碼"><a class="header-anchor" href="#變更-SA-的密碼"></a>變更 SA 的密碼</h2><p>SA 帳號是在安裝期間建立的 SQL Server 實例上的系統管理員。建立 SQL Server container 之後，在 container 中執行 <code>echo $MSSQL_SA_PASSWORD</code>，即可查看 SA 的密碼：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> docker <span class="hljs-built_in">exec</span> -it sql1 bash</span><br>root@xxx:/# echo $MSSQL_SA_PASSWORD<br>YourStrong!Passw0rd<br></code></pre></td></tr></table></figure><p>執行下面指令可以變更 SA 的密碼，而 <code>opt/mssql-tools/bin/sqlcmd</code> 是 <code>sqlcmd</code> 所在的路徑：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> docker <span class="hljs-built_in">exec</span> -it sql1 /opt/mssql-tools/bin/sqlcmd \</span><br>  -S localhost -U SA -P '&lt;YourStrong!Passw0rd&gt;' \<br>  -Q 'ALTER LOGIN SA WITH PASSWORD="&lt;YourNewStrong!Passw0rd&gt;"'<br></code></pre></td></tr></table></figure><p>參數說明：</p><ul><li><code>-S</code>：server</li><li><code>-U</code>：user name</li><li><code>-P</code>：password</li><li><code>-Q</code>：query，執行 SQL 指令後結束 <code>sqlcmd</code></li></ul><h2 id="建立資料庫及查詢資料"><a class="header-anchor" href="#建立資料庫及查詢資料"></a>建立資料庫及查詢資料</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查詢 server 上所有 DB 名稱</span><br><span class="hljs-meta">1&gt;</span><span class="bash"> SELECT Name from sys.Databases</span><br><span class="hljs-meta">#</span><span class="bash"> 在 sqlcmd 指令模式下，要輸入 GO 指令才會執行</span><br><span class="hljs-meta">2&gt;</span><span class="bash"> GO</span><br>Name<br>------------<br>master<br>tempdb<br>model<br>msdb<br><br>(4 rows affected)<br><br><span class="hljs-meta">#</span><span class="bash"> 建立資料庫</span><br><span class="hljs-meta">1&gt;</span><span class="bash"> CREATE DATABASE TestDB</span><br><span class="hljs-meta">2&gt;</span><span class="bash"> GO</span><br><span class="hljs-meta">#</span><span class="bash"> 出現下面畫面 <span class="hljs-string">"1&gt;"</span> 就代表已成功建立資料庫</span><br><span class="hljs-meta">1&gt;</span><br><br><span class="hljs-meta">#</span><span class="bash"> 離開 sqlcmd</span><br><span class="hljs-meta">1&gt;</span><span class="bash"> quit</span><br></code></pre></td></tr></table></figure><h2 id="使用-Azure-Data-Studio-連接-SQL-Server"><a class="header-anchor" href="#使用-Azure-Data-Studio-連接-SQL-Server"></a>使用 Azure Data Studio 連接 SQL Server</h2><p><a href="https://github.com/Microsoft/azuredatastudio" target="_blank" rel="noopener">Azure Data Studio</a> (以前稱為 SQL Operations Studio) 是一個輕量且免費的跨平台 SQL Server 開源管理工具，支援 Windows、macOS、Linux。</p><p><img src="../images/docker-mssql-server-for-linux/2019-01-30_21-20-32.png" alt=""></p><h3 id="安裝-Azure-Data-Studio"><a class="header-anchor" href="#安裝-Azure-Data-Studio"></a>安裝 Azure Data Studio</h3><h4 id="for-Windows"><a class="header-anchor" href="#for-Windows"></a>for Windows</h4><p>下載並解壓縮，接著執行 <code>\azuredatastudio-windows\sqlops.exe</code> 即可開始使用。</p><h4 id="for-Linux"><a class="header-anchor" href="#for-Linux"></a>for Linux</h4><p>下載並解壓縮，接著將 Azure Data Studio 執行檔加入 <code>PATH</code> 環境變數，以後即可在終端機輸入 <code>azuredatastudio</code> 開啟 Azure Data Studio：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~</span><br><span class="hljs-meta">$</span><span class="bash"> cp ~/Downloads/azuredatastudio-linux-&lt;version string&gt;.tar.gz ~</span><br><span class="hljs-meta">$</span><span class="bash"> tar -xvf ~/azuredatastudio-linux-&lt;version string&gt;.tar.gz</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">'export PATH="$PATH:~/azuredatastudio-linux-x64"'</span> &gt;&gt; ~/.bashrc</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> ~/.bashrc</span><br><span class="hljs-meta">$</span><span class="bash"> azuredatastudio</span><br></code></pre></td></tr></table></figure><h4 id="for-macOS"><a class="header-anchor" href="#for-macOS"></a>for macOS</h4><p>下載並解壓縮，然後將 Azure Data Studio 加入 Launchpad，將 <code>Studio.app</code> 拖曳到應用程式目錄 (Applications folder) 即可。</p><blockquote><p>安裝詳情可參考官方的 <a href="https://docs.microsoft.com/zh-tw/sql/azure-data-studio/download?view=sql-server-2017" target="_blank" rel="noopener">下載並安裝 - Azure Data Studio | Microsoft Docs</a> 文件。</p></blockquote><h3 id="登入-SQL-Server"><a class="header-anchor" href="#登入-SQL-Server"></a>登入 SQL Server</h3><p>Server name 的格式： <code>IP, Port</code></p><ul><li>IP：<ul><li>Linux：使用 <code>ifconfig</code> 指令查詢 IP</li><li>Windows：使用 <code>ipconfig</code> 指令查詢 IP</li></ul></li><li>Port：要看前面建立的 container 是設定多少 Port</li></ul><p>此範例 (也就是下面的指令) 是設定使用 1401 port，所以只要輸入 <code>YourIP, 1401</code> 就能與 SQL Server 連接。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> docker run -e <span class="hljs-string">'ACCEPT_EULA=Y'</span> -e <span class="hljs-string">'MSSQL_SA_PASSWORD=&lt;YourStrong!Passw0rd&gt;'</span> \</span><br>  -p 1401:1433 --name sql1 \<br>  -d microsoft/mssql-server-linux:2017-latest<br></code></pre></td></tr></table></figure><p><img src="../images/docker-mssql-server-for-linux/2019-01-30_23-02-20.png" alt=""></p><h2 id="建立資料表和資料，並查詢資料"><a class="header-anchor" href="#建立資料表和資料，並查詢資料"></a>建立資料表和資料，並查詢資料</h2><p>執行下面指令，建立資料表和資料，並查詢資料：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 切換至 TestDB 資料庫</span><br><span class="hljs-keyword">use</span> TestDB;<br><span class="hljs-comment">-- 建立資料表</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> People(<span class="hljs-keyword">Name</span> <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">50</span>), Age <span class="hljs-built_in">int</span>);<br><span class="hljs-comment">-- 新增資料</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> People <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Titan'</span>, <span class="hljs-number">18</span>), (<span class="hljs-string">'John'</span>, <span class="hljs-number">6</span>), (<span class="hljs-string">'Alex'</span>, <span class="hljs-number">40</span>);<br><span class="hljs-comment">-- 查詢年齡小於 20 歲的人</span><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> People <span class="hljs-keyword">WHERE</span> Age &lt; <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure><p>執行完的結果如下圖，看到此查詢結果就代表已成功新增資料：</p><p><img src="../images/docker-mssql-server-for-linux/2019-01-30_21-20-32.png" alt=""></p><h2 id="刪除-Container"><a class="header-anchor" href="#刪除-Container"></a>刪除 Container</h2><p>指定刪除名為 <code>sql1</code> 的 container：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查詢目前的正在執行的 container</span><br><span class="hljs-meta">$</span><span class="bash"> docker ps</span><br><br><span class="hljs-meta">#</span><span class="bash"> container 停止執行</span><br><span class="hljs-meta">$</span><span class="bash"> docker stop sql</span><br><br><span class="hljs-meta">#</span><span class="bash"> 刪除 container</span><br><span class="hljs-meta">$</span><span class="bash"> docker rm sql1</span><br></code></pre></td></tr></table></figure><p>或是可以在未停止執行 container 的情況下，直接強制刪除 container：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 強制刪除 container</span><br><span class="hljs-meta">$</span><span class="bash"> docker rm -f sql1</span><br></code></pre></td></tr></table></figure><h2 id="透過-Volume-將資料庫的資料儲存至主機"><a class="header-anchor" href="#透過-Volume-將資料庫的資料儲存至主機"></a>透過 Volume 將資料庫的資料儲存至主機</h2><p>在 <code>docker run</code> 指令上加 <code>-v</code> 參數可以建立實體資料夾與 container 資料夾的對應關係，將主機上的指定目錄綁定到 container 的指定目錄，也就是可以存資料庫的資料至主機，參數語法為 <code>-v &lt;host directory&gt;:/var/opt/mssql</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 執行 Docker container image</span><br><span class="hljs-meta">$</span><span class="bash"> docker run -e <span class="hljs-string">'ACCEPT_EULA=Y'</span> -e <span class="hljs-string">'MSSQL_SA_PASSWORD=&lt;YourStrong!Passw0rd&gt;'</span> \</span><br>  -p 1402:1433 --name sql2 \<br>  -v `pwd`/mssql:/var/opt/mssql \<br>  -d microsoft/mssql-server-linux:2017-latest<br></code></pre></td></tr></table></figure><h2 id="備份與還原資料庫"><a class="header-anchor" href="#備份與還原資料庫"></a>備份與還原資料庫</h2><h3 id="範例前置準備：建立資料庫、資料表和資料"><a class="header-anchor" href="#範例前置準備：建立資料庫、資料表和資料"></a>範例前置準備：建立資料庫、資料表和資料</h3><p>下面的 SQL 指令是用來立資料庫、資料表和資料，因為此 container 是剛剛另外新建的，之前的 container 已經刪除了 (因為沒有利用 Volume 儲存資料庫的資料)，所以需要重新建立資料：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 建立 資料庫</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> TestDB;<br>GO<br><span class="hljs-comment">-- 切換至 TestDB 資料庫</span><br><span class="hljs-keyword">use</span> TestDB;<br><span class="hljs-comment">-- 建立資料表</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> People(<span class="hljs-keyword">Name</span> <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">50</span>), Age <span class="hljs-built_in">int</span>);<br><span class="hljs-comment">-- 新增資料</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> People <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Titan'</span>, <span class="hljs-number">18</span>), (<span class="hljs-string">'John'</span>, <span class="hljs-number">6</span>), (<span class="hljs-string">'Alex'</span>, <span class="hljs-number">40</span>);<br></code></pre></td></tr></table></figure><h3 id="備份資料庫"><a class="header-anchor" href="#備份資料庫"></a>備份資料庫</h3><p>使用 sqlcmd 連接到 SQL Server，並完整備份 TestDB 資料庫，備份檔存至 <code>./data/testdb.bak</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> docker <span class="hljs-built_in">exec</span> -it sql2 /opt/mssql-tools/bin/sqlcmd -S localhost -U SA \</span><br>  -Q "BACKUP DATABASE TestDB TO DISK = N'/var/opt/mssql/data/testdb.bak' WITH NOFORMAT, NOINIT, NAME = 'demodb-full', SKIP, NOREWIND, NOUNLOAD, STATS = 10"<br></code></pre></td></tr></table></figure><p>當執行此指令時，SQL Server 將會提示需輸入密碼。輸入密碼後，很快就會備份完成，如果備份成功畫面就會顯示「BACKUP DATABASE successfully …」：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">Password: <br>10 percent processed.<br>20 percent processed.<br>30 percent processed.<br>40 percent processed.<br>50 percent processed.<br>60 percent processed.<br>70 percent processed.<br>80 percent processed.<br>90 percent processed.<br>Processed 312 pages for database 'TestDB', file 'TestDB' on file 1.<br>100 percent processed.<br>Processed 6 pages for database 'TestDB', file 'TestDB_log' on file 1.<br>BACKUP DATABASE successfully processed 318 pages in 0.348 seconds (7.139 MB/sec).<br></code></pre></td></tr></table></figure><h3 id="範例前置處理：刪除-container-和資料庫資料"><a class="header-anchor" href="#範例前置處理：刪除-container-和資料庫資料"></a>範例前置處理：刪除 container 和資料庫資料</h3><p>下面是要模擬把 container 刪除後，要如何將剛剛備份的資料庫資料 (也就是 <code>./data/testdb.bak</code> ) 還原，因此也要刪除透過 Volume 儲存的資料庫資料，如以下步驟：</p><ol><li>刪除 container</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查詢目前的正在執行的 container</span><br><span class="hljs-meta">$</span><span class="bash"> docker ps</span><br><span class="hljs-meta">#</span><span class="bash"> 強制刪除 container</span><br><span class="hljs-meta">$</span><span class="bash"> docker rm -f sql2</span><br></code></pre></td></tr></table></figure><ol start="2"><li>刪除透過 Volume 儲存的資料庫資料</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看剛剛刪除的 container 保存下來的 DB 資料檔 (TestDB_log.ldf 和 TestDB.mdf)</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> mssql/data</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">pwd</span></span><br>/home/titan/project/mssql/data<br><span class="hljs-meta">$</span><span class="bash"> tree</span><br>├── master.mdf<br>├── mastlog.ldf<br>├── modellog.ldf<br>├── model.mdf<br>├── msdbdata.mdf<br>├── msdblog.ldf<br>├── tempdb.mdf<br>├── templog.ldf<br>├── testdb.bak<br>├── TestDB_log.ldf   &lt;---<br>└── TestDB.mdf       &lt;---<br><br><span class="hljs-meta">#</span><span class="bash"> 刪除 TestDB.mdf 和 TestDB_log.ldf</span><br><span class="hljs-meta">$</span><span class="bash"> sudo rm TestDB*</span><br><span class="hljs-meta">$</span><span class="bash"> tree</span><br>├── master.mdf<br>├── mastlog.ldf<br>├── modellog.ldf<br>├── model.mdf<br>├── msdbdata.mdf<br>├── msdblog.ldf<br>├── tempdb.mdf<br>├── templog.ldf<br>└── testdb.bak<br></code></pre></td></tr></table></figure><ol start="3"><li>在建立一個新的 container (用來做還原資料庫用的)</li></ol><p>先回到專案的根目錄：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">pwd</span></span><br>/home/titan/project/mssql/data<br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ../..</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">pwd</span></span><br>/home/titan/project<br></code></pre></td></tr></table></figure><p>接著建立一個新的 container，名稱叫做 sql3：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> docker run -e <span class="hljs-string">'ACCEPT_EULA=Y'</span> -e <span class="hljs-string">'MSSQL_SA_PASSWORD=&lt;YourStrong!Passw0rd&gt;'</span> \</span><br>  -p 1403:1433 --name sql3 \<br>  -v `pwd`/mssql:/var/opt/mssql \<br>  -d microsoft/mssql-server-linux:2017-latest<br></code></pre></td></tr></table></figure><h3 id="還原資料庫"><a class="header-anchor" href="#還原資料庫"></a>還原資料庫</h3><p>使用 sqlcmd 連接到 SQL Server，並還原 TestDB 資料庫 (要還原的備份檔存至 <code>./data/testdb.bak</code> )：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> docker <span class="hljs-built_in">exec</span> -it sql3 /opt/mssql-tools/bin/sqlcmd -S localhost -U SA \</span><br>  -Q "RESTORE DATABASE TestDB FROM DISK = N'/var/opt/mssql/data/testdb.bak' WITH  FILE = 1, NOUNLOAD, REPLACE, STATS = 5"<br></code></pre></td></tr></table></figure><p>當執行此指令時，SQL Server 將會提示需輸入密碼。輸入密碼後，很快就會還原完成，如果還原成功畫面就會顯示「RESTORE DATABASE successfully …」：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">Password: <br>6 percent processed.<br>11 percent processed.<br>15 percent processed.<br>20 percent processed.<br>25 percent processed.<br>31 percent processed.<br>36 percent processed.<br>41 percent processed.<br>45 percent processed.<br>50 percent processed.<br>57 percent processed.<br>61 percent processed.<br>66 percent processed.<br>70 percent processed.<br>75 percent processed.<br>82 percent processed.<br>86 percent processed.<br>91 percent processed.<br>95 percent processed.<br>100 percent processed.<br>Processed 344 pages for database 'TestDB', file 'TestDB' on file 1.<br>Processed 7 pages for database 'TestDB', file 'TestDB_log' on file 1.<br>RESTORE DATABASE successfully processed 351 pages in 0.321 seconds (8.530 MB/sec).<br></code></pre></td></tr></table></figure><p>檢查一下剛剛刪除的 <code>TestDB.mdf</code> 和 <code>TestDB_log.ldf</code> 都正確的還原了：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> mssql/data</span><br><span class="hljs-meta">$</span><span class="bash"> tree</span><br>├── master.mdf<br>├── mastlog.ldf<br>├── modellog.ldf<br>├── model.mdf<br>├── msdbdata.mdf<br>├── msdblog.ldf<br>├── tempdb.mdf<br>├── templog.ldf<br>├── testdb.bak<br>├── TestDB_log.ldf   &lt;---<br>└── TestDB.mdf       &lt;---<br></code></pre></td></tr></table></figure><p>使用 <code>select</code> SQL 指令可以看到資料確實已還原：</p><p><img src="../images/docker-mssql-server-for-linux/2019-01-30_22-04-08.png" alt=""></p><h2 id="使用-Azure-Data-Studio-備份或還原資料庫"><a class="header-anchor" href="#使用-Azure-Data-Studio-備份或還原資料庫"></a>使用 Azure Data Studio 備份或還原資料庫</h2><p>如果覺得打指令很麻煩，其實 Azure Data Studio、<a href="https://docs.microsoft.com/zh-tw/sql/linux/sql-server-linux-manage-ssms?view=sql-server-2017" target="_blank" rel="noopener">SQL Server Management Studio (SSMS)</a>、<a href="https://docs.microsoft.com/zh-tw/sql/linux/sql-server-linux-develop-use-ssdt?view=sql-server-2017" target="_blank" rel="noopener">SQL Server Data Tools (SSDT)</a> 或 <a href="https://docs.microsoft.com/zh-tw/sql/linux/sql-server-linux-develop-use-vscode?view=sql-server-2017" target="_blank" rel="noopener">Visual Studio Code (VS Code) 的 mssql 擴充功能</a> 都有提供 GUI 的介面，可以直接備份或還原資料庫。</p><p>下圖是 Azure Data Studio 備份或還原資料庫的畫面：</p><p><img src="https://i.imgur.com/wexszt5.png" alt=""></p><blockquote><p>詳情可參考官方的 <a href="https://docs.microsoft.com/zh-tw/sql/azure-data-studio/tutorial-backup-restore-sql-server?view=sql-server-2017" target="_blank" rel="noopener">備份與還原的資料庫 - Azure Data Studio | Microsoft Docs</a> 文件。</p></blockquote><h2 id="參考連結"><a class="header-anchor" href="#參考連結"></a>參考連結</h2><ul><li><a href="https://docs.microsoft.com/zh-tw/sql/linux/quickstart-install-connect-docker?view=sql-server-2017" target="_blank" rel="noopener">開始使用 Docker （Linux 上執行 SQL Server） 上的 SQL Server 容器 - SQL Server | Microsoft Docs</a></li><li><a href="https://docs.microsoft.com/zh-tw/sql/linux/sql-server-linux-configure-docker?view=sql-server-2017" target="_blank" rel="noopener">在 Docker 上的 SQL Server 組態選項 - SQL Server | Microsoft Docs</a></li><li><a href="https://docs.microsoft.com/zh-tw/sql/linux/tutorial-restore-backup-in-sql-server-container?view=sql-server-2017" target="_blank" rel="noopener">在 Docker 中的 SQL Server 資料庫還原 - SQL Server | Microsoft Docs</a></li><li><a href="https://github.com/Microsoft/mssql-docker/tree/master/linux/preview" target="_blank" rel="noopener">Github repo: Microsoft/mssql-docker</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> SQL Server </category>
          
          <category> Linux </category>
          
          <category> Database </category>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Container </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>將 Hexo 的 Markdown 渲染引擎換成 markdown-it</title>
      <link href="/article/hexo-markdown-it.html"/>
      <url>/article/hexo-markdown-it.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/hexo.jpg" alt=""></p><p>個人很常用 HackMD 紀錄筆記，希望 blog 也可以支援 HackMD 的 Markdown 格式，因此本篇的目標就是要將 Hexo 原本的 Markdown 渲染引擎 <code>marked</code>，換成 HackMD 的 Markdown 渲染引擎：<code>markdown-it</code>。</p><a id="more"></a><h2 id="更換渲染引擎"><a class="header-anchor" href="#更換渲染引擎"></a>更換渲染引擎</h2><p>Hexo 預設的 markdown 渲染引擎是 <a href="https://github.com/markedjs/marked" target="_blank" rel="noopener"><code>marked</code></a>，並使用 <a href="https://github.com/hexojs/hexo-renderer-marked" target="_blank" rel="noopener"><code>hexo-renderer-marked</code></a> 此 Hexo 外掛來將 Markdown 轉換成靜態檔案 HTML，但因前面提到的需求，所以要刪除原本的渲染引擎</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm uninstall hexo-renderer-marked --save</span><br></code></pre></td></tr></table></figure><p>安裝我們要改用的 Markdown 渲染引擎：<code>markdown-it</code>，而使用此渲染引擎的 Hexo 外掛就是 <a href="https://github.com/hexojs/hexo-renderer-markdown-it" target="_blank" rel="noopener"><code>hexo-renderer-markdown-it</code></a>，所以要在 hexo 的專案中安裝此外掛：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install git+https://github.com/hexojs/hexo-renderer-markdown-it.git --save</span><br></code></pre></td></tr></table></figure><p>為何安裝 NPM 套件時要指定 github 的 repo 呢？因為 <code>hexo-renderer-markdown-it</code> 此 NPM 套件的程式沒有更新成 Github 上面的程式版本，請確定剛剛安裝套件中，<code>node_modules\hexo-renderer-markdown-it\lib\renderer.js</code> 這個檔案內的下面這段程式碼是否相同：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span> (opt.plugins) &#123;<br>  parser = opt.plugins.reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parser, pugs</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (pugs <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Object</span> &amp;&amp; pugs.name) &#123;<br>      <span class="hljs-keyword">return</span> parser.use(<span class="hljs-built_in">require</span>(pugs.name), pugs.options);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> parser.use(<span class="hljs-built_in">require</span>(pugs));<br>    &#125;<br>  &#125;, parser);<br>&#125;<br></code></pre></td></tr></table></figure><p>若是從 NPM 下載的套件版本 (也就是直接使用 <code>npm install hexo-renderer-markdown-it --save</code> 此指令)，會少幾句程式，少了可在載入 <code>markdown-it</code> 的外掛時為該外掛設定所需的 options：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span> (opt.plugins) &#123;<br>  parser = opt.plugins.reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parser, pugs</span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> parser.use(<span class="hljs-built_in">require</span>(pugs));<br>  &#125;, parser);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="安裝渲染引擎外掛套件"><a class="header-anchor" href="#安裝渲染引擎外掛套件"></a>安裝渲染引擎外掛套件</h2><p>我們可以參考 <a href="https://github.com/hackmdio/codimd/blob/master/package.json" target="_blank" rel="noopener">HackMD</a> 的相依套件，只要是名為 <code>markdown-it-xxx</code> 的套件就是渲染引擎 <code>markdown-it</code> 的外掛：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">"dependencies"</span>: &#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-attr">"markdown-it"</span>: <span class="hljs-string">"^8.2.2"</span>,<br>    <span class="hljs-attr">"markdown-it-abbr"</span>: <span class="hljs-string">"^1.0.4"</span>,<br>    <span class="hljs-attr">"markdown-it-container"</span>: <span class="hljs-string">"^2.0.0"</span>,<br>    <span class="hljs-attr">"markdown-it-deflist"</span>: <span class="hljs-string">"^2.0.1"</span>,<br>    <span class="hljs-attr">"markdown-it-emoji"</span>: <span class="hljs-string">"^1.3.0"</span>,<br>    <span class="hljs-attr">"markdown-it-footnote"</span>: <span class="hljs-string">"^3.0.1"</span>,<br>    <span class="hljs-attr">"markdown-it-imsize"</span>: <span class="hljs-string">"^2.0.1"</span>,<br>    <span class="hljs-attr">"markdown-it-ins"</span>: <span class="hljs-string">"^2.0.0"</span>,<br>    <span class="hljs-attr">"markdown-it-mark"</span>: <span class="hljs-string">"^2.0.0"</span>,<br>    <span class="hljs-attr">"markdown-it-mathjax"</span>: <span class="hljs-string">"^2.0.0"</span>,<br>    <span class="hljs-attr">"markdown-it-regexp"</span>: <span class="hljs-string">"^0.4.0"</span>,<br>    <span class="hljs-attr">"markdown-it-sub"</span>: <span class="hljs-string">"^1.0.0"</span>,<br>    <span class="hljs-attr">"markdown-it-sup"</span>: <span class="hljs-string">"^1.0.0"</span>,<br>    <span class="hljs-attr">"markdown-it-task-checkbox"</span>: <span class="hljs-string">"^1.0.6"</span>,<br>    <span class="hljs-comment">// ...</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>而下列是我選擇要安裝的外掛：</p><ul><li><a href="https://github.com/markdown-it/markdown-it-abbr" target="_blank" rel="noopener">markdown-it-abbr</a></li><li><a href="https://github.com/markdown-it/markdown-it-container" target="_blank" rel="noopener">markdown-it-container</a></li><li><a href="https://github.com/markdown-it/markdown-it-deflist" target="_blank" rel="noopener">markdown-it-deflist</a></li><li><a href="https://github.com/markdown-it/markdown-it-emoji" target="_blank" rel="noopener">markdown-it-emoji</a></li><li><a href="https://github.com/markdown-it/markdown-it-footnote" target="_blank" rel="noopener">markdown-it-footnote</a></li><li><a href="https://github.com/tatsy/markdown-it-imsize" target="_blank" rel="noopener">markdown-it-imsize</a></li><li><a href="https://github.com/markdown-it/markdown-it-ins" target="_blank" rel="noopener">markdown-it-ins</a></li><li><a href="https://github.com/markdown-it/markdown-it-mark" target="_blank" rel="noopener">markdown-it-mark</a></li><li><a href="https://github.com/rlidwka/markdown-it-regexp" target="_blank" rel="noopener">markdown-it-regexp</a></li><li><a href="https://github.com/markdown-it/markdown-it-sub" target="_blank" rel="noopener">markdown-it-sub</a></li><li><a href="https://github.com/markdown-it/markdown-it-sup" target="_blank" rel="noopener">markdown-it-sup</a></li><li><a href="https://github.com/linsir/markdown-it-task-checkbox" target="_blank" rel="noopener">markdown-it-task-checkbox</a></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm i markdown-it-abbr \</span><br>        markdown-it-task-checkbox \<br>        markdown-it-container \<br>        markdown-it-deflist \<br>        markdown-it-emoji \<br>        markdown-it-footnote \<br>        markdown-it-imsize \<br>        markdown-it-ins \<br>        markdown-it-mark \<br>        markdown-it-regexp \<br>        markdown-it-sub \<br>        markdown-it-sup --save<br></code></pre></td></tr></table></figure><h3 id="markdown-it-mathjax"><a class="header-anchor" href="#markdown-it-mathjax"></a>markdown-it-mathjax</h3><p>為何我未安裝 <code>markdown-it-mathjax</code> 這個外掛？這是因為…我之後再單獨寫一篇文章來介紹如何在 Markdown 加上數學式 MathJax。</p><h3 id="markdown-it-task-checkbox"><a class="header-anchor" href="#markdown-it-task-checkbox"></a>markdown-it-task-checkbox</h3><p>為何我會比 HackMD 多安裝 <code>markdown-it-task-checkbox</code> 這個外掛？</p><p>有使用過 HackMD 的朋友都知道，只要在 HackMD 輸入下列 Markdown 語法：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">- </span>[ ] task 1<br><span class="hljs-bullet">- </span>[x] task 2<br></code></pre></td></tr></table></figure><p>就會被轉換成 HTML 的 checkbox：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"task-list-item"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"task-list-item-checkbox "</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>task 1<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"task-list-item"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"task-list-item-checkbox"</span> <span class="hljs-attr">checked</span>=<span class="hljs-string">""</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>task 2<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></figure><p>畫面會看到一個未被勾選以及一個已被勾選的 checkbox：</p><p><img src="../images/hexo-markdown-it/markdown-it_checkbox.png" alt=""></p><p>不過 HackMD 不是靠著 Markdown 渲染引擎 <code>markdown-it</code> 的外掛來轉換成 HTML 的，而是直接利用正規表示法 (Regular Expression) 找到 <code>[ ]</code> 或 <code>[x]</code> 的文字，再將這些文字直接轉換成 HTML 的 checkbox。我擷取了 HackMD 的這段程式邏輯，若想看詳細的原始碼可至 HackMD 的原始碼內的 <a href="https://github.com/hackmdio/codimd/blob/master/public/js/extra.js#L263" target="_blank" rel="noopener"><code>public/js/extra.js</code> 檔案中的第 263 行左右</a>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^\s*\[[x ]\]\s*/</span>.test(html)) &#123;<br>  li.innerHTML = html<br>    .replace(<br>      /^\s*\[ \]\s*<span class="hljs-regexp">/,</span><br><span class="hljs-regexp">      `&lt;input type="checkbox" class="task-list-item-checkbox" $&#123;disabled&#125;&gt;&lt;label&gt;&lt;/</span>label&gt;<span class="hljs-string">`,</span><br><span class="hljs-string">    )</span><br><span class="hljs-string">    .replace(</span><br><span class="hljs-string">      /^\s*\[x\]\s*/,</span><br><span class="hljs-string">      `</span>&lt;input type=<span class="hljs-string">"checkbox"</span> <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"task-list-item-checkbox"</span> checked $&#123;disabled&#125;&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><span class="hljs-string">`,</span><br><span class="hljs-string">    );</span><br><span class="hljs-string">  if (li.tagName.toLowerCase() !== 'li') &#123;</span><br><span class="hljs-string">    li.parentElement.setAttribute('class', 'task-list-item');</span><br><span class="hljs-string">  &#125; else &#123;</span><br><span class="hljs-string">    li.setAttribute('class', 'task-list-item');</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="設定-config-yml"><a class="header-anchor" href="#設定-config-yml"></a>設定 _config.yml</h2><p>將下面這些設定在根目錄的 <code>_config.yml</code> 設定檔中：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Markdown-it config</span><br><span class="hljs-comment"># Docs: https://github.com/hexojs/hexo-renderer-markdown-it/wiki</span><br><span class="hljs-attr">markdown:</span><br>  <span class="hljs-attr">render:</span><br>    <span class="hljs-attr">html:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">xhtmlOut:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">breaks:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">linkify:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">typographer:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">quotes:</span> <span class="hljs-string">'“”‘’'</span><br>  <span class="hljs-attr">plugins:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-abbr</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-footnote</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-ins</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-sub</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-sup</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-deflist</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-imsize</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-mark</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-regexp</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-task-checkbox</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">markdown-it-container</span><br>      <span class="hljs-attr">options:</span> <span class="hljs-string">success</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">markdown-it-container</span><br>      <span class="hljs-attr">options:</span> <span class="hljs-string">info</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">markdown-it-container</span><br>      <span class="hljs-attr">options:</span> <span class="hljs-string">warning</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">markdown-it-container</span><br>      <span class="hljs-attr">options:</span> <span class="hljs-string">danger</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">markdown-it-deflist</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">markdown-it-emoji</span><br>      <span class="hljs-attr">options:</span><br>        <span class="hljs-attr">shortcuts:</span> <span class="hljs-string">&#123;&#125;</span><br>  <span class="hljs-attr">anchors:</span><br>    <span class="hljs-attr">level:</span> <span class="hljs-number">1</span><br>    <span class="hljs-attr">collisionSuffix:</span> <span class="hljs-string">'v'</span><br>    <span class="hljs-attr">permalink:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">permalinkClass:</span> <span class="hljs-string">header-anchor</span><br>    <span class="hljs-attr">permalinkSymbol:</span> <span class="hljs-string">''</span><br></code></pre></td></tr></table></figure><blockquote><p>想了解設定詳情可參考 <a href="https://github.com/hexojs/hexo-renderer-markdown-it/wiki/Advanced-Configuration" target="_blank" rel="noopener">Advanced Configuration | hexojs/hexo-renderer-markdown-it Wiki</a> 官方文件。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter 載入圖片</title>
      <link href="/article/flutter-loading-images.html"/>
      <url>/article/flutter-loading-images.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/flutter.jpg" alt=""></p><p>要如何在 Flutter 內載入圖片？這篇做個小記錄。</p><a id="more"></a><h2 id="指定資源"><a class="header-anchor" href="#指定資源"></a>指定資源</h2><p>Flutter 是在根目錄內的 <code>pubspec.yaml</code> 檔案來設定應用程式所需的資源，設定的資源沒有順序關係。</p><p>若要指定某些資源，資源的路徑是相對於 <code>pubspec.yaml</code> 檔案的相對路徑：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">flutter:</span><br>  <span class="hljs-attr">assets:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/images/avatar.jpg</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/images/background.jpg</span><br></code></pre></td></tr></table></figure><p>也可以指定某個目錄，代表可以存取到這個目錄下的所有資源，但記得要在目錄的最後加上 <code>/</code> 這個符號：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">flutter:</span><br>  <span class="hljs-attr">assets:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/</span><br></code></pre></td></tr></table></figure><p>若要存取子目錄內的資源，請記得要另外為子目錄設定，例如：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">flutter:</span><br>  <span class="hljs-attr">assets:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/images/</span><br></code></pre></td></tr></table></figure><h2 id="載入圖片"><a class="header-anchor" href="#載入圖片"></a>載入圖片</h2><p>可使用 <code>Image.asset()</code> 來載入圖片，裡面的參數就是圖片的路徑：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context) &#123;<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-keyword">return</span> Image.asset(<span class="hljs-string">'assets/images/background.jpg'</span>);<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>或是在 <code>Image()</code> 內的 <code>image</code> 參數使用 <code>AssetImage()</code>：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget build(BuildContext context) &#123;<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-keyword">return</span> Image(<br>    image: AssetImage(<span class="hljs-string">'assets/images/background.jpg'</span>),<br>  );<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>最後顯示的結果會一樣：</p><p><img src="../images/flutter-loading-images/flutter_loading-images.png" alt=""></p><h2 id="參考連結"><a class="header-anchor" href="#參考連結"></a>參考連結</h2><ul><li><a href="https://flutter.io/docs/development/ui/assets-and-images" target="_blank" rel="noopener">Adding assets and images - Flutter</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
          <category> Mobile App </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dart </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python - 日誌 (logging) 模組</title>
      <link href="/article/python-logging.html"/>
      <url>/article/python-logging.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/python.png" alt=""></p><p>開發 Python 時，很常使用 <code>print()</code> 來輸出變數以方便 debug，但要部署時，不需要這些訊息，需要自己手動去註解或刪除那些放在各處的 <code>print()</code>。而 Python 內建提供了 <code>logging</code> 模組可以用來取代 <code>print()</code>，<code>logging</code> 除了可以輸出訊息，也可以將訊息儲存至日誌檔保存。下面紀錄如何使用 <code>logging</code> 模組。</p><a id="more"></a><h2 id="載入-logging-模組"><a class="header-anchor" href="#載入-logging-模組"></a>載入 logging 模組</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br></code></pre></td></tr></table></figure><h2 id="logging-等級"><a class="header-anchor" href="#logging-等級"></a>logging 等級</h2><p><code>logging</code> 模組預先定義了 6 種等級以及對應的 log 輸出函數 (除了 <code>logging.NOTSET</code> 沒有對應的輸出函數)：</p><table><thead><tr><th>等級</th><th>等級數值</th><th>輸出函數</th><th>說明</th></tr></thead><tbody><tr><td>NOTSET</td><td>0</td><td>無對應的輸出函數</td><td>未設定</td></tr><tr><td>DEBUG</td><td>10</td><td><code>logging.debug()</code></td><td>除錯</td></tr><tr><td>INFO</td><td>20</td><td><code>logging.info()</code></td><td>訊息</td></tr><tr><td>WARNING</td><td>30</td><td><code>logging.warning()</code></td><td>警告</td></tr><tr><td>ERROR</td><td>40</td><td><code>logging.error()</code></td><td>錯誤</td></tr><tr><td>CRITICAL</td><td>50</td><td><code>logging.critical()</code></td><td>嚴重錯誤</td></tr></tbody></table><p>若要查詢各等級的數值，可直接呼叫該等級：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>print(logging.NOTSET)   <span class="hljs-comment"># 0</span><br>print(logging.DEBUG)    <span class="hljs-comment"># 10</span><br>print(logging.INFO)     <span class="hljs-comment"># 20</span><br>print(logging.WARNING)  <span class="hljs-comment"># 30</span><br>print(logging.ERROR)    <span class="hljs-comment"># 40</span><br>print(logging.CRITICAL) <span class="hljs-comment"># 50</span><br></code></pre></td></tr></table></figure><p>若要用等級數值來查詢是哪個等級的訊息，可使用 <code>logging.getLevelName(level)</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>print(logging.getLevelName(<span class="hljs-number">0</span>))    <span class="hljs-comment"># NOTSET</span><br>print(logging.getLevelName(<span class="hljs-number">10</span>))   <span class="hljs-comment"># DEBUG</span><br>print(logging.getLevelName(<span class="hljs-number">20</span>))   <span class="hljs-comment"># INFO</span><br>print(logging.getLevelName(<span class="hljs-number">30</span>))   <span class="hljs-comment"># WARNING</span><br>print(logging.getLevelName(<span class="hljs-number">40</span>))   <span class="hljs-comment"># ERROR</span><br>print(logging.getLevelName(<span class="hljs-number">50</span>))   <span class="hljs-comment"># CRITICAL</span><br></code></pre></td></tr></table></figure><h2 id="輸出-logging"><a class="header-anchor" href="#輸出-logging"></a>輸出 logging</h2><p><code>logging</code> 模組預設等級為 <code>WARNING</code>，大於或等於 <code>WARNING</code> 等級的訊息才會被記錄：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>logging.debug(<span class="hljs-string">'debug message'</span>)<br>logging.info(<span class="hljs-string">'info message'</span>)<br>logging.warning(<span class="hljs-string">'warning message'</span>)<br>logging.error(<span class="hljs-string">'error message'</span>)<br>logging.critical(<span class="hljs-string">'critical message'</span>)<br></code></pre></td></tr></table></figure><p>下面是輸出結果，可以看到比 <code>WARNING</code> 等級還要低的訊息有 <code>DEBUG</code> 和 <code>INFO</code> 就不會被輸出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">WARNING:root:warning message<br>ERROR:root:error message<br>CRITICAL:root:critical message<br></code></pre></td></tr></table></figure><p>若將等級設為 <code>DEBUG</code>，就會將所有等級的訊息都輸出：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>logging.basicConfig(level=logging.DEBUG)<br><br>logging.debug(<span class="hljs-string">'debug message'</span>)<br>logging.info(<span class="hljs-string">'info message'</span>)<br>logging.warning(<span class="hljs-string">'warning message'</span>)<br>logging.error(<span class="hljs-string">'error message'</span>)<br>logging.critical(<span class="hljs-string">'critical message'</span>)<br></code></pre></td></tr></table></figure><p>下面是輸出結果，預設的訊息輸出格式是 <code>%(levelname)s:%(name)s:%(message)s</code> (後面會介紹如何自訂輸出格式)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">DEBUG:root:debug message<br>INFO:root:info message<br>WARNING:root:warning message<br>ERROR:root:error message<br>CRITICAL:root:critical message<br></code></pre></td></tr></table></figure><h2 id="紀錄堆疊追蹤資訊"><a class="header-anchor" href="#紀錄堆疊追蹤資訊"></a>紀錄堆疊追蹤資訊</h2><p><code>logging</code> 模組也提供可以紀錄完整的堆疊追蹤 (stack traces)，若在 <code>logging.error()</code> 加上 <code>exc_info</code> 參數，並將該參數設為 <code>True</code>，就可以紀錄 Exception，如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br><span class="hljs-keyword">try</span>:<br>    x = <span class="hljs-number">5</span> / <span class="hljs-number">0</span><br><span class="hljs-keyword">except</span>:<br>    logging.error(<span class="hljs-string">"Catch an exception."</span>, exc_info=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>下面是輸出結果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">ERROR:root:Catch an exception.<br>Traceback (most recent call last):<br>  File "main.py", line 14, in &lt;module&gt;<br>    x = 5 / 0<br>ZeroDivisionError: division by zero<br></code></pre></td></tr></table></figure><p>若沒有加上 <code>exc_info=True</code> 則無法紀錄 Exception：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br><span class="hljs-keyword">try</span>:<br>    x = <span class="hljs-number">5</span> / <span class="hljs-number">0</span><br><span class="hljs-keyword">except</span>:<br>    logging.error(<span class="hljs-string">"Catch an exception."</span>)<br></code></pre></td></tr></table></figure><p>下面是輸出結果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ERROR:root:Catch an exception.<br></code></pre></td></tr></table></figure><p>若要在 logging 內紀錄 exception 訊息，可使用 <code>logging.exception()</code>，它會將 exception 添加至訊息中，此方法的等級為 <code>ERROR</code>，也就是說 <code>logging.exception()</code> 就等同於 <code>logging.error(exc_info=True)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br><span class="hljs-keyword">try</span>:<br>    x = <span class="hljs-number">5</span> / <span class="hljs-number">0</span><br><span class="hljs-keyword">except</span>:<br>    logging.exception(<span class="hljs-string">'Catch an exception.'</span>)<br></code></pre></td></tr></table></figure><p>輸出結果和 <code>logging.error(exc_info=True)</code> 相同：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">ERROR:root:Catch an exception.<br>Traceback (most recent call last):<br>  File "main.py", line 14, in &lt;module&gt;<br>    x = 5 / 0<br>ZeroDivisionError: division by zero<br></code></pre></td></tr></table></figure><p>若不想使用 <code>ERROR</code> 級別紀錄 exception 訊息，可使用 <code>DEBUG</code>、<code>INFO</code>、<code>WARNING</code>、<code>CRITICAL</code> 級別並加上參數 <code>exc_info=True</code> 的設定：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>logging.basicConfig(level=logging.DEBUG)<br><br><span class="hljs-keyword">try</span>:<br>    x = <span class="hljs-number">5</span> / <span class="hljs-number">0</span><br><span class="hljs-keyword">except</span>:<br>    logging.debug(<span class="hljs-string">'Catch an exception.'</span>, exc_info=<span class="hljs-literal">True</span>)<br>    logging.info(<span class="hljs-string">'Catch an exception.'</span>, exc_info=<span class="hljs-literal">True</span>)<br>    logging.warning(<span class="hljs-string">'Catch an exception.'</span>, exc_info=<span class="hljs-literal">True</span>)<br>    logging.critical(<span class="hljs-string">'Catch an exception.'</span>, exc_info=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>下面是輸出結果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">DEBUG:root:Catch an exception.<br>Traceback (most recent call last):<br>  File "main.py", line 14, in &lt;module&gt;<br>    x = 5 / 0<br>ZeroDivisionError: division by zero<br>INFO:root:Catch an exception.<br>Traceback (most recent call last):<br>  File "main.py", line 14, in &lt;module&gt;<br>    x = 5 / 0<br>ZeroDivisionError: division by zero<br>WARNING:root:Catch an exception.<br>Traceback (most recent call last):<br>  File "main.py", line 14, in &lt;module&gt;<br>    x = 5 / 0<br>ZeroDivisionError: division by zero<br>CRITICAL:root:Catch an exception.<br>Traceback (most recent call last):<br>  File "main.py", line 14, in &lt;module&gt;<br>    x = 5 / 0<br>ZeroDivisionError: division by zero<br></code></pre></td></tr></table></figure><h2 id="自訂-logging-輸出格式"><a class="header-anchor" href="#自訂-logging-輸出格式"></a>自訂 logging 輸出格式</h2><p>預設的訊息輸出格式只有 <code>levelname</code>、<code>name</code>、<code>message</code>，下面是其他相關的資訊：</p><table><thead><tr><th>格式化字串</th><th>說明</th></tr></thead><tbody><tr><td><code>%(asctime)s</code></td><td>日期時間, 格式為 <code>YYYY-MM-DD HH:mm:SS,ms</code>，例如：2018-12-13 17:20:30,567</td></tr><tr><td><code>%(filename)s</code></td><td>模組檔名</td></tr><tr><td><code>%(funcName)s</code></td><td>函數名稱</td></tr><tr><td><code>%(levelname)s</code></td><td>日誌的等級名稱</td></tr><tr><td><code>%(levelno)s</code></td><td>日誌的等級數值</td></tr><tr><td><code>%(lineno)d</code></td><td>呼叫日誌函數所在的行數</td></tr><tr><td><code>%(message)s</code></td><td>訊息</td></tr><tr><td><code>%(module)s</code></td><td>模組名稱</td></tr><tr><td><code>%(name)s</code></td><td>logger 的名稱</td></tr><tr><td><code>%(pathname)s</code></td><td>檔案的完整路徑 (如果可用)</td></tr><tr><td><code>%(process)d</code></td><td>process ID (如果可用)</td></tr><tr><td><code>%(thread)d</code></td><td>執行緒 ID (如果可用)</td></tr><tr><td><code>%(threradName)s</code></td><td>執行緒名稱</td></tr></tbody></table><p>可將這些資訊加入 <code>logging.basicConfig()</code> 內的 <code>format</code> 參數：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>FORMAT = <span class="hljs-string">'%(asctime)s %(levelname)s: %(message)s'</span><br>logging.basicConfig(level=logging.DEBUG, format=FORMAT)<br><br>logging.debug(<span class="hljs-string">'debug message'</span>)<br>logging.info(<span class="hljs-string">'info message'</span>)<br>logging.warning(<span class="hljs-string">'warning message'</span>)<br>logging.error(<span class="hljs-string">'error message'</span>)<br>logging.critical(<span class="hljs-string">'critical message'</span>)<br></code></pre></td></tr></table></figure><p>下面是自訂訊息的輸出結果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">2018-12-13 17:40:34,604 DEBUG: debug message<br>2018-12-13 17:40:34,604 INFO: info message<br>2018-12-13 17:40:34,604 WARNING: warning message<br>2018-12-13 17:40:34,604 ERROR: error message<br>2018-12-13 17:40:34,608 CRITICAL: critical message<br></code></pre></td></tr></table></figure><h3 id="自訂輸出的時間格式"><a class="header-anchor" href="#自訂輸出的時間格式"></a>自訂輸出的時間格式</h3><p>在 <code>logging.basicConfig()</code> 內的 <code>datefmt</code> 參數可設定所需的時間格式，要使用 <code>time.strftime()</code> 接受的時間格式：</p><table><thead><tr><th>參數</th><th>說明</th></tr></thead><tbody><tr><td>%Y</td><td>長年份，例如：2019</td></tr><tr><td>%y</td><td>短年份，例如：19</td></tr><tr><td>%m</td><td>月份：01 ~ 12</td></tr><tr><td>%B</td><td>月份完整名稱，例如：February</td></tr><tr><td>%b</td><td>月份縮寫名稱，例如：Feb</td></tr><tr><td>%d</td><td>日期：01 ~ 31</td></tr><tr><td>%H</td><td>小時 (24 小時制)：00 ~ 23</td></tr><tr><td>%I</td><td>小時 (12 小時制)：01 ~ 12</td></tr><tr><td>%w</td><td>星期：0 ~ 6，0 代表星期日</td></tr><tr><td>%A</td><td>星期完整名稱，例如：Friday</td></tr><tr><td>%a</td><td>星期縮寫名稱，例如：Fri</td></tr><tr><td>%P</td><td>AM 或 PM</td></tr><tr><td>%M</td><td>分鐘：00 ~ 59</td></tr><tr><td>%S</td><td>秒：00 ~ 61</td></tr></tbody></table><blockquote><p><code>time.strftime()</code> 的時間參數詳情可參考 Python 官方的 <a href="https://docs.python.org/3/library/time.html#time.strftime" target="_blank" rel="noopener">time — Time access and conversions — Python 3.7.2 documentation</a> 文件。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>LOGGING_FORMAT = <span class="hljs-string">'%(asctime)s %(levelname)s: %(message)s'</span><br>DATE_FORMAT = <span class="hljs-string">'%Y%m%d %H:%M:%S'</span><br>logging.basicConfig(level=logging.DEBUG, format=LOGGING_FORMAT, datefmt=DATE_FORMAT)<br><br>logging.debug(<span class="hljs-string">'debug message'</span>)<br>logging.info(<span class="hljs-string">'info message'</span>)<br>logging.warning(<span class="hljs-string">'warning message'</span>)<br>logging.error(<span class="hljs-string">'error message'</span>)<br>logging.critical(<span class="hljs-string">'critical message'</span>)<br></code></pre></td></tr></table></figure><p>下面是自訂訊息的輸出結果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs log">20190107 08:57:07 DEBUG: debug message<br>20190107 08:57:07 INFO: info message<br>20190107 08:57:07 WARNING: warning message<br>20190107 08:57:07 ERROR: error message<br>20190107 08:57:07 CRITICAL: critical message<br></code></pre></td></tr></table></figure><h2 id="儲存-logging"><a class="header-anchor" href="#儲存-logging"></a>儲存 logging</h2><p>只要在 <code>logging.basicConfig()</code> 內的 <code>filename</code> 參數設定要儲存的日誌檔名，就可以將 logging 儲存：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>FORMAT = <span class="hljs-string">'%(asctime)s %(levelname)s: %(message)s'</span><br>logging.basicConfig(level=logging.DEBUG, filename=<span class="hljs-string">'myLog.log'</span>, filemode=<span class="hljs-string">'w'</span>, format=FORMAT)<br><br>logging.debug(<span class="hljs-string">'debug message'</span>)<br>logging.info(<span class="hljs-string">'info message'</span>)<br>logging.warning(<span class="hljs-string">'warning message'</span>)<br>logging.error(<span class="hljs-string">'error message'</span>)<br>logging.critical(<span class="hljs-string">'critical message'</span>)<br></code></pre></td></tr></table></figure><p>預設 <code>filemode</code> 參數是設為 <code>a</code>，代表 append (附加) 的意思，每次執行程式時，Logging 會將新的訊息加在舊的訊息後面，不會覆蓋舊的訊息。若要改成新訊息覆蓋就訊息，那可以將 <code>filemode</code> 參數設為 <code>w</code>，代表 write 的意思。</p><p>下面是剛剛執行後儲存的 <code>myLog.log</code> 日誌檔：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs log">2018-12-13 17:47:18,686 DEBUG: debug message<br>2018-12-13 17:47:18,687 INFO: info message<br>2018-12-13 17:47:18,687 WARNING: warning message<br>2018-12-13 17:47:18,687 ERROR: error message<br>2018-12-13 17:47:18,687 CRITICAL: critical message<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考官方文件 <a href="https://docs.python.org/3/library/logging.html" target="_blank" rel="noopener">Logging facility for Python — Python documentation</a>。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Logging </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>設定 Windows 工作排程定期執行 Python 爬蟲程式</title>
      <link href="/article/set-up-windows-task-scheduler-to-periodically-execute-python-crawler.html"/>
      <url>/article/set-up-windows-task-scheduler-to-periodically-execute-python-crawler.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/python_crawler.png" alt=""></p><p>如何將 Python 爬蟲程式定期執行？使用 Windows 的使用者可以選擇「工作排程器」來解決。</p><a id="more"></a><p>最近有些資料想透過爬蟲來擷取，而且希望可以定期 (例如：每 10 分鐘一次) 自動執行爬蟲程式，因此就有了這篇筆記。下面介紹如何以 Windows 工作排程器來定期執行爬蟲程式。</p><h2 id="目標"><a class="header-anchor" href="#目標"></a>目標</h2><p>每 10 分鐘自動執行 Python 爬蟲程式，將爬蟲抓到的最新降雨量資料存入 CSV 檔內收集。</p><h2 id="準備"><a class="header-anchor" href="#準備"></a>準備</h2><ul><li>Windows</li><li>Python 環境：建議安裝 Anaconda，可參考 <a href="./create-a-virtual-environment-and-manage-dependencies-with-conda.html">用 Conda 建立虛擬環境和管理相依套件</a></li><li>Python 套件 (這是本篇爬蟲範例所需的相依套件，可依各自需求來選擇)<ul><li><a href="https://pandas.pydata.org/" target="_blank" rel="noopener">Pandas</a></li><li><a href="http://www.numpy.org/" target="_blank" rel="noopener">Numpy</a></li><li><a href="http://docs.python-requests.org/en/master/" target="_blank" rel="noopener">Requests</a></li></ul></li></ul><h2 id="Python-爬蟲程式原始碼"><a class="header-anchor" href="#Python-爬蟲程式原始碼"></a>Python 爬蟲程式原始碼</h2><p>source code: <a href="https://github.com/titangene/cwb-opendata-crawler-demo/blob/master/crawler.py" target="_blank" rel="noopener">titangene/cwb-opendata-crawler-demo/crawler.py</a></p><p>簡單說明一下程式的執行步驟：</p><ol><li>利用 Python 的 <a href="http://docs.python-requests.org/en/master/" target="_blank" rel="noopener">Requests</a> 套件來建立 HTTP 的 GET 請求，從中央氣象局提供的開放資料 API 中取得資料，回傳的格式是 JSON</li><li>解析 API 回傳的 JSON 資料，並將 JSON 轉成 <a href="https://pandas.pydata.org/" target="_blank" rel="noopener">Pandas</a> 的 <code>DataFrame</code> 型別的資料格式</li><li>將 <code>DataFrame</code> 儲存成 CSV 檔保存資料</li></ol><blockquote><p>若想了解中央氣象局開放資料的相關內容，詳情可參考 <a href="https://opendata.cwb.gov.tw/devManual/insrtuction" target="_blank" rel="noopener">中央氣象局開放資料 - 開發指南</a>。</p></blockquote><h2 id="Python-爬蟲程式的批次檔"><a class="header-anchor" href="#Python-爬蟲程式的批次檔"></a>Python 爬蟲程式的批次檔</h2><p>建立一個副檔名為 <code>.bat</code> 的批次檔，批次檔是用來執行 Python 爬蟲程式，因此就能讓 Windows 工作排程器在定期時間自動執行批次檔，以達成自動化執行爬蟲的目的。</p><p>下面就來說明批次檔每行都做了甚麼：</p><ul><li>第一行：切到指定目錄</li><li>第二行：指定 Python 虛擬環境 (可參考 <a href="./create-a-virtual-environment-and-manage-dependencies-with-conda.html">用 Conda 建立虛擬環境和管理相依套件</a>。如果要在全域環境下執行就不需要這行)</li><li>第三行：執行 Python 爬蟲程式</li><li>第四行：若想查看 Python 爬蟲程式執行過程中所輸出 (也就是執行 <code>print</code> 方法的部分) 內容，就需要取消這行的註解<ul><li><code>REM</code>：單行註解</li><li><code>pause</code>：用來暫停批次檔的執行</li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /d D:/Project/Python/cwb-opendata-crawler<br>call activate dev<br>call python crawler.py<br>REM pause<br></code></pre></td></tr></table></figure><p>source code: <a href="https://github.com/titangene/cwb-opendata-crawler-demo/blob/master/crawler.bat" target="_blank" rel="noopener">titangene/cwb-opendata-crawler-demo/crawler.bat</a></p><h2 id="Windows-工作排程器-簡介"><a class="header-anchor" href="#Windows-工作排程器-簡介"></a>Windows 工作排程器 簡介</h2><p>可預先設定工作在特定時間或指定時間時，會自動執行程式或批次檔以達成工作自動化。下圖為 Windows 10 的工作排程器介面：</p><p><img src="../images/set-up-windows-task-scheduler-to-periodically-execute-python-crawler/2018-11-30_13-46-33.png" alt=""></p><h2 id="建立工作，設定定期執行爬蟲程式"><a class="header-anchor" href="#建立工作，設定定期執行爬蟲程式"></a>建立工作，設定定期執行爬蟲程式</h2><p>開啟 Windows 的「工作排程器」，點擊右上角的「建立工作」</p><p><img src="../images/set-up-windows-task-scheduler-to-periodically-execute-python-crawler/2018-11-30_13-47-29.png" alt=""></p><p>自訂工作名稱，若有權限需求可勾選「以最高權限執行」選項</p><p><img src="../images/set-up-windows-task-scheduler-to-periodically-execute-python-crawler/2018-11-30_13-48-27.png" alt=""></p><p>接著新增「觸發程序」</p><p><img src="../images/set-up-windows-task-scheduler-to-periodically-execute-python-crawler/2018-11-30_22-13-47.png" alt=""></p><p>設定工作的開始時間，並選擇「僅一次」，以及設定工作要每隔多久就執行一次，並且要持續多久時間</p><p><img src="../images/set-up-windows-task-scheduler-to-periodically-execute-python-crawler/2018-11-30_13-49-02.png" alt=""></p><p>然後新增「動作」</p><p><img src="../images/set-up-windows-task-scheduler-to-periodically-execute-python-crawler/2018-11-30_22-14-07.png" alt=""></p><p>設定要自動執行的程式，這邊選擇的就是剛剛提到的 <a href="#Python-%E7%88%AC%E8%9F%B2%E7%A8%8B%E5%BC%8F%E7%9A%84%E6%89%B9%E6%AC%A1%E6%AA%94">批次檔</a> (<a href="https://github.com/titangene/cwb-opendata-crawler-demo/blob/master/crawler.bat" target="_blank" rel="noopener">原始碼</a>)</p><p><img src="../images/set-up-windows-task-scheduler-to-periodically-execute-python-crawler/2018-11-30_13-49-54.png" alt=""></p><p>如果設定好了就可以按確定完成建立工作，此時就會看到在「工作排程器程式庫」內的工作清單中，多了剛剛新增的工作</p><p><img src="../images/set-up-windows-task-scheduler-to-periodically-execute-python-crawler/2018-11-30_13-46-05.png" alt=""></p><h2 id="成果"><a class="header-anchor" href="#成果"></a>成果</h2><p>可以看到爬蟲程式會在定期自動執行，執行的時候會跳出一個 <code>cmd</code> 視窗。若剛剛提到的 <a href="#Python-%E7%88%AC%E8%9F%B2%E7%A8%8B%E5%BC%8F%E7%9A%84%E6%89%B9%E6%AC%A1%E6%AA%94">批次檔</a> 內沒有將 <code>REM pause</code> 這行註解，就會看到爬蟲程式執行完成後，不會自動關閉 <code>cmd</code> 視窗，這是為了可以立即看到該次爬蟲執行過程中輸出的訊息。</p><p><img src="../images/set-up-windows-task-scheduler-to-periodically-execute-python-crawler/2018-12-01_00-19-10.png" alt=""></p><p>下圖就是自動執行爬蟲所抓到的資料：</p><p><img src="../images/set-up-windows-task-scheduler-to-periodically-execute-python-crawler/2018-12-01_09-14-48.png" alt=""></p><blockquote><p>完整 source code：<a href="https://github.com/titangene/cwb-opendata-crawler-demo" target="_blank" rel="noopener">titangene/cwb-opendata-crawler-demo</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
          <category> Python </category>
          
          <category> Crawler </category>
          
          <category> OS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python Requests </tag>
            
            <tag> Windows 工作排程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用 Conda 建立虛擬環境和管理相依套件</title>
      <link href="/article/create-a-virtual-environment-and-manage-dependencies-with-conda.html"/>
      <url>/article/create-a-virtual-environment-and-manage-dependencies-with-conda.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/python_anaconda.png" alt=""></p><p>學習如何利用 Conda 來建立不同需求所需的 Python 開發環境，並如何管理相依套件。</p><a id="more"></a><h2 id="Anaconda"><a class="header-anchor" href="#Anaconda"></a>Anaconda</h2><p><img src="../images/create-a-virtual-environment-and-manage-dependencies-with-conda/anaconda-logo.png" alt=""></p><p>Anaconda 是最受歡迎的 Python 資料科學 (Data Science) 平台，它特點就是本來就包含了各種數據分析、科學計算的相關套件 (例如：NumPy、SciPy、Matplotlib、SymPy、Pandas … 等)，而 Anaconda 的套件管理工具就是 conda。</p><h2 id="Conda"><a class="header-anchor" href="#Conda"></a>Conda</h2><p><img src="../images/create-a-virtual-environment-and-manage-dependencies-with-conda/conda-logo.png" alt=""></p><p>Conda 是一個開源的套件與環境管理的系統，可以在 Windows、macOS 和 Linux 上使用。可利用 Conda 來安裝、執行、更新套件以及其相依的套件，並且還可用來建立不同的開發環境 (例如：不同環境有不同的 Python 版本)。</p><!-- more --><h2 id="安裝-Anaconda"><a class="header-anchor" href="#安裝-Anaconda"></a>安裝 Anaconda</h2><p>至 <a href="https://www.anaconda.com/download/" target="_blank" rel="noopener">Anaconda</a> 官網下載並安裝，建議選擇 Python 3.x 的版本。</p><h2 id="建立虛擬環境"><a class="header-anchor" href="#建立虛擬環境"></a>建立虛擬環境</h2><p>從指定套件列表中建立新的 conda 環境：</p><ul><li><code>-n</code>，<code>--name</code>：設定環境名稱</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> conda create -n &lt;environment&gt; &lt;package&gt;</span><br><br><span class="hljs-meta">#</span><span class="bash"> 安裝包含 Anaconda 發行版的套件</span><br><span class="hljs-meta">$</span><span class="bash"> conda create -n &lt;environment&gt; anaconda</span><br><br><span class="hljs-meta">#</span><span class="bash"> 指定 Python 版本</span><br><span class="hljs-meta">$</span><span class="bash"> conda create -n &lt;environment&gt; python=3.6</span><br></code></pre></td></tr></table></figure><ul><li><code>-e</code>，<code>--envs</code>：列出已建立的環境</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 顯示虛擬環境列表，並顯示正在使用的虛擬環境</span><br><span class="hljs-meta">$</span><span class="bash"> conda info -e</span><br><span class="hljs-meta">#</span><span class="bash"> conda environments:</span><br><span class="hljs-meta">#</span><br>base                  *  D:\Users\Titan\Anaconda3<br>hello                    D:\Users\Titan\Anaconda3\envs\hello<br></code></pre></td></tr></table></figure><p>使用或 <code>activate</code> 至指定環境：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Windows</span><br><span class="hljs-meta">$</span><span class="bash"> activate &lt;environment&gt;</span><br><br><span class="hljs-meta">#</span><span class="bash"> Linux and macOS</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> activate &lt;environment&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 顯示虛擬環境列表，並顯示正在使用的虛擬環境</span><br><span class="hljs-meta">$</span><span class="bash"> conda info -e</span><br><span class="hljs-meta">#</span><span class="bash"> conda environments:</span><br><span class="hljs-meta">#</span><br>base                     D:\Users\Titan\Anaconda3<br>hello                 *  D:\Users\Titan\Anaconda3\envs\hello<br></code></pre></td></tr></table></figure><blockquote><p><code>*</code> 代表目前正在使用的虛擬環境</p></blockquote><h2 id="離開虛擬環境"><a class="header-anchor" href="#離開虛擬環境"></a>離開虛擬環境</h2><p>如果要將現在環境改回預設值 <code>base</code> (離開目前環境) 可使用下面指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Windows</span><br><span class="hljs-meta">$</span><span class="bash"> deactivate</span><br><br><span class="hljs-meta">#</span><span class="bash"> Linux and macOS</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> deactivate</span><br></code></pre></td></tr></table></figure><h2 id="利用-conda-安裝套件"><a class="header-anchor" href="#利用-conda-安裝套件"></a>利用 conda 安裝套件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> conda install &lt;package&gt;</span><br><br><span class="hljs-meta">#</span><span class="bash"> 安裝多個套件</span><br><span class="hljs-meta">$</span><span class="bash"> conda install &lt;package-1&gt; &lt;package-2&gt;</span><br></code></pre></td></tr></table></figure><h2 id="查看資訊"><a class="header-anchor" href="#查看資訊"></a>查看資訊</h2><p>查看 conda 目前版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> conda -V</span><br>conda 4.5.11<br></code></pre></td></tr></table></figure><p>查看目前環境已安裝的套件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> conda list</span><br><span class="hljs-meta">#</span><span class="bash"> packages <span class="hljs-keyword">in</span> environment at D:\Users\Titan\Anaconda3:</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta">#</span><span class="bash"> Name                    Version                   Build  Channel</span><br>...<br>jupyter                   1.0.0                    py35_3<br>jupyter_client            5.2.3                    py35_0<br>jupyter_console           4.1.1                    py35_0<br>jupyter_core              4.4.0            py35h629ba7f_0<br>jupyterlab                0.32.1                    &lt;pip&gt;<br>jupyterlab-launcher       0.10.5                    &lt;pip&gt;<br>...<br></code></pre></td></tr></table></figure><p>查看 conda 是否有某套件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> conda search &lt;package&gt;</span><br><br><span class="hljs-meta">$</span><span class="bash"> conda search pandas</span><br>Loading channels: done<br><span class="hljs-meta">#</span><span class="bash"> Name                  Version           Build  Channel</span><br>pandas                    0.9.0      np16py27_0  pkgs/free<br>pandas                    0.9.1      np16py27_0  pkgs/free<br>...<br></code></pre></td></tr></table></figure><p>如果 conda 沒有該套件，可以使用 pip 來安裝套件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 安裝套件</span><br><span class="hljs-meta">$</span><span class="bash"> pip install &lt;package&gt;</span><br><br><span class="hljs-meta">#</span><span class="bash"> 更新套件</span><br><span class="hljs-meta">$</span><span class="bash"> pip install --upgrade &lt;package&gt;</span><br></code></pre></td></tr></table></figure><h2 id="刪除套件"><a class="header-anchor" href="#刪除套件"></a>刪除套件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 刪除環境內的套件</span><br><span class="hljs-meta">$</span><span class="bash"> conda remove -n &lt;environment&gt; &lt;package&gt;</span><br><br><span class="hljs-meta">#</span><span class="bash"> 刪除目前環境內的套件</span><br><span class="hljs-meta">$</span><span class="bash"> conda remove &lt;package&gt;</span><br><br><span class="hljs-meta">#</span><span class="bash"> 刪除多個套件</span><br><span class="hljs-meta">$</span><span class="bash"> conda remove &lt;package-1&gt; &lt;package-2&gt;</span><br></code></pre></td></tr></table></figure><h2 id="更新套件"><a class="header-anchor" href="#更新套件"></a>更新套件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 更新 conda</span><br><span class="hljs-meta">$</span><span class="bash"> conda update conda</span><br><br><span class="hljs-meta">#</span><span class="bash"> 更新 Anaconda</span><br><span class="hljs-meta">$</span><span class="bash"> conda update anaconda</span><br><br><span class="hljs-meta">#</span><span class="bash"> 更新 Python</span><br><span class="hljs-meta">$</span><span class="bash"> conda update python</span><br><br><span class="hljs-meta">#</span><span class="bash"> 更新特定套件</span><br><span class="hljs-meta">$</span><span class="bash"> conda update &lt;package&gt;</span><br></code></pre></td></tr></table></figure><h2 id="刪除虛擬環境"><a class="header-anchor" href="#刪除虛擬環境"></a>刪除虛擬環境</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> conda env remove -n &lt;environment&gt;</span><br></code></pre></td></tr></table></figure><h2 id="更新-Python"><a class="header-anchor" href="#更新-Python"></a>更新 Python</h2><h3 id="更新全域環境"><a class="header-anchor" href="#更新全域環境"></a>更新全域環境</h3><p>若目前 Python 版本是 3.6.1，下面指令只會將 Python 更新至 3.6.x 的最新版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> conda update python</span><br></code></pre></td></tr></table></figure><p>若是要更新到其他版本可指定 Python 版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> conda install python=3.6</span><br></code></pre></td></tr></table></figure><h2 id="更新-Anaconda"><a class="header-anchor" href="#更新-Anaconda"></a>更新 Anaconda</h2><p>更新套件管理器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> conda update conda</span><br></code></pre></td></tr></table></figure><div class="warning"><p>注意：Conda 會更新該版本列表中的最高版本，因此 Python 2.7 更新到 2.x 中的最高版本，而 3.x 系列依此類推。</p></div><p>更新 anaconda 此 meta-package，可更新 Anaconda 發行版包含的套件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> conda update anaconda</span><br></code></pre></td></tr></table></figure><p>如果要更新 Python 的特定版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> conda install python==<span class="hljs-variable">$pythonversion</span>$</span><br></code></pre></td></tr></table></figure><h2 id="參考連結"><a class="header-anchor" href="#參考連結"></a>參考連結</h2><ul><li><a href="https://conda.io/docs/user-guide/tasks/manage-pkgs.html" target="_blank" rel="noopener">Managing packages | Conda documentation</a></li><li><a href="https://stackoverflow.com/questions/41535881/how-do-i-upgrade-to-python-3-6-with-conda" target="_blank" rel="noopener">macos - How do I upgrade to Python 3.6 with conda? - Stack Overflow</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Anaconda </tag>
            
            <tag> Conda </tag>
            
            <tag> Virtual Environment </tag>
            
            <tag> Package Management </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows Subsystem for Linux (WSL)</title>
      <link href="/article/windows-subsystem-for-linux.html"/>
      <url>/article/windows-subsystem-for-linux.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/windows-subsystem-for-linux.png" alt=""></p><p>Windows Subsystem for Linux (簡稱 WSL)，由 Microsoft 與 Canonical 公司合作開發，可直接在 Windows 10 中建立一個 Linux 子系統，原生執行 Linux，還可自行選擇你想安裝的 Linux 發行版，例如：Ubuntu、Kali Linux、SUSE。</p><a id="more"></a><h2 id="啟用-Windows-Subsystem-for-Linux"><a class="header-anchor" href="#啟用-Windows-Subsystem-for-Linux"></a>啟用 Windows Subsystem for Linux</h2><p>使用系統管理者權限開啟 PowerShell，並執行下面命令啟用 <code>Windows Subsystem for Linux</code> 功能：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux</span><br></code></pre></td></tr></table></figure><p>如果顯示下面訊息就代表你沒有使用系統管理員開啟 PowerShell：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">Enable-WindowsOptionalFeature : 要求的作業需要提升的權限。<br>位於 線路:1 字元:1<br>+ Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows- ...<br>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>    + CategoryInfo          : NotSpecified: (:) [Enable-WindowsOptionalFeature], COMException<br>    + FullyQualifiedErrorId : Microsoft.Dism.Commands.EnableWindowsOptionalFeatureCommand<br></code></pre></td></tr></table></figure><p><img src="../images../images/windows-subsystem-for-linux/2018-11-17-19-04-25.png" alt=""></p><p>接著等他跑一下…：</p><p><img src="../images/windows-subsystem-for-linux/2018-11-17-19-04-37.png" alt=""></p><p>接著他會問是否要重啟電腦，因為預設是 Yes，所以可以直接按 <code>Enter</code>：</p><p><img src="../images/windows-subsystem-for-linux/2018-11-17-19-04-47.png" alt=""></p><p>其實上面指令就等於去「控制台 &gt; 程式集 &gt; 開啟或關閉 Windows 功能」開啟「適用於 Linux 的 Windows 子系統」。</p><p><img src="../images/windows-subsystem-for-linux/2018-11-17-19-05-10.png" alt=""></p><h2 id="安裝-Linux-發行版"><a class="header-anchor" href="#安裝-Linux-發行版"></a>安裝 Linux 發行版</h2><p>系統組建 (build) 必須要 Windows build 16215 或更新版本。若要想知道系統組建，可至 Windows 的「設定」內的「關於」即可查看。</p><p><img src="../images/windows-subsystem-for-linux/2018-11-17-19-05-23.png" alt=""></p><p>你可以選擇你想安裝的 Linux 發行版：</p><ul><li><a href="https://www.microsoft.com/zh-tw/p/ubuntu-1604-lts/9pjn388hp8c9" target="_blank" rel="noopener">Ubuntu 16.04 LTS</a></li><li><a href="https://www.microsoft.com/zh-tw/p/ubuntu-1804-lts/9n9tngvndl3q" target="_blank" rel="noopener">Ubuntu 18.04 LTS</a></li><li><a href="https://www.microsoft.com/zh-tw/p/debian-gnu-linux/9msvkqc78pk6" target="_blank" rel="noopener">Debian GNU/Linux</a></li><li><a href="https://www.microsoft.com/zh-tw/p/opensuse-leap-42/9njvjts82tjx" target="_blank" rel="noopener">OpenSUSE Leap 42</a></li><li><a href="https://www.microsoft.com/zh-tw/p/suse-linux-enterprise-server-12/9p32mwbh6cns" target="_blank" rel="noopener">SUSE Linux Enterprise Server 12</a></li><li><a href="https://blogs.msdn.microsoft.com/commandline/2018/03/05/kali-linux-for-wsl/" target="_blank" rel="noopener">Kali Linux</a></li></ul><p><img src="../images/windows-subsystem-for-linux/2018-11-17-19-05-41.png" alt=""></p><p>如果在安裝後直接開啟 Ubuntu，就會顯示 <code>Error: 0x8007007e</code> 錯誤就代表你沒有啟用 <code>Windows Subsystem for Linux</code> 功能，詳情請參考上面：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">The WSL optional component is not enabled. Please enable it and try again.<br>See https://aka.ms/wslinstall for details.<br>Error: 0x8007007e<br>Press any key to continue...<br></code></pre></td></tr></table></figure><p>安裝後啟動 Linux 發行版，此時會開啟一個 console 視窗。因為是第一次開啟，所以會先安裝 WSL，等它安裝完後，就會看到下面畫面，系統要你建立一個新的 Unix 使用者名稱：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">Installing, this may take a few minutes...<br>Installation successful!<br>Please create a default UNIX user account. The username does not need to match your Windows username.<br>For more information visit: https://aka.ms/wslusers<br>Enter new UNIX username:<br></code></pre></td></tr></table></figure><p><img src="../images/windows-subsystem-for-linux/2018-11-17-19-06-06.png" alt=""></p><p>接著是設定此使用者的密碼，這邊的使用者與你的 Windows 使用者名稱和密碼沒有任何關係。詳情可參考官方的 <a href="https://docs.microsoft.com/zh-tw/windows/wsl/user-support" target="_blank" rel="noopener">Linux User Account and Permissions | Microsoft Docs</a> 文件。</p><p>如果顯示 <code>$</code> 就代表設定完成囉！</p><p><img src="../images/windows-subsystem-for-linux/2018-11-17-19-06-17.png" alt=""></p><p>執行 <code>lsb_release -a</code> 指令就會看到 Linux 的系統版本：</p><p><img src="../images/windows-subsystem-for-linux/2018-11-17-19-06-28.png" alt=""></p><h2 id="在其他終端使用-Bash"><a class="header-anchor" href="#在其他終端使用-Bash"></a>在其他終端使用 Bash</h2><p>如果在使用 CMD 、 PowerShell 或其他終端 (例如我常用的 Cmder) 時想用 bash shell，可使用 <code>bash</code> 指令就可以啟動新的 Ubuntu shell：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> bash</span><br></code></pre></td></tr></table></figure><p><img src="../images/windows-subsystem-for-linux/2018-11-17-19-06-42.png" alt=""></p><p><img src="../images/windows-subsystem-for-linux/2018-11-17-19-06-53.png" alt=""></p><p><img src="../images/windows-subsystem-for-linux/2018-11-17-19-07-01.png" alt=""></p><h2 id="存取目錄"><a class="header-anchor" href="#存取目錄"></a>存取目錄</h2><p>如果想存取 <code>D:\project</code>，在此環境下的路徑就是 <code>/mnt/d/project</code>。</p><p><img src="../images/windows-subsystem-for-linux/2018-11-17-19-07-14.png" alt=""></p><h2 id="小結"><a class="header-anchor" href="#小結"></a>小結</h2><p>如果有在跨平台開發或維運的朋友，這個功能應該是一直以來的願望吧？讓你在 Windows 上可以直接處理事情，不用再多開 VM 來使用，不只省資源，也省硬碟空間，重點是不用等 VM 開機…</p><h2 id="參考連結"><a class="header-anchor" href="#參考連結"></a>參考連結</h2><ul><li><a href="https://docs.microsoft.com/zh-tw/windows/wsl/install-win10" target="_blank" rel="noopener">Install the Linux Subsystem on Windows 10 | Microsoft Docs</a></li><li><a href="https://blogs.msdn.microsoft.com/microsoft_student_partners_in_taiwan/2017/10/03/wsltune/" target="_blank" rel="noopener">【WSL】Windows Subsystem for Linux 安裝及基本配置！ | 台灣微軟學生大使</a></li><li><a href="https://kheresy.wordpress.com/2016/04/12/bash-on-ubuntu-on-windows/" target="_blank" rel="noopener">Bash on Ubuntu on Windows 的簡單使用 | Heresy’s Space</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
            <tag> WSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitHub 縮網址服務 Git.io</title>
      <link href="/article/github-url-shortener.html"/>
      <url>/article/github-url-shortener.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/github-url-shortener.png" alt=""></p><p>最近發現原來 Github 也有提供縮網址 (URL Shortener) 服務「<a href="https://git.io/" target="_blank" rel="noopener">Git.io</a>」，它只適用於 <code>gist.github.com</code> 及 <code>github.com</code> 兩個 hostname。</p><a id="more"></a><p>下列網址都可以透過 <a href="http://Git.io" target="_blank" rel="noopener">Git.io</a> 來建立縮網址：</p><ul><li>Github 個人或組織專業 ( <code>https://github.com/&lt;github-id&gt;</code> )</li><li>Github repository ( <code>https://github.com/&lt;github-id&gt;/&lt;repo-name&gt;</code> ) 或 repository 內目錄或檔案</li><li>Gist ( <code>https://gist.github.com/&lt;github-id&gt;/&lt;gist-id&gt;</code> )</li></ul><p><a href="http://Git.io" target="_blank" rel="noopener">Git.io</a> 有兩種建立短網址的方法，下面會分別介紹：</p><ul><li>直接到 <a href="https://git.io/" target="_blank" rel="noopener">Git.io</a> 線上設定</li><li>使用 <code>curl</code> 指令設定：<a href="https://blog.github.com/2011-11-10-git-io-github-url-shortener/" target="_blank" rel="noopener">Git.io: GitHub URL Shortener | GitHub Blog</a></li></ul><h2 id="Git-io-線上設定"><a class="header-anchor" href="#Git-io-線上設定"></a><a href="https://git.io/" target="_blank" rel="noopener">Git.io</a> 線上設定</h2><p>最簡單的方法當然是直接打開 <a href="https://git.io/" target="_blank" rel="noopener">Git.io</a>，接著輸入網址並點擊「shorten」按鈕就會將你剛剛輸入的網址變成短網址，短網址的格式是 <code>git.io/xxx</code>。</p><p>但缺點是無法自訂短網址名稱，預設是自動隨機英文 + 數字的字串。</p><p><img src="../images/github-url-shortener/github-url-shortener.png" alt=""></p><h2 id="使用-curl-指令建立短網址"><a class="header-anchor" href="#使用-curl-指令建立短網址"></a>使用 <code>curl</code> 指令建立短網址</h2><ul><li><code>-i</code>、<code>--include</code>：顯示 HTTP response headers</li><li><code>-F</code>、<code>--form &lt;name=content&gt;</code>：設定表單資料，<code>Content-Type</code> 會被設為 <code>multipart/form-data</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> curl -i https://git.io -F <span class="hljs-string">"url=&lt;想縮短的網址&gt;"</span> -F <span class="hljs-string">"code=&lt;自訂短網址名稱&gt;"</span></span><br></code></pre></td></tr></table></figure><p>例如我想將自己的 Github profile URL：<code>github.com/titangene</code> 縮短成 <code>git.io/titan</code>，就要執行下面指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> curl -i https://git.io -F <span class="hljs-string">"url=https://github.com/titangene"</span> -F <span class="hljs-string">"code=titan"</span></span><br>HTTP/1.1 201 Created<br>...<br>Location: https://git.io/titan<br>...<br><br><span class="hljs-meta">$</span><span class="bash"> curl -i https://git.io -F <span class="hljs-string">"url=https://titangene.github.io/"</span> -F <span class="hljs-string">"code=titan-blog"</span></span><br></code></pre></td></tr></table></figure><p>只要輸入下面指令就可以確認是否建立成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> curl -i https://git.io/titan</span><br>HTTP/1.1 302 Found<br>...<br>Location: https://github.com/titangene<br>...<br></code></pre></td></tr></table></figure><h2 id="小插曲-縮網址不小心設定錯誤"><a class="header-anchor" href="#小插曲-縮網址不小心設定錯誤"></a>[小插曲] 縮網址不小心設定錯誤</h2><p>一開始在 <a href="http://Git.io" target="_blank" rel="noopener">Git.io</a> 測試時，直接用自己的 Github profile URL ( <code>github.com/titangene</code> ) 來產生預設隨機英文 + 數字的短網址，想要修改成 <code>git.io/titan</code> 卻沒辦法！這是因為 <a href="http://Git.io" target="_blank" rel="noopener">Git.io</a> 沒有直接提供修改短網址的功能。</p><p>後來 Google 一下才發現只能聯繫 <a href="https://github.com/contact" target="_blank" rel="noopener">Github 客服</a>來幫忙刪除短網址，然後再自行重新設定。過了不到半天客服就回信幫我解決了！真是太感謝 Github 客服了！</p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github </tag>
            
            <tag> URL </tag>
            
            <tag> URL Shortener </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter 自訂字型</title>
      <link href="/article/flutter-custom-fonts.html"/>
      <url>/article/flutter-custom-fonts.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/flutter.jpg" alt=""></p><p>雖然 Android 和 iOS 內建都有字型，但常有自訂字型的需求，所以這篇會教你如何在 Flutter 使用自訂字型。</p><a id="more"></a><h2 id="將字型檔放入專案資料夾內"><a class="header-anchor" href="#將字型檔放入專案資料夾內"></a>將字型檔放入專案資料夾內</h2><p>此範例是放在 <code>./assets/fonts</code> 資料夾內：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">assets&#x2F;<br>  fonts&#x2F;<br>    FiraCode-Medium.ttf<br>    mononoki-Bold.ttf<br>    mononoki-BoldItalic.ttf<br>    mononoki-Italic.ttf<br>    mononoki-Regular.ttf<br></code></pre></td></tr></table></figure><h2 id="在-pubspec-yaml-定義字型資訊"><a class="header-anchor" href="#在-pubspec-yaml-定義字型資訊"></a>在 <code>pubspec.yaml</code> 定義字型資訊</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">flutter:</span><br>  <span class="hljs-attr">fonts:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">family:</span> <span class="hljs-string">FiraCode</span><br>      <span class="hljs-attr">fonts:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">asset:</span> <span class="hljs-string">assets/fonts/FiraCode-Medium.ttf</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">family:</span> <span class="hljs-string">Mononoki</span><br>      <span class="hljs-attr">fonts:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">asset:</span> <span class="hljs-string">assets/fonts/mononoki-Regular.ttf</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">asset:</span> <span class="hljs-string">assets/fonts/mononoki-Bold.ttf</span><br>          <span class="hljs-attr">weight:</span> <span class="hljs-number">700</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">asset:</span> <span class="hljs-string">assets/fonts/mononoki-Italic.ttf</span><br>          <span class="hljs-attr">style:</span> <span class="hljs-string">italic</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">asset:</span> <span class="hljs-string">assets/fonts/mononoki-BoldItalic.ttf</span><br>          <span class="hljs-attr">weight:</span> <span class="hljs-number">700</span><br>          <span class="hljs-attr">style:</span> <span class="hljs-string">italic</span><br></code></pre></td></tr></table></figure><h2 id="設定預設字型"><a class="header-anchor" href="#設定預設字型"></a>設定預設字型</h2><p><img src="../images/flutter-custom-fonts/flutter_set-default-font.png" alt=""></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart">MaterialApp(<br>  title: <span class="hljs-string">'Custom Fonts'</span>,<br>  theme: ThemeData(fontFamily: <span class="hljs-string">'FiraCode'</span>),<br>  home: MyHomePage(title: <span class="hljs-string">'Custom Fonts'</span>),<br>);<br></code></pre></td></tr></table></figure><h2 id="在特定-Widget-設定字型"><a class="header-anchor" href="#在特定-Widget-設定字型"></a>在特定 Widget 設定字型</h2><p><img src="../images/flutter-custom-fonts/flutter_set-the-font-on-a-specific-widget.png" alt=""></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart">Text(<br>  <span class="hljs-string">'Custom Fonts'</span>,<br>  style: TextStyle(<br>    fontFamily: <span class="hljs-string">'Mononoki'</span>,<br>    fontSize: <span class="hljs-number">30.0</span>,<br>    fontWeight: FontWeight.w700,<br>    fontStyle: FontStyle.italic,<br>  ),<br>)<br></code></pre></td></tr></table></figure><h2 id="完整範例程式碼"><a class="header-anchor" href="#完整範例程式碼"></a>完整範例程式碼</h2><p><img src="../images/flutter-custom-fonts/flutter_custom-fonts_demo.png" alt=""></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;<br><br><span class="hljs-keyword">void</span> main() =&gt; runApp(<span class="hljs-keyword">new</span> MyApp());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MaterialApp(<br>      title: <span class="hljs-string">'Custom Fonts'</span>,<br>      theme: <span class="hljs-keyword">new</span> ThemeData(<br>        primarySwatch: Colors.blue,<br>        fontFamily: <span class="hljs-string">'FiraCode'</span>,<br>      ),<br>      home: <span class="hljs-keyword">new</span> MyHomePage(title: <span class="hljs-string">'Custom Fonts'</span>),<br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyHomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  MyHomePage(&#123;Key key, <span class="hljs-keyword">this</span>.title&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> title;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Scaffold(<br>      appBar: <span class="hljs-keyword">new</span> AppBar(<br>        title: <span class="hljs-keyword">new</span> Text(<span class="hljs-keyword">this</span>.title),<br>      ),<br>      body: Column(<br>        children: &lt;Widget&gt;[<br>          <span class="hljs-keyword">new</span> Text(<br>            <span class="hljs-string">'&lt;-- Custom Fonts -&gt;&gt;'</span>,<br>            style: TextStyle(fontSize: <span class="hljs-number">30.0</span>),<br>          ),<br>          <span class="hljs-keyword">new</span> Text(<br>            <span class="hljs-string">'Custom Fonts'</span>,<br>            style: TextStyle(<br>              fontFamily: <span class="hljs-string">'Mononoki'</span>,<br>              fontSize: <span class="hljs-number">30.0</span>,<br>            ),<br>          ),<br>          <span class="hljs-keyword">new</span> Text(<br>            <span class="hljs-string">'Custom Fonts'</span>,<br>            style: TextStyle(<br>              fontFamily: <span class="hljs-string">'Mononoki'</span>,<br>              fontSize: <span class="hljs-number">30.0</span>,<br>              fontWeight: FontWeight.w700,<br>            ),<br>          ),<br>          <span class="hljs-keyword">new</span> Text(<br>            <span class="hljs-string">'Custom Fonts'</span>,<br>            style: TextStyle(<br>              fontFamily: <span class="hljs-string">'Mononoki'</span>,<br>              fontSize: <span class="hljs-number">30.0</span>,<br>              fontStyle: FontStyle.italic,<br>            ),<br>          ),<br>          <span class="hljs-keyword">new</span> Text(<br>            <span class="hljs-string">'Custom Fonts'</span>,<br>            style: TextStyle(<br>              fontFamily: <span class="hljs-string">'Mononoki'</span>,<br>              fontSize: <span class="hljs-number">30.0</span>,<br>              fontWeight: FontWeight.w700,<br>              fontStyle: FontStyle.italic,<br>            ),<br>          ),<br>        ],<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>詳情可參考 <a href="https://flutter.io/cookbook/design/fonts/" target="_blank" rel="noopener">Using custom fonts - Flutter</a> 官方文件</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
          <category> Mobile App </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dart </tag>
            
            <tag> Font </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter 環境建置 (Windows)</title>
      <link href="/article/flutter-install-on-windows.html"/>
      <url>/article/flutter-install-on-windows.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/flutter.jpg" alt=""></p><p>最近剛接觸 Flutter，於是就把在 Windows 上建置環境的記錄寫成一篇筆記，裡面包括 Android Studio 和 VS Code 的開發流程。</p><a id="more"></a><p>詳情可參考官方連結：<a href="https://flutter.io/setup-windows/" target="_blank" rel="noopener">Get Started: Install on Windows | Flutter</a></p><h2 id="系統要求"><a class="header-anchor" href="#系統要求"></a>系統要求</h2><ul><li>OS：Windows 7 SP1 或以上 (64-bit)</li><li>硬碟空間：400 MB (不包括 IDE 和工具的空間)</li><li>工具<ul><li><a href="https://docs.microsoft.com/en-us/powershell/scripting/setup/installing-windows-powershell?view=powershell-6#upgrading-existing-windows-powershell" target="_blank" rel="noopener">PowerShell 5.0</a> 或更新版</li><li><a href="https://git-scm.com/download/win" target="_blank" rel="noopener">Git for Windows</a> (勾選 <code>Use Git from the Windows Command Prompt</code> 選項，若沒打勾可自行將 Git 安裝目錄內的 <code>bin</code> 資料夾設定為 <code>Path</code> 環境變數，預設目錄為 <code>C:\Program Files\Git\bin</code> )</li></ul></li></ul><h2 id="安裝-Flutter-SDK"><a class="header-anchor" href="#安裝-Flutter-SDK"></a>安裝 Flutter SDK</h2><ol><li>下載 Flutter SDK，可下載<a href="https://flutter.io/sdk-archive/#windows" target="_blank" rel="noopener">歷史版本</a>，但建議安裝新版。</li><li>解壓檔內有一個 <code>flutter</code> 資瞭夾，將此資料夾放在 Flutter SDK 所需的安裝目錄 (e.g <code>D:\dev\flutter</code>，請勿將 <code>flutter</code> 資瞭夾放在需要提高權限之類的目錄內，e.g. <code>C:\Program Files\</code> )。</li><li>將 <code>flutter\bin</code> 的完整目錄 (e.g. <code>D:\dev\flutter\bin</code> ) 加入 <code>Path</code> 環境變數 (各完整路徑記得用 <code>;</code> 分號分隔)</li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-09-08.png" alt=""></p><ol start="4"><li>接著就可以在 Console 內執行 Flutter commands</li><li>執行 <code>flutter --version</code> 指令確定已成功安裝 Flutter SDK</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> flutter --version</span><br>Flutter 0.7.3 • channel beta • https://github.com/flutter/flutter.git<br>Framework • revision 3b309bda07 (12 days ago) • 2018-08-28 12:39:24 -0700<br>Engine • revision af42b6dc95<br>Tools • Dart 2.1.0-dev.1.0.flutter-ccb16f7282<br></code></pre></td></tr></table></figure><ol start="6"><li>之後請定期執行 <code>flutter upgrade</code> 指令更新 Flutter (因為目前還在 beta，大約幾週就會有新版)</li></ol><p>執行 <code>flutter --version</code> 指令後，若看到下面畫面就代表現在有新版可以更新：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> flutter --version</span><br>  ╔════════════════════════════════════════════════════════════════════════════╗<br>  ║ A new version of Flutter is available!                                     ║<br>  ║                                                                            ║<br>  ║ To update to the latest version, run "flutter upgrade".                    ║<br>  ╚════════════════════════════════════════════════════════════════════════════╝<br><br><br>Flutter 0.7.3 • channel beta • https://github.com/flutter/flutter.git<br>Framework • revision 3b309bda07 (3 weeks ago) • 2018-08-28 12:39:24 -0700<br>Engine • revision af42b6dc95<br>Tools • Dart 2.1.0-dev.1.0.flutter-ccb16f7282<br></code></pre></td></tr></table></figure><p>執行 <code>flutter upgrade</code> 指令更新 Flutter：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> flutter upgrade</span><br>Upgrading Flutter from D:\dev\flutter...<br>...<br>Flutter 0.7.3 • channel beta • https://github.com/flutter/flutter.git<br>Framework • revision 3b309bda07 (3 weeks ago) • 2018-09-07 12:33:05 -0700<br>Engine • revision 58a1894a1c<br>Tools • Dart 2.1.0-dev.1.0.flutter-ccb16f7282<br><br>Running flutter doctor...<br>Doctor summary (to see all details, run flutter doctor -v):<br>[√] Flutter (Channel beta, v0.8.2, on Microsoft Windows [Version 10.0.17134.285], locale zh-TW)<br>[√] Android toolchain - develop for Android devices (Android SDK 28.0.2)<br>[√] Android Studio (version 3.1)<br>[√] VS Code (version 1.27.2)<br>[!] Connected devices<br>    ! No devices available<br><br>! Doctor found issues in 1 category.<br></code></pre></td></tr></table></figure><p>在執行一次 <code>flutter --version</code> 確認已更新至新的版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> flutter --version</span><br>Flutter 0.8.2 • channel beta • https://github.com/flutter/flutter.git<br>Framework • revision 5ab9e70727 (13 days ago) • 2018-09-07 12:33:05 -0700<br>Engine • revision 58a1894a1c<br>Tools • Dart 2.1.0-dev.3.1.flutter-760a9690c2<br></code></pre></td></tr></table></figure><h2 id="flutter-doctor"><a class="header-anchor" href="#flutter-doctor"></a>flutter doctor</h2><p>下面指令是用來查看是否需要安裝任何依賴才能完成設定，因此他會檢查你的環境並顯示檢查報告：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> flutter doctor</span><br></code></pre></td></tr></table></figure><p>Dart SDK is bundled with Flutter，不用另外安裝 Dart。從檢查報告的輸出中可以了解需要安裝的其他軟體或執行的其他任務 (以粗體顯示)。例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> flutter doctor</span><br>Doctor summary (to see all details, run flutter doctor -v):<br>[√] Flutter (Channel beta, v0.7.3, on Microsoft Windows [Version 10.0.17134.228], locale zh-TW)<br>[!] Android toolchain - develop for Android devices (Android SDK 28.0.2)<br>    X Android license status unknown.<br>[√] Android Studio (version 3.1)<br>    X Flutter plugin not installed; this adds Flutter specific functionality.<br>    X Dart plugin not installed; this adds Dart specific functionality.<br>[!] Connected devices<br>    ! No devices available<br><br>! Doctor found issues in 2 categories.<br></code></pre></td></tr></table></figure><p>下面會介紹如何執行這些任務並完成設定過程。可再次執行 <code>flutter doctor</code> 指令來驗證是否已正確設定所有內容。</p><p>如果已驗證設定所有內容，就會看到下面輸出結果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> flutter doctor</span><br>Doctor summary (to see all details, run flutter doctor -v):<br>[√] Flutter (Channel beta, v0.7.3, on Microsoft Windows [Version 10.0.17134.285], locale zh-TW)<br>[√] Android toolchain - develop for Android devices (Android SDK 28.0.2)<br>[√] Android Studio (version 3.1)<br>[√] Connected devices (1 available)<br><br>• No issues found!<br></code></pre></td></tr></table></figure><p>加上參數 <code>-v</code>，可以看更詳細的驗證說明：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> flutter doctor -v</span><br>[√] Flutter (Channel beta, v0.7.3, on Microsoft Windows [Version 10.0.17134.285], locale zh-TW)<br>    • Flutter version 0.7.3 at D:\dev\flutter<br>    • Framework revision 3b309bda07 (3 weeks ago), 2018-08-28 12:39:24 -0700<br>    • Engine revision af42b6dc95<br>    • Dart version 2.1.0-dev.1.0.flutter-ccb16f7282<br><br>[√] Android toolchain - develop for Android devices (Android SDK 28.0.2)<br>    • Android SDK at C:\Users\Titan\AppData\Local\Android\sdk<br>    • Android NDK location not configured (optional; useful for native profiling support)<br>    • Platform android-28, build-tools 28.0.2<br>    • ANDROID_HOME = C:\Users\Titan\AppData\Local\Android\sdk<br>    • Java binary at: C:\Program Files\Android\Android Studio\jre\bin\java<br>    • Java version OpenJDK Runtime Environment (build 1.8.0_152-release-1024-b02)<br>    • All Android licenses accepted.<br><br>[√] Android Studio (version 3.1)<br>    • Android Studio at C:\Program Files\Android\Android Studio<br>    • Flutter plugin version 28.0.1<br>    • Dart plugin version 173.4700<br>    • Java version OpenJDK Runtime Environment (build 1.8.0_152-release-1024-b02)<br><br>[√] Connected devices (1 available)<br>    • SM N950F • 988a98444d********** • android-arm64 • Android 8.0.0 (API 26)<br><br>• No issues found!<br></code></pre></td></tr></table></figure><h2 id="Android-設定"><a class="header-anchor" href="#Android-設定"></a>Android 設定</h2><div class="info"><p>Flutter 依賴於 Android Studio 以提供 Android 平台的依賴性。但也可以使用其他編輯器來寫 Flutter App。</p></div><h3 id="安裝-Java-JDK"><a class="header-anchor" href="#安裝-Java-JDK"></a>安裝 Java JDK</h3><ol><li>安裝 <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">JDK</a></li><li>將 Java JDK 安裝目錄設定為 <code>JAVA_HOME</code> 環境變數 (e.g. <code>C:\Program Files\Java\jdk1.8.0_151</code> )，並在將 Java JDK 安裝目錄內的 <code>bin</code> 資料夾設定為 <code>Path</code> 環境變數 (e.g. <code>C:\Program Files\Java\jdk1.8.0_151\bin</code>，也可設定為 <code>%JAVA_HOME%\bin</code> )</li></ol><h3 id="安裝-Android-Studio"><a class="header-anchor" href="#安裝-Android-Studio"></a>安裝 Android Studio</h3><ol><li>安裝 <a href="https://developer.android.com/studio/" target="_blank" rel="noopener">Android Studio</a>，請安裝 Recommended (建議) 版</li><li>執行 Android Studio，並瀏覽 <code>Android Studio Setup Wizard</code>，安裝最新的 Android SDK、Android SDK Platform-Tools、Android SDK Build-Tools，這些都是 Flutter 在開發 Android 時所必須的。</li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-10-14.png" alt=""></p><ol start="3"><li>將 Android SDK 目錄設定為 <code>ANDROID_HOME</code> 環境變數 (預設目錄為 <code>C:\Users\Titan\AppData\Local\Android\sdk</code> )</li><li>定期更新 Android SDK (於 <code>Android Studio</code> &gt; <code>Configure</code> &gt; <code>SDK Manager</code> 安裝)</li></ol><h3 id="設定你的-Android-裝置"><a class="header-anchor" href="#設定你的-Android-裝置"></a>設定你的 Android 裝置</h3><p>想在 Android 裝置上執行和測試 Flutter App，需要 Android 4.1 (API level 16) 或更高版本的 Android 設備。</p><ol><li>裝置請開啟 <code>開發者模式</code> 內的 <code>USB 偵錯</code>，詳情可參考 <a href="https://developer.android.com/studio/debug/dev-options" target="_blank" rel="noopener">Configure on-device developer options  |  Android Developers</a> 此 Android 官方文件</li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-10-23.png" alt=""></p><ol start="2"><li>安裝 <a href="https://developer.android.com/studio/run/win-usb" target="_blank" rel="noopener">Google USB Driver</a> (限 Windows)</li><li>使用 USB 線將裝置連接至電腦，如果你的裝置有出現提示，請授權你的電腦可訪問你的裝置</li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-10-36.png" alt=""></p><ol start="4"><li>開啟終端機，執行 <code>flutter devices</code> 指令以驗證 Flutter 是否成功連結 Android 裝置</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 像我連接到 Note 8</span><br><span class="hljs-meta">$</span><span class="bash"> flutter devices</span><br>1 connected device:<br><br>SM N950F • 988a98444d********** • android-arm64 • Android 8.0.0 (API 26)<br></code></pre></td></tr></table></figure><p>Flutter 預設會以 <code>adb</code> 工具基於的 Android SDK 版本來使用，若想用其他版本的 Android SDK，可設定你所需的 Android SDK 目錄為 <code>ANDROID_HOME</code> 環境變數。</p><p>如果執行 <code>flutter run</code>指令，而且成功將 App 安置手機並執行，就會看到 App 的畫面</p><p><img src="../images/flutter-install-on-windows/2018-10-23-07-10-45.png" alt=""></p><h3 id="設定-Android-模擬器-emulator"><a class="header-anchor" href="#設定-Android-模擬器-emulator"></a>設定 Android 模擬器 (emulator)</h3><p>想在 Android 模擬器上執行和測試 Flutter App，請依照下面步驟：</p><ol><li>在主機上啟用 <a href="https://developer.android.com/studio/run/emulator-acceleration" target="_blank" rel="noopener">VM acceleration</a></li><li>啟動 <strong>Android Studio</strong> &gt; <strong>Tools</strong> &gt; <strong>AVD Manager</strong> 並點選 <strong>Create Virtual Device</strong></li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-10-55.png" alt=""></p><p><img src="../images/flutter-install-on-windows/2018-10-23-07-11-05.png" alt=""></p><ol><li>選擇設備定義，然後點擇 <strong>Next</strong></li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-11-14.png" alt=""></p><ol start="2"><li>選擇你所需的 Android 版本的 OS image，然後點選 <strong>Next</strong> (建議選擇 <em>x86</em> 或 x86_64 image)</li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-11-23.png" alt=""></p><ol start="3"><li>在 Emulated Performance 欄位請選擇 <strong>Hardware - GLES 2.0</strong> 以啟用 <a href="https://developer.android.com/studio/run/emulator-acceleration" target="_blank" rel="noopener">hardware acceleration</a></li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-11-38.png" alt=""></p><ol start="4"><li>驗證 AVD 設定是否正確，若確定請點選 <strong>Finish</strong></li><li>在 Android Virtual Device Manager 中，選擇某台模擬器並點擊 Run</li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-12-30.png" alt=""></p><p>有關上述步驟的詳情可參考 <a href="https://developer.android.com/studio/run/managing-avds.html" target="_blank" rel="noopener">Managing AVDs</a></p><h2 id="設定編輯器"><a class="header-anchor" href="#設定編輯器"></a>設定編輯器</h2><h3 id="設定-Android-Studio"><a class="header-anchor" href="#設定-Android-Studio"></a>設定 Android Studio</h3><p>安裝 Flutter 和 Dart plugins (外掛)，有兩個 plugin 支援 Flutter：</p><ul><li><code>Flutter</code> 外掛：支持 Flutter 開發人員工作流程 (running, debugging, hot reload … 等)</li><li><code>Dart</code> 外掛：提供程式碼分析 (輸入時的程式碼驗證、程式碼自動補全)</li></ul><p>安裝步驟：</p><ol><li>執行 Android Studio</li><li>開啟外掛選項 (<strong>File</strong> &gt; <strong>Settings</strong> &gt; <strong>Plugins</strong>)</li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-14-00.png" alt=""></p><ol start="3"><li>點選 <strong>Browse repositories…</strong>，接著搜尋 <code>Flutter</code> 並選擇並安裝名為 <code>Flutter</code> 的 plugin (請注意，安裝 <code>Flutter</code> 外掛時會同時安裝 <code>Dart</code> 語言外掛)</li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-14-06.png" alt=""></p><p><img src="../images/flutter-install-on-windows/2018-10-23-07-14-13.png" alt=""></p><ol start="4"><li>點擊 <strong>Restart Android Studio</strong></li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-14-20.png" alt=""></p><h3 id="設定-VS-Code"><a class="header-anchor" href="#設定-VS-Code"></a>設定 VS Code</h3><ul><li>安裝 Flutter plugin：<ul><li>安裝 <a href="https://marketplace.visualstudio.com/items?itemName=Dart-Code.flutter" target="_blank" rel="noopener">Flutter</a> 此擴充功能，並重啟 VS Code。</li></ul></li></ul><p><img src="../images/flutter-install-on-windows/2018-10-23-07-14-30.png" alt=""></p><ul><li>使用 Flutter Doctor 驗證你的設定環境：<ul><li>按 <code>F1</code> 或 <code>ctrl + shift + p</code> 後，輸入 <strong>Flutter</strong> 並點選 <strong>Flutter: Run Flutter Doctor</strong> 即可至 <strong>OUTPUT (輸出)</strong> 查看驗證結果。</li></ul></li></ul><p><img src="../images/flutter-install-on-windows/2018-10-23-07-14-39.png" alt=""></p><h2 id="使用-Android-Studio-開發"><a class="header-anchor" href="#使用-Android-Studio-開發"></a>使用 Android Studio 開發</h2><h3 id="建立新-app"><a class="header-anchor" href="#建立新-app"></a>建立新 app</h3><p>在 Android Studio 中建立 Flutter 專案 ( <strong>File</strong> &gt; <strong>New</strong> &gt; <strong>New Flutter Project…</strong> )</p><p><img src="../images/flutter-install-on-windows/2018-10-23-07-15-04.png" alt=""></p><p>接著選擇 <strong>Flutter Application</strong>，並點選 <strong>Next</strong></p><p><img src="../images/flutter-install-on-windows/2018-10-23-07-15-10.png" alt=""></p><p>請設定專案名稱、確定 Flutter SDK 目錄、設定專案儲存位置與填寫專案的簡單描述後，點選 <strong>Next</strong></p><p><img src="../images/flutter-install-on-windows/2018-10-23-07-15-17.png" alt=""></p><p>最後輸入公司網域 (e.g. <a href="http://example.com" target="_blank" rel="noopener">example.com</a>) 後，點選 <strong>Finish</strong> 即可建立新的 Flutter 專案</p><p><img src="../images/flutter-install-on-windows/2018-10-23-07-15-23.png" alt=""></p><h3 id="執行-app"><a class="header-anchor" href="#執行-app"></a>執行 app</h3><p>下圖為 Android Studio 的工具列：</p><p><img src="../images/flutter-install-on-windows/2018-10-23-07-15-29.png" alt=""></p><p>圖片來源：<a href="https://flutter.io/get-started/test-drive/#androidstudio" target="_blank" rel="noopener">Get Started: Test Drive | Flutter</a></p><ol><li>在 <strong>target selector</strong> 中，選擇已執行的 Android 裝置，若當前未啟動或未連接任何 Android 裝置，選擇某一模擬器時，Android Studio 就會開啟該選擇的模擬器。如果沒有可用的裝置，可至前面介紹的 <a href="#%E8%A8%AD%E5%AE%9A-Android-%E6%A8%A1%E6%93%AC%E5%99%A8-emulator">設定 Android 模擬器</a> 段落來新建模擬器。</li><li>點擊 <strong>Run</strong> 圖示執行 app</li><li>稍後就會在模擬器或裝置上看到下圖的 app 畫面<ol><li>等待的過程中會初始化 gradle</li><li>gradle 會 resolve dependencies</li><li>將專案轉成 apk</li><li>將 apk 安裝並執行於裝置上</li></ol></li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-15-41.png" alt=""></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">Launching lib\main.dart on Android SDK built for x86 64 in debug mode...<br>Initializing gradle...<br>Resolving dependencies...<br>Running 'gradlew assembleDebug'...<br>Built build\app\outputs\apk\debug\app-debug.apk.<br>Installing build\app\outputs\apk\app.apk...<br>D/OpenGLRenderer( 4777): HWUI GL Pipeline<br>I/OpenGLRenderer( 4777): Initialized EGL, version 1.4<br>D/OpenGLRenderer( 4777): Swap behavior 1<br>D/        ( 4777): HostConnection::get() New Host Connection established 0x7073cf2e5b00, tid 4831<br>W/OpenGLRenderer( 4777): Failed to choose config with EGL_SWAP_BEHAVIOR_PRESERVED, retrying without...<br>D/OpenGLRenderer( 4777): Swap behavior 0<br>D/EGL_emulation( 4777): eglCreateContext: 0x7073cf2a7600: maj 2 min 0 rcv 2<br>D/EGL_emulation( 4777): eglMakeCurrent: 0x7073cf2a7600: ver 2 0 (tinfo 0x7073b4be9300)<br>D/EGL_emulation( 4777): eglCreateContext: 0x7073cf3b10a0: maj 2 min 0 rcv 2<br>D/EGL_emulation( 4777): eglMakeCurrent: 0x7073cf3b10a0: ver 2 0 (tinfo 0x7073c2fe87c0)<br>Syncing files to device Android SDK built for x86 64...<br>D/EGL_emulation( 4777): eglMakeCurrent: 0x7073cf2a7600: ver 2 0 (tinfo 0x7073b4be9300)<br>D/        ( 4777): HostConnection::get() New Host Connection established 0x7073cf2e65e0, tid 4813<br>D/EGL_emulation( 4777): eglMakeCurrent: 0x7073cf3b10a0: ver 2 0 (tinfo 0x7073c560d6c0)<br></code></pre></td></tr></table></figure><h3 id="嘗試-hot-reload"><a class="header-anchor" href="#嘗試-hot-reload"></a>嘗試 hot reload</h3><p>修改一些內容並儲存，app 就會自動做 hot reload，就會很快地看到最新的更新。</p><h2 id="使用-VS-Code-開發"><a class="header-anchor" href="#使用-VS-Code-開發"></a>使用 VS Code 開發</h2><h3 id="建立新-app-v2"><a class="header-anchor" href="#建立新-app-v2"></a>建立新 app</h3><ol><li>按 <code>F1</code> 或 <code>ctrl + shift + p</code> 後，輸入 <strong>Flutter</strong> 並點選 <strong>Flutter: New Project</strong></li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-15-50.png" alt=""></p><ol start="2"><li>輸入專案名稱後，按 <code>enter</code> 鍵</li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-15-56.png" alt=""></p><ol start="3"><li>選擇專案目錄的儲存位置</li><li>等待專案建立完成，並在畫面顯示 <code>lib/main.dart</code> 檔案</li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-16-01.png" alt=""></p><h3 id="執行-app-v2"><a class="header-anchor" href="#執行-app-v2"></a>執行 app</h3><ol><li><p>從 VS Code 底部的藍色狀態欄中點選 <strong>Device Selector</strong></p><ul><li><p>若要使用實體裝置，詳情至 <a href="#%E8%A8%AD%E5%AE%9A%E4%BD%A0%E7%9A%84-Android-%E8%A3%9D%E7%BD%AE">設定你的 Android 裝置</a> 參考。若連結成功會在 VS Code 底部的藍色狀態欄中看到你的裝置名稱</p><p><img src="../images/flutter-install-on-windows/2018-10-23-07-16-14.png" alt=""></p></li><li><p>如果沒有可用的裝置，請點選 <strong>No Devices</strong> 並啟動模擬器</p><p><img src="../images/flutter-install-on-windows/2018-10-23-07-16-34.png" alt=""></p><p><img src="../images/flutter-install-on-windows/2018-10-23-07-16-41.png" alt=""></p></li></ul></li><li><p>執行 <strong>Debug</strong></p></li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-16-46.png" alt=""></p><ol start="3"><li>等待 App 執行，可在偵錯主控台 (Debug Console) 看到執行進度，稍後就會在模擬器或裝置上看到下圖的 app 畫面</li></ol><p><img src="../images/flutter-install-on-windows/2018-10-23-07-16-52.png" alt=""></p><h2 id="使用-Terminal-Editor-開發"><a class="header-anchor" href="#使用-Terminal-Editor-開發"></a>使用 Terminal + Editor 開發</h2><h3 id="建立新-app-v3"><a class="header-anchor" href="#建立新-app-v3"></a>建立新 app</h3><p>使用 <code>flutter create</code> 指令來建立 Flutter 專案，裡面包含 <a href="https://material.io/design/" target="_blank" rel="noopener">Material Components</a> 的範例 app。app 的程式碼在 <code>lib/main.dart</code>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> flutter create &lt;prject-name&gt;</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> &lt;prject-name&gt;</span><br></code></pre></td></tr></table></figure><h3 id="執行-app-v3"><a class="header-anchor" href="#執行-app-v3"></a>執行 app</h3><p>使用 <code>flutter devices</code> 指令可檢查是否有正在執行的模擬器或裝置。如果沒有可用的裝置，可至前面介紹的 <a href="#%E8%A8%AD%E5%AE%9A-Android-%E6%A8%A1%E6%93%AC%E5%99%A8-emulator">設定 Android 模擬器</a> 段落來新建模擬器。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> flutter devices</span><br>1 connected device:<br><br>Android SDK built for x86 64 • emulator-5554 • android-x64 • Android 8.0.0 (API 26) (emulator)<br></code></pre></td></tr></table></figure><p>使用 <code>flutter run</code> 指令可執行 app，並提供以下功能的快速鍵：</p><ul><li><code>r</code>：hot reload</li><li><code>R</code>：hot restart (and rebuild state)</li><li><code>h</code>：顯示更多幫助訊息</li><li><code>q</code>：停止執行</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> flutter run</span><br>Using hardware rendering with device Android SDK built for x86 64. If you get graphics artifacts, consider enabling software rendering with "--enable-software-rendering".<br>Launching lib/main.dart on Android SDK built for x86 64 in debug mode...<br>Initializing gradle...                                       1.7s<br>Resolving dependencies...                                   48.1s<br>Running 'gradlew assembleDebug'...                          88.5s<br>Built build\app\outputs\apk\debug\app-debug.apk.<br>Installing build\app\outputs\apk\app.apk...                 11.4s<br>Syncing files to device Android SDK built for x86 64...<br>D/        ( 5458): HostConnection::get() New Host Connection established 0x7073c31aabe0, tid 5513<br>D/EGL_emulation( 5458): eglMakeCurrent: 0x7073cf3b1280: ver 2 0 (tinfo 0x7073c2ab65c0)                                       12.3s<br><br>🔥  To hot reload changes while running, press "r". To hot restart (and rebuild state), press "R".<br>An Observatory debugger and profiler on Android SDK built for x86 64 is available at: http://127.0.0.1:2158/<br>For a more detailed help message, press "h". To quit, press "q".<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
          <category> Flutter </category>
          
          <category> Android </category>
          
          <category> Mobile App </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dart </tag>
            
            <tag> VS Code </tag>
            
            <tag> Android Studio </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 加入 Disqus 留言版 (包含留言數)</title>
      <link href="/article/hexo-disqus.html"/>
      <url>/article/hexo-disqus.html</url>
      
        <content type="html"><![CDATA[<p><img src="../images/cover/hexo-disqus.png" alt=""></p><p>Blog 最重要的是可以增進技術的交流，而交流就可以透過留言版來達成。大部分的 Blog 在每篇文章下面都會有留言板，而最常見的就是 Disqus 留言板，因此本篇會說明如何將 Disqus 留言板和各文章的留言數加入 Hexo 的主題中。</p><a id="more"></a><h2 id="申請網站留言版帳號"><a class="header-anchor" href="#申請網站留言版帳號"></a>申請網站留言版帳號</h2><p>至 <a href="https://disqus.com/" target="_blank" rel="noopener">Disqus</a> 首頁註冊帳號後並登入，接著點擊首頁的「GET STARTED」：</p><p><img src="../images/hexo-disqus/disqus-home-page.png" alt=""></p><p>選擇「I want to install Disqus on my site」選項：</p><p><img src="../images/hexo-disqus/disqus-on-my-site.png" alt=""></p><p>需要輸入的欄位：</p><ul><li>Websit Name：自訂 short name，且是唯一，像我是設定 titangene-blog。short name 會在設定 Hexo 時需要</li><li>Category：類別，自行選擇</li><li>Language：語言，自行選擇</li></ul><p>填寫後點擊「Create Site」：</p><p><img src="../images/hexo-disqus/disqus-create-a-new-site.png" alt=""></p><h2 id="設定-Hexo"><a class="header-anchor" href="#設定-Hexo"></a>設定 Hexo</h2><p>在 <a href="https://github.com/stkevintan/hexo-theme-material-flow" target="_blank" rel="noopener">material-flow</a> 主題內的 <code>_config.yml</code> 原有設定是使用 <code>disqus_shortname</code> 參數來設定 Disqus 的 short name：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">disqus_shortname:</span> <span class="hljs-string">your_disqus_short_name</span><br></code></pre></td></tr></table></figure><p>但我想在 blog 加上留言數，所以才將參數設定改成下面內容：</p><ul><li><code>enable</code>：設定 <code>true</code> 或 <code>false</code> 來決定是否要啟用 Disqus 的留言版功能</li><li><code>shortname</code>：設定你的 Disqus 的 short name</li><li><code>count</code>：設定 <code>true</code> 或 <code>false</code> 來決定是否要顯示文章的留言數</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Comments</span><br><span class="hljs-attr">disqus:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">shortname:</span> <span class="hljs-string">your_disqus_short_name</span><br>  <span class="hljs-attr">count:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>那接著就是將 Disqus 的留言版功能加入主題中，主要分成幾個步驟：</p><ol><li>加入 Disqus script</li><li>新增 Disqus 留言版</li><li>新增 Disqus 留言數</li></ol><p>如果在剛剛上面的 <code>count</code> 參數設定為 <code>false</code> 則可以跳過第三個步驟 <a href="#%E6%96%B0%E5%A2%9E-disqus-%E7%95%99%E8%A8%80%E6%95%B8">新增 Disqus 留言數</a>。</p><p>下面提供的程式碼可適用於 Hexo 的 <a href="https://github.com/stkevintan/hexo-theme-material-flow" target="_blank" rel="noopener">material-flow</a> 主題，HTML 結構可依各自使用的版型或需求來修改。若想直接看我設定的原始碼，可至此 Blog 的 GitHub Repo「<a href="https://github.com/titangene/hexo-blog/tree/master/themes/material-flow/layout" target="_blank" rel="noopener">titangene/hexo-blog</a>」查看。</p><h3 id="加入-Disqus-script"><a class="header-anchor" href="#加入-Disqus-script"></a>加入 Disqus script</h3><p>在 <code>themes\material-flow\layout\_partial\script\disqus.ejs</code> 檔案內加入以下程式碼，當頁面載入時，會以非同步的方式將 Disqus 的 script 加入 <code>&lt;head&gt;</code> 或 <code>&lt;body&gt;</code> 標籤中：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">if</span> (<span class="hljs-attr">config.disqus.enable</span>) &#123; %&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">if</span> (<span class="hljs-attr">page.comments</span>) &#123; %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><br><span class="actionscript">  <span class="hljs-keyword">var</span> disqus_shortname = <span class="hljs-string">'&lt;%= config.disqus.shortname %&gt;'</span>;</span><br><span class="actionscript">  <span class="hljs-keyword">var</span> disqus_config = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="actionscript">    <span class="hljs-keyword">this</span>.page.url = <span class="hljs-string">'&lt;%= page.permalink %&gt;'</span>;</span><br><span class="actionscript">    <span class="hljs-keyword">this</span>.page.identifier = <span class="hljs-string">'&lt;%= page.path %&gt;'</span>;</span><br><span class="actionscript">    <span class="hljs-keyword">this</span>.page.title = <span class="hljs-string">'&lt;%= page.title %&gt;'</span>;</span><br>  &#125;;<br><span class="actionscript">  (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="javascript">    <span class="hljs-keyword">var</span> dsq = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>);</span><br><span class="actionscript">    dsq.async = <span class="hljs-literal">true</span>;</span><br><span class="actionscript">    dsq.src = <span class="hljs-string">'//'</span> + disqus_shortname + <span class="hljs-string">'.disqus.com/embed.js'</span>;</span><br><span class="javascript">    dsq.setAttribute(<span class="hljs-string">'data-timestamp'</span>, <span class="hljs-string">''</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());</span><br><span class="javascript">    (<span class="hljs-built_in">document</span>.head || <span class="hljs-built_in">document</span>.body).appendChild(dsq);</span><br>  &#125;)();<br><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%</span> &#125; %&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">if</span> (<span class="hljs-attr">config.disqus.count</span>) &#123; %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span></span><br><span class="hljs-tag">  <span class="hljs-attr">id</span>=<span class="hljs-string">"dsq-count-scr"</span></span><br><span class="hljs-tag">  <span class="hljs-attr">src</span>=<span class="hljs-string">"https://&lt;%= config.disqus.shortname %&gt;.disqus.com/count.js"</span></span><br><span class="hljs-tag">  <span class="hljs-attr">async</span></span><br><span class="hljs-tag">&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%</span> &#125; %&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">%</span> &#125; %&gt;</span><br></code></pre></td></tr></table></figure><p>接著在 <code>themes\material-flow\layout\layout.ejs</code> 檔案內的 <code>&lt;body&gt;</code> 標籤中將剛剛新增的 <code>disqus.ejs</code> 載入：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">partial</span>('<span class="hljs-attr">script</span>/<span class="hljs-attr">disqus</span>') %&gt;</span><br></code></pre></td></tr></table></figure><h3 id="新增-Disqus-留言版"><a class="header-anchor" href="#新增-Disqus-留言版"></a>新增 Disqus 留言版</h3><p>在 <code>themes\material-flow\layout\_partial\article.ejs</code> 檔案內找到適當的位置加入以下程式碼，就可以在文章內新增 Disqus 留言版：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">if</span> (<span class="hljs-attr">post.comments</span> &amp;&amp; <span class="hljs-attr">config.disqus.enable</span>) &#123; %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"comments"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"comments"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>留言版<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"disqus_thread"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">noscript</span></span><br><span class="hljs-tag">      &gt;</span>Please enable JavaScript to view the<br>      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://disqus.com/?ref_noscript"</span>&gt;</span>comments powered by Disqus.<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span></span><br><span class="hljs-tag">    &gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%</span> &#125; %&gt;</span><br></code></pre></td></tr></table></figure><p>上面程式碼中最重要的是 <code>&lt;div id=&quot;disqus_thread&quot;&gt;</code> 這句，因為當頁面載入並將 Disqus 的 script 載入後，就會將此標籤內的內容取代成 Disqus 留言版，而 Disqus 留言版是使用 <code>&lt;iframe&gt;</code> 標籤的方式嵌入在頁面中：</p><p><img src="../images/hexo-disqus/disqus-comments-iframe.png" alt=""></p><h3 id="新增-Disqus-留言數"><a class="header-anchor" href="#新增-Disqus-留言數"></a>新增 Disqus 留言數</h3><p>在 <code>themes\material-flow\layout\_partial\article.ejs</code> 檔案內找到適當的位置加入以下程式碼，就可以在文章內新增 Disqus 留言數：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">if</span> (<span class="hljs-attr">post.comments</span> &amp;&amp; <span class="hljs-attr">config.disqus.enable</span> &amp;&amp; <span class="hljs-attr">config.disqus.count</span>) &#123; %&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"comments-count"</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"post-meta-item-icon"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-comment"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span></span><br><span class="hljs-tag">    <span class="hljs-attr">href</span>=<span class="hljs-string">"&lt;%- post.permalink %&gt;#disqus_thread"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">class</span>=<span class="hljs-string">"article-comment-count"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">data-disqus-identifier</span>=<span class="hljs-string">"&lt;%= post.path %&gt;"</span></span><br><span class="hljs-tag">    <span class="hljs-attr">itemprop</span>=<span class="hljs-string">"discussionUrl"</span></span><br><span class="hljs-tag">  &gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">%</span> &#125; %&gt;</span><br></code></pre></td></tr></table></figure><p>也可以在 <code>themes\material-flow\layout\_partial\post.ejs</code> 檔案內新增 Disqus 留言數，這樣就可以在首頁看到各文章的留言數。</p><p>上面程式碼中最重要的是 <code>&lt;a href=&quot;&lt;%- post.permalink %&gt;#disqus_thread&quot;...&gt;</code> 這句，因為在連結的最後加上 <code>#disqus_thread</code>，就代表要告訴 Disqus 要找哪個連結的留言數，並將留言數設為連結名稱 (例如：1 留言)。而 <code>data-disqus-identifier</code> 屬性需設為此頁面的識別名稱：</p><p><img src="../images/hexo-disqus/disqus-comments-count-link.png" alt=""></p><blockquote><p>可參考 Disqus 的 <a href="https://help.disqus.com/developer/javascript-configuration-variables" target="_blank" rel="noopener">JavaScript configuration variables | Disqus</a> 文件。</p></blockquote><p>若要設定顯示在頁面上的留言數文字，可至 Disqus 的「Setting &gt; Community &gt; Comment Count Link」內設定，可分別設定三種情況：</p><ul><li>0 則留言</li><li>1 則留言</li><li>多則留言：<code>{num}</code> 是作為留言數的變數</li></ul><p><img src="../images/hexo-disqus/disqus-setting.png" alt=""></p><h2 id="Demo"><a class="header-anchor" href="#Demo"></a>Demo</h2><p>設定後就可以看到每篇文章下面都可以留言囉！</p><p><img src="../images/hexo-disqus/disqus-hexo.png" alt=""></p><p>可在每篇文章看到留言數：</p><p><img src="../images/hexo-disqus/disqus-comment-count.png" alt=""></p><h2 id="參考來源"><a class="header-anchor" href="#參考來源"></a>參考來源</h2><ul><li><a href="https://disqus.com/admin/install/platforms/universalcode/" target="_blank" rel="noopener">Install instructions for Universal Code | Disqus</a></li><li><a href="https://help.disqus.com/developer/adding-comment-count-links-to-your-home-page" target="_blank" rel="noopener">Adding comment count links to your home page | Disqus</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Comment </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
