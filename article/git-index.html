<!DOCTYPE html><html><head><meta charset="utf-8"><title>深入 Git：index 檔案 | Titangene Blog</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="author" content="Titangene"><link rel="shortcut icon" href="/favicon.ico"><link rel="alternate" href="/atom.xml" title="Titangene Blog"><meta name="description" content="git add 會將檔案加入 index，究竟 index 到底存在哪？其實，通常會放在 .git&#x2F;index，本篇將深入探討此檔案式如何紀錄有哪些檔案被加入 index。"><meta property="og:type" content="article"><meta property="og:title" content="深入 Git：index 檔案"><meta property="og:url" content="https://titangene.github.io/article/git-index.html"><meta property="og:site_name" content="Titangene Blog"><meta property="og:description" content="git add 會將檔案加入 index，究竟 index 到底存在哪？其實，通常會放在 .git&#x2F;index，本篇將深入探討此檔案式如何紀錄有哪些檔案被加入 index。"><meta property="og:locale" content="zh_TW"><meta property="og:image" content="https://titangene.github.io/images/cover/git.jpg"><meta property="article:published_time" content="2020-03-08T15:56:40.000Z"><meta property="article:modified_time" content="2020-03-08T18:41:13.000Z"><meta property="article:author" content="Titangene"><meta property="article:tag" content="w3HexSchool"><meta property="article:tag" content="深入 Git"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://titangene.github.io/images/cover/git.jpg"><meta name="twitter:creator" content="@titangeneTW"><meta name="twitter:site" content="@titangene_blog"><meta property="fb:admins" content="100001106016019"><meta property="fb:app_id" content="2470546159839111"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name="google-site-verification" content="AaJ39L7h-nWwJjXJMhAMtXSF6H6BUgGWXC80kYvLic8"><link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><link rel="stylesheet" href="/style.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-129758206-1"></script><script>!function(a){function n(){dataLayer.push(arguments)}a.dataLayer=a.dataLayer||[],n("js",new Date),n("config","UA-129758206-1")}(window)</script><script>function setLoadingBarProgress(e){document.getElementById("loading-bar").style.width=e+"%"}</script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Titangene Blog" type="application/atom+xml"></head></html><body><div id="loading-bar-wrapper"><div id="loading-bar"></div></div><script>setLoadingBarProgress(20)</script><header class="l_header"><div class="wrapper"><div class="nav-main container container--flex"><a class="logo flat-box" href="/">Titangene Blog</a><div class="menu"><ul class="h-list"><li><a class="flat-box nav-home" href="/">Home</a></li><li><a class="flat-box nav-archives" href="/archives">Archives</a></li></ul><div class="underline"></div></div><div class="m_search"><form name="searchform" class="form u-search-form"><input type="text" class="input u-search-input" placeholder="Search"> <i class="fas fa-search"></i></form></div><ul class="switcher h-list"><li class="s-search"><a class="fas fa-search" href="javascript:void(0)"></a></li><li class="s-menu"><a class="fas fa-bars" href="javascript:void(0)"></a></li></ul></div><div class="nav-sub container container--flex"><a class="logo flat-box" href="/">Titangene Blog</a><ul class="switcher h-list"><li class="s-comment"><a class="far fa-comment-alt" href="javascript:void(0)"></a></li><li class="s-top"><a class="fas fa-arrow-up" href="javascript:void(0)"></a></li><li class="s-toc"><a class="fas fa-list-ol" href="javascript:void(0)"></a></li></ul></div></div></header><aside class="menu-phone"><nav><a href="/" class="nav-home nav">Home </a><a href="/archives" class="nav-archives nav">Archives</a></nav></aside><script>setLoadingBarProgress(40)</script><div class="l_body"><div class="container clearfix"><div class="l_main"><article id="post-git-index" class="post white-box article-type-post" itemscope itemprop="blogPost"><section class="meta"><h2 class="title"><a href="/article/git-index.html">深入 Git：index 檔案</a></h2><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar"></i> </span><span class="post-meta-item-text">發表於</span> <time title="建立時間：2020-03-08 23:56:40" itemprop="dateCreated datePublished" datetime="2020-03-08T23:56:40+08:00">2020-03-08 </time><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-calendar-check"></i> </span><span class="post-meta-item-text">更新於</span> <time title="修改時間：2020-03-09 02:41:13" itemprop="dateModified" datetime="2020-03-09T02:41:13+08:00">2020-03-09</time></span> <span class="comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fas fa-comment"></i> </span><a href="https://titangene.github.io/article/git-index.html#comments" class="article-comment-count">留言</a></span><div class="post-category"><span class="post-meta-item-icon"><i class="fa fa-folder"></i> </span><span class="post-meta-item-text">分類於</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/git/" itemprop="url" rel="index"><span itemprop="name">Git</span></a></span></div></section><section class="toc-wrapper"><h3>目錄</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#透過-git-ls-files-來認識-index"><span class="toc-text">透過 git ls-files 來認識 index</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#git-index-內部"><span class="toc-text">.git&#x2F;index 內部</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Header"><span class="toc-text">Header</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Index-Entry"><span class="toc-text">Index Entry</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#64-bit-ctime"><span class="toc-text">64-bit ctime</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#64-bit-mtime"><span class="toc-text">64-bit mtime</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32-bit-dev"><span class="toc-text">32-bit dev</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32-bit-ino"><span class="toc-text">32-bit ino</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32-bit-mode"><span class="toc-text">32-bit mode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32-bit-uid"><span class="toc-text">32-bit uid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32-bit-gid"><span class="toc-text">32-bit gid</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32-bit-file-size"><span class="toc-text">32-bit file size</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#160-bit-SHA-1-Object-ID"><span class="toc-text">160-bit SHA-1 Object ID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-bit-‘flags’-field"><span class="toc-text">16-bit ‘flags’ field</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-bit-field"><span class="toc-text">16-bit field</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#檔案路徑"><span class="toc-text">檔案路徑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-8-NUL-byte"><span class="toc-text">1-8 NUL byte</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Extensions"><span class="toc-text">Extensions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SHA-1-Index-Checksum"><span class="toc-text">SHA-1 Index Checksum</span></a></li></ol></li></ol></section><section class="article typo"><div class="article-entry" itemprop="articleBody"><p><img src="../images/cover/git.jpg" alt=""></p><p><code>git add</code> 會將檔案加入 index，究竟 index 到底存在哪？其實，通常會放在 <code>.git/index</code>，本篇將深入探討此檔案式如何紀錄有哪些檔案被加入 index。</p><a id="more"></a><p>index 是一個二進位檔案，通常放在 <code>.git/index</code>，其中包含路徑名稱的排序列表、每個路徑名稱的權限和 blob 物件的 SHA-1 值。而 <code>git ls-files</code> 指令可顯示 index 的內容。</p><h2 id="透過-git-ls-files-來認識-index"><a class="header-anchor" href="#透過-git-ls-files-來認識-index"></a>透過 <code>git ls-files</code> 來認識 index</h2><p>使用 <code>git ls-files</code> 底層指令來察看 index 檔案，但指令預設只會顯示有哪些檔名，所以加上一些選項：</p><ul><li><code>-c</code>，<code>--cached</code>：預設選項，只在輸出顯示已暫存的檔案</li><li><code>-s</code>，<code>--stage</code>：在輸出中顯示 stage 內容的 mode bit、物件名稱和 stage number</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git ls-files -s</span><br>100644 9015a7a32ca0681be64471d3ac2f8c1f24c1040d 0	index.html<br></code></pre></td></tr></table></figure><p>從上面輸出可得知：</p><ul><li><code>index.html</code> 的 file mode bits 為 <code>100644</code>，代表是 regular non-executable file</li><li><code>index.html</code> 的 blob 物件名稱為 <code>9015a7...</code></li><li>stage number 在合併衝突處理時會用到</li><li>檔案名稱</li></ul><p>file mode bits (6 位數) 是檔案權限的八進位表示法，也可以是以二進位的方式讀取。這邊的 <code>100644</code> ( <code>0b1000000110100100</code> ) 代表檔案是 regular non-executable file，檔案擁有者可以讀寫，檔案群組中的其他使用者可以讀取，而其他使用者也可以讀取。</p><p>這類似 Unix 的檔案屬性 <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>，用來表示該檔案的類型 (檔案、目錄、link) 和權限 (可讀、可寫、可執行)，以下是常見的 (用二進位和八進位表示) <sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup> <sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>：</p><ul><li><code>0100000000000000</code> ( <code>040000</code> )：Directory</li><li><code>1000000110100100</code> ( <code>100644</code> )：Regular non-executable file</li><li><code>1000000110110100</code> ( <code>100664</code> )：Regular non-executable group-writeable file</li><li><code>1000000111101101</code> ( <code>100755</code> )：Regular executable file</li><li><code>1010000000000000</code> ( <code>120000</code> )：Symbolic link</li><li><code>1110000000000000</code> ( <code>160000</code> )：Gitlink</li></ul><div class="info"><p>註：二進位表示法 <sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></p><ul><li>前 4-bit：物件 type<ul><li><code>1000</code>：regular file</li><li><code>1010</code>：symbolic link</li><li><code>1110</code>：gitlink</li></ul></li><li>中間 3-bit：沒有使用</li><li>後面 9-bit：unix 權限<ul><li>regular file 只能用 <code>0755</code> 和 <code>0644</code></li><li>symbolic link 和 gitlink 在此 field 中的值為 <code>0</code></li></ul></li></ul><p>blob 物件只對 <code>100644</code>、<code>100664</code> 和 <code>100755</code> 這三種 mode 有效。</p></div><p>在 <code>git add</code> 指令期間沒有真正使用不同的 stage number，用於處理合併衝突：</p><ul><li><code>0</code>：normal，無衝突，一切正常</li><li><code>1</code>：base，共同 ancestor 版本</li><li><code>2</code>：ours，目標 ( <code>HEAD</code> ) 版本</li><li><code>3</code>：theris，被合併的版本</li></ul><h2 id="git-index-內部"><a class="header-anchor" href="#git-index-內部"></a><code>.git/index</code> 內部</h2><p>對 Git index 檔案 <code>.git/index</code> 進行位元轉儲 (bits dump)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> xxd -b -c 4 .git/index</span><br>00000000: 01000100 01001001 01010010 01000011  DIRC<br>00000004: 00000000 00000000 00000000 00000010  ....<br>00000008: 00000000 00000000 00000000 00000001  ....<br>0000000c: 01011110 01011011 11000111 10010001  ^[..<br>00000010: 00101111 00001011 00100011 00101010  /.#*<br>00000014: 01011110 01011011 11000111 10010001  ^[..<br>00000018: 00100111 00101111 10101000 11100000  '/..<br>0000001c: 00000000 00000000 00001000 00000100  ....<br>00000020: 00000000 10111000 00001101 01001111  ...O<br>00000024: 00000000 00000000 10000001 10100100  ....<br>00000028: 00000000 00000000 00000011 11101000  ....<br>0000002c: 00000000 00000000 00000011 11101000  ....<br>00000030: 00000000 00000000 00000000 00001011  ....<br>00000034: 10111011 11011110 11111001 00101010  ...*<br>00000038: 11101111 00001111 11101100 11111000  ....<br>0000003c: 00100111 00000100 01110000 10100110  '.p.<br>00000040: 00011111 11101000 10010101 00101010  ...*<br>00000044: 01101010 11111101 01011011 10011010  j.[.<br>00000048: 00000000 00001010 01101001 01101110  ..in<br>0000004c: 01100100 01100101 01111000 00101110  dex.<br>00000050: 01101000 01110100 01101101 01101100  html<br>00000054: 00000000 00000000 00000000 00000000  ....<br>00000058: 00000000 00000000 00000000 00000000  ....<br>0000005c: 00101000 01000001 00101101 00100001  (A-!<br>00000060: 00011010 10000111 01011011 00010011  ..[.<br>00000064: 01101111 01010010 10010111 01110010  oR.r<br>00000068: 11001010 01001100 01110011 11110011  .Ls.<br>0000006c: 10110011 11001100 00110011 00001000  ..3.<br></code></pre></td></tr></table></figure><p>或以十六進位轉儲 (hex dump) 版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> xxd .git/index     </span><br>00000000: 4449 5243 0000 0002 0000 0001 5e5b c791  DIRC........^[..<br>00000010: 2f0b 232a 5e5b c791 272f a8e0 0000 0804  /.#*^[..'/......<br>00000020: 00b8 0d4f 0000 81a4 0000 03e8 0000 03e8  ...O............<br>00000030: 0000 000b bbde f92a ef0f ecf8 2704 70a6  .......*....'.p.<br>00000040: 1fe8 952a 6afd 5b9a 000a 696e 6465 782e  ...*j.[...index.<br>00000050: 6874 6d6c 0000 0000 0000 0000 2841 2d21  html........(A-!<br>00000060: 1a87 5b13 6f52 9772 ca4c 73f3 b3cc 3308  ..[.oR.r.Ls...3.<br></code></pre></td></tr></table></figure><p>index 檔案包含以下資訊：</p><ul><li>12-byte header</li><li>多個排序的 index entries</li><li>Extensions，它們通過簽名 (signature) 來識別</li><li>此 checksum 和之前的 index 檔案內容的 160-bit SHA-1</li></ul><h3 id="Header"><a class="header-anchor" href="#Header"></a>Header</h3><p>index 以 12-byte 的 header 開頭：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 4449 5243 0000 0002 0000 0001<br></code></pre></td></tr></table></figure><p>由代表 “DirCache” 的 4-btye 簽名 “DIRC” ( <code>0x44495243</code> ) 組成<br>4-byte 是 Git index 格式的當前版本號 “2” ( <code>0x00000002</code> )<br>32-bit 的 index entries “1” ( <code>0x00000001</code> )</p><h3 id="Index-Entry"><a class="header-anchor" href="#Index-Entry"></a>Index Entry</h3><p>在 <code>index.html</code> 此 index entry 中包括：</p><h4 id="64-bit-ctime"><a class="header-anchor" href="#64-bit-ctime"></a>64-bit ctime</h4><p>ctime 是 change time，也就是檔案的 metadata 在最後修改的時間</p><ul><li>前面 32-bit：ctime seconds</li><li>後面 32-bit：ctime nanosecond fractions</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 5e5b c791 2f0b 232a<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 的最後修改時間：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'ctime: %z (%Z)'</span> index.html</span><br>ctime: 2020-03-01 22:32:49.789259050 +0800 (1583073169)<br></code></pre></td></tr></table></figure><p>然後用下面指令驗證：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 1583073169</span><br><span class="hljs-meta">5e5bc791%</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 789259050</span><br><span class="hljs-meta">2f0b232a%</span><br></code></pre></td></tr></table></figure><h4 id="64-bit-mtime"><a class="header-anchor" href="#64-bit-mtime"></a>64-bit mtime</h4><p>mtime 是 modify time，也就是檔案的資料在最後修改的時間</p><ul><li>前面 32-bit：mtime seconds</li><li>後面 32-bit：mtime nanosecond fractions</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 5e5b c791 272f a8e0<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 的最後修改時間：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'mtime: %y (%Y)'</span> index.html</span><br>mtime: 2020-03-01 22:32:49.657434848 +0800 (1583073169)<br></code></pre></td></tr></table></figure><p>然後用下面指令驗證：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 1583073169</span><br><span class="hljs-meta">5e5bc791%</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 657434848</span><br><span class="hljs-meta">272fa8e0%</span><br></code></pre></td></tr></table></figure><h4 id="32-bit-dev"><a class="header-anchor" href="#32-bit-dev"></a>32-bit dev</h4><p>檔案所在的裝置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 0000 0804<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 檔案所在的裝置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'%D'</span> index.html</span><br>804<br></code></pre></td></tr></table></figure><h4 id="32-bit-ino"><a class="header-anchor" href="#32-bit-ino"></a>32-bit ino</h4><p>檔案 inode number：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 00b8 0d4f<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 檔案所在的裝置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'%i'</span> index.html</span><br>12062031<br></code></pre></td></tr></table></figure><p>然後用下面指令驗證：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 12062031</span><br><span class="hljs-meta">b80d4f%</span><br></code></pre></td></tr></table></figure><h4 id="32-bit-mode"><a class="header-anchor" href="#32-bit-mode"></a>32-bit mode</h4><p>檔案權限以十六進位表示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 0000 81a4<br>bin: 00000000 00000000 10000001 10100100<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 檔案的權限：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'%f'</span> index.html</span><br>81a4<br></code></pre></td></tr></table></figure><h4 id="32-bit-uid"><a class="header-anchor" href="#32-bit-uid"></a>32-bit uid</h4><p>當前使用者的 user identifier</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 0000 03e8<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 檔案的 uid：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'%u'</span> index.html</span><br>1000<br></code></pre></td></tr></table></figure><p>然後用下面指令驗證：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 1000</span><br><span class="hljs-meta">3e8%</span><br></code></pre></td></tr></table></figure><h4 id="32-bit-gid"><a class="header-anchor" href="#32-bit-gid"></a>32-bit gid</h4><p>當前使用者的 group identifier</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 0000 03e8<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 檔案的 gid：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'%g'</span> index.html</span><br>1000<br></code></pre></td></tr></table></figure><p>然後用下面指令驗證：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 1000</span><br><span class="hljs-meta">3e8%</span><br></code></pre></td></tr></table></figure><h4 id="32-bit-file-size"><a class="header-anchor" href="#32-bit-file-size"></a>32-bit file size</h4><p>檔案大小</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 0000 000b<br></code></pre></td></tr></table></figure><p>可用 <code>stat</code> 指令來取得 <code>index.html</code> 檔案的大小：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">stat</span> -c <span class="hljs-string">'%s'</span> index.html</span><br>11<br></code></pre></td></tr></table></figure><p>然後用下面指令驗證：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'%x'</span> 11</span><br><span class="hljs-meta">b%</span><br></code></pre></td></tr></table></figure><h4 id="160-bit-SHA-1-Object-ID"><a class="header-anchor" href="#160-bit-SHA-1-Object-ID"></a>160-bit SHA-1 Object ID</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: bbde f92a ef0f ecf8 2704<br>     70a6 1fe8 952a 6afd 5b9a<br></code></pre></td></tr></table></figure><p>可用 <code>git hash-object</code> 指令來取得 <code>index.html</code> 檔案的 blob 物件 ID：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">hash</span>-object index.html</span><br>bbdef92aef0fecf8270470a61fe8952a6afd5b9a<br></code></pre></td></tr></table></figure><h4 id="16-bit-‘flags’-field"><a class="header-anchor" href="#16-bit-‘flags’-field"></a>16-bit ‘flags’ field</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 000a<br></code></pre></td></tr></table></figure><p>分為：</p><ul><li>1-bit：assume-valid flag</li><li>1-bit：extended flag (在版本 2 中必須為零)</li><li>2-bit：stage (合併期間)</li><li>如果 length 小於 0xFFF，則為 12-bit name length；否則，將 0xFFF 儲存在此 field 中</li></ul><h4 id="16-bit-field"><a class="header-anchor" href="#16-bit-field"></a>16-bit field</h4><p>(版本 3 或更新版) 當前面的 16-bit field 的 “extended flag” 為 1 時適用</p><ul><li>1-bit：為未來保留</li><li>1-bit：skip-worktree flag (用於 sparse checkout)</li><li>1-bit：intent-to-add flag (用於 <code>git add -N</code> )</li><li>13-bit：未使用，必須為零</li></ul><p>忽略此部份，因為我目前使用的 Git 的版本為 2：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git --version</span><br>git version 2.17.1<br></code></pre></td></tr></table></figure><h4 id="檔案路徑"><a class="header-anchor" href="#檔案路徑"></a>檔案路徑</h4><ul><li>相對於 top level 目錄 (不包含斜線) 的 entry 路徑名稱 (可變長度)</li><li><code>/</code> 作為路徑分隔字元</li><li>不允許使用特殊路徑元件 <code>.</code>、<code>..</code> 和 <code>.git</code></li><li>不允許使用斜線</li><li>確切的編碼不確定，但 <code>.</code> 和 <code>/</code> 字元會以 7-bit ASCII 編碼，並且編碼不能包含 NUL byte (UNIX 路徑名稱)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 696e 6465 782e 6874 6d6c<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">printf</span> <span class="hljs-string">'index.html'</span> | xxd</span><br>00000000: 696e 6465 782e 6874 6d6c                 index.html<br></code></pre></td></tr></table></figure><h4 id="1-8-NUL-byte"><a class="header-anchor" href="#1-8-NUL-byte"></a>1-8 NUL byte</h4><p>使用 1-8 NUL byte 將 entry 填充為 8 byte 的倍數，同時保持名稱 NUL-terminated</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 0000 0000 0000 0000<br></code></pre></td></tr></table></figure><h3 id="Extensions"><a class="header-anchor" href="#Extensions"></a>Extensions</h3><p>忽略此部份，因本範例的 index 無 extensions。</p><h3 id="SHA-1-Index-Checksum"><a class="header-anchor" href="#SHA-1-Index-Checksum"></a>SHA-1 Index Checksum</h3><p>在 index 檔案內容的最後 160-bit 是 index checksum，是由這 160-bit 之前的 index 檔案內容透過 SHA-1 計算的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">hex: 2841 2d21 1a87 5b13 6f52<br>     9772 ca4c 73f3 b3cc 3308<br></code></pre></td></tr></table></figure><p>用下面指令驗證：</p><ul><li><code>head -c</code>：列印檔案的前幾個 byte</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat .git/index | head -c92 | sha1sum </span><br>28412d211a875b136f529772ca4c73f3b3cc3308  -<br></code></pre></td></tr></table></figure><p>如果 index 損壞，就能透過此 SHA-1 Index Checksum 來確認，並會說明 index 檔案已損壞：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git status</span><br>error: bad index file sha1 signature<br>fatal: index file corrupt<br></code></pre></td></tr></table></figure><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="http://linux.vbird.org/linux_basic/0210filepermission.php#filepermission_perm" target="_blank" rel="noopener">鳥哥的 Linux 私房菜 – 第五章、Linux 的檔案權限與目錄配置</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><a href="https://stackoverflow.com/questions/737673/how-to-read-the-mode-field-of-git-ls-trees-output" target="_blank" rel="noopener">file permissions - How to read the mode field of git-ls-tree’s output - Stack Overflow</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><a href="https://github.com/doggy8088/Learn-Git-in-30-days/blob/master/zh-tw/09.md" target="_blank" rel="noopener">30 天精通 Git 版本控管 第 09 天：比對檔案與版本差異 by 保哥</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p><a href="https://github.com/git/git/blob/master/Documentation/technical/index-format.txt#L63" target="_blank" rel="noopener">git/index-format.txt at master · git/git</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p></li></ol></section></div><div class="article-tags tags"><a href="/tags/w3hexschool/" title="w3HexSchool">w3HexSchool</a> <a href="/tags/%E6%B7%B1%E5%85%A5-git/" title="深入 Git">深入 Git</a></div></section><div class="article-share-links"><span>分享：</span> <a class="fab fa-facebook-f" title="Facebook" target="_blank" href="javascript:window.open('https://www.facebook.com/sharer.php?u=https%3A%2F%2Ftitangene.github.io%2Farticle%2Fgit-index.html', 'Share on Facebook','width=600, height=600')"></a> <a class="fab fa-twitter" title="Twitter" target="_blank" href="javascript:window.open('https://twitter.com/share?url=https%3A%2F%2Ftitangene.github.io%2Farticle%2Fgit-index.html&amp;text=深入 Git：index 檔案&amp;hashtags=w3HexSchool,深入Git&amp;via=titangene_blog', 'Share on Twitter','width=600, height=260')"></a> <a class="fab fa-linkedin-in" title="Linkedin" target="_blank" href="javascript:window.open('https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Ftitangene.github.io%2Farticle%2Fgit-index.html&amp;title=深入 Git：index 檔案', 'Share on Linkedin','width=600, height=600')"></a> <a class="fab fa-facebook-messenger" title="Facebook Messenger" target="_blank" href="javascript:window.open('http://www.facebook.com/dialog/send?app_id=2470546159839111&amp;link=https%3A%2F%2Ftitangene.github.io%2Farticle%2Fgit-index.html&amp;display=popup&amp;redirect_uri=https%3A%2F%2Fwww.facebook.com%2Fdialog%2Freturn%2Fclose%23_%3D_', 'Send in Messenger','width=600, height=600')"></a> <a class="fab fa-telegram-plane" href="https://telegram.me/share/url?url=https%3A%2F%2Ftitangene.github.io%2Farticle%2Fgit-index.html&text=深入 Git：index 檔案" target="_blank"></a></div><nav id="article-nav"><a href="/article/git-tree-object.html" id="article-nav-prev" class="article-nav-link-wrap" title="深入 Git：Git 物件儲存 - tree 物件" rel="prev"><strong class="article-nav-caption">Prev</strong><p class="article-nav-title">深入 Git：Git 物件儲存 - tree 物件</p><i class="fas fa-angle-left"></i> </a><a href="/article/git-commit-object.html" id="article-nav-next" class="article-nav-link-wrap" title="深入 Git：Git 物件儲存 - commit 物件" rel="next"><strong class="article-nav-caption">Next</strong><p class="article-nav-title">深入 Git：Git 物件儲存 - commit 物件</p><i class="fas fa-angle-right"></i></a></nav><section id="list_related_posts"><h2>相關文章</h2><ul class="related-posts"><li class="related-posts-item"><a class="related-posts-link" href="/article/git-tag-object.html">深入 Git：Git 物件儲存 - tag 物件</a><div class="related-posts-item-abstract">本篇將深入探討 Git tag 是什麼？如何建立 tag？Git 是如何儲存 tag？與 commit 和分支的差別在哪？Git tagGit tag 常用於標記某個版本號碼，例如：v0.5、v1.0.1、9.1.0-r</div></li><li class="related-posts-item"><a class="related-posts-link" href="/article/git-commit-object.html">深入 Git：Git 物件儲存 - commit 物件</a><div class="related-posts-item-abstract">本篇將深入探討 Git 如何運作，在執行 git commit 時，Git 會如何建立和儲存 commit 物件。tree 物件會指向追蹤專案的不同 snapshot，若要取得這些 snapshot 就會遇到一些問題：必</div></li><li class="related-posts-item"><a class="related-posts-link" href="/article/git-tree-object.html">深入 Git：Git 物件儲存 - tree 物件</a><div class="related-posts-item-abstract">本篇將深入探討 Git 如何運作，Git 是如何建立和儲存 tree 物件。之前講到 blob 物件是由檔案內容來產生的，那 Git 是如何知道這些檔案內容是分別存在哪個目錄內的檔案名稱中？目錄名稱和檔案名稱就是由 tr</div></li><li class="related-posts-item"><a class="related-posts-link" href="/article/git-branch-ref.html">深入 Git：分支 refs</a><div class="related-posts-item-abstract">本篇將深入探討 Git 分支到底是什麼？建立分支時到底建立了什麼？如何紀錄分支要指向哪個 commit？Git 參考 (references 或 refs) 都存在 .git/refs 目錄內，目錄結構如下：123456</div></li><li class="related-posts-item"><a class="related-posts-link" href="/article/git--blob-object.html">深入 Git：Git 物件儲存 - blob 物件</a><div class="related-posts-item-abstract">本篇將深入探討 Git 如何運作，在執行 git add 將檔案加入 index 時，Git 會如何建立和儲存 blob 物件。Git 是一個 content-addressable (按內容定址，按檔案內容定位) 的檔</div></li><li class="related-posts-item"><a class="related-posts-link" href="/article/git-detached-head.html">淺入 Git：detached HEAD</a><div class="related-posts-item-abstract">在 Git 的世界中，想回到過去，也許你會用 git checkout 跳至某個過去的 commit，但 Git 會提醒你正在「detached HEAD」狀態。那 detached HEAD 是什麼？它能做什麼？要怎麼</div></li></ul></section><section class="comments" id="comments"><h2>討論區</h2><div id="gitalk-container"></div><div id="disqus_thread" style="margin-top:20px"><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript></div></section></article><script>window.subData={title:"深入 Git：index 檔案",tools:!0}</script></div><aside class="l_side"><section class="m_widget about"><div class="avatar-section"><style>.avatar-cover{background:url(/images/avatar_cover.jpg) 0 10%/cover no-repeat}</style><div class="avatar-cover"></div><img class="avatar" src="/images/avatar.jpg"></div><div class="header">Titangene</div><div class="content"><div class="desc">利用 blog 紀錄學習歷程</div></div><div class="content"><meta itemprop="url" content="https://titangene.github.io"><div class="social-wrapper"><a itemprop="sameAs" href="https://github.com/titangene" class="social github" target="_blank" rel="external"><span class="fab fa-github-alt"></span> </a><a itemprop="sameAs" href="https://www.facebook.com/titangene.tw" class="social facebook" target="_blank" rel="external"><span class="fab fa-facebook-square"></span> </a><a itemprop="sameAs" href="https://www.instagram.com/titangene/" class="social instagram" target="_blank" rel="external"><span class="fab fa-instagram"></span> </a><a itemprop="sameAs" href="https://www.flickr.com/photos/titangene" class="social flickr" target="_blank" rel="external"><span class="fab fa-flickr"></span> </a><a itemprop="sameAs" href="/atom.xml" class="social rss" target="_blank" rel="external"><span class="fas fa-rss"></span></a></div></div></section><section class="m_widget facebook_page"><div class="fb-page" data-href="https://www.facebook.com/titangene.blog/" data-width="250" data-small-header="false" data-adapt-container-width="false" data-hide-cover="false" data-show-facepile="true"><blockquote cite="https://www.facebook.com/titangene.blog/" class="fb-xfbml-parse-ignore"><p><a href="https://www.facebook.com/titangene.blog/" class="social facebook" target="_blank"><span class="fab fa-facebook-square"></span></a></p><p><a href="https://www.facebook.com/titangene.blog/" target="_blank" rel="noopener">Titangene Blog</a></p><p>Loading...</p></blockquote></div></section><section class="m_widget recent"><div class="header">Recents</div><div class="content"><ul class="entry"><li><a itemprop="url" class="flat-box" href="/article/jest-timer-mocks.html"><time>2020-07-19</time><div class="name">Jest：Timer Mocks</div></a></li><li><a itemprop="url" class="flat-box" href="/article/jest-snapshot-testing.html"><time>2020-07-12</time><div class="name">Jest：Snapshot 測試</div></a></li><li><a itemprop="url" class="flat-box" href="/article/jest-mock-function.html"><time>2020-07-05</time><div class="name">Jest：Mock 函數</div></a></li><li><a itemprop="url" class="flat-box" href="/article/jest-async-test.html"><time>2020-06-28</time><div class="name">Jest：非同步測試</div></a></li><li><a itemprop="url" class="flat-box" href="/article/jest-setup-teardown.html"><time>2020-06-21</time><div class="name">Jest：Setup &amp; Teardown</div></a></li><li><a itemprop="url" class="flat-box" href="/article/jest-describe-test-case.html"><time>2020-06-14</time><div class="name">Jest：Describe &amp; Test case</div></a></li><li><a itemprop="url" class="flat-box" href="/article/jest-matcher-assertion.html"><time>2020-06-07</time><div class="name">Jest：Matcher &amp; Assertion</div></a></li></ul></div></section></aside><script>setLoadingBarProgress(60)</script></div></div><footer id="footer" class="clearfix"><div class="social-wrapper"><a href="https://github.com/titangene" class="social github" target="_blank" rel="external"><span class="fab fa-github-alt"></span> </a><a href="https://www.facebook.com/titangene.tw" class="social facebook" target="_blank" rel="external"><span class="fab fa-facebook-square"></span> </a><a href="https://www.instagram.com/titangene/" class="social instagram" target="_blank" rel="external"><span class="fab fa-instagram"></span> </a><a href="https://www.flickr.com/photos/titangene" class="social flickr" target="_blank" rel="external"><span class="fab fa-flickr"></span> </a><a href="/atom.xml" class="social rss" target="_blank" rel="external"><span class="fas fa-rss"></span></a></div><div>© 2018 - 2020 <span itemprop="copyrightHolder">Titangene</span></div><div>Powered by <a href="https://hexo.io/" target="_blank" class="codename" rel="external noopener">Hexo</a> - Theme <a href="https://github.com/stkevintan/hexo-theme-material-flow" target="_blank" class="codename" rel="external noopener">MaterialFlow</a></div><div><a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="external noopener"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"></a></div></footer><script>setLoadingBarProgress(80)</script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/jquery.fitvids.js"></script><script>var SEARCH_SERVICE="hexo",ROOT="/";ROOT.endsWith("/")||(ROOT+="/")</script><script src="/js/search.js"></script><script src="/js/app.js"></script><script src="/js/clipboard-use.js"></script><script type="text/javascript">var gitalk=new Gitalk({clientID:"dd1684f31ee17e25c22b",clientSecret:"4b51bb4a5996b04d58821a6e3da8558f23da4cdf",id:window.location.pathname,repo:"hexo-blog",owner:"titangene",admin:"titangene",distractionFreeMode:"true"});gitalk.render("gitalk-container")</script><script>var disqus_shortname="titangene-blog",disqus_config=function(){this.page.url="https://titangene.github.io/article/git-index.html",this.page.identifier="article/git-index.html",this.page.title="深入 Git：index 檔案"};!function(){var t=document.createElement("script");t.async=!0,t.src="//"+disqus_shortname+".disqus.com/embed.js",t.setAttribute("data-timestamp",""+new Date),(document.head||document.body).appendChild(t)}()</script><script id="dsq-count-scr" src="https://titangene-blog.disqus.com/count.js" async></script><div id="fb-root"></div><script>window.fbAsyncInit=function(){FB.init({appId:"2470546159839111",autoLogAppEvents:!0,xfbml:!0,version:"v2.11"}),FB.AppEvents.logPageView()},function(e,n,t){var o,s=e.getElementsByTagName(n)[0];e.getElementById(t)||((o=e.createElement(n)).id=t,o.src="//connect.facebook.net/zh_TW/sdk.js",s.parentNode.insertBefore(o,s))}(document,"script","facebook-jssdk")</script><script>setLoadingBarProgress(100)</script></body>